<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="description" content="A size-optimized, customizable and highly extensible MCU-class 32-bit RISC-V soft-core CPU and microcontroller-like SoC written in platform-independent VHDL.">
<meta name="keywords" content="neorv32, risc-v, fpga, soft-core, microcontroller, cpu, soc, processor, asip">
<link rel="icon" type="image/png" href="img/icon.png">
<title>[Data Sheet] The NEORV32 RISC-V Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The NEORV32 RISC-V Processor - Data Sheet</h1>
<div class="details">
<span id="revnumber">version v1.12.8-r19-g31297d61</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_project_key_features">1.1. Project Key Features</a></li>
<li><a href="#_project_folder_structure">1.2. Project Folder Structure</a></li>
<li><a href="#_vhdl_file_hierarchy">1.3. VHDL File Hierarchy</a>
<ul class="sectlevel3">
<li><a href="#_file_list_files">1.3.1. File-List Files</a></li>
</ul>
</li>
<li><a href="#_vhdl_coding_style">1.4. VHDL Coding Style</a></li>
<li><a href="#_performance">1.5. Performance</a></li>
<li><a href="#_risc_v_compatibility">1.6. RISC-V Compatibility</a></li>
</ul>
</li>
<li><a href="#_neorv32_processor_soc">2. NEORV32 Processor (SoC)</a>
<ul class="sectlevel2">
<li><a href="#_processor_top_entity_signals">2.1. Processor Top Entity - Signals</a></li>
<li><a href="#_processor_top_entity_generics">2.2. Processor Top Entity - Generics</a></li>
<li><a href="#_processor_clocking">2.3. Processor Clocking</a>
<ul class="sectlevel3">
<li><a href="#_peripheral_clocks">2.3.1. Peripheral Clocks</a></li>
</ul>
</li>
<li><a href="#_processor_reset">2.4. Processor Reset</a></li>
<li><a href="#_processor_interrupts">2.5. Processor Interrupts</a>
<ul class="sectlevel3">
<li><a href="#_risc_v_standard_interrupts">2.5.1. RISC-V Standard Interrupts</a></li>
<li><a href="#_neorv32_specific_fast_interrupt_requests">2.5.2. NEORV32-Specific Fast Interrupt Requests</a></li>
</ul>
</li>
<li><a href="#_address_space">2.6. Address Space</a>
<ul class="sectlevel3">
<li><a href="#_bus_system">2.6.1. Bus System</a></li>
<li><a href="#_bus_gateway">2.6.2. Bus Gateway</a></li>
<li><a href="#_io_switch">2.6.3. IO Switch</a></li>
<li><a href="#_atomic_memory_operations_controller">2.6.4. Atomic Memory Operations Controller</a></li>
<li><a href="#_memory_coherence">2.6.5. Memory Coherence</a></li>
</ul>
</li>
<li><a href="#_boot_configuration">2.7. Boot Configuration</a>
<ul class="sectlevel3">
<li><a href="#_booting_via_bootloader">2.7.1. Booting via Bootloader</a></li>
<li><a href="#_boot_from_custom_address">2.7.2. Boot from Custom Address</a></li>
<li><a href="#_boot_imem_image">2.7.3. Boot IMEM Image</a></li>
</ul>
</li>
<li><a href="#_processor_internal_modules">2.8. Processor-Internal Modules</a>
<ul class="sectlevel3">
<li><a href="#_instruction_memory_imem">2.8.1. Instruction Memory (IMEM)</a></li>
<li><a href="#_data_memory_dmem">2.8.2. Data Memory (DMEM)</a></li>
<li><a href="#_bootloader_rom_bootrom">2.8.3. Bootloader ROM (BOOTROM)</a></li>
<li><a href="#_instruction_cache_icache">2.8.4. Instruction Cache (iCache)</a></li>
<li><a href="#_data_cache_dcache">2.8.5. Data Cache (dCache)</a></li>
<li><a href="#_direct_memory_access_controller_dma">2.8.6. Direct Memory Access Controller (DMA)</a></li>
<li><a href="#_processor_external_bus_interface_xbus">2.8.7. Processor-External Bus Interface (XBUS)</a></li>
<li><a href="#_stream_link_interface_slink">2.8.8. Stream Link Interface (SLINK)</a></li>
<li><a href="#_general_purpose_input_and_output_port_gpio">2.8.9. General Purpose Input and Output Port (GPIO)</a></li>
<li><a href="#_watchdog_timer_wdt">2.8.10. Watchdog Timer (WDT)</a></li>
<li><a href="#_core_local_interruptor_clint">2.8.11. Core-Local Interruptor (CLINT)</a></li>
<li><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.8.12. Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></li>
<li><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.8.13. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></li>
<li><a href="#_serial_peripheral_interface_controller_spi">2.8.14. Serial Peripheral Interface Controller (SPI)</a></li>
<li><a href="#_serial_data_interface_controller_sdi">2.8.15. Serial Data Interface Controller (SDI)</a></li>
<li><a href="#_two_wire_serial_interface_controller_twi">2.8.16. Two-Wire Serial Interface Controller (TWI)</a></li>
<li><a href="#_two_wire_serial_device_controller_twd">2.8.17. Two-Wire Serial Device Controller (TWD)</a></li>
<li><a href="#_one_wire_serial_interface_controller_onewire">2.8.18. One-Wire Serial Interface Controller (ONEWIRE)</a></li>
<li><a href="#_pulse_width_modulation_controller_pwm">2.8.19. Pulse-Width Modulation Controller (PWM)</a></li>
<li><a href="#_true_random_number_generator_trng">2.8.20. True Random-Number Generator (TRNG)</a></li>
<li><a href="#_custom_functions_subsystem_cfs">2.8.21. Custom Functions Subsystem (CFS)</a></li>
<li><a href="#_smart_led_interface_neoled">2.8.22. Smart LED Interface (NEOLED)</a></li>
<li><a href="#_general_purpose_timer_gptmr">2.8.23. General Purpose Timer (GPTMR)</a></li>
<li><a href="#_execution_trace_buffer_tracer">2.8.24. Execution Trace Buffer (TRACER)</a></li>
<li><a href="#_system_configuration_information_memory_sysinfo">2.8.25. System Configuration Information Memory (SYSINFO)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</a>
<ul class="sectlevel2">
<li><a href="#_cpu_top_entity_signals">3.1. CPU Top Entity - Signals</a></li>
<li><a href="#_cpu_top_entity_generics">3.2. CPU Top Entity - Generics</a></li>
<li><a href="#_architecture">3.3. Architecture</a>
<ul class="sectlevel3">
<li><a href="#_cpu_front_end">3.3.1. CPU Front-End</a></li>
<li><a href="#_cpu_back_end">3.3.2. CPU Back-End</a></li>
<li><a href="#_cpu_register_file">3.3.3. CPU Register File</a></li>
<li><a href="#_cpu_arithmetic_logic_unit">3.3.4. CPU Arithmetic Logic Unit</a></li>
<li><a href="#_cpu_loadstore_unit">3.3.5. CPU Load/Store Unit</a></li>
<li><a href="#_execution_trace_port">3.3.6. Execution Trace Port</a></li>
<li><a href="#_cpu_tuning_options">3.3.7. CPU Tuning Options</a></li>
<li><a href="#_sleep_mode">3.3.8. Sleep Mode</a></li>
<li><a href="#_full_virtualization">3.3.9. Full Virtualization</a></li>
</ul>
</li>
<li><a href="#_bus_interface">3.4. Bus Interface</a>
<ul class="sectlevel3">
<li><a href="#_bus_interface_protocol">3.4.1. Bus Interface Protocol</a></li>
<li><a href="#_locked_bus_accesses_and_bursts">3.4.2. Locked Bus Accesses and Bursts</a></li>
</ul>
</li>
<li><a href="#_instruction_sets_and_extensions">3.5. Instruction Sets and Extensions</a>
<ul class="sectlevel3">
<li><a href="#_latency_definitions">3.5.1. Latency Definitions</a></li>
<li><a href="#_a_isa_extension">3.5.2. <code>A</code> ISA Extension</a></li>
<li><a href="#_b_isa_extension">3.5.3. <code>B</code> ISA Extension</a></li>
<li><a href="#_c_isa_extension">3.5.4. <code>C</code> ISA Extension</a></li>
<li><a href="#_e_isa_extension">3.5.5. <code>E</code> ISA Extension</a></li>
<li><a href="#_i_isa_extension">3.5.6. <code>I</code> ISA Extension</a></li>
<li><a href="#_m_isa_extension">3.5.7. <code>M</code> ISA Extension</a></li>
<li><a href="#_u_isa_extension">3.5.8. <code>U</code> ISA Extension</a></li>
<li><a href="#_x_isa_extension">3.5.9. <code>X</code> ISA Extension</a></li>
<li><a href="#_zaamo_isa_extension">3.5.10. <code>Zaamo</code> ISA Extension</a></li>
<li><a href="#_zalrsc_isa_extension">3.5.11. <code>Zalrsc</code> ISA Extension</a></li>
<li><a href="#_zcb_isa_extension">3.5.12. <code>Zcb</code> ISA Extension</a></li>
<li><a href="#_zifencei_isa_extension">3.5.13. <code>Zifencei</code> ISA Extension</a></li>
<li><a href="#_zfinx_isa_extension">3.5.14. <code>Zfinx</code> ISA Extension</a></li>
<li><a href="#_zibi_isa_extension">3.5.15. <code>Zibi</code> ISA Extension</a></li>
<li><a href="#_zicntr_isa_extension">3.5.16. <code>Zicntr</code> ISA Extension</a></li>
<li><a href="#_zicond_isa_extension">3.5.17. <code>Zicond</code> ISA Extension</a></li>
<li><a href="#_zicsr_isa_extension">3.5.18. <code>Zicsr</code> ISA Extension</a></li>
<li><a href="#_zihpm_isa_extension">3.5.19. <code>Zihpm</code> ISA Extension</a></li>
<li><a href="#_zimop_isa_extension">3.5.20. <code>Zimop</code> ISA Extension</a></li>
<li><a href="#_zba_isa_extension">3.5.21. <code>Zba</code> ISA Extension</a></li>
<li><a href="#_zbb_isa_extension">3.5.22. <code>Zbb</code> ISA Extension</a></li>
<li><a href="#_zbs_isa_extension">3.5.23. <code>Zbs</code> ISA Extension</a></li>
<li><a href="#_zbkb_isa_extension">3.5.24. <code>Zbkb</code> ISA Extension</a></li>
<li><a href="#_zbkc_isa_extension">3.5.25. <code>Zbkc</code> ISA Extension</a></li>
<li><a href="#_zbkx_isa_extension">3.5.26. <code>Zbkx</code> ISA Extension</a></li>
<li><a href="#_zkn_isa_extension">3.5.27. <code>Zkn</code> ISA Extension</a></li>
<li><a href="#_zknd_isa_extension">3.5.28. <code>Zknd</code> ISA Extension</a></li>
<li><a href="#_zkne_isa_extension">3.5.29. <code>Zkne</code> ISA Extension</a></li>
<li><a href="#_zknh_isa_extension">3.5.30. <code>Zknh</code> ISA Extension</a></li>
<li><a href="#_zks_isa_extension">3.5.31. <code>Zks</code> ISA Extension</a></li>
<li><a href="#_zksed_isa_extension">3.5.32. <code>Zksed</code> ISA Extension</a></li>
<li><a href="#_zksh_isa_extension">3.5.33. <code>Zksh</code> ISA Extension</a></li>
<li><a href="#_zkt_isa_extension">3.5.34. <code>Zkt</code> ISA Extension</a></li>
<li><a href="#_zmmul_isa_extension">3.5.35. <code>Zmmul</code> - ISA Extension</a></li>
<li><a href="#_xcfu_isa_extension">3.5.36. <code>Xcfu</code> ISA Extension</a></li>
<li><a href="#_smpmp_isa_extension">3.5.37. <code>Smpmp</code> ISA Extension</a></li>
<li><a href="#_smcntrpmf_isa_extension">3.5.38. <code>Smcntrpmf</code> - ISA Extension</a></li>
<li><a href="#_sdext_isa_extension">3.5.39. <code>Sdext</code> ISA Extension</a></li>
<li><a href="#_sdtrig_isa_extension">3.5.40. <code>Sdtrig</code> ISA Extension</a></li>
</ul>
</li>
<li><a href="#_custom_functions_unit_cfu">3.6. Custom Functions Unit (CFU)</a>
<ul class="sectlevel3">
<li><a href="#_cfu_instruction_formats">3.6.1. CFU Instruction Formats</a></li>
<li><a href="#_using_custom_instructions_in_software">3.6.2. Using Custom Instructions in Software</a></li>
<li><a href="#_custom_instructions_hardware">3.6.3. Custom Instructions Hardware</a></li>
</ul>
</li>
<li><a href="#_control_and_status_registers_csrs">3.7. Control and Status Registers (CSRs)</a>
<ul class="sectlevel3">
<li><a href="#_floating_point_csrs">3.7.1. Floating-Point CSRs</a></li>
<li><a href="#_machine_trap_setup_csrs">3.7.2. Machine Trap Setup CSRs</a></li>
<li><a href="#_machine_trap_handling_csrs">3.7.3. Machine Trap Handling CSRs</a></li>
<li><a href="#_machine_configuration_csrs">3.7.4. Machine Configuration CSRs</a></li>
<li><a href="#_machine_physical_memory_protection_csrs">3.7.5. Machine Physical Memory Protection CSRs</a></li>
<li><a href="#_machine_counter_and_timer_csrs">3.7.6. (Machine) Counter and Timer CSRs</a></li>
<li><a href="#_hardware_performance_monitors_hpm_csrs">3.7.7. Hardware Performance Monitors (HPM) CSRs</a></li>
<li><a href="#_machine_counter_setup_csrs">3.7.8. Machine Counter Setup CSRs</a></li>
<li><a href="#_machine_information_csrs">3.7.9. Machine Information CSRs</a></li>
<li><a href="#_neorv32_specific_csrs">3.7.10. NEORV32-Specific CSRs</a></li>
</ul>
</li>
<li><a href="#_traps_exceptions_and_interrupts">3.8. Traps, Exceptions and Interrupts</a>
<ul class="sectlevel3">
<li><a href="#_memory_access_exceptions">3.8.1. Memory Access Exceptions</a></li>
<li><a href="#_nested_interrupts">3.8.2. Nested Interrupts</a></li>
<li><a href="#_custom_fast_interrupt_request_lines">3.8.3. Custom Fast Interrupt Request Lines</a></li>
<li><a href="#_neorv32_trap_listing">3.8.4. NEORV32 Trap Listing</a></li>
</ul>
</li>
<li><a href="#_dual_core_configuration">3.9. Dual-Core Configuration</a>
<ul class="sectlevel3">
<li><a href="#_dual_core_boot">3.9.1. Dual-Core Boot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_software_framework">4. Software Framework</a>
<ul class="sectlevel2">
<li><a href="#_compiler_toolchain">4.1. Compiler Toolchain</a></li>
<li><a href="#_core_libraries">4.2. Core Libraries</a></li>
<li><a href="#_system_view_description_file_svd">4.3. System View Description File (SVD)</a></li>
<li><a href="#_application_makefile">4.4. Application Makefile</a>
<ul class="sectlevel3">
<li><a href="#_makefile_targets">4.4.1. Makefile Targets</a></li>
<li><a href="#_default_compiler_flags">4.4.2. Default Compiler Flags</a></li>
</ul>
</li>
<li><a href="#_linker_script">4.5. Linker Script</a>
<ul class="sectlevel3">
<li><a href="#_ram_layout">4.5.1. RAM Layout</a></li>
<li><a href="#_rom_layout">4.5.2. ROM Layout</a></li>
</ul>
</li>
<li><a href="#_c_standard_library">4.6. C Standard Library</a></li>
<li><a href="#_start_up_code_crt0">4.7. Start-Up Code (crt0)</a></li>
<li><a href="#_executable_image_formats">4.8. Executable Image Formats</a></li>
<li><a href="#_bootloader">4.9. Bootloader</a>
<ul class="sectlevel3">
<li><a href="#_bootloader_console">4.9.1. Bootloader Console</a></li>
<li><a href="#_auto_boot_sequence">4.9.2. Auto Boot Sequence</a></li>
<li><a href="#_uploading_an_executable">4.9.3. Uploading an Executable</a></li>
<li><a href="#_programming_an_spi_twi_flash">4.9.4. Programming an SPI (/TWI) Flash</a></li>
<li><a href="#_booting_from_sd_card">4.9.5. Booting from SD Card</a></li>
<li><a href="#_customizing_the_internal_bootloader">4.9.6. Customizing the Internal Bootloader</a></li>
<li><a href="#_bootloader_error_codes">4.9.7. Bootloader Error Codes</a></li>
</ul>
</li>
<li><a href="#_neorv32_runtime_environment">4.10. NEORV32 Runtime Environment</a>
<ul class="sectlevel3">
<li><a href="#_rte_operation">4.10.1. RTE Operation</a></li>
<li><a href="#_using_the_rte">4.10.2. Using the RTE</a></li>
<li><a href="#_default_rte_trap_handlers">4.10.3. Default RTE Trap Handlers</a></li>
<li><a href="#_application_context_handling">4.10.4. Application Context Handling</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</a>
<ul class="sectlevel2">
<li><a href="#_openocd">5.1. openOCD</a></li>
<li><a href="#_semihosting">5.2. Semihosting</a></li>
<li><a href="#_debug_transport_module_dtm">5.3. Debug Transport Module (DTM)</a></li>
<li><a href="#_debug_module_dm">5.4. Debug Module (DM)</a>
<ul class="sectlevel3">
<li><a href="#_dm_registers">5.4.1. DM Registers</a></li>
<li><a href="#_dm_cpu_access">5.4.2. DM CPU Access</a></li>
</ul>
</li>
<li><a href="#_debug_authentication">5.5. Debug Authentication</a>
<ul class="sectlevel3">
<li><a href="#_default_authentication_mechanism">5.5.1. Default Authentication Mechanism</a></li>
</ul>
</li>
<li><a href="#_cpu_debug_mode">5.6. CPU Debug Mode</a>
<ul class="sectlevel3">
<li><a href="#_cpu_debug_mode_csrs">5.6.1. CPU Debug Mode CSRs</a></li>
</ul>
</li>
<li><a href="#_trigger_module">5.7. Trigger Module</a>
<ul class="sectlevel3">
<li><a href="#_trigger_module_csrs">5.7.1. Trigger Module CSRs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_legal">6. Legal</a>
<ul class="sectlevel2">
<li><a href="#_about">About</a></li>
<li><a href="#_license">License</a></li>
<li><a href="#_proprietary_notice">Proprietary Notice</a></li>
<li><a href="#_disclaimer">Disclaimer</a></li>
<li><a href="#_limitation_of_liability_for_external_links">Limitation of Liability for External Links</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://github.com/stnolting/neorv32"><img src="img/neorv32_logo_riscv.png" alt="neorv32 logo riscv"></a>
</div>
</div>
<div class="paragraph text-center">
<p><a href="https://github.com/stnolting/neorv32"><span class="image"><img src="https://img.shields.io/badge/GitHub-stnolting%2Fneorv32-ffbd00?style=flat&amp;logo=github&amp;" alt="GitHub stnolting%2Fneorv32 ffbd00?style=flat&amp;logo=github&amp;" title="homepage"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/download/nightly_release/NEORV32-nightly.pdf"><span class="image"><img src="https://img.shields.io/badge/Data%20Sheet-PDF-ffbd00?longCache=true&amp;style=flat&amp;logo=asciidoctor" alt="Data%20Sheet PDF ffbd00?longCache=true&amp;style=flat&amp;logo=asciidoctor" title="Data Sheet (pdf)"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/download/nightly_release/NEORV32_UserGuide-nightly.pdf"><span class="image"><img src="https://img.shields.io/badge/User%20Guide-PDF-ffbd00?longCache=true&amp;style=flat&amp;logo=asciidoctor" alt="User%20Guide PDF ffbd00?longCache=true&amp;style=flat&amp;logo=asciidoctor" title="User Guide (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32/ug"><span class="image"><img src="https://img.shields.io/badge/-HTML-ffbd00?longCache=true&amp;style=flat" alt=" HTML ffbd00?longCache=true&amp;style=flat" title="User Guide (html)"></span></a>
<a href="https://stnolting.github.io/neorv32/sw/files.html"><span class="image"><img src="https://img.shields.io/badge/SW_API-HTML-ffbd00?longCache=true&amp;style=flat&amp;logo=Doxygen" alt="SW API HTML ffbd00?longCache=true&amp;style=flat&amp;logo=Doxygen" title="doxygen"></span></a><br>
<a href="https://github.com/stnolting/neorv32/blob/main/LICENSE"><span class="image"><img src="https://img.shields.io/github/license/stnolting/neorv32?longCache=true&amp;style=flat&amp;logo=bsd&amp;" alt="neorv32?longCache=true&amp;style=flat&amp;logo=bsd&amp;" title="license"></span></a>
<a href="https://github.com/stnolting/neorv32/releases"><span class="image"><img src="https://img.shields.io/github/v/release/stnolting/neorv32?longCache=true&amp;style=flat&amp;logo=GitHub" alt="neorv32?longCache=true&amp;style=flat&amp;logo=GitHub" title="release"></span></a>
<a href="https://github.com/stnolting/neorv32/releases"><span class="image"><img src="https://img.shields.io/github/commits-since/stnolting/neorv32/latest?longCache=true&amp;style=flat&amp;logo=GitHub" alt="latest?longCache=true&amp;style=flat&amp;logo=GitHub" title="release-commits"></span></a></p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 RISC-V Processor is an open-source RISC-V compatible processor system that is intended as
<strong>ready-to-go</strong> auxiliary processor within a larger SoC designs or as stand-alone custom / customizable
microcontroller.</p>
</div>
<div class="paragraph">
<p>The system is highly configurable and provides optional common peripherals like embedded memories,
timers, serial interfaces, general purpose IO ports and an external bus interface to connect custom IP like
memories, NoCs and other peripherals. On-line and in-system debugging is supported by an OpenOCD/gdb
compatible on-chip debugger accessible via JTAG.</p>
</div>
<div class="paragraph">
<p>Special focus is paid on <strong>execution safety</strong> to provide defined and predictable behavior at any time.
Therefore, the CPU ensures that all memory access are acknowledged and no invalid/malformed instructions
are executed. Whenever an unexpected situation occurs, the application code is informed via hardware exceptions.</p>
</div>
<div class="paragraph">
<p>The software framework of the processor comes with application makefiles, software libraries for all CPU
and processor features, a bootloader, a runtime environment and several example programs - including a port
of the CoreMark MCU benchmark and the official RISC-V architecture test suite. RISC-V GCC is used as
default toolchain.</p>
</div>
<div class="paragraph">
<p>Check out the processor&#8217;s <strong><a href="https://stnolting.github.io/neorv32/ug">online User Guide</a></strong>
that provides hands-on tutorials to get you started.</p>
</div>
<div class="paragraph">
<p><strong>Structure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="#_neorv32_processor_soc">NEORV32 Processor (SoC)</a></p>
</li>
<li>
<p><a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a></p>
</li>
<li>
<p><a href="#_software_framework">Software Framework</a></p>
</li>
<li>
<p><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></p>
</li>
<li>
<p><a href="#_legal">Legal</a></p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_project_key_features">1.1. Project Key Features</h3>
<div class="paragraph">
<p><strong>Project</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>all-in-one package: <strong>CPU</strong> + <strong>SoC</strong> + <strong>Software Framework &amp; Tooling</strong></p>
</li>
<li>
<p>completely described in behavioral, platform-independent VHDL - no vendor- or technology-specific primitives, attributes, macros, libraries, etc. are used at all</p>
</li>
<li>
<p>all-Verilog "version" available (auto-generated by GHDL)</p>
</li>
<li>
<p>extensive configuration options for adapting the processor to the requirements of the application</p>
</li>
<li>
<p>highly extensible hardware - on CPU, SoC and system level</p>
</li>
<li>
<p>aims to be as small as possible while being as RISC-V-compliant as possible - with a reasonable area-vs-performance trade-off</p>
</li>
<li>
<p>FPGA friendly (e.g. all internal memories can be mapped to block RAM - including the register file)</p>
</li>
<li>
<p>optimized for high clock frequencies to ease timing closure and integration</p>
</li>
<li>
<p>from zero to <em>"hello world!"</em> - completely open source and documented</p>
</li>
<li>
<p>easy to use even for FPGA/RISC-V starters  intended to <em>work out of the box</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NEORV32 CPU (the core)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>32-bit RISC-V CPU</p>
</li>
<li>
<p>fully compatible to the RISC-V ISA specs. - checked by the official RISC-V architecture compatibility tests</p>
</li>
<li>
<p>base ISA + privileged ISA + several optional standard and custom ISA extensions</p>
</li>
<li>
<p>option to add user-defined RISC-V instructions as custom ISA extension</p>
</li>
<li>
<p>rich set of customization options (ISA extensions, design goal: performance / area / energy, tuning options, &#8230;&#8203;)</p>
</li>
<li>
<p><a href="#_full_virtualization">Full Virtualization</a> capabilities to increase execution safety</p>
</li>
<li>
<p>official RISC-V open source architecture ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NEORV32 Processor (the SoC)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>highly-configurable full-scale microcontroller-like processor system</p>
</li>
<li>
<p>based on the NEORV32 CPU</p>
</li>
<li>
<p>optional standard serial interfaces (UART, TWI, SPI (host and device), 1-Wire)</p>
</li>
<li>
<p>optional timers and counters (watchdog, system timer)</p>
</li>
<li>
<p>optional general purpose IO and PWM; a native NeoPixel(c)-compatible smart LED interface</p>
</li>
<li>
<p>optional embedded memories and caches for data, instructions and bootloader</p>
</li>
<li>
<p>optional external memory interface for custom connectivity</p>
</li>
<li>
<p>optional DMA controller for CPU-independent data transfers</p>
</li>
<li>
<p>on-chip debugger compatible with OpenOCD and GDB including hardware trigger module and optional authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Software framework</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>written in C and based on GCC</p>
</li>
<li>
<p>internal bootloader with serial user interface (via UART)</p>
</li>
<li>
<p>core libraries and HAL for high-level usage of the provided functions and peripherals</p>
</li>
<li>
<p>processor-specific runtime environment and several example programs</p>
</li>
<li>
<p>Doxygen-based documentation of the software framework; a deployed version is available at <a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a></p>
</li>
<li>
<p>Ada support at <a href="https://github.com/GNAT-Academic-Program/neorv32-hal" class="bare">https://github.com/GNAT-Academic-Program/neorv32-hal</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>OS Support</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>FreeRTOS port: <a href="https://github.com/stnolting/neorv32-freertos" class="bare">https://github.com/stnolting/neorv32-freertos</a></p>
</li>
<li>
<p>Upstream Zephyr support: <a href="https://docs.zephyrproject.org/latest/boards/others/neorv32/doc/index.html" class="bare">https://docs.zephyrproject.org/latest/boards/others/neorv32/doc/index.html</a></p>
</li>
<li>
<p>MicroPython port: <a href="https://github.com/stnolting/neorv32-micropython" class="bare">https://github.com/stnolting/neorv32-micropython</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Extensibility and Customization</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 processor is designed to ease customization and extensibility and provides several options for adding
application-specific custom hardware modules and accelerators. The three most common options for adding custom
on-chip modules are listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a> to attach processor-external IP modules (memories and peripherals)</p>
</li>
<li>
<p><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for tightly-coupled processor-internal co-processors</p>
</li>
<li>
<p><a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> for custom RISC-V instructions</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A more detailed comparison of the extension/customization options can be found in section
<a href="https://stnolting.github.io/neorv32/ug/#_adding_custom_hardware_modules">Adding Custom Hardware Modules</a>
of the user guide.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_project_folder_structure">1.2. Project Folder Structure</h3>
<div class="paragraph">
<p>The root directory of the repository is considered the NEORV32 base or home folder (i.e. <code>neorv32/</code>).</p>
</div>
<div class="literalblock">
<div class="title">Folder Structure</div>
<div class="content">
<pre>neorv32                   - Project home folder

 docs                   - Documentation
   datasheet           - AsciiDoc sources for the NEORV32 data sheet
   figures             - Figures and logos
   references          - Data sheets and RISC-V specs
   userguide           - AsciiDoc sources for the NEORV32 user guide

 rtl                    - HDL sources
   core                - Core sources of the CPU &amp; SoC
   system_integration  - System wrappers and bridges for advanced SoC connectivity
   test_setups         - Minimal test setup "SoCs" used in the User Guide
   verilog             - Scripts and examples for converting NEORV32 to Verilog

 sim                    - Simulation files

 sw                     - Software framework
    bootloader          - Sources of the default builtin bootloader
    common              - Linker script, crt0.S start-up code and central makefile
    example             - Example programs for the core and the SoC modules
      eclipse          - Pre-configured Eclipse IDE project
      ...              - Several example programs
    image_gen           - Helper program to generate executables &amp; memory images
    lib                 - NEORV32 core library
    ocd_firmware        - Firmware for the on-chip debugger "park loop"
    openocd             - OpenOCD configuration files
    riscv-arch-test     - Test RISC-V compatibility using the official test framework
    svd                 - Processor system view description file (CMSIS-SVD)</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_vhdl_file_hierarchy">1.3. VHDL File Hierarchy</h3>
<div class="paragraph">
<p>All required VHDL hardware source files are located in the project&#8217;s <code>rtl/core</code> folder.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">VHDL Library</div>
All core VHDL files from the list below have to be assigned to a <strong>new library</strong> named <code>neorv32</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Compilation Order</div>
See section <a href="#_file_list_files">File-List Files</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Replacing Modules for Customization or Optimization (Especially Memory Modules)</div>
Any module of the core can be replaced for customization purpose.
For ASIC implementations (and for some FPGA implementations), this is particularly recommended for
the underlying memories. Therefore, all (larger) memories are encapsulated as easily replaceable IP
wrappers (i.e. <code>*_ram.vhd</code> and <code>*_rom.vhd</code> files). By default, these wrappers use a generic memory
description that should infer blockRAM on most FPGA platforms.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="title">RTL File List (in alphabetical order)</div>
<div class="content">
<pre>rtl/core

 neorv32_bootrom.vhd           - Bootloader ROM
 neorv32_bootrom_image.vhd     - Bootloader ROM initialization image
 neorv32_bootrom_rom.vhd       - Bootloader ROM primitive wrapper
 neorv32_bus.vhd               - SoC bus infrastructure modules
 neorv32_cache.vhd             - Generic cache module
 neorv32_cache_ram.vhd         - Cache tag and data RAM primitive wrapper
 neorv32_cfs.vhd               - Custom functions subsystem
 neorv32_clint.vhd             - Core local interruptor
 neorv32_cpu.vhd               - NEORV32 CPU TOP ENTITY
 neorv32_cpu_alu.vhd           - Arithmetic/logic unit
 neorv32_cpu_control.vhd       - CPU control, exception system and CSRs
 neorv32_cpu_counters.vhd      - Hardware counters (Zicntr &amp; Zihpm ext.)
 neorv32_cpu_alu_bitmanip.vhd  - Bit-manipulation unit (B ext.)
 neorv32_cpu_alu_cfu.vhd       - Custom instructions unit (Xcfu ext.)
 neorv32_cpu_alu_cond.vhd      - Integer conditional unit (Zicond ext.)
 neorv32_cpu_alu_crypto.vhd    - Scalar cryptography unit (Zk*/Zbk* ext.)
 neorv32_cpu_alu_fpu.vhd       - Floating-point unit (Zfinx ext.)
 neorv32_cpu_alu_muldiv.vhd    - Integer MUL/DIV unit (M ext.)
 neorv32_cpu_alu_shifter.vhd   - Bit-shift unit (base ISA)
 neorv32_cpu_decompressor.vhd  - Compressed instructions decoder (C ext.)
 neorv32_cpu_frontend.vhd      - Instruction fetch and issue
 neorv32_cpu_hwtrig.vhd        - Hardware trigger module (Sdtrig ext.)
 neorv32_cpu_lsu.vhd           - Load/store unit
 neorv32_cpu_pmp.vhd           - Physical memory protection unit (Smpmp ext.)
 neorv32_cpu_regfile.vhd       - Data register file
 neorv32_cpu_trace.vhd         - Trace generator
 neorv32_debug_auth.vhd        - On-chip debugger: authentication module
 neorv32_debug_dm.vhd          - On-chip debugger: debug module
 neorv32_debug_dtm.vhd         - On-chip debugger: debug transfer module
 neorv32_dma.vhd               - Direct memory access controller
 neorv32_dmem.vhd              - Data memory
 neorv32_dmem_ram.vhd          - Data memory RAM primitive wrapper
 neorv32_gpio.vhd              - General purpose input/output port unit
 neorv32_gptmr.vhd             - General purpose 32-bit timer
 neorv32_imem.vhd              - Instruction memory
 neorv32_imem_image.vhd        - Instruction memory initialization image
 neorv32_imem_ram.vhd          - Instruction memory RAM primitive wrapper
 neorv32_imem_rom.vhd          - Instruction memory ROM primitive wrapper
 neorv32_neoled.vhd            - NeoPixel (TM) compatible smart LED interface
 neorv32_onewire.vhd           - One-Wire serial interface controller
 neorv32_package.vhd           - Main VHDL package file
 neorv32_prim.vhd              - Generic RTL primitives
 neorv32_pwm.vhd               - Pulse-width modulation controller
 neorv32_sdi.vhd               - Serial data interface controller (SPI device)
 neorv32_slink.vhd             - Stream link interface
 neorv32_spi.vhd               - Serial peripheral interface controller (SPI host)
 neorv32_sys.vhd               - System infrastructure modules
 neorv32_sysinfo.vhd           - System configuration information memory
 neorv32_top.vhd               - NEORV32 PROCESSOR/SOC TOP ENTITY
 neorv32_tracer.vhd            - Instruction trace buffer
 neorv32_trng.vhd              - True random number generator
 neorv32_twd.vhd               - Two wire serial device controller
 neorv32_twi.vhd               - Two wire serial interface controller
 neorv32_uart.vhd              - Universal async. receiver/transmitter
 neorv32_wdt.vhd               - Watchdog timer
 neorv32_xbus.vhd              - External bus interface gateway</pre>
</div>
</div>
<div class="sect3">
<h4 id="_file_list_files">1.3.1. File-List Files</h4>
<div class="paragraph">
<p>Most of the RTL sources use <strong>entity instantiation</strong>. Hence, the RTL compile order might be relevant (depending on
the synthesis/simulation tool. Therefore, two file-list files are provided in the <code>rtl</code> folder that list all required
HDL files for the CPU core and for the entire processor and also represent their recommended compile order. Note that
these files list the architecture "bottom-up" - the according top entity is listed in the very last line.
These file-list files can be consumed by EDA tools to simplify project setup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file_list_cpu.f</code> - HDL files and compile order for the CPU core; top module: <code>neorv32_cpu</code></p>
</li>
<li>
<p><code>file_list_soc.f</code> - HDL files and compile order for the entire processor/SoC; top module: <code>neorv32_top</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A simple bash script <code>generate_file_lists.sh</code> is provided for regenerating the file-lists (using GHDL&#8217;s <em>elaborate</em> command).
This script can also be invoked using the default application makefile (see <a href="#_makefile_targets">Makefile Targets</a>).</p>
</div>
<div class="paragraph">
<p>By default, the file-list files include a <strong>placeholder</strong> in the path of each included hardware source file.
These placeholders need to be replaced by the actual path before being used. Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>default: <code>NEORV32_RTL_PATH_PLACEHOLDER/core/neorv32_package.vhd</code></p>
</li>
<li>
<p>adjusted: <code>path/to/neorv32/rtl/core/neorv32_package.vhd</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 1. Example: Processing the File-List Files in a Makefile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-makefile hljs" data-lang="makefile">NEORV32_HOME = path/to/neorv32 <i class="conum" data-value="1"></i><b>(1)</b>
NEORV32_SOC_FILE = $(shell cat $(NEORV32_HOME)/rtl/file_list_soc.f) <i class="conum" data-value="2"></i><b>(2)</b>
NEORV32_SOC_SRCS = $(subst NEORV32_RTL_PATH_PLACEHOLDER, $(NEORV32_HOME)/rtl, $(NEORV32_SOC_FILE)) <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Path to the NEORV32 home folder (i.e. the root folder of the GitHub repository).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the content of the <code>file_list_soc.f</code> file-list into a new variable <code>NEORV32_SOC_FILE</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Substitute the file-list file&#8217;s path placeholder &#8220;NEORV32_RTL_PATH_PLACEHOLDER&#8221; by the actual path.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 2. Example: Processing the File-List Files in a TCL Script</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set file_list_file [read [open "$neorv32_home/rtl/file_list_soc.f" r]]
set file_list [string map [list "NEORV32_RTL_PATH_PLACEHOLDER" "$neorv32_home/rtl"] $file_list_file]
puts "NEORV32 source files:"
puts $file_list</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_vhdl_coding_style">1.4. VHDL Coding Style</h3>
<div class="ulist">
<ul>
<li>
<p>The entire processor, including the CPU core, is written in platform-/technology-independent VHDL.
The code makes minimal use of VHDL 2008 features in order to remain compatible with older EDA tools.</p>
</li>
<li>
<p>A specific VHDL library <code>neorv32</code> is used for all sources.</p>
</li>
<li>
<p>All registers / flip-flops provide an <em>asynchronous</em> reset (see <a href="#_processor_reset">Processor Reset</a>).</p>
</li>
<li>
<p>The entire setup uses a single clock domain. External "clock" signals are synchronized into this
clock domain using 2-stage shift registers.</p>
</li>
<li>
<p>A single package/library file (<code>neorv32_package.vhd</code>) is used to provide global definitions and auxiliary functions.
The user-defined configuration is done entirely via the generics of the top entity.</p>
</li>
<li>
<p>Internally, all generics are checked to ensure correct configuration.
Asserts are used to inform the user about the actual processor configuration and possible invalid settings.</p>
</li>
<li>
<p>The code uses entity instantiation for all internal modules. However, if multiple submodules are specified within the
same source file, component instantiation is used for them. * When instantiating the top-level processor module
(<code>neorv32_top.vhd</code>) in a user-defined design, either entity instantiation or component instantiation can be used,
as the NEORV32 package file/library file already provides a corresponding component declaration.</p>
</li>
<li>
<p>Larger memories (IMEM, DMEM, caches) are implemented as encapsulated wrappers, which are instantiated by component
instantiation. The interfaces of these blocks are static (fixed signal widths; not dependent on the configuration).
This means they can be easily replaced by corresponding Verilog IP wrappers (also via black-box instantiation and late binding).</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">All-Verilog Setup</div>
Scripts and instructions for an automatic to-Verilog conversion as well as an all-Verilog
setup that uses custom Verilog memory IPs can be found in <code>rtl/verilog</code>. See
<a href="https://stnolting.github.io/neorv32/ug/#_neorv32_in_verilog">UG: NEORV32 in Verilog</a>for more information.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_performance">1.5. Performance</h3>
<div class="paragraph">
<p><strong>Area Utilization</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 processor is optimized for minimal size. However, the actual size (silicon area or FPGA resources)
depends on the specific configuration. For example, an RTOS-capable setup based on a <code>rv32imc_Zicsr_Zicntr</code> CPU
configuration including peripheral and memories requires about 2300 LUTs and 1000 FFs and can run at up to 130 MHz
(implementation results for an Altera Cyclone IV E <code>EP4CE22F17C6</code> FPGA).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">NEORV32 Setups</div>
The processor has been successfully ported to AMD, Altera, Lattice, Microchip, Gowin, Cologne Chip
and NanoXplore FPGAs. Some pre-configured example setup are available online: <a href="https://github.com/stnolting/neorv32-setups" class="bare">https://github.com/stnolting/neorv32-setups</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Processing Speed</strong></p>
</div>
<div class="paragraph">
<p>The computational performance of the NEORV32 is evaluated using <a href="https://www.eembc.org/coremark/">Core Mark CPU benchmark</a>.
The according sources can be found in the <code>sw/example/coremark</code> folder.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. CoreMark results (<code>-O3</code> optimization)</caption>
<colgroup>
<col style="width: 62.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU</th>
<th class="tableblock halign-center valign-top">CoreMark Score</th>
<th class="tableblock halign-center valign-top">CoreMarks/MHz</th>
<th class="tableblock halign-center valign-top">Average CPI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>small</em> (<code>rv32i_Zicsr_Zifencei</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">33.89</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.3389</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>4.04</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>medium</em> (<code>rv32imc_Zicsr_Zifencei</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">62.50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.6250</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>5.34</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>performance</em> (<code>rv32imc_Zicsr_Zifencei</code> + perf. options)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95.23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.9523</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>3.54</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Performance can be further improved by enabling additional ISA extensions. Note that the compiler
also needs to support these extensions (make sure to use a <code>multilib</code> GCC configuration for optimal
code results).</p>
</div>
<div class="paragraph">
<p>The NEORV32 CPU is based on a multi-cycle architecture. Each instruction is executed in a sequence of
several consecutive micro operations. The average CPI (cycles per instruction) depends on the instruction
mix of a specific applications and also on the available CPU extensions, tuning options and memory latency.</p>
</div>
</div>
<div class="sect2">
<h3 id="_risc_v_compatibility">1.6. RISC-V Compatibility</h3>
<div class="paragraph">
<p>The NEORV32 CPU passes the official <strong>RISC-V Architecture Compatibility Tests</strong>. This framework is used to check
RISC-V implementations for compatibility to the official RISC-V user/privileged ISA specifications. The NEORV32 port
of this test framework is available in <code>sw/riscv-arch-test</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Unsupported ISA Extensions</div>
Executing instructions or accessing CSRs from unsupported ISA extensions will raise a precise illegal
instruction exception allowing full software emulation (see section <a href="#_full_virtualization">Full Virtualization</a>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_processor_soc">2. NEORV32 Processor (SoC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor provides a RISC-V-based full-scale microcontroller-like SoC platform
build around the <a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_processor.png" alt="neorv32 processor">
</div>
<div class="title">Figure 1. The NEORV32 Processor (Block Diagram)</div>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a> and <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a></p>
</li>
<li>
<p><a href="#_processor_clocking">Processor Clocking</a> and <a href="#_processor_reset">Processor Reset</a></p>
</li>
<li>
<p><a href="#_processor_interrupts">Processor Interrupts</a></p>
</li>
<li>
<p><a href="#_address_space">Address Space</a> and <a href="#_boot_configuration">Boot Configuration</a></p>
</li>
<li>
<p><a href="#_processor_internal_modules">Processor-Internal Modules</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>optional</em> SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a></p>
</li>
<li>
<p><em>optional</em> data and instruction memories (<a href="#_data_memory_dmem"><strong>DMEM</strong></a>/<a href="#_instruction_memory_imem"><strong>IMEM</strong></a>)</p>
</li>
<li>
<p><em>optional</em> caches (<a href="#_instruction_cache_icache"><strong>I-CACHE</strong></a>, <a href="#_data_cache_dcache"><strong>D-CACHE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> internal bootloader (<a href="#_bootloader_rom_bootrom"><strong>BOOTROM</strong></a>) with UART console &amp; SPI/TWI flash and SD card boot options</p>
</li>
<li>
<p><em>optional</em> RISC-V-compatible core local interruptor (<a href="#_core_local_interruptor_clint"><strong>CLINT</strong></a>)</p>
</li>
<li>
<p><em>optional</em> two independent universal asynchronous receivers and transmitters (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0"><strong>UART0</strong></a>,
<a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1"><strong>UART1</strong></a>) with optional hardware flow control (RTS/CTS)</p>
</li>
<li>
<p><em>optional</em> serial peripheral interface host controller (<a href="#_serial_peripheral_interface_controller_spi"><strong>SPI</strong></a>) with 8 dedicated CS lines</p>
</li>
<li>
<p><em>optional</em> 8-bit serial data device interface (<a href="#_serial_data_interface_controller_spi"><strong>SDI</strong></a>)</p>
</li>
<li>
<p><em>optional</em> two-wire serial interface controller (<a href="#_two_wire_serial_interface_controller_twi"><strong>TWI</strong></a>), compatible to the IC standard</p>
</li>
<li>
<p><em>optional</em> two-wire serial device controller (<a href="#_two_wire_serial_device_controller_twd"><strong>TWD</strong></a>), compatible to the IC standard</p>
</li>
<li>
<p><em>optional</em> general purpose parallel IO port (<a href="#_general_purpose_input_and_output_port_gpio"><strong>GPIO</strong></a>), 32 inputs (interrupt capable), 32 outputs</p>
</li>
<li>
<p><em>optional</em> 32-bit external bus interface, Wishbone-compatible (<a href="#_processor_external_bus_interface_xbus"><strong>XBUS</strong></a>), AXI4-compatible bridge available</p>
</li>
<li>
<p><em>optional</em> watchdog timer (<a href="#_watchdog_timer_wdt"><strong>WDT</strong></a>)</p>
</li>
<li>
<p><em>optional</em> PWM controller with up to 32 individual channels (<a href="#_pulse_width_modulation_controller_pwm"><strong>PWM</strong></a>)</p>
</li>
<li>
<p><em>optional</em> ring-oscillator-based true random number generator (<a href="#_true_random_number_generator_trng"><strong>TRNG</strong></a>)</p>
</li>
<li>
<p><em>optional</em> NeoPixel&#8482;/WS2812-compatible smart LED interface (<a href="#_smart_led_interface_neoled"><strong>NEOLED</strong></a>)</p>
</li>
<li>
<p><em>optional</em> custom functions subsystem for custom co-processor extensions (<a href="#_custom_functions_subsystem_cfs"><strong>CFS</strong></a>)</p>
</li>
<li>
<p><em>optional</em> general purpose 32-bit timer (<a href="#_general_purpose_timer_gptmr"><strong>GPTMR</strong></a>) with up to 16 individual timer slices</p>
</li>
<li>
<p><em>optional</em> 1-wire serial interface controller (<a href="#_one_wire_serial_interface_controller_onewire"><strong>ONEWIRE</strong></a>), compatible to the 1-wire standard</p>
</li>
<li>
<p><em>optional</em> autonomous direct memory access controller (<a href="#_direct_memory_access_controller_dma"><strong>DMA</strong></a>)</p>
</li>
<li>
<p><em>optional</em> stream link interface (<a href="#_stream_link_interface_slink"><strong>SLINK</strong></a>), AXI4-Stream-compatible</p>
</li>
<li>
<p><em>optional</em> on-chip debugger with JTAG TAP (<a href="#_on_chip_debugger_ocd"><strong>OCD</strong></a>), optional authentication and hardware breakpoint</p>
</li>
<li>
<p><em>optional</em> execution trace buffer to debug program flow (<a href="#_execution_trace_buffer_tracer"><strong>TRACER</strong></a>) via branch tracing</p>
</li>
<li>
<p><em>optional</em> RVFI-compatible <a href="#_execution_trace_port">Execution Trace Port</a> for advanced debugging, profiling and verification</p>
</li>
<li>
<p><em>optional</em> system configuration information memory to determine hardware configuration via software (<a href="#_system_configuration_information_memory_sysinfo"><strong>SYSINFO</strong></a>)</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_processor_top_entity_signals">2.1. Processor Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows the interface signals of the processor top entity (<code>rtl/core/neorv32_top.vhd</code>).
All signals are of type <code>std_ulogic</code> or <code>std_ulogic_vector</code>, respectively. Custom interface type are used only
for the <a href="#_execution_trace_port">Execution Trace Port</a> (<code>trace_*</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default Values of Inputs</div>
All input signals - except for clock and reset - provide default values in case they are not explicitly assigned
during instantiation. The weak driver strengths of VHDL (<code>'L'</code> and <code>'H'</code>) are used to model a pull-down or pull-up
resistor for these unconnected inputs. After synthesis, these will result in <code>0</code> or <code>1</code>, respectively.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Variable-Sized Ports</div>
Some peripherals allow to configure the number of channels to-be-implemented by a generic (for example the number
of PWM channels). The according input/output signals have a fixed sized regardless of the actually configured
amount of channels. If less than the maximum number of channels is configured, only the LSB-aligned channels are used:
in case of an <em>input port</em> the remaining bits/channels are left unconnected; in case of an <em>output port</em> the remaining
bits/channels are hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Tri-State Interfaces</div>
Some interfaces (like the TWI, the TWD and the 1-Wire bus) require explicit tri-state drivers in the final top module.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Input/Output Registers</div>
By default all output signals are driven by register and all input signals are synchronized into the processor&#8217;s
clock domain also using registers. However, for ASIC implementations it is recommended to add another register state
to all inputs and output so the synthesis tool can insert an explicit IO (boundary) scan chain.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 2. NEORV32 Processor Signal List</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>Global Control (<a href="#_processor_clocking">Processor Clocking</a> and <a href="#_processor_reset">Processor Reset</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global clock line, all registers triggering on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global reset, asynchronous, <strong>low-active</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_ocd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> reset output, synchronous, <strong>low-active</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_wdt_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a> reset output, synchronous, <strong>low-active</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_execution_trace_port">Execution Trace Port</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trace_cpu0_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU core 0 trace port (type <code>trace_port_t</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trace_cpu1_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU core 1 trace port (type <code>trace_port_t</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>JTAG Access Port for <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_adr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_cti_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycle type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_tag_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access tag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable ('0' = read transfer)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_sel_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_stb_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_cyc_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer acknowledge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer error</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_src_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX source routing information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_lst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX last element of stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dst_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX destination routing information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_lst_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX last element of stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel input (interrupt-capable)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rtsn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_ctsn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to start sending, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rtsn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_ctsn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to start sending, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_clk_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controller clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controller clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_csn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chip select, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_sda_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_sda_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_scl_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_scl_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire bus sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire bus output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulse-width modulated channels</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS input signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS output signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asynchronous serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_time_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLINT.MTIMER system time output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>RISC-V Machine-Mode <a href="#_processor_interrupts">Processor Interrupts</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_msi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (RISC-V), high-level-active; available only if CLINT is not enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_mti_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (RISC-V), high-level-active; available only if CLINT is not enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_mei_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (RISC-V), high-level-active</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_top_entity_generics">2.2. Processor Top Entity - Generics</h3>
<div class="paragraph">
<p>This section lists all configuration generics of the NEORV32 processor top entity (<code>rtl/neorv32_top.vhd</code>).
These generics allow to configure the system according to your needs. The generics are
used to control implementation of certain CPU extensions and peripheral modules and even allow to
optimize the system for certain design goals like minimal area or maximum performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default Values</div>
All configuration generics provide default values in case they are not explicitly assigned during instantiation.
By default, all configuration options are <strong>disabled</strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Software Discovery of Configuration</div>
Software can determine the actual CPU configuration via the <a href="#_misa"><strong><code>misa</code></strong></a> and <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSRs. The SoC/Processor configuration
can be determined via the <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> memory-mapped registers.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 3. NEORV32 Processor Generic List; table abbreviations: the generic type &#8220;suv(x:y)&#8221; is an abbreviation for &#8220;std_ulogic_vector(x downto y)&#8221;</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 53.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Type</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>General</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOCK_FREQUENCY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The clock frequency of the processor&#8217;s <code>clk_i</code> input port in Hertz (Hz). See <a href="#_processor_clocking">Processor Clocking</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRACE_PORT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable external CPU execution <a href="#_execution_trace_port">Execution Trace Port</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DUAL_CORE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_boot_configuration">Boot Configuration</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOOT_MODE_SELECT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boot mode select; see <a href="#_boot_configuration">Boot Configuration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOOT_ADDR_CUSTOM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x"00000000"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom CPU boot address (available if <code>BOOT_MODE_SELECT</code> = 1).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the on-chip debugger and the CPU debug mode (<a href="#_sdext_isa_extension"><code>Sdext</code> ISA Extension</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_NUM_HW_TRIGGERS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented HW triggers (<a href="#_trigger_module">Trigger Module</a> / <a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a>) for hardware break-/watchpoints (0..16).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_AUTHENTICATION</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement <a href="#_debug_authentication">Debug Authentication</a> module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_JEDEC_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(10:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">"00000000000"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEDEC ID: continuation codes plus vendor ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>CPU <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> (compressed instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> (reduced register file size).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> (hardware-based integer multiplication and division).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_U</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_u_isa_extension"><code>U</code> ISA Extension</a> (less-privileged user mode).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zaamo</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zaamo_isa_extension"><code>Zaamo</code> ISA Extension</a> (atomic read-modify-write operations).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zalrsc</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zalrsc_isa_extension"><code>Zalrsc</code> ISA Extension</a> (atomic reservation-set operations).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zba</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zba_isa_extension"><code>Zba</code> ISA Extension</a> (shifted-add bit-manipulation instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zbb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zbb_isa_extension"><code>Zbb</code> ISA Extension</a> (basic bit-manipulation instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zbkb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zbkb_isa_extension"><code>Zbkb</code> ISA Extension</a> (scalar cryptography bit manipulation instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zbkc</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zbkc_isa_extension"><code>Zbkc</code> ISA Extension</a> (scalar cryptography carry-less multiplication instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zbkx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zbkx_isa_extension"><code>Zbkx</code> ISA Extension</a> (scalar cryptography crossbar permutations).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zbs</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zbs_isa_extension"><code>Zbs</code> ISA Extension</a> (single-bit bit-manipulation instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zcb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zcb_isa_extension"><code>Zcb</code> ISA Extension</a> (additional code size reduction instruction; builds upon <code>C</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zfinx_isa_extension"><code>Zfinx</code> ISA Extension</a> (single-precision floating-point unit).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zibi</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zibi_isa_extension"><code>Zibi</code> ISA Extension</a> (CPU base counters).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zicntr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zicntr_isa_extension"><code>Zicntr</code> ISA Extension</a> (CPU base counters).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zicond</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zicond_isa_extension"><code>Zicond</code> ISA Extension</a> (integer conditional instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zihpm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zihpm_isa_extension"><code>Zihpm</code> ISA Extension</a> (hardware performance monitors).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zimop</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zimop_isa_extension"><code>Zimop</code> ISA Extension</a> (may-be-operations).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zknd</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zknd_isa_extension"><code>Zknd</code> ISA Extension</a> (scalar cryptography NIST AES decryption instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zkne</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zkne_isa_extension"><code>Zkne</code> ISA Extension</a> (scalar cryptography NIST AES encryption instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zknh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zknh_isa_extension"><code>Zknh</code> ISA Extension</a> (scalar cryptography NIST hash instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zksed</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zksed_isa_extension"><code>Zksed</code> ISA Extension</a> (scalar cryptography ShangMi block cyphers).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zksh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zksh_isa_extension"><code>Zksh</code> ISA Extension</a> (scalar cryptography ShangMi hash functions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Zmmul</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zmmul_isa_extension"><code>Zmmul</code> - ISA Extension</a> (hardware-based integer multiplication).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Smcntrpmf</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_smcntrpmf_isa_extension"><code>Smcntrpmf</code> - ISA Extension</a> (counter privilege-mode filtering).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Xcfu</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable NEORV32-specific <a href="#_xcfu_isa_extension"><code>Xcfu</code> ISA Extension</a> (custom RISC-V instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_cpu_tuning_options">CPU Tuning Options</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_CONSTT_BR_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement constant-time branches (same execution times for taken and not-taken branches).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_FAST_MUL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement fast but large full-parallel multipliers (trying to infer DSP blocks); see section <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_FAST_SHIFT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement fast but large full-parallel barrel shifters; see section <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_RF_ARCH_SEL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU register file implementation style select; see section <a href="#_cpu_register_file">CPU Register File</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Physical Memory Protection (<a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_NUM_REGIONS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented PMP regions (0..16).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_MIN_GRANULARITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimal region granularity in bytes. Has to be a power of two, min 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_TOR_MODE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement support for top-of-region (TOR) mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_NAP_MODE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement support for naturally-aligned power-of-two (NAPOT &amp; NA4) modes.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Hardware Performance Monitors (<a href="#_zihpm_isa_extension"><code>Zihpm</code> ISA Extension</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM_NUM_CNTS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented hardware performance monitor counters (0..13).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM_CNT_WIDTH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total LSB-aligned size of each HPM counter. Min 0, max 64.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement instruction memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_BASE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x"00000000"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base address of the instruction memory (has to be naturally-aligned to its size). Handle with care.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16*1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes of the instruction memory (use a power of 2).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_OUTREG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add IMEM output register stage (improves mapping/timing at the expense of latency).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Internal <a href="#_data_memory_dmem">Data Memory (DMEM)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement data memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_BASE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">x"80000000"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base address of the data memory (has to be naturally-aligned to its size). Handle with care.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8*1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes of the data memory (use a power of 2).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_OUTREG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add DMEM output register stage (improves mapping/timing at the expense of latency).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>CPU Caches (<a href="#_instruction_cache_icache">Instruction Cache (iCache)</a> &amp; <a href="#_data_cache_dcache">Data Cache (dCache)</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the instruction cache ("I$").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of blocks ("lines"). Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the data cache ("D$")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of blocks ("lines"). Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global cache block size (I$ <strong>and</strong> D$) in bytes. Has to be a power of two, min 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE_BURSTS_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable burst transfers for cache updates.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a> (Wishbone / AXI4-Compatible Bridging)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XBUS_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the external bus interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XBUS_TIMEOUT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of clock cycles after which an unacknowledged external bus access will auto-terminate (0 = disabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XBUS_REGSTAGE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement XBUS register stages to ease timing closure.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Peripheral/IO Modules</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPIO_NUM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of general purpose input/output pairs of the <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a>, max 32.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CLINT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 RX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 TX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 RX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 TX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a> FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWI_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a> FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWD_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWD_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a> RX FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWD_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a> TX FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_PWM_NUM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of channels of the <a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a> to implement (0..32).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_WDT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the TRNG data FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth of the <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a>. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPTMR_NUM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of individual <a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a> timer slices (0..16).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_ONEWIRE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_ONEWIRE_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a> FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_DMA_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_DMA_DSC_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the DMA transfer descriptor FIFO. Has to be a power of two, min 4, max 512.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a> (AXI4-Stream-Compatible).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK RX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK TX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRACER_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRACER_BUFFER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a>. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRACER_SIMLOG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write full trace log to file (simulation-only).</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_clocking">2.3. Processor Clocking</h3>
<div class="paragraph">
<p>The entire system is implemented as fully-synchronous logic design using a single clock domain that is driven
by the top&#8217;s <code>clk_i</code> signal. This clock signal is used by all internal registers and memories. All of them trigger
on the <strong>rising edge</strong> of this clock signal. External "clocks" like the OCD&#8217;s JTAG clock or the SDI&#8217;s serial clock
are synchronized into the processor&#8217;s clock domain before being used as "general logic signal" (and not as a dedicated clock).</p>
</div>
<div class="sect3">
<h4 id="_peripheral_clocks">2.3.1. Peripheral Clocks</h4>
<div class="paragraph">
<p>Many processor modules like the UARTs or the timers provide a programmable time base for operations. In order to simplify
the hardware, the processor implements a global "clock generator" (<code>neorv32_sys.vhd</code>) that provides single-cycle <em>clock enables</em>
for certain frequencies which are derived from the main clock. These clock enable signals are synchronous to the system&#8217;s
main clock. The processor modules can use these enables for sub-main-clock operations while still providing a single
clock domain only.</p>
</div>
<div class="paragraph">
<p>In total, 8 sub-main-clock signals are available. All processor modules, which feature a time-based configuration, provide a
programmable three-bit prescaler select in their control register to select one of the 8 available clocks. The
mapping of the prescaler select bits to the according clock source is shown in the table below. Here, <em>f</em> represents the
processor main clock from the top entity&#8217;s <code>clk_i</code> signal.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prescaler bits:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b010</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b011</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b100</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b101</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b110</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting clock:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/8</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/64</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/128</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/1024</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2048</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4096</em></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_reset">2.4. Processor Reset</h3>
<div class="paragraph">
<p>The NEORV32 processor includes a central reset sequencer (<code>neorv32_sys.vhd</code>) that handles all reset requests
and controls the internal reset nets. The processor-wide reset ("system reset") can be triggered by any
of the following sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the asynchronous low-active <code>rstn_i</code> top entity input signal (external source)</p>
</li>
<li>
<p>the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> (internal source)</p>
</li>
<li>
<p>the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a> (internal source)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Reset Cause</div>
The actual reset cause can be determined via the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If any of these sources triggers a reset, the internal system-wide reset will be active for at least 4 clock cycles ensuring
a valid reset of the entire processor. This system reset is asserted <em>asynchronoulsy</em> if triggered by the external
<code>rstn_i</code> signal and is asserted <em>synchronously</em> if triggered by an internal reset source. However, the system reset is
always de-asserted <em>synchronously</em> at the next rising clock edge.</p>
</div>
<div class="paragraph">
<p>Internally, <strong>all registers</strong> that are not meant for mapping to blockRAM (like the register file) do provide a dedicated and
<strong>low-active asynchronous</strong> hardware reset. This asynchronous reset ensures that the entire processor logic is reset to a
defined state even if the main clock is not operational yet.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_interrupts">2.5. Processor Interrupts</h3>
<div class="paragraph">
<p>The system offers several interrupts (IRQs). Some can be used freely, others are reserved for specific tasks.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger Type</div>
All interrupt request lines are <strong>level-triggered and high-active</strong>. Once set, the signal should remain high until
the interrupt request is explicitly acknowledged (e.g. by writing to a memory-mapped register).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_risc_v_standard_interrupts">2.5.1. RISC-V Standard Interrupts</h4>
<div class="paragraph">
<p>The processor supports the standard RISC-V machine-level interrupts for "machine timer interrupt (MTI)", "machine
software interrupt (MSI)" and "machine external interrupt (MEI)". Their usage is defined by the RISC-V privileged
architecture specification. See CPU section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 4. Processor Top RISC-V Machine-Level Interrupts</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Top signal</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_msi_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine software interrupt (<code>MSI</code>). This IRQ is only available if the processor-internal <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a> is not implemented.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_mti_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine timer interrupt (<code>MTI</code>). This IRQ is only available if the processor-internal <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a> is not implemented.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_mei_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine external interrupt (<code>MEI</code>). This interrupt is always available for custom use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_fast_interrupt_requests">2.5.2. NEORV32-Specific Fast Interrupt Requests</h4>
<div class="paragraph">
<p>As part of the NEORV32-specific CPU extensions, the processor core features 16 fast interrupt request signals
(<code>FIRQ0</code> to <code>FIRQ15</code>) with dedicated bits in <a href="#_mip"><strong><code>mip</code></strong></a> and <a href="#_mie"><strong><code>mie</code></strong></a> CSRs and custom <a href="#_mcause"><strong><code>mcause</code></strong></a> trap codes.
The FIRQ signals are reserved for <em>processor-internal</em> modules only (for example for the communication
interfaces to signal "available incoming data" or "ready to send new data").</p>
</div>
<div class="paragraph">
<p>The mapping of the 16 FIRQ channels to the according processor-internal modules is shown in the following
table. The channel number also corresponds to the according FIRQ priority (0 = highest, 15 = lowest):</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 5. NEORV32 Fast Interrupt Request (FIRQ) Mapping</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Channel (priority)</th>
<th class="tableblock halign-left valign-top">Source</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_address_space">2.6. Address Space</h3>
<div class="paragraph">
<p>As a 32-bit architecture, NEORV32 can access 4GB of physical address space. This address space is divided into two
regions: the lower 3.75 GB (<code>0x00000000 &#8230;&#8203; 0xEFFFFFFF</code>) are referred to as <strong>Memory Address Space</strong> while
the upper 256 MB (<code>0xF0000000 &#8230;&#8203; 0xFFFFFFFF</code>) are referred to as <strong>IO/Peripheral Address Space</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/address_space.png" alt="900">
</div>
<div class="title">Figure 2. NEORV32 Processor Address Space (Default Configuration)</div>
</div>
<div class="paragraph">
<p>The <em>memory address space</em> is intended for actual memory and provides fully cached accesses from the
<a href="#_instruction_cache_icache">instruction</a> and <a href="#_data_cache_dcache">data</a> caches of the CPU(s). In contrast, the
<em>IO/peripheral address space</em> is dedicated for memory-mapped IO and provides direct / uncached accesses only.
Note that the address ranges for cached and uncached accesses are hard-wired and are not intended to be customized by the user.</p>
</div>
<div class="paragraph">
<p>How these two address regions are used is ultimately up to the user. However, in the default processor configuration
the memory address space can be optionally populated with processor-internal instruction and data memories. By default,
the processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> is mapped to base address <code>0x00000000</code> and the processor- internal
<a href="#_data_memory_dmem">Data Memory (DMEM)</a> is mapped to base address <code>0x80000000</code>. The very last 2 MB of the IO/peripheral address space is
exclusively reserved for the NEORV32-internal memory-mapped IO and peripheral modules.</p>
</div>
<div class="paragraph">
<p>Accesses to "unmapped" addresses (a.k.a. <strong>the void</strong>) are redirected to the <a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a>.
For example, if the processor-internal IMEM is disabled, accesses to the addresses starting at <code>0x00000000</code> are also
redirected to the external bus interface. If the external bus interface is not enabled any access to the void will raise
a bus error exception.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Physical Memory Attributes "PMAs"</div>
The address space regions provides specific physical memory attributes that define the access capabilities:
<code>r</code> = read access, <code>w</code> = write access, <code>x</code> = execute access, <code>a</code> = atomic access, <code>c</code> = cached CPU access.
Custom physical memory attributes enforced by the CPU&#8217;s physical memory protection "PMP" (<a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a>)
can be used to further constrain the physical memory attributes.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_bus_system">2.6.1. Bus System</h4>
<div class="paragraph">
<p>The CPU core provides individual interfaces for instruction fetch and data access. Both interface access the same
address space making the core a von-Neumann architecture. Optionally, the two interface can be equipped with data
and/or instruction caches (<a href="#_data_cache_dcache">i-cache</a> &amp; <a href="#_instruction_cache_icache">d-cache</a>).</p>
</div>
<div class="paragraph">
<p>The two CPU interfaces are multiplexed by a simple bus switch into a single processor-internal bus. Optionally,
this bus is further multiplexed by another instance of the bus switch so the <a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a>
can also access the entire address space.</p>
</div>
<div class="paragraph">
<p>Accesses via the resulting SoC bus are routed by the <a href="#_bus_gateway">Bus Gateway</a> that is used to redirect the access to the
processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> (if implemented), the processor-internal <a href="#_data_memory_dmem">Data Memory (DMEM)</a>
(if implemented), the processor-internal peripheral devices or - if the access does not target any of these - the
<a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a>. Accesses to the processor-internal IO/peripheral devices are further
redirected via a dedicated <a href="#_io_switch">IO Switch</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_bus.png" alt="1300">
</div>
<div class="title">Figure 3. Processor-Internal Bus Architecture</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Bus System Infrastructure IP</div>
The individual components of the processor&#8217;s bus system infrastructure are defined in <code>rtl/core/neorv32_bus.vhd</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bus Interface</div>
See sections CPU <a href="#_architecture">Architecture</a> and <a href="#_bus_interface">Bus Interface</a> for more information regarding the CPU bus accesses
and the according protocol.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">SMP Dual-Core Configuration</div>
The dual-core configuration adds a second CPU core complex in parallel to the first one.
See section <a href="#_dual_core_configuration">Dual-Core Configuration</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_bus_gateway">2.6.2. Bus Gateway</h4>
<div class="paragraph">
<p>The central bus gateway (VHDL component <code>neorv32_bus_gateway</code>) distributes CPU accesses to the two main memory
regions. Depending on the configuration, it routes accesses to:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> (if implemented)</p>
</li>
<li>
<p><a href="#_data_memory_dmem">Data Memory (DMEM)</a> (if implemented)</p>
</li>
<li>
<p>processor-internal IO/peripherals</p>
</li>
<li>
<p><a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a> (if implemented)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Additionally, the gateway also provides a <a href="#_bus_monitor_and_timeout">bus monitor</a> (aka "the bus keeper") that
<em>tracks</em> all bus transactions to ensure safe and deterministic operations.</p>
</div>
<div class="sect4">
<h5 id="_bus_monitor_and_timeout">Bus Monitor and Timeout</h5>
<div class="paragraph">
<p>For each single access the bus monitor starts an internal countdown.
The accessed module has to respond to the bus request within a bound time window. For <strong>processor-internal</strong> accesses
this time windows is defined by a constant in the main NEORV32 package file. For <strong>processor-external accesses</strong>
(via the external bus interface) this timeout is defined by the <code>XBUS_TIMEOUT</code> top configuration generic.</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Internal Bus Timeout Configuration (package constant in <code>neorv32_package.vhd</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-vhdl hljs" data-lang="vhdl">constant int_bus_tmo_c : natural := 16; -- internal bus timeout window; has to be a power of two</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 4. External Bus Timeout Configuration (top generic of <code>neorv32_top.vhd</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-vhdl hljs" data-lang="vhdl">XBUS_TIMEOUT : natural := 2048; -- cycles after a pending bus access auto-terminates (0 = disabled)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The according time window defines the maximum number of cycles after which a <em>non-responding</em> bus request will time out
raising a bus access fault exception. For example this can happen when accessing "address space holes" - addresses that
are not mapped to any physical module at all. The specific bus access exception type corresponds to the according access
type (i.e. instruction fetch bus access fault, load bus access fault or store bus access fault).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_io_switch">2.6.3. IO Switch</h4>
<div class="paragraph">
<p>The IO switch (VHDL component <code>neorv32_bus_io_switch</code>) decodes accesses to the <em>procesor-internal IO/peripheral</em>
address space. This 2MB address space is used to map all NEORV32 peripherals (like UART, SPI, timers, etc.),
the bootloader ROM and the on-chip debugger. Each device occupies an address range of 64kB; so up to 32 individual
devices can be mapped. The according address map is defined in the main VHDL package file (<code>rtl/core/neorv32_package.vhd</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_atomic_memory_operations_controller">2.6.4. Atomic Memory Operations Controller</h4>
<div class="paragraph">
<p>The CPU&#8217;s <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> adds support for atomic memory accesses. These atomic memory accesses are handles by
dedicated modules of the processor bus system. The SoC bus that is driven by the CPU core(s) is fed through two
atomic memory controller modules that handle read-modify-write operations as well as reservation-set operation:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hardware Module</th>
<th class="tableblock halign-left valign-top">CPU ISA Extensions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_bus_amo_rmw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zaamo_isa_extension"><code>Zaamo</code> ISA Extension</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_atomic_read_modify_write_controller">Atomic Read-Modify-Write Controller</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_bus_amo_rvs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zalrsc_isa_extension"><code>Zalrsc</code> ISA Extension</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_atomic_reservation_set_controller">Atomic Reservation-Set Controller</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Direct/Non-Caches Atomic Accesses</div>
Atomic operations <strong>always bypass</strong> the CPU&#8217;s <a href="#_data_cache_dcache">data cache</a>
using direct/uncached accesses. Care must be taken to maintain data <a href="#_memory_coherence">Memory Coherence</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Physical Memory Attributes</div>
Atomic memory operations can be executed targeting <em>any</em> address. This also includes
cached memory, memory-mapped IO devices and processor-external address spaces.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_atomic_read_modify_write_controller">Atomic Read-Modify-Write Controller</h5>
<div class="paragraph">
<p>This modules converts a single read-modify-write (RMW) memory operations request into two consecutive and
atomic bus transactions. For each request, the controller executes an atomic set of three operations:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 6. Simplified AMO Controller Operation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Step</th>
<th class="tableblock halign-left valign-top">Pseudo Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp1 &#8656; MEM[address];</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform a read operation from the targeted memory
address and temporarily store the loaded data into an internal buffer (<code>tmp1</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tmp2 &#8656; tmp1 OP cpu_wdata;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The buffered data from the first step is processed
using the write data provided by the CPU. The result is stored to another temporary internal buffer (<code>tmp2</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM[address] &#8656; tmp2;</code> <code>cpu_rdata &#8656; tmp1;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data from the second buffer (<code>tmp2</code>) is
written to the addressed memory location. In parallel, the data from the first buffer (<code>tmp1</code> = original
content of the accessed address) is sent back to the requesting CPU.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_atomic_reservation_set_controller">Atomic Reservation-Set Controller</h5>
<div class="paragraph">
<p>A "reservation"  is defined by an address or address range that provides a guarding mechanism to support atomic
accesses (as specified by the RISC-V <a href="#_zalrsc_isa_extension"><code>Zalrsc</code> ISA Extension</a>). A new reservation is registered by the <code>LR</code>
instruction. The address provided by this instruction defines the memory location(s) that is/are monitored for
exclusive accesses. The according <code>SC</code> instruction evaluates the state of this reservation. If the reservation
is still valid the write access performed by the <code>SC</code> instruction is finally executed and the instruction returns
a "success" state (i.e. <code>rd</code> = 0). If the reservation has been invalidated the <code>SC</code> instruction will not write
to memory and will return a "failed" state (i.e. <code>rd</code> = 1).</p>
</div>
<div class="paragraph">
<p>The reservation-set controller implements the <em>strong semnatics</em>. A reservation is created when executing
an <code>LR</code> instruction. Any other data memory access (for example by the DMA) will invalidate any active reservation
(note that instruction fetch accesses do not affect the reservations at all). Furthermore, <code>fence[.i]</code> also do not
impact the reservation state at all.</p>
</div>
<div class="paragraph">
<p>The reservation-set controller implements a <strong>single, global reservation set only</strong> which is used by both cores
of the SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a>. The <code>LR</code> operation of any CPU core creates a new reservation (for the
entire address space as the reservation is global) that is also used by the other CPUs. However, only one CPU will
receive a success state for the according <code>SC</code> operation, which - in term - invalidates the reservation again.
This guarantees atomic accesses and thus, mutually exclusive access.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">External Reservations</div>
Note that the reservation-set controller cannot track memory accesses outside
of the NEORV32 processor (i.e. atomic accesses via the external bus interface)
that are executed by processor-external agents.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_memory_coherence">2.6.5. Memory Coherence</h4>
<div class="paragraph">
<p>Depending on the configuration, the NEORV32 memory hierarchy consists of several levels.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The CPU execution pipeline and its <em>instruction prefetch buffer</em> (<a href="#_cpu_front_end">CPU Front-End</a>)</p>
</li>
<li>
<p>The <a href="#_data_cache_dcache">Data Cache (dCache)</a> and <a href="#_instruction_cache_icache">Instruction Cache (iCache)</a> (both optional)</p>
</li>
<li>
<p>Processor-internal and processor-external memories (depends on setup configuration)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Memory accesses are initiated exclusively by the CPU or the <a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a>.
Since the levels of the memory hierarchy are transparent to the software, special care must be taken
to ensure memory coherence is maintained throughout the entire system/application. Note that coherence
and especially cache synchronization is <strong>not</strong> performed automatically by the hardware itself as there
is no snooping implemented. NEORV32 supports two RISC-V memory ordering instructions for manual memory
synchronization which are always available regardless of the actual CPU/ISA configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fence.i</code> (<a href="#_zifencei_isa_extension"><code>Zifencei</code> ISA Extension</a>): flush the CPU&#8217;s instruction prefetch buffer
and clear the CPU&#8217;s instruction cache.</p>
</li>
<li>
<p><code>fence</code> (<a href="#_i_isa_extension"><code>I</code> ISA Extension</a> / <a href="#_e_isa_extension"><code>E</code> ISA Extension</a>): clear and reload the CPU&#8217;s
data cache. Flushing is not implemented as the data cache uses <strong>write-through</strong> strategy.
Hence, write operations are always synchronized with main memory.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Weak Coherence Model</div>
The NEORV32-specific implementation of the <code>fence[.i]</code> ordering instructions only provides a rather <strong>weak</strong>
coherence model. A core&#8217;s <code>fence</code> just orders all memory accesses towards main memory. Hence, they <em>can</em> become
visible by other agents (the secondary CPU core, the DMA, processor-external modules) if these agents also
synchronize (e.g. reload) their cache(s).
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_coherence_example">Coherence Example</h5>
<div class="paragraph">
<p>The following C example shows how to declare and use an atomic variable using the`_Atomic` specifier:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Atomic Variables - C Source Code</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">_Atomic int counter = 0;

counter = 3;
counter++;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 6. Atomic Variables - According RISC-V Assembly Code</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-assembly hljs" data-lang="assembly">li a3,3
li a4,1

fence rw,w
sw    a3,0(a2)
fence rw,rw

amoadd.w.aqrl zero,a4,(a2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The initial assignment <code>counter = 0</code> is translated into a store-word instruction (<code>sw</code>) that is
automatically encapsulated within two <code>fence</code> instructions. This guarantees memory coherence as each
<code>fence</code> will synchronize the CPU&#8217;s data cache with upstream/main memory.</p>
</div>
<div class="paragraph">
<p>The counter increment (<code>counter++</code>) is implemented as RISC-V atomic memory operation (<code>amoadd</code>). However, the
compiler does not encapsulate this in within FENCE instructions. Hence, the altered atomic variable
is <strong>not</strong> updated in the CPU&#8217;s data cache (but in upstream/main memory).</p>
</div>
<div class="paragraph">
<p>The above example clearly shows that special attention must be paid to memory coherence when using
atomic memory operations.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_boot_configuration">2.7. Boot Configuration</h3>
<div class="paragraph">
<p>The NEORV32 processor provides pre-defined boot configurations to adjust system start-up to
the requirements of the application. The actual boot configuration is defined by the <code>BOOT_MODE_SELECT</code>
generic (see <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).
For the SMP dual-core CPU configuration boot procedure see section <a href="#_dual_core_boot">Dual-Core Boot</a>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 7. NEORV32 Boot Configurations</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><code>BOOT_MODE_SELECT</code></th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Boot address</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0 (default)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bootloader</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Base of internal BOOTROM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> as pre-initialized ROM and boot from there.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Custom Address</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BOOT_ADDR_CUSTOM</code> generic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start booting at user-defined address (<code>BOOT_ADDR_CUSTOM</code> top generic).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IMEM Image</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Base of internal IMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> as pre-initialized ROM and boot from there.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_booting_via_bootloader">2.7.1. Booting via Bootloader</h4>
<div class="paragraph">
<p>This is the default configuration. When selected, the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is enabled.
This ROM contains the executable image (<code>rtl/core/neorv32_bootrom_image.vhd</code>) of the default NEORV32 <a href="#_bootloader">Bootloader</a>
that will be executed right after reset. The bootloader provides an interactive user console for executable upload as
well as an automatic mode to boot from external (SPI) flash memory.</p>
</div>
<div class="paragraph">
<p>If the processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> is enabled it will be implemented as <em>blank</em> RAM.</p>
</div>
</div>
<div class="sect3">
<h4 id="_boot_from_custom_address">2.7.2. Boot from Custom Address</h4>
<div class="paragraph">
<p>This is the most flexible boot configuration as it allows the user to specify a custom boot address via the
<code>BOOT_ADDR_CUSTOM</code> generic. Note that this address has to be aligned to 4-byte boundary. The processor will
start executing from the defined address right after reset. For example, this boot configuration ca be used to
execute a <em>custom bootloader</em> from a memory that is attached via the <a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a>.</p>
</div>
<div class="paragraph">
<p>For this configuration the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is not enabled / implement at all.
If the processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> is enabled it will be implemented as <em>blank</em> RAM.</p>
</div>
</div>
<div class="sect3">
<h4 id="_boot_imem_image">2.7.3. Boot IMEM Image</h4>
<div class="paragraph">
<p>This configuration will implement the <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> as <em>pre-initialized ROM</em>. The ROM is
initialized during synthesis with the according application image file (<code>rtl/core/neorv32_imem_image.vhd</code>).
After reset, the CPU will directly start executing this image. Since the IMEM is implemented as ROM, the
executable cannot be altered at runtime at all.</p>
</div>
<div class="paragraph">
<p>For this configuration the <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is not enabled / implement at all.
Note that this boot configuration requires the IMEM to be enabled (<code>IMEM_EN</code> = true).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Simulation Setup</div>
This boot configuration is handy for simulations as the application software is executed right away without the
need for an explicit initialization / executable upload.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_internal_modules">2.8. Processor-Internal Modules</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Full-Word Write Accesses Only</div>
Unless otherwise specified, all peripheral/IO devices should only be accessed using full-word accesses (i.e. 32-bit).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">IO Module Address Space</div>
Each peripheral/IO module occupies an address space of 64kB bytes. Most devices do not fully utilize this
address space and will mirror the available memory-mapped registers across the device&#8217;s address space.
However, only the specified memory-mapped registers addresses should be used.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unimplemented Modules / Address Holes</div>
When accessing an IO device tha hast not been implemented (disabled via the according generic)
or when accessing an address that is actually unused, a load/store access fault exception is raised.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Writing to Read-Only Registers</div>
Unless otherwise specified, writing to registers that are listed as read-only does not trigger an exception
as the write access is just ignored by the corresponding hardware module.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Module Interrupts</div>
Several peripheral/IO devices provide some kind of interrupt. These interrupts are mapped to the CPU&#8217;s
<a href="#_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</a>. See section <a href="#_processor_interrupts">Processor Interrupts</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CMSIS System Description View (SVD)</div>
A CMSIS-compatible <strong>System View Description (SVD)</strong> file including all peripherals is available in <code>sw/svd</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_instruction_memory_imem">2.8.1. Instruction Memory (IMEM)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generic processor-internal instruction memory (RAM or ROM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem_image.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory initialization image (VHDL package)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem_ram.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM component (primitive/IP wrapper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem_rom.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROM component (primitive/IP wrapper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement IMEM when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit base address (naturally aligned to IMEM size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM size in bytes (use a power of 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM_OUTREG_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add IMEM output register stage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOOT_MODE_SELECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement IMEM as ROM when <code>BOOT_MODE_SELECT</code> = 2; see <a href="#_boot_configuration">Boot Configuration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Burst-capable tightly-coupled on-chip instruction memory</p>
</li>
<li>
<p>Configurable RAM size</p>
</li>
<li>
<p>Accessible at the byte level</p>
</li>
<li>
<p>Mapped to memory primitives</p>
</li>
<li>
<p>Optional output register for improved timing</p>
</li>
<li>
<p>Can be implemented as pre-initialized ROM containing application firmware</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>Implementation of the processor-internal instruction memory is enabled by the processor&#8217;s
<code>IMEM_EN</code> generic. The total memory size in bytes is defined via the <code>IMEM_SIZE</code> generic.
Only sizes that are powers of two are supported. If enabled, the IMEM is mapped to base
address <code>0x00000000</code> by default (see section <a href="#_address_space">Address Space</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Custom IMEM Base Address</div>
The base address of the IMEM can be customized via the <code>IMEM_BASE</code> generic. Please note that
the selected address must be naturally aligned to the IMEM size (<code>IMEM_SIZE</code>) and that there must
be no overlap with other sections of the internal <a href="#_address_space">Address Space</a> (internal DMEM if enabled
and the internal IO/peripheral address space). Any non-default address must also be passed to the
<a href="#_linker_script">Linker Script</a> (e.g. <code>USER_FLAGS += -Wl,--defsym,__neorv32_rom_base=&lt;IMEM_BASE&gt;</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the IMEM is implemented as true RAM so the content can be modified during run time.
Alternatively, the IMEM can be implemented as <strong>pre-initialized read-only memory (ROM)</strong>, so the
processor can directly boot from it after reset. This option is configured via the <code>BOOT_MODE_SELECT</code>
generic. See section <a href="#_boot_configuration">Boot Configuration</a> for more information. If the IMEM is implemented as ROM
any write attempt to it will raise a <em>store access fault</em> exception.</p>
</div>
<div class="paragraph">
<p>The software framework provides an option to generate and override the default VHDL initialization
file <code>rtl/core/neorv32_imem_image.vhd</code>, which is automatically inserted into the IMEM (see
<a href="#_makefile_targets">Makefile Targets</a>. If the IMEM is implemented as RAM (default), the memory block will not be
initialized at all.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Output Register Stage</div>
An optional output register stage can be enabled via <code>IMEM_OUTREG_EN</code>. For FPGA targets this might improve
mapping/timing results. Note that this option will increase the read latency by one clock cycle. Write accesses
are not affected by this at all.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Memory Configuration by Software</div>
Software can retrieve the DMEM size from the <a href="#_sysinfo_miscellaneous_configuration">SYSINFO - Miscellaneous Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Memory Primitives</div>
The memory&#8217;s memory core is encapsulated as individual wrapper (<code>neorv32_imem_ram.vhd</code> / <code>neorv32_imem_ram.vhd</code>)
that can be replaced by a technology-specific IP. All interface ports provide static signal widths to ease replacement.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_data_memory_dmem">2.8.2. Data Memory (DMEM)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dmem.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generic processor-internal data memory (RAM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dmem_ram.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM component (primitive/IP wrapper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement DMEM when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit base address (naturally aligned to DMEM size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM size in bytes (use a power of 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM_OUTREG_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add DMEM output register stage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Burst-capable tightly-coupled on-chip data memory</p>
</li>
<li>
<p>Configurable RAM size</p>
</li>
<li>
<p>Accessible at the byte level</p>
</li>
<li>
<p>Can also be used for executing code</p>
</li>
<li>
<p>Mapped to memory primitives</p>
</li>
<li>
<p>Optional output register for improved timing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>Implementation of the processor-internal data memory is enabled by the processor&#8217;s <code>DMEM_EN</code>
generic. The total memory size in bytes is defined via the <code>DMEM_SIZE</code> generic. Only sizes that
are powers of two are supported. If enabled, the DMEM is mapped to base address <code>0x80000000</code>
by default (see section <a href="#_address_space">Address Space</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Custom DMEM Base Address</div>
The base address of the DMEM can be customized via the <code>DMEM_BASE</code> generic. Please note that
the selected address must be naturally aligned to the DMEM size (<code>DMEM_SIZE</code>) and that there must
be no overlap with other sections of the internal <a href="#_address_space">Address Space</a> (internal IMEM if enabled
and the internal IO/peripheral address space). Any non-default address must also be passed to the
<a href="#_linker_script">Linker Script</a> (e.g. <code>USER_FLAGS += -Wl,--defsym,__neorv32_ram_base=&lt;DMEM_BASE&gt;</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Platform-Specific Memory Primitives</div>
If required, the default DMEM can be replaced by a platform-/technology-specific primitive to
optimize area utilization, timing and power consumption.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Output Register Stage</div>
An optional output register stage can be enabled via <code>DMEM_OUTREG_EN</code>. For FPGA targets this might improve
mapping/timing results. Note that this option will increase the read latency by one clock cycle. Write accesses
are not affected by this at all.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Memory Configuration by Software</div>
Software can retrieve the DMEM size from the <a href="#_sysinfo_miscellaneous_configuration">SYSINFO - Miscellaneous Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Memory Primitives</div>
The memory&#8217;s memory core is encapsulated as individual wrapper (<code>neorv32_dmem_ram.vhd</code>) that can be
replaced by a technology-specific IP. All interface ports provide static signal widths to ease replacement.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_bootloader_rom_bootrom">2.8.3. Bootloader ROM (BOOTROM)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_bootrom.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default platform-agnostic bootloader ROM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_bootrom_image.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory initialization image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_bootrom_rom.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROM component (primitive/IP wrapper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOOT_MODE_SELECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement BOOTROM when <code>BOOT_MODE_SELECT</code> = 0; see <a href="#_boot_configuration">Boot Configuration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tightly-coupled on-chip ROM</p>
</li>
<li>
<p>Accessible at the byte level</p>
</li>
<li>
<p>Mapped to memory primitives</p>
</li>
<li>
<p>Pre-initialized with default NEORV32 bootloader</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The boot ROM contains the pre-compiled executable image of the default NEORV32 <a href="#_bootloader">Bootloader</a>. When the
<a href="#_boot_configuration">Boot Configuration</a> is set to <em>bootloader</em> mode (0) via the <code>BOOT_MODE_SELECT</code> generic, the
boot ROM is automatically enabled and the CPU boot address is adjusted to the base address of the boot ROM.
Note that the entire boot ROM is read-only.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bootloader Image</div>
The bootloader ROM is initialized during synthesis with the default bootloader image
(<code>rtl/core/neorv32_bootrom_image.vhd</code>). The physical size of the ROM is automatically
adjusted to the next power of two of the image size. However, note that the BOOTROM is
constrained to a maximum size of 64kB.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Memory Primitives</div>
The memory&#8217;s memory core is encapsulated as individual wrapper (<code>neorv32_bootrom_rom.vhd</code>)
that can be replaced by a technology-specific IP. All interface ports provide static signal
widths to ease replacement.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_instruction_cache_icache">2.8.4. Instruction Cache (iCache)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cache.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generic cache module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cache_ram.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag and data RAM (primitive/IP wrapper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CPU-exclusive instruction cache (I$) when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of cache blocks ("cache lines"); has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of a cache block in bytes (global configuration for I$ and D$); has to be a power of two, min 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE_BURSTS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable burst transfers for cache update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct-mapped read-only cache</p>
</li>
<li>
<p>Configurable number of lines</p>
</li>
<li>
<p>Configurable line size</p>
</li>
<li>
<p>Allows bypassing for <em>uncached</em> accesses</p>
</li>
<li>
<p>Tag and data storage mapped to memory primitives</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The processor features an optional CPU instruction cache. The cache is connected directly to the <a href="#_cpu_front_end">CPU Front-End</a>
fetch interface and provides full-transparent accesses. The cache is direct-mapped and read-only.
For the <a href="#_dual_core_configuration">Dual-Core Configuration</a> each CPU core is equipped with a private instruction cache.</p>
</div>
<div class="paragraph">
<p>The instruction cache is enabled by the <code>ICACHE_EN</code> generic. The total cache memory size in bytes is defined by
<code>ICACHE_NUM_BLOCKS x CACHE_BLOCK_SIZE</code>. <code>ICACHE_NUM_BLOCKS</code> defines the number of cache blocks (or "cache lines")
and <code>CACHE_BLOCK_SIZE</code> defines the block size in bytes; note that the latter configuration is global for all caches.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Burst Transfers</div>
Cache update operations (to resolve a cache miss) can use <a href="#_locked_bus_accesses_and_bursts">burst transfers</a>
to increase performance. Burst operations are enabled (for all caches) by the <code>CACHE_BURSTS_EN</code> top generic.
When bursts are enabled all cache block transfers are <strong>always executed as burst transfers</strong>. Hence, all devices,
memories and endpoints that can be accessed by the cache must also be able to process bursts (including the
<a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Uncached Accesses</div>
The cache provides direct/uncached accesses to memory (bypassing the cache) in order to access memory-mapped IO
(like the processor-internal IO/peripheral modules). All accesses that target the address range from <code>0xF0000000</code>
to <code>0xFFFFFFFF</code> will bypass the cache. See section <a href="#_address_space">Address Space</a> for more information. Furthermore, atomic
memory operations  will always <strong>bypass</strong> the cache.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manual Cache Clear/Reload and Memory Coherence</div>
By executing the <code>fence.i</code> instruction the instruction cache is cleared and reloaded.
See section <a href="#_memory_coherence">Memory Coherence</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Cache Block Update Bus Error Handling</div>
If the cache encounters a bus error while downloading a new block from main memory, the entire block is discarded
and an bus error exception is raised.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Cache Configuration by Software</div>
Software can retrieve the cache configuration/layout from the <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Memory Primitives</div>
The cache&#8217;s tag and data RAMs are encapsulated as individual wrapper (<code>neorv32_cache_ram.vhd</code>) that can be
replaced by a technology-specific IP. All interface ports provide static signal widths to ease replacement.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_data_cache_dcache">2.8.5. Data Cache (dCache)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cache.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generic cache module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cache_ram.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag and data RAM (primitive/IP wrapper)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CPU-exclusive data cache (D$) when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of cache blocks ("cache lines"); has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of a cache block in bytes (global configuration for I$ and D$); has to be a power of two, min 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE_BURSTS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable burst transfers for cache update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct-mapped write-through cache</p>
</li>
<li>
<p>Configurable number of lines</p>
</li>
<li>
<p>Configurable line size</p>
</li>
<li>
<p>Allows bypassing for <em>uncached</em> accesses</p>
</li>
<li>
<p>Tag and data storage mapped to memory primitives</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The processor features an optional CPU data cache. The cache is connected directly to the <a href="#_cpu_loadstore_unit">CPU Load/Store Unit</a>
and provides full-transparent accesses. The cache is direct-mapped and uses "write-through" as write policy.
For the <a href="#_dual_core_configuration">Dual-Core Configuration</a> each CPU core is equipped with a private data cache.</p>
</div>
<div class="paragraph">
<p>The data cache is enabled by the <code>DCACHE_EN</code> generic. The total cache memory size in bytes is defined by
<code>DCACHE_NUM_BLOCKS x CACHE_BLOCK_SIZE</code>. <code>DCACHE_NUM_BLOCKS</code> defines the number of cache blocks (or "cache lines")
and <code>CACHE_BLOCK_SIZE</code> defines the block size in bytes; note that the latter configuration is global for all caches.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Burst Transfers</div>
Cache update operations (to resolve a cache miss) can use <a href="#_locked_bus_accesses_and_bursts">burst transfers</a>
to increase performance. Burst operations are enabled (for all caches) by the <code>CACHE_BURSTS_EN</code> top generic.
When bursts are enabled all cache block transfers are <strong>always executed as burst transfers</strong>. Hence, all devices,
memories and endpoints that can be accessed by the cache must also be able to process bursts (including the
<a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Uncached Accesses</div>
The cache provides direct/uncached accesses to memory (bypassing the cache) in order to access memory-mapped IO
(like the processor-internal IO/peripheral modules). All accesses that target the address range from <code>0xF0000000</code>
to <code>0xFFFFFFFF</code> will bypass the cache. See section <a href="#_address_space">Address Space</a> for more information. Furthermore, atomic
memory operations  will always <strong>bypass</strong> the cache.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manual Cache Flush/Clear/Reload and Memory Coherence</div>
By executing the <code>fence</code> instruction the data cache is flushed, cleared and reloaded.
See section <a href="#_memory_coherence">Memory Coherence</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Cache Block Update Bus Error Handling</div>
If the cache encounters a bus error while downloading a new block from main memory, the entire block is discarded
and an bus error exception is raised.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Cache Configuration by Software</div>
Software can retrieve the cache configuration/layout from the <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Memory Primitives</div>
The cache&#8217;s tag and data RAMs are encapsulated as individual wrapper (<code>neorv32_cache_ram.vhd</code>) that can be
replaced by a technology-specific IP. All interface ports provide static signal widths to ease replacement.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_direct_memory_access_controller_dma">2.8.6. Direct Memory Access Controller (DMA)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dma.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dma.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__dma_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dma.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__dma_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_DMA_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement DMA when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_DMA_DSC_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">descriptor FIFO depth, has to be a power of 2, min 4, max 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA transfer(s) done (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU-independent data movement</p>
</li>
<li>
<p>Byte-wide or word-wide data transfers</p>
</li>
<li>
<p>Up to 16MB (bytes) or 64MB (words) per transfer</p>
</li>
<li>
<p>Optional Endianness conversion</p>
</li>
<li>
<p>Optional descriptor FIFO</p>
</li>
<li>
<p>Chaining of pre-programmed transfers</p>
</li>
<li>
<p>Transfer-done interrupt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 DMA features a lightweight direct memory access controller that allows to move and modify data independently
of the CPU. Only a single read/write channel is implemented. So only one programmed transfer can be in progress at a time.
However, a configurable descriptor FIFO is provided which allows to program several transfers so the DMA can execute them
one after the other.</p>
</div>
<div class="paragraph">
<p>The DMA is connected to the central processor-internal bus system (see section <a href="#_address_space">Address Space</a>) and can access the
entire/same address space as the CPU core. It uses <em>interleaving mode</em> accessing the central processor bus only if the CPU
does not currently request a bus access. The DMA controller can handle different data quantities (e.g. read bytes and write
them back as zero-extended words) and can also change the Endianness of data while transferring. It supports reading/writing
data from/to fixed or auto-incrementing addresses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">DMA Bus Access</div>
Transactions performed by the DMA are executed as bus transactions with elevated <strong>machine-mode</strong> privilege level.
Note that any physical memory protection rules (<a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a>) are not applied to DMA transfers.
Furthermore, the DMA uses single-transfers only (.e. no burst transfers).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DMA Demo Program</div>
A DMA example program can be found in <code>sw/example/demo_dma</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The DMA provides just two memory-mapped interface registers: A status and control register <code>CTRL</code> and
another one for writing the transfer descriptor(s) to the internal descriptor FIFO.</p>
</div>
<div class="paragraph">
<p>The DMA is enabled by setting the <code>DMA_CTRL_EN</code> bit of the control register. Clearing this flag will abort any outstanding
transfer and will also reset/clear the descriptor FIFO. A programmed DMA transfer is initiated by setting the control
register&#8217;s <code>DMA_CTRL_START</code> bit. Setting this bit while the descriptor FIFO is empty has no effect. The current status
of the FIFO can be checked via the <code>DMA_CTRL_D*</code> flags.</p>
</div>
<div class="paragraph">
<p>The DMA uses an atomic read-modify-write transfer process. Data is read from the current source address, modified/aligned
internally and then written back to the current destination address. If the DMA controller encounters a bus error during
operation, it will set the <code>DMA_CTRL_ERROR</code> flag and will terminate the current transfer. An new transfer can only start
if the <code>DMA_CTRL_ERROR</code> flag is cleared manually.</p>
</div>
<div class="paragraph">
<p>When the <code>DMA_CTRL_DONE</code> flag is set the DMA has completed all programmed transfers, i.e. all descriptors from the FIFO
were executed. This flag also triggers the DMA controller&#8217;s interrupt request signal. The application software has to
clear <code>DMA_CTRL_DONE</code> in order to acknowledge the interrupt and to start further transfers.</p>
</div>
<div class="paragraph">
<p><strong>DMA Descriptor</strong></p>
</div>
<div class="paragraph">
<p>All DMA transfers are executed based on <em>descriptors</em>. A descriptor contains the data source and destination base addresses
as well as the number of elements to transfer and the data type and handling configuration. A complete descriptor is
encoded as 3 consecutive 32-bit words:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. DMA Descriptor</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Index</th>
<th class="tableblock halign-left valign-top">Size</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source data base address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination data base address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfer configuration word (see next table)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Descriptor FIFO Size</div>
The descriptor FIFO has a minimal size of 4 entries. This can be extended by the <code>IO_DMA_DSC_FIFO</code> generic.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Incomplete Descriptors</div>
The DMA controller consumes 3 entries from the FIFO for each transfer. If the FIFO does not provide a complete
DMA descriptor, the controller will wait until a complete descriptor is available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The source and destination data addresses can target any memory location in the entire 32-bit address space including
memory-mapped peripherals. The number of elements to transfer as well as incrementing or constant byte- or word-level
transfers are configured via the transfer configuration word (3rd descriptor word):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. DMA Descriptor - Transfer Configuration Word</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bit(s)</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMA_CONF_NUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of elements to transfer; must be greater than zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26:24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, set to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMA_CONF_BSWAP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to swap byte order ("Endianness" conversion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29:28</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMA_CONF_SRC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source data configuration (see list below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMA_CONF_DST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination data configuration (see list below)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Source and destination data accesses are configured by a 2-bit selector individually for the source and the destination data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>00</code>: Constant byte - transfer data as byte (8-bit); do not alter address during transfer</p>
</li>
<li>
<p><code>01</code>: Constant word - transfer data as word (32-bit); do not alter address during transfer</p>
</li>
<li>
<p><code>10</code>: Incrementing byte - transfer data as byte (8-bit); increment the source address by 1</p>
</li>
<li>
<p><code>11</code>: Incrementing word - transfer data as word (32-bit); increment the source address by 4</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally, the controller can automatically swap the logical byte order ("Endianness") of the transferred data
when the <code>DMA_CONF_BSWAP</code> bit is set.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. DMA Register Map (<code>struct NEORV32_DMA</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock"><code>0xffed0000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>DMA_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA module enable; reset module when cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>DMA_CTRL_START</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start programmed DMA transfer(s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:2</code>  <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19:16</code> <code>DMA_CTRL_DFIFO_MSB : DMA_CTRL_DFIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descriptor FIFO depth, log2(<code>IO_DMA_DSC_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26:20</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>DMA_CTRL_ACK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write <code>1</code> to clear DMA interrupt (also clears <code>DMA_CTRL_ERROR</code> and <code>DMA_CTRL_DONE</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>DMA_CTRL_DEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descriptor FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>    <code>DMA_CTRL_DFULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descriptor FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>DMA_CTRL_ERROR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus access error during transfer or incomplete descriptor data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>DMA_CTRL_DONE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All transfers executed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>DMA_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA transfer(s) in progress</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffed0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DESC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descriptor FIFO write access</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_external_bus_interface_xbus">2.8.7. Processor-External Bus Interface (XBUS)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xbus.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External bus gateway</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_adr_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_cti_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycle type (3-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_tag_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access tag (3-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_we_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_sel_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable (4-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_stb_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus strobe (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_cyc_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_ack_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acknowledge (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xbus_err_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus error (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XBUS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable external bus interface when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XBUS_TIMEOUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of clock cycles after which an unacknowledged external bus access will auto-terminate (0 = disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XBUS_REGSTAGE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement XBUS register stages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(<code>CACHE_BLOCK_SIZE</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">burst size (defined by global cache block size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(<code>CACHE_BURSTS_EN</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable burst transfers for cache update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gateway for processor-external modules</p>
</li>
<li>
<p>Wishbone-compatible bus protocol</p>
</li>
<li>
<p>Optional burst support</p>
</li>
<li>
<p>Optional AXI4-compatible bridging</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The external bus interface provides a <strong>Wishbone</strong>-compatible on-chip bus interface. This bus interface
can be used to attach processor-external modules like memories, custom hardware accelerators or additional
peripheral devices.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Burst Transfers</div>
If any cache (<a href="#_processor_internal_instruction_cache_icache">i-cache</a> or <a href="#_processor_internal_data_cache_dcache">d-cache</a>)
is implemented and bursts are globally enabled (by the <code>CACHE_BURSTS_EN</code> top generic) all cache block transfers are
<strong>always executed as burst transfers</strong> with a burst size equal to the cache block size (<code>CACHE_BLOCK_SIZE</code> top generic).
Burst transfers should <strong>not</strong> be enabled if any external module mapped to <em>cached</em> <a href="#_address_space">Address Space</a> does not support bursts.
Note that burst transactions need to set <code>ACK</code> or <code>ERR</code> for each burst element. Note that the cycle type identifier signal
(<code>xbus_cti_o</code>) does not support the end-of-burst identifier.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Address Mapping</div>
The external interface is <strong>not</strong> mapped to a specific address range. Instead, all CPU memory accesses that
do not target a specific (and actually implemented) processor-internal address region (hence, accessing the "void";
see section <a href="#_address_space">Address Space</a>) are <strong>redirected</strong> to the external bus interface.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Wishbone Specs</div>
The official Wishbone specification scan be found online:
<a href="https://wishbone-interconnect.readthedocs.io/en/latest/index.html" class="bare">https://wishbone-interconnect.readthedocs.io/en/latest/index.html</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">AXI4-Compatible Interface Bridge</div>
A bridge that converts the processor&#8217;s XBUS interface into an AXI4-compatible host interface is available
in <code>rtl/system_integration/xbus2axi4_bridge.vhd</code>. This bridge is also used for the ENORV32 Vivado IP block:
<a href="https://stnolting.github.io/neorv32/ug/#_packaging_the_processor_as_vivado_ip_block" class="bare">https://stnolting.github.io/neorv32/ug/#_packaging_the_processor_as_vivado_ip_block</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>XBUS Bus Protocol</strong></p>
</div>
<div class="paragraph">
<p>The external bus interface implements a subset of the <strong>pipelined Wishbone</strong> protocol.
Basically, three types of bus transfer are implemented which are illustrated in the following figures.
The actual transfer type is indicated via the <em>cycle type identifier</em> (<code>xbus_cti_o</code>) signal.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>Single-access (<code>xbus_cti_o = 000</code>)</strong> transfers perform a single read or write operation.</p>
</li>
<li>
<p><strong>Atomic-access (<code>xbus_cti_o = 001</code>)</strong> transfers perform a read followed by a write operation.
The bus is locked during the entire transfer (keeping <code>cyc</code> high) to maintain exclusive bus access.
This transfer type is used by the CPU to perform atomic read-modify-write operations.</p>
</li>
<li>
<p><strong>Burst read (<code>xbus_cti_o = 010</code>)</strong> transfers perform several consecutive read accesses.
This transfer type is used by cache block operations.</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-647c075f5fac843001edac667aed35e9.svg" alt="Diagram" width="760" height="390">
</div>
<div class="title">Figure 4. XBUS <strong>Single Access</strong> Transfers: Write (left) and Read (right)</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-316c5b02b55457e50645c2197bdc2513.svg" alt="Diagram" width="440" height="390">
</div>
<div class="title">Figure 5. XBUS <strong>Atomic Access</strong> Transfer</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-f53c2c824b74b91752e945e262fd05e7.svg" alt="Diagram" width="480" height="390">
</div>
<div class="title">Figure 6. XBUS <strong>Burst Read</strong> Transfer (4-Words)</div>
</div>
<div class="paragraph">
<p><strong>Bus Latency</strong></p>
</div>
<div class="paragraph">
<p>An accessed XBUS device does not have to respond immediately to a bus request by sending an <code>ACK</code>.
Instead, there is a <strong>time window</strong> where the device has to acknowledge the transfer. This time window
is configured by the <code>XBUS_TIMEOUT</code> generic. Note that the value provided by this generic is internally
extended to the next power of two.</p>
</div>
<div class="paragraph">
<p>All XBUS transactions have to be acknowledged within this time window. Otherwise the transfer is terminated
and a bus fault exception is raised. See section <a href="#_bus_monitor_and_timeout">Bus Monitor and Timeout</a> for more information.</p>
</div>
<div class="paragraph">
<p>Furthermore, an accesses XBUS device can signal an error condition at any time by setting the <code>ERR</code> signal
high for one cycle. This will also terminate the current bus transaction raising a CPU bus fault exception.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Register Stage</div>
An optional register stage can be added to the XBUS gateway to break up the critical path easing timing closure.
When <code>XBUS_REGSTAGE_EN</code> is <em>true</em> all outgoing and incoming XBUS signals are registered increasing access latency
by two cycles. Furthermore, all outgoing signals (like the address) will be kept stable if there is no bus access
being initiated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Access Tag</strong></p>
</div>
<div class="paragraph">
<p>The XBUS tag signal <code>xbus_tag_o</code> provides additional information about the current access cycle.
The encoding is compatible to the AXI4 <code>xPROT</code> signal.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>xbus_tag_o(2)</code> <strong>I</strong>: access is an <strong>instruction</strong> fetch when set; access is a data access when cleared</p>
</li>
<li>
<p><code>xbus_tag_o(1)</code> <strong>NS</strong>: this bit is hardwired to <code>0</code> indicating a <strong>secure</strong> access</p>
</li>
<li>
<p><code>xbus_tag_o(0)</code> <strong>P</strong>: access is performed from <strong>privileged</strong> mode (machine-mode) when set</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_stream_link_interface_slink">2.8.8. Stream Link Interface (SLINK)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__slink_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__slink_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_src_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX routing information (4-bit, optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data valid (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_lst_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link last element of stream (1-bit, optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link ready to receive (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dst_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX routing information (4-bit, optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data valid (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_lst_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link last element of stream (1-bit, optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link allowed to send (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SLINK when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK IRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compatible to the AXI-4 stream standard</p>
</li>
<li>
<p>Independent RX and TX channels</p>
</li>
<li>
<p>Optional per-channel FIFOs</p>
</li>
<li>
<p>Supports "last" and "source/destination" stream signals</p>
</li>
<li>
<p>Interrupt based on FIFO status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The stream link interface provides independent RX and TX channels for sending and receiving stream data.
Each channel features a configurable internal data FIFO (<code>IO_SLINK_RX_FIFO</code> and <code>IO_SLINK_TX_FIFO</code>). The
SLINK interface provides higher bandwidth and less latency than the external bus interface making it
ideally suited for coupling custom stream processors or streaming peripherals.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Program</div>
An example program for the SLINK module is available in <code>sw/example/demo_slink</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interface &amp; Protocol</strong></p>
</div>
<div class="paragraph">
<p>Each link/channel consists of the following signals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dat</code> provides the actual data word</p>
</li>
<li>
<p><code>val</code> indicates the current transmission cycle is valid</p>
</li>
<li>
<p><code>lst</code> indicates the current transmission cycle is the last element of a stream (optional)</p>
</li>
<li>
<p><code>rdy</code> indicates the receiver is ready to receive</p>
</li>
<li>
<p><code>src</code> and <code>dst</code> provide source/destination routing information (optional)</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-fe89e8e8d9b92d384a26e005849019bb.svg" alt="Diagram" width="500" height="180">
</div>
<div class="title">Figure 7. SLINK example transmissions</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">AXI4-Stream Compatibility</div>
The interface names (except for <code>src</code> and <code>dst</code>) and the underlying protocol is compatible to the AXI4-Stream
protocol standard. A processor top entity with AXI4-Stream-compatible interfaces can be found in
<code>rtl/system_inegration</code>. More information can be found in the user guide:
<a href="https://stnolting.github.io/neorv32/ug/#_packaging_the_processor_as_vivado_ip_block" class="bare">https://stnolting.github.io/neorv32/ug/#_packaging_the_processor_as_vivado_ip_block</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SLINK provides four interface register. The control register (<code>CTRL</code>) is used to configure the module and to
check its status. The <code>ROUTE</code> register can be used to configure a 4-bit routing ID. Two individual data registers
(<code>DATA</code> and <code>DATA_LAST</code>) are used to send and receive the actual data.</p>
</div>
<div class="paragraph">
<p>The <code>DATA</code> register provides direct access to the RX/TX FIFO buffers. Read accesses return data from the RX FIFO.
The end-of-stream delimiter as well as the RX routing information are also buffered in the RX FIFO and can be obtained
from control register&#8217;s <code>SLINK_CTRL_RX_LAST</code> flag and the <code>ROUTE</code> register, respectively, after reading the actual RX data.</p>
</div>
<div class="paragraph">
<p>Writing to the <code>DATA</code> register will immediately write to the TX link FIFO. Writing to the <code>DATA_LAST</code> register will
also push data to the TX link FIFO and will also set the end-of-stream delimiter for that data word. TX routing
information can be configured via the <code>ROUTE</code> register before writing data to <code>DATA</code> / <code>DATA_LAST</code>.</p>
</div>
<div class="paragraph">
<p>The configured FIFO sizes can be retrieved by software via the control register&#8217;s <code>SLINK_CTRL_RX_FIFO_*</code> and
<code>SLINK_CTRL_TX_FIFO_*</code> bits.</p>
</div>
<div class="paragraph">
<p>The SLINK is globally enabled by setting the control register&#8217;s enable bit <code>SLINK_CTRL_EN</code>. Clearing this bit will
reset all internal logic and will also clear both FIFOs. Writing to the TX channel&#8217;s FIFO while it is <em>full</em> will
have no effect. Reading from the RX channel&#8217;s FIFO while it is <em>empty</em> will also have no effect and will return
the last received data word. The current status of the RX and TX FIFOs can be determined via the control register&#8217;s
<code>SLINK_CTRL_RX_EMPTY</code>, <code>SLINK_CTRL_RX_FULL</code>, <code>SLINK_CTRL_TX_EMPTY</code> and <code>SLINK_CTRL_TX_FULL</code> flags.</p>
</div>
<div class="paragraph">
<p><strong>Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SLINK module provides a single interrupt request that can be used to signal certain RX/TX data FIFO conditions.
The interrupt conditions are based on the RX/TX FIFO status flags <code>SLINK_CTRL_RX_*</code> / <code>SLINK_CTRL_TX_*</code> and are
configured via the according <code>SLINK_CTRL_IRQ_RX_*</code> / <code>SLINK_CTRL_IRQ_TX_*</code> bits. The SLINK interrupt will fire when the
module is enabled (<code>SLINK_CTRL_EN</code>) and <strong>any</strong> of the enabled interrupt conditions is met. Hence, all enabled interrupt
conditions are logically OR-ed. The interrupt remains active until all interrupt-causing conditions are resolved.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. SLINK register map (<code>struct NEORV32_SLINK</code>)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 30.7692%;">
<col style="width: 7.6923%;">
<col style="width: 30.7693%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="15"><p class="tableblock"><code>0xffec0000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="15"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>    <code>SLINK_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK global enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:1</code>   <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>    <code>SLINK_CTRL_RX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code>    <code>SLINK_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code>   <code>SLINK_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code>   <code>SLINK_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code>   <code>SLINK_CTRL_RX_LAST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last word read from <code>DATA</code> is end-of-stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:13</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>   <code>SLINK_CTRL_IRQ_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fire interrupt if RX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>   <code>SLINK_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fire interrupt if RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>   <code>SLINK_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fire interrupt if TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code>   <code>SLINK_CTRL_IRQ_TX_NFULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fire interrupt if TX FIFO not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:20</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27:24</code> <code>SLINK_CTRL_RX_FIFO_MSB : SLINK_CTRL_RX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(RX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:28</code> <code>SLINK_CTRL_TX_FIFO_MSB : SLINK_CTRL_TX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(TX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>0xffec0004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>ROUTE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX destination routing information (<code>slink_tx_dst_o</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX source routing information (<code>slink_rx_src_i</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:4</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffec0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write data to TX FIFO; read data from RX FIFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffec000c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA_LAST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write data to TX FIFO (and also set end-of-stream delimiter); read data from RX FIFO</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_input_and_output_port_gpio">2.8.9. General Purpose Input and Output Port (GPIO)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__gpio_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__gpio_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit parallel output port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit parallel input port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPIO_NUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of input/output pairs to implement (0..32)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">input-pin change interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Up to 32 inputs and 32 outputs</p>
</li>
<li>
<p>Each input pin is interrupt-capable</p>
</li>
<li>
<p>Configurable interrupt triggers (positive/negative level or edge)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The general purpose IO unit provides simple uni-directional input and output port. These ports can be used
chip-externally (for example to drive status LEDs, connect buttons, etc.) or chip-internally to provide control
signals for other IP modules. The input port features programmable pin-individual level or edge interrupts
capabilities.</p>
</div>
<div class="paragraph">
<p>Data written to the <code>PORT_OUT</code> will appear on the processor&#8217;s <code>gpio_o</code> port. Vice versa, the <code>PORT_IN</code> register
represents the current state of the processor&#8217;s <code>gpio_i</code>.</p>
</div>
<div class="paragraph">
<p>The actual number of input/output pairs is defined by the <code>IO_GPIO_NUM</code> generic. When set to zero, the GPIO module
is excluded from synthesis and the output port <code>gpio_o</code> is tied to all-zero. If <code>IO_GPIO_NUM</code> is less than the
maximum value of 32, only the LSB-aligned bits in <code>gpio_o</code> and <code>gpio_i</code> are actually connected while the remaining
bits are tied to zero or are left unconnected, respectively. This also applies to all memory-mapped interface
registers of the GPIO module (i.e. the according most-significant bits are hardwired to zero).</p>
</div>
<div class="paragraph">
<p><strong>Input Pin Interrupts</strong></p>
</div>
<div class="paragraph">
<p>Each input pin (<code>gpio_i</code>) provides an individual programmable interrupt trigger. The actual interrupt trigger
type can be configured individually for each input pin using the <code>IRQ_TYPE</code> and <code>IRQ_POLARITY</code> registers.
<code>IRQ_TYPE</code> defines the actual trigger type (level-triggered or edge-triggered), while <code>IRQ_POLARITY</code> defines
the trigger&#8217;s polarity (low-level/falling-edge or high-level/rising-edge). The position of each bit in these
registers corresponds the according <code>gpio_i</code> input pin.</p>
</div>
<div class="paragraph">
<p>Each pin interrupt channel can be enabled or disabled individually using the <code>IRQ_ENABLE</code> register. Each bit
in this register corresponds to the according input pin. If the programmed trigger of a disabled input
(<code>IRQ_ENABLE(i) = 0</code>) fires, the interrupt request is entirely ignored.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. GPIO Trigger Configuration for Pin <em>i</em></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><code>IRQ_ENABLE(i)</code></th>
<th class="tableblock halign-center valign-top"><code>IRQ_TYPE(i)</code></th>
<th class="tableblock halign-center valign-top"><code>IRQ_POLARITY(i)</code></th>
<th class="tableblock halign-left valign-top">Resulting trigger of <code>gpio_i(i)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-level (<code>GPIO_TRIG_LEVEL_LOW</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-level (<code>GPIO_TRIG_LEVEL_HIGH</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">falling-edge (<code>GPIO_TRIG_EDGE_FALLING</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rising-edge (<code>GPIO_TRIG_EDGE_RISING</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt disabled</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the configured trigger of an enabled input pin (<code>IRQ_ENABLE(i) = 1</code>) fires, the according interrupt request
is buffered internally in the <code>IRQ_PENDING</code> register. When this register contains a non-zero value (i.e. any
bit becomes set) an interrupt request is sent to the CPU via FIRQ channel 8 (see <a href="#_processor_interrupts">Processor Interrupts</a>).</p>
</div>
<div class="paragraph">
<p>The CPU can determine the interrupt-triggering pins by reading the <code>IRQ_PENDING</code> register. Each set bit in this
register indicates that the according input pin&#8217;s interrupt trigger has fired. Then, the CPU can clear those
pending interrupt pin by setting all set bits to zero.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">GPIO Interrupts Demo Program</div>
A demo program for the GPIO input interrupts can be found in <code>sw/example/demo_gpio</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 13. GPIO unit register map (<code>struct NEORV32_GPIO</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PORT_IN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel input port; <code>PORT_IN(i)</code> corresponds to <code>gpio_i(i)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PORT_OUT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel output port; <code>PORT_OUT(i)</code> corresponds to <code>gpio_o(i)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc000c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc0010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IRQ_TYPE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger type select (<code>0</code> = level trigger, <code>1</code> = edge trigger); <code>IRQ_TYPE(i)</code> corresponds to <code>gpio_i(i)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc0014</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IRQ_POLARITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger polarity select (<code>0</code> = low-level/falling-edge, <code>1</code> = high-level/rising-edge); <code>IRQ_POLARITY(i)</code> corresponds to <code>gpio_i(i)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc0018</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IRQ_ENABLE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per-pin interrupt enable; <code>IRQ_ENABLE(i)</code> corresponds to <code>gpio_i(i)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffc001c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IRQ_PENDING</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per-pin interrupt pending, can be cleared by writing zero to the according bit(s); <code>IRQ_PENDING(i)</code> corresponds to <code>gpio_i(i)</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_watchdog_timer_wdt">2.8.10. Watchdog Timer (WDT)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__wdt_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__wdt_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_wdt_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronous watchdog reset output, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_WDT_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement watchdog when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>32-bit timeout counter with 3-bit clock divider</p>
</li>
<li>
<p>Password-protected; lockable configuration</p>
</li>
<li>
<p>Provides information about the cause of the last reset</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The watchdog (WDT) provides a last resort for safety-critical applications. When a pre-programmed timeout value
is reached a system-wide hardware reset is generated. The internal counter has to be reset explicitly by the
application program every now and then to prevent a timeout.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The watchdog is enabled by setting the control register&#8217;s <code>WDT_CTRL_EN</code> bit. When this bit is cleared, the internal
timeout counter is reset to zero and no system reset can be triggered by this module.</p>
</div>
<div class="paragraph">
<p>The internal 24-bit timeout counter is clocked at 1/4096 of the processor&#8217;s main clock.
Whenever this counter reaches the programmed timeout value (24-bit <code>WDT_CTRL_TIMEOUT</code> value) a hardware reset is triggered.
The timeout counter is reset by writing the reset <strong>PASSWORD</strong> to the <code>RESET</code> register ("feeding the watchdog").
The password is hardwired to hexadecimal <code>0x709D1AB3</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>T<sub>timoeut</sub> = ( 1 / f<sub>main</sub>[Hz] ) * 4096 * <code>WDT_CTRL_TIMEOUT</code></p>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Operation in Sleep-Mode and During Debugging</div>
Once enabled, the watchdog keeps operating even if the CPU is in <a href="#_sleep_mode">Sleep Mode</a> or if the processor is being
debugged via the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuration Lock</strong></p>
</div>
<div class="paragraph">
<p>The watchdog control register can be <em>locked</em> to protect the current configuration from being modified. The lock is
activated by setting the <code>WDT_CTRL_LOCK</code> bit. The lock bit can only be cleared by a <em>hardware</em> reset</p>
</div>
<div class="paragraph">
<p>In the locked state any write access to the control register will trigger an immediate hardware reset (read accesses
are still possible and have no side effects). Additionally, writing an incorrect password to the <code>RESET</code> register will
also trigger an immediate hardware reset.</p>
</div>
<div class="paragraph">
<p><strong>Cause of last Hardware Reset</strong></p>
</div>
<div class="paragraph">
<p>The cause of the last system hardware reset can be determined via the two <code>WDT_CTRL_RCAUSE</code> bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WDT_RCAUSE_EXT</code> (0b00): Reset caused by external reset signal pin</p>
</li>
<li>
<p><code>WDT_RCAUSE_OCD</code> (0b01): Reset caused by on-chip debugger</p>
</li>
<li>
<p><code>WDT_RCAUSE_TMO</code> (0b10): Reset caused by watchdog timeout</p>
</li>
<li>
<p><code>WDT_RCAUSE_ACC</code> (0b11): Reset caused by illegal watchdog access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>External Reset Output</strong></p>
</div>
<div class="paragraph">
<p>The WDT provides a dedicated output (<a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>: <code>rstn_wdt_o</code>) to reset processor-external modules
when the watchdog times out. This signal is low-active and synchronous to the processor clock. It is available if the
watchdog is implemented; otherwise it is hardwired to <code>1</code>. Note that the signal also becomes active (low) when the
processor&#8217;s main reset signal is active (even if the watchdog is deactivated or disabled for synthesis).</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. WDT register map (<code>struct NEORV32_WDT</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 26.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-center valign-top">Reset value</th>
<th class="tableblock halign-center valign-top">Writable if locked</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>0xfffb0000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>    <code>WDT_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watchdog enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>    <code>WDT_CTRL_LOCK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lock configuration when set, clears only on system reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:2</code>  <code>WDT_CTRL_RCAUSE_HI : WDT_CTRL_RCAUSE_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cause of last system reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:4</code>  -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, reads as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code> <code>WDT_CTRL_TIMEOUT_MSB : WDT_CTRL_TIMEOUT_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout value (24-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffb0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write <em>PASSWORD</em> to reset WDT timeout counter</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_core_local_interruptor_clint">2.8.11. Core-Local Interruptor (CLINT)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_clint.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_clint.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__clint_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_clint.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__clint_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_msi_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V software IRQ if CLINT is <strong>not</strong> implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>irq_mti_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine timer IRQ if CLINT is <strong>not</strong> implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_time_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current system time (from CLINT&#8217;s MTIMER)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CLINT_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement core local interruptor when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compatible to the RISC-V CLINT specification</p>
</li>
<li>
<p>Global 64-bit system time</p>
</li>
<li>
<p>Timer and software interrupts for each CPU core</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The core local interruptor provides machine-level timer and software interrupts for a set of CPU cores (also called <em>harts).
It is compatible to the original SiFive&#174; CLINT specifications and it is also backwards-compatible to the upcoming RISC-V
_Advanced Core Local Interruptor (ACLINT)</em> specifications. In terms of the ACLINT spec the NEORV32 CLINT implements three
<em>devices</em> that are placed next to each other in the address space: an MTIMER and an MSWI device.</p>
</div>
<div class="paragraph">
<p>The CLINT can support up to 4095 harts. However, the NEORV32 CLINT is configured for a single hart only (yet).
Hence, only the according registers are implemented while the remaining ones are hardwired to zero.</p>
</div>
<div class="paragraph">
<p><strong>MTIMER Device</strong></p>
</div>
<div class="paragraph">
<p>The MTIMER device provides a global 64-bit machine timer (<code>NEORV32_CLINT&#8594;MTIME</code>) that increments with every main processor
clock tick. Upon reset the timer is reset to all zero. Each hart provides an individual 64-bit timer-compare register
(<code>NEORV32_CLINT&#8594;MTIMECMP[0]</code> for hart 0). Whenever <code>MTIMECMP &gt;= MTIME</code> the according machine timer interrupt is pending.</p>
</div>
<div class="paragraph">
<p><strong>MSWI Device</strong></p>
</div>
<div class="paragraph">
<p>The MSWI provides software interrupts for each hart via hart-individual memory-mapped registers (<code>NEORV32_CLINT&#8594;MSWI[0]</code> for
hart 0). Setting bit 0 of this register will bring the machine software interrupt into pending state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">External Machine Timer and Software Interrupts</div>
If the NEORV32 CLINT module is disabled (<code>IO_CLINT_EN</code> = <code>false</code>) the core&#8217;s machine timer interrupt and
machine software interrupt become available as processor-external signals (<code>irq_mti_i</code> and <code>irq_msi_i</code>, respectively).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. CLINT register map (<code>struct NEORV32_CLINT</code>)</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 42.8574%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfff40000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>MSWI[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger machine software interrupt for hart 0 when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfff40004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>MSWI[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger machine software interrupt for hart 1 when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff44000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTIMECMP[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit time compare for hart 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff44008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTIMECMP[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit time compare for hart 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff4bff8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTIME</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit global machine timer</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.8.12. Primary Universal Asynchronous Receiver and Transmitter (UART0)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__uart_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__uart_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rtsn_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_ctsn_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART0 when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART0_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART0_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Programmable FIFO status interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Independent RX and TX lines</p>
</li>
<li>
<p>Fixed format: 8 data bits, 1 stop bit, no parity bit</p>
</li>
<li>
<p>Programmable baud rate</p>
</li>
<li>
<p>Optional RX and TX FIFO buffers</p>
</li>
<li>
<p>Optional support for hardware flow-control</p>
</li>
<li>
<p>Interrupt based on FIFO buffer status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 UART provides a a standard universal asynchronous serial interface with independent transmitter and
receiver channels, each equipped with a configurable FIFO. The transmission frame is fixed to <strong>8-N-1</strong>: 8 data bits,
no parity bit, 1 stop bit. The actual transmission baud rate is programmable via software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Standard Console</div>
All default example programs and software libraries of the NEORV32 software framework (including the bootloader
and the runtime environment) use the primary UART (UART0) as default user console interface. Furthermore, UART0
is used to implement the standard consoles <code>STDIN</code>, <code>STDOUT</code> and <code>STDERR</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The module is enabled by setting the <code>UART_CTRL_EN</code> bit in the control register <code>CTRL</code>. A new TX transmission is
started by writing to the <code>DATA</code> register. RX data is available via the <code>DATA</code> register. The baud rate is configured
via a 10-bit <code>UART_CTRL_BAUDx</code> baud divisor (<code>baud_div</code>) and a 3-bit <code>UART_CTRL_PRSCx</code> clock prescaler select
(<code>clock_prescaler</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 16. UART0 Clock Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>UART_CTRL_PRSC[2:0]</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>Baud rate</strong></em> = (<em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code>) / (<code>baud_div</code> + 1)</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>RX and TX FIFOs</strong></p>
</div>
<div class="paragraph">
<p>The UART provides individual data FIFOs for RX and TX to allow data transmission without CPU intervention. The sizes
of these FIFOs can be configured via the according configuration generics (<code>UART0_RX_FIFO</code> and <code>UART0_TX_FIFO</code>). Write
to <code>DATA</code> and reads from <code>DATA</code> are automatically buffered by the according FIFO. Both FIFOs are automatically cleared
when disabling the module via the <code>UART_CTRL_EN</code> flag. The control register&#8217;s <code>UART_CTRL_RX_*</code> and <code>UART_CTRL_TX_*</code>
flags provide information about the RX and TX
FIFO fill level.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">RX/TX FIFO Size</div>
Software can retrieve the configured sizes of the RX and TX FIFO via the according <code>UART_DATA_RX_FIFO</code> and
<code>UART_DATA_TX_FIFO</code> bits from the <code>DATA</code> register.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>UART Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The UART module provides a single interrupt line that can be used to signal certain RX/TX data FIFO conditions. The
interrupt conditions are based on the RX/TX FIFO status flags (<code>UART_CTRL_RX_*</code> / <code>UART_CTRL_TX_*</code>) and are configured
via the according <code>UART_CTRL_IRQ_RX_*</code> / <code>UART_CTRL_IRQ_TX_*</code> bits. The UART interrupt will fire when the module is
enabled (<code>SLINK_CTRL_EN</code>) and <strong>any</strong> of the enabled interrupt conditions is met. Hence, all enabled interrupt
conditions are logically OR-ed. The interrupt remains active until all interrupt-causing conditions are resolved.</p>
</div>
<div class="paragraph">
<p><strong>RTS/CTS Hardware Flow Control</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 UART supports optional hardware flow control using the standard CTS <code>uart0_ctsn_i</code> ("clear to send") and
RTS <code>uart0_rtsn_o</code> ("ready to send" / "ready to receive (RTR)") signals. Both signals are low-active. Hardware flow
control is enabled by setting the <code>UART_CTRL_HWFC_EN</code> bit in the modules control register <code>CTRL</code>.</p>
</div>
<div class="paragraph">
<p>When hardware flow control is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The UART&#8217;s transmitter will not start a new transmission until the <code>uart0_ctsn_i</code> signal goes low. During this time
the UART busy flag <code>UART_CTRL_TX_BUSY</code> remains set.</p>
</li>
<li>
<p>The UART will set <code>uart0_rtsn_o</code> signal low if the RX FIFO is not already full. <code>uart0_rtsn_o</code> is always low if
hardware flow-control is disabled. Disabling the UART (setting <code>UART_CTRL_EN</code> low) while having hardware flow-control
enabled, will set <code>uart0_rtsn_o</code> high to indicate that the UART is not capable of receiving data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The simulation mode of the UART allows to redirect TX data to the simulator console instead of sending it via the
physical <code>uart0_txd_o</code> signal. Simulation mode is enabled by setting the <code>UART_CTRL_SIM_MODE</code> bit. When enabled,
all data written to the <code>DATA</code> register is sent to the simulator and printed as ASCII characters to the simulator console.
Note that this feature is only available within a simulation.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. UART0 register map (<code>struct NEORV32_UART0</code>)</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 27.7777%;">
<col style="width: 11.1111%;">
<col style="width: 27.7779%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>0xfff50000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>UART_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>UART_CTRL_SIM_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable <strong>simulation mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>UART_CTRL_HWFC_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable RTS/CTS hardware flow-control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5:3</code>   <code>UART_CTRL_PRSC_MSB : UART_CTRL_PRSC_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">baud rate clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:6</code>  <code>UART_CTRL_BAUD_MSB : UART_CTRL_BAUD_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10-bit baud value configuration value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>UART_CTRL_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO not empty (data available)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>    <code>UART_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>    <code>UART_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code>    <code>UART_CTRL_TX_NFULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code>    <code>UART_CTRL_IRQ_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire RX-IRQ if RX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code>    <code>UART_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire RX-IRQ if RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code>    <code>UART_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire TX-IRQ if TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code>    <code>UART_CTRL_IRQ_TX_NFULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire TX-IRQ if TX not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29:24</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>UART_CTRL_RX_OVER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO overflow; cleared by disabling the module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>UART_CTRL_TX_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX busy or TX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfff50004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <code>UART_DATA_RTX_MSB : UART_DATA_RTX_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:8</code>  <code>UART_DATA_RX_FIFO_MSB : UART_DATA_RX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(RX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:12</code> <code>UART_DATA_TX_FIFO_MSB : UART_DATA_TX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(TX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.8.13. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__uart_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__uart_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rtsn_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_ctsn_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART1 when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART1_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART1_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Programmable FIFO status interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) is functionally identical to the primary UART
(<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>). UART1 uses different addresses for the
control register (<code>CTRL</code>) and the data register (<code>DATA</code>) and uses a different CPU fast interrupt (FIRQ) channel.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. UART1 register map (<code>struct NEORV32_UART1</code>)</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff60000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff60004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UART0</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_serial_peripheral_interface_controller_spi">2.8.14. Serial Peripheral Interface Controller (SPI)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__spi_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__spi_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_clk_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit dedicated chip select output (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SPI controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable SPI interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>SPI-compatible host controller</p>
</li>
<li>
<p>Programmable clock phase and polarity</p>
</li>
<li>
<p>Fine-grained programmable clock</p>
</li>
<li>
<p>8 dedicated chip-select lines</p>
</li>
<li>
<p>Optional data/command FIFO (ring-buffer)</p>
</li>
<li>
<p>Interrupt if programmed transfer sequences have completed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 SPI module provides a <strong>host-mode</strong> serial peripheral interface. The module operates on byte-wide data,
supports all 4 standard SPI clock modes, provides a precise SPI clock generator and implements 8 dedicated chip select
signals via the top entity&#8217;s <code>spi_csn_o</code> signal. An optional receive/transmit ring-buffer/FIFO can be configured
via the <code>IO_SPI_FIFO</code> generic to support programming of complete SPI transmissions without CPU interaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Host-Mode Only</div>
The NEORV32 SPI module only supports <em>host mode</em>. Transmission are initiated only by the SPI
module itself. If you are looking for a <em>device-mode</em> serial peripheral interface (transactions
initiated by an external host) check out the <a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SPI module provides a single control register <code>CTRL</code> to configure the module and to check it&#8217;s status and a single
data register <code>DATA</code> for receiving/transmitting data and for issuing chip-select commands.</p>
</div>
<div class="paragraph">
<p>The SPI module is enabled by setting the <code>SPI_CTRL_EN</code> bit in the <code>CTRL</code> control register. No transfer can be initiated
and no interrupt request will be triggered if this bit is cleared. Clearing this bit resets the entire module, clears
the RX/TX FIFO and terminates any transfer being in process.</p>
</div>
<div class="paragraph">
<p>The actual SPI transfer (receiving one byte while also sending one byte) as well as control of the chip-select lines is
handled by the module&#8217;s <code>DATA</code> register. Note that this register will access the TX FIFO of the ring-buffer when writing
to it and will access the RX FIFO of the ring-buffer when reading from it.</p>
</div>
<div class="paragraph">
<p>The most significant bit of the <code>DATA</code> register (<code>SPI_DATA_CMD</code>) is used to select the purpose of the data being written.
When the <code>SPI_DATA_CMD</code> is cleared, the lowest 8-bit represent the actual SPI TX data that will be transmitted by the
SPI engine. After completion, the according receive data is pushed to the RX FIFO.</p>
</div>
<div class="paragraph">
<p>If <code>SPI_DATA_CMD</code> is set, the lowest 4-bit control the chip-select lines. In this case, bits <code>2:0</code> select one of the eight
chip-select lines. The selected line will become enabled when bit <code>3</code> is set. If bit <code>3</code> is cleared, all chip-select
lines will be disabled at once. Note that the bits of the <code>spi_csn_o</code> port are low-active. Only one chip-select can be
active at a time.</p>
</div>
<div class="paragraph">
<p>Since all SPI operations are controlled via the FIFOs, entire SPI sequences (chip-enable, data transmission(s), chip-disable)
can be <em>programmed</em>. Thus, SPI operations can be executed without any CPU interaction at all and can also be coordinated by
the system&#8217;s DMA controller.</p>
</div>
<div class="paragraph">
<p><strong>SPI Clock Configuration</strong></p>
</div>
<div class="paragraph">
<p>The SPI module supports all standard SPI clock modes (0, 1, 2, 3), which are configured via the two control register bits
<code>SPI_CTRL_CPHA</code> and <code>SPI_CTRL_CPOL</code>. The <code>SPI_CTRL_CPHA</code> bit defines the <em>clock phase</em> and the <code>SPI_CTRL_CPOL</code>
bit defines the <em>clock polarity</em>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-8768a218641e87f1e280589e63bce3fb.svg" alt="Diagram" width="900" height="240">
</div>
<div class="title">Figure 8. SPI Clock Modes</div>
</div>
<div class="paragraph">
<p>The SPI clock frequency (<code>spi_clk_o</code>) is programmed by the 3-bit <code>SPI_CTRL_PRSCx</code> clock prescaler for a coarse clock
selection and a 4-bit clock divider <code>SPI_CTRL_CDIVx</code> for a fine clock configuration. The following clock prescalers
(<code>SPI_CTRL_PRSCx</code>) are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 19. SPI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>SPI_CTRL_PRSC[2:0]</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the programmed clock configuration, the actual SPI clock frequency f<sub>SPI</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * <code>clock_prescaler</code> * (1 + <code>SPI_CTRL_CDIVx</code>))</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock is f<sub>main</sub> / 4 and the lowest SPI clock is f<sub>main</sub> / 131072.
The SPI clock is always symmetric having a duty cycle of exactly 50%.</p>
</div>
<div class="paragraph">
<p><strong>SPI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SPI module provides a single interrupt that gets triggered when the programmed SPI sequence
has completed (i.e. the TX FIFO is empty and the SPI engine is idle).</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. SPI register map (<code>struct NEORV32_SPI</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="14"><p class="tableblock"><code>0xfff80000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="14"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>SPI_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>SPI_CTRL_CPHA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock phase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>SPI_CTRL_CPOL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock polarity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5:3</code>   <code>SPI_CTRL_PRSC2 : SPI_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9:6</code>   <code>SPI_CTRL_CDIV3 : SPI_CTRL_CDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider for fine-tuning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:10</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>SPI_CTRL_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available (RX FIFO not empty)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>    <code>SPI_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>    <code>SPI_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27:24</code> <code>SPI_CTRL_FIFO_MSB : SPI_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<code>IO_SPI_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29:28</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>SPI_CS_ACTIVE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if any chip-select line is active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>SPI_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI module busy when set (serial engine operation in progress and TX FIFO not empty yet)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfff80004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>  <code>SPI_DATA_MSB : SPI_DATA_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (FIFO), only for data mode (<code>SPI_DATA_CMD = 0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chip-select-enable (bit 3) and chip-select (bit 2:0), only for command mode (<code>SPI_DATA_CMD = 1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30:8</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>   <code>SPI_DATA_CMD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> = data, <code>1</code> = chip-select-command</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_serial_data_interface_controller_sdi">2.8.15. Serial Data Interface Controller (SDI)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sdi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sdi.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__sdi_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sdi.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__sdi_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_clk_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_csn_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit chip-select input (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SDI controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data FIFO size, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable SDI interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>SPI-compatible device-side controller</p>
</li>
<li>
<p>Programmable SPI clock polarity</p>
</li>
<li>
<p>Optional data RX/TX FIFO</p>
</li>
<li>
<p>Interrupt based on FIFO status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The serial data interface module provides a <strong>device-side</strong> SPI interface to receive communications from an
<strong>external SPI host</strong>, which is responsible for performing the actual transmission (i.e. the host generates the
SPI clock and control the chip-select line). An optional receive/transmit FIFO can be configured via the
<code>IO_SDI_FIFO</code> generic to support transmissions without CPU interaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Device-Mode Only</div>
The NEORV32 SDI module only supports <em>device mode</em>. If you are looking for a <em>host-mode</em> serial peripheral
interface (transactions performed by the NEORV32) check out the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SDI module provides a single control register <code>CTRL</code> to configure the module and to check its status and a
single data register <code>DATA</code> for receiving/transmitting data. Any access to the <code>DATA</code> register actually accesses
the internal RX/TX FIFO.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SDI module is enabled by setting the <code>SDI_CTRL_EN</code> bit in the <code>CTRL</code> control register. Clearing this bit
resets the entire module and will also clear the entire RX/TX FIFO.</p>
</div>
<div class="paragraph">
<p>The SDI operates on byte-level. Data bytes written to the <code>DATA</code> register will be pushed to the internal TX
FIFO. This TX data will be sent back to the external host during an SPI transfer. If no data is available in the
TX FIFO all-zero is sent. Received bytes are pushed to the RX FIFO and can be retrieved by reading the RX FIFO via
the <code>DATA</code> register. Data is always transferred MSB-first. The current state of these FIFOs is available via the
control register&#8217;s <code>SDI_CTRL_RX_*</code> and <code>SDI_CTRL_TX_*</code> status flags. The RX/TX FIFOs can be cleared at any time by
the <code>SDI_CTRL_CLR_*</code> control register bits.</p>
</div>
<div class="paragraph">
<p>Data is only transferred (and pushed to the RX FIFO / popped from the TX FIFO) when the chip-select input <code>sdi_csn_i</code>
is active (low-active). If the external SPI host aborts the transmission by setting the chip-select signal high again
<em>before</em> 8 data bits have been transferred, no data is written to the RX FIFO and no data is retrieved from the TX FIFO.</p>
</div>
<div class="paragraph">
<p><strong>SDI Clocking</strong></p>
</div>
<div class="paragraph">
<p>The SDI module supports both SPI clock polarity modes ("CPOL"), but only "CPHA=0"-clock-phase is <em>officially</em>
supported yet. However, experiments have shown that the SDI module can also deal with both clock phase modes.</p>
</div>
<div class="paragraph">
<p>All SDI operations are clocked by the external <code>sdi_clk_i</code> signal. This signal is synchronized to the processor&#8217;s
clock domain to simplify timing behavior. This clock synchronization requires the external SDI clock (<code>sdi_clk_i</code>)
to <strong>not exceed 1/4 of the processor&#8217;s main clock</strong>.</p>
</div>
<div class="paragraph">
<p><strong>SDI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SDI module provides a single interrupt that is triggered by a set of programmable interrupt conditions that are
based on the status of the RX &amp; TX FIFOs. The different interrupt sources are enabled by setting the according
<code>SDI_CTRL_IRQ_*</code> bits. All enabled interrupt conditions are logically OR-ed - so any enabled interrupt source will
trigger the module&#8217;s interrupt signal. Once the SDI interrupt has fired it will remain active until the actual cause
of the interrupt is resolved.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. SDI register map (<code>struct NEORV32_SDI</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>0xfff70000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>SDI_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDI module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>SDI_CTRL_CLR_RX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clear RX FIFO, flag auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>SDI_CTRL_CLR_TX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clear TX FIFO, flag auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>     -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:4</code>   <code>SDI_CTRL_FIFO_MSB : SDI_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<em>IO_SDI_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code>  -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>SDI_CTRL_IRQ_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if RX FIFO is not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>    <code>SDI_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if if RX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>    <code>SDI_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code>    <code>SDI_CTRL_RX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code>    <code>SDI_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code>    <code>SDI_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>SDI_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30:28</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>SDI_CTRL_CS_ACTIVE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chip-select is active when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfff70004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>  <code>SDI_DATA_MSB : SDI_DATA_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (FIFO)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_two_wire_serial_interface_controller_twi">2.8.16. Two-Wire Serial Interface Controller (TWI)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__twi_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__twi_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWI_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TWI controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWI_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO empty and module idle interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Philips IC-compatible host controller</p>
</li>
<li>
<p>Programmable clock speed</p>
</li>
<li>
<p>Support for host-ACK generated by the controller</p>
</li>
<li>
<p>Optional support for clock stretching</p>
</li>
<li>
<p>Optional data/command FIFO</p>
</li>
<li>
<p>Interrupt based on FIFO status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 TWI implements an I2C-compatible host controller to communicate with arbitrary I2C-devices.
Note that multi-controller mode and bus arbitration are not supported.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Host-Mode Only</div>
The NEORV32 TWI controller only supports <strong>host mode</strong>. Transmission are initiated by the processor&#8217;s TWI controller
and not by an external IC module. If you are looking for a <em>device-mode</em> module (transactions
initiated by an external host) check out the <a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The TWI controller provides two memory-mapped registers that are used for configuration &amp; status check (<code>CTRL</code>) and
for accessing transmission data (<code>DATA</code>). The <code>DATA</code> register is transparently buffered by separate RX and TX FIFOs.
The size of those FIFOs can be configured by the <code>IO_TWI_RX_FIFO</code> and <code>IO_TWI_TX_FIFO</code> generics. Software can determine
the FIFO size via the control register&#8217;s <code>TWI_CTRL_FIFO_*</code> bits. The current status of the RX and TX FIFO can be polled
by software via the <code>TWD_CTRL_RX_*</code> and <code>TWI_CTRL_TX_*</code> flags.</p>
</div>
<div class="paragraph">
<p>The module is globally enabled by setting the control register&#8217;s <code>TWI_CTRL_EN</code> bit. Clearing this bit will disable
and reset the entire module also clearing the internal RX and TX FIFOs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Current Bus State</div>
The current state of the I2C bus lines (SCL and SDA) can be checked by software via the <code>TWI_CTRL_SENSE_*</code> control
register bits. Note that the TWI module needs to be enabled in order to sample the bus state.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TWI Clock Speed</strong></p>
</div>
<div class="paragraph">
<p>The TWI clock frequency is programmed by two bit-fields in the device&#8217;s control register <code>CTRL</code>: a 3-bit clock prescaler
(<code>TWI_CTRL_PRSCx</code>) is used for a coarse clock configuration and a 4-bit clock divider (<code>TWI_CTRL_CDIVx</code>) is used for a fine
clock configuration.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 22. TWI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>TWI_CTRL_PRSC[2:0]</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the clock configuration, the actual TWI clock frequency f<sub>SCL</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>f<sub>SCL</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (4 * <code>clock_prescaler</code> * (1 + TWI_CTRL_CDIV))</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Hence, the maximum TWI clock is f<sub>main</sub> / 8 and the lowest TWI clock is f<sub>main</sub> / 262144. The generated TWI clock is
always symmetric having a duty cycle of exactly 50% (if the clock is not haled by a device during clock stretching).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Clock Stretching</div>
An accessed peripheral can slow down/halt the controller&#8217;s bus clock by using clock stretching (= actively keeping the
SCL line low). The controller will halt operation in this case. Clock stretching is enabled by setting the
<code>TWI_CTRL_CLKSTR</code> bit in the module&#8217;s control register <code>CTRL</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TWI Transfers</strong></p>
</div>
<div class="paragraph">
<p>All TWI operations are controlled by the <code>DCMD</code> register, which is buffered by a FIFO. This command/data FIFO is internally
split into a TX FIFO and a RX FIFO. Writing to <code>DCMD</code> will write to the TX FIFO while reading from <code>DCMD</code> will read from the
RX FIFO. Thus, complete TWI sequences can be programmed and executed without further CPU intervention. The actual operation
is selected by a 2-bit value that is written to the register&#8217;s <code>TWI_DCMD_CMD_*</code> bit-field:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>00</code>: NOP (no-operation); all further bit-fields in <code>DCMD</code> are ignored; no bus operation is executed</p>
</li>
<li>
<p><code>01</code>: Generate a (repeated) START condition; all further bit-fields in <code>DCMD</code> are ignored</p>
</li>
<li>
<p><code>10</code>: Generate a STOP condition; all further bit-fields in <code>DCMD</code> are ignored</p>
</li>
<li>
<p><code>11</code>: Trigger a data transmission; see below</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For any transmission the data to be send has to be written to the register&#8217;s <code>TWI_DCMD_MSB : TWI_DCMD_LSB</code> bit-field.
If <code>TWI_DCMD_ACK</code> is set the controller will generate an ACK by it&#8217;s own. If <code>TWI_DCMD_ACK</code> is cleared the controller will
sample ACK/NACK from the accessed device. Vice versa, the device&#8217;s data response can be read from <code>TWI_DCMD_MSB : TWI_DCMD_LSB</code>
bit-field. The ACK/NACK generated by the device can be read from the <code>TWI_DCMD_ACK</code> bit.</p>
</div>
<div class="paragraph">
<p>The control register&#8217;s busy flag <code>TWI_CTRL_BUSY</code> is set as long as the TX FIFO contains data (i.e. programmed TWI operations
that have not been executed yet) or if the TWI bus engine is still processing an operation. An active transmission can be
terminated at any time by disabling the TWI module. This will also clear the data/command FIFO.</p>
</div>
<div class="paragraph">
<p><strong>Tristate Drivers</strong></p>
</div>
<div class="paragraph">
<p>The TWI module requires two tristate drivers (actually: open-drain drivers - signals can only be actively driven low) for
the SDA and SCL lines, which have to be implemented by the user in the setup&#8217;s top module / IO ring. A generic VHDL example
is shown below (here, <code>sda_io</code> and <code>scl_io</code> are the actual IC bus lines, which are of type <code>std_logic</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. TWI VHDL Tristate Driver Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-VHDL hljs" data-lang="VHDL">sda_io    &lt;= '0' when (twi_sda_o = '0') else 'Z'; -- drive
scl_io    &lt;= '0' when (twi_scl_o = '0') else 'Z'; -- drive
twi_sda_i &lt;= std_ulogic(sda_io); -- sense
twi_scl_i &lt;= std_ulogic(scl_io); -- sense</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>TWI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The TWI module provides a single interrupt to signal "idle condition" to the CPU. The interrupt becomes active when the
TWI module is enabled (<code>TWI_CTRL_EN</code> = <code>1</code>) and the TX FIFO is empty and the TWI bus engine is idle.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. TWI register map (<code>struct NEORV32_TWI</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="12"><p class="tableblock"><code>0xfff90000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="12"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>TWI_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:1</code>   <code>TWI_CTRL_PRSC2 : TWI_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:4</code>   <code>TWI_CTRL_CDIV3 : TWI_CTRL_CDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>     <code>TWI_CTRL_CLKSTR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable (allow) clock stretching</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14:9</code>   -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18:15</code> <code>TWI_CTRL_FIFO_MSB : TWI_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<code>IO_TWI_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26:12</code>  -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>TWI_CTRL_SENSE_SCL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of the SCL bus line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>    <code>TWI_CTRL_SENSE_SDA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of the SDA bus line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>TWI_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TWI bus is claimed by any controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>TWI_CTRL_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>TWI_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI bus engine busy or TX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfff90004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DCMD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <code>TWI_DCMD_MSB : TWI_DCMD_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write: TX data byte; read: RX data byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>     <code>TWI_DCMD_ACK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write: ACK issued by controller; read: <code>1</code> = device NACK, <code>0</code> = device ACK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10:9</code>  <code>TWI_DCMD_CMD_HI : TWI_DCMD_CMD_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI operation (<code>00</code> = NOP, <code>01</code> = START conditions, <code>10</code> = STOP condition, <code>11</code> = data transmission)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:11</code>  -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_two_wire_serial_device_controller_twd">2.8.17. Two-Wire Serial Device Controller (TWD)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twd.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twd.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__twd_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twd.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__twd_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_sda_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_sda_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_scl_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twd_scl_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWD_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TWD controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWD_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWD_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO status interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>IC-compatible device-side controller</p>
</li>
<li>
<p>Programmable 7-bit device address</p>
</li>
<li>
<p>Optional RX/TX data FIFOs</p>
</li>
<li>
<p>Programmable interrupt conditions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 TWD implements an I2C-compatible <strong>device-side</strong> interface. Processor-external I2C hosts can communicate
with this module by issuing I2C transactions. The TWD is entirely passive an only reacts to external transmissions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Device-Mode Only</div>
The NEORV32 TWD controller only supports <strong>device mode</strong>. Transmission are initiated by processor-external modules
and not by an external TWD. If you are looking for a <em>host-mode</em> module (transactions initiated by the processor)
check out the <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The TWD module provides two memory-mapped registers that are used for configuration &amp; status check (<code>CTRL</code>) and
for accessing transmission data (<code>DATA</code>). The <code>DATA</code> register is transparently buffered by separate RX and TX FIFOs.
The size of those FIFOs can be configured by the <code>IO_TWD_RX_FIFO</code> and <code>IO_TWD_TX_FIFO</code> generics. Software can determine
the FIFO size via the control register&#8217;s <code>TWD_CTRL_FIFO_*</code> bits. The current status of the RX and TX FIFO can be polled
by software via the <code>TWD_CTRL_RX_*</code> and <code>TWD_CTRL_TX_*</code> flags.</p>
</div>
<div class="paragraph">
<p>The module is globally enabled by setting the control register&#8217;s <code>TWD_CTRL_EN</code> bit. Clearing this bit will disable
and reset the entire module also clearing the internal RX and TX FIFOs. Each FIFO can also be cleared individually at
any time by setting <code>TWD_CTRL_CLR_RX</code> or <code>TWD_CTRL_CLR_TX</code> control register bits, respectively.</p>
</div>
<div class="paragraph">
<p>The external IC bus is sampled and synchronized into the processor&#8217;s clock domain with a sampling frequency of
1/8 of the processor&#8217;s main clock. In order to increase the resistance to glitches the sampling frequency can be lowered
to 1/64 of the processor clock by setting the control register&#8217;s <code>TWD_CTRL_FSEL</code> bit.</p>
</div>
<div class="paragraph">
<p>The TWD only responds to a configurable 7-bit device address that is programmed by the <code>TWD_CTRL_DEV_ADDR</code> bits.
Specific general-call or broadcast addresses are not supported yet.</p>
</div>
<div class="paragraph">
<p>Depending on the transaction type, data is either read from the TX FIFO and transferred back to the host
(<strong>read operation</strong>) or data is received from the host and written to the RX FIFO (<strong>write operation</strong>).</p>
</div>
<div class="paragraph">
<p><strong>Read Operation: Host Reads Data from TWD Module</strong></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-8d8d27ddeab96404021f77a980a7893b.svg" alt="Diagram" width="1400" height="150">
</div>
<div class="title">Figure 9. Exemplary single-byte TWD read operation (split across two lines)</div>
</div>
<div class="paragraph">
<p>For a read operation the host first generates START or REPEATED-START condition. Then, the host transmits the 7 bit device
address (green signals <code>A6</code> to <code>A0</code>) plus the read-command bit. If the transferred address matches the one programmed to to
<code>TWD_CTRL_DEV_ADDR</code> control register bits the TWD module will response with an ACK by pulling the SDA bus line actively
low during the 9th SCL clock pulse. If there is no address match the TWD will not interfere with the bus and will wait for
the next START or REPEATED-START condition.</p>
</div>
<div class="paragraph">
<p>For the actual data transmission the host keeps the SDA line at high state while sending the clock pulses. The TWD will
read a byte from the internal TX FIFO and will transmit it MSB-first to the host. During the 9th clock pulse the host has
to acknowledged the transfer (ACK) by pulling SDA low. If no ACK is received by the TWD no data is taken from the TX FIFO
and the same byte is transmitted in the next data phase. If the TX FIFO becomes empty while the host keeps reading data,
all-one bytes are sent back to the host. The transaction is terminated by a STOP condition.</p>
</div>
<div class="paragraph">
<p><strong>Write Operation: Host Writes Data to TWD Module</strong></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-f0913f428656f71ee309708c0ce4f00d.svg" alt="Diagram" width="1400" height="150">
</div>
<div class="title">Figure 10. Exemplary single-byte TWD write operation timing (split across two lines)</div>
</div>
<div class="paragraph">
<p>For a write operation the host first generates START or REPEATED-START condition. Then, the host transmits the 7 bit device
address (green signals <code>A6</code> to <code>A0</code>) plus the write-command bit. If the transferred address matches the one programmed to to
<code>TWD_CTRL_DEV_ADDR</code> control register bits the TWD module will response with an ACK by pulling the SDA bus line actively
low during the 9th SCL clock pulse. If there is no address match the TWD will not interfere with the bus and will wait for
the next START or REPEATED-START condition.</p>
</div>
<div class="paragraph">
<p>For the actual data transmission the host sends the write-data MSB first together with the clock pulses. During the 9th clock
pulse the TWD will respond with an ACK by pulling SDA low. Note that the TWD will respond with a NACK if the RX FIFO is full.
The transaction is terminated by a STOP condition.</p>
</div>
<div class="paragraph">
<p><strong>Communication Status</strong></p>
</div>
<div class="paragraph">
<p>Actual communication with the TWD is (re-)<strong>started</strong> when a START or REPEATED-START condition followed by the TWD device
address is received. This communication is <strong>terminated</strong> as soon as a STOP condition is received. The current state of the
communication can be polled via the <code>TWD_CTRL_COM</code> control register flag.</p>
</div>
<div class="paragraph">
<p>Whenever a communication start has been observed the <code>TWD_CTRL_COM_BEG</code> control register flag becomes set.
Accordingly, the <code>TWD_CTRL_COM_END</code> control register flag becomes set whenever a communication end / termination
has been observed. These flags retain their value until they are either manually deleted (by writing a <code>1</code> to
the respective flag) or the TWD module is deactivated and thus reset.</p>
</div>
<div class="paragraph">
<p><strong>TWD Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The TWD module provides a single interrupt to signal certain FIFO conditions and/or communication states to the CPU.
The control register&#8217;s <code>TWD_CTRL_IRQ_*</code> bits are used to enabled individual interrupt conditions. Note that all enabled
conditions are logically OR-ed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. TWD Interrupts Sources</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interrupt Enable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Interrupt Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_IRQ_RX_AVAIL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt if at least one data byte is available in the RX FIFO.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_RX_AVAIL == 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt if the RX FIFO is full.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_RX_FULL == 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt if the TX FIFO is empty.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_TX_EMPTY == 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_IRQ_TX_NFULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt if the TX FIFO is not full yet.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_TX_FULL == 0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_IRQ_COM_BEG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt if a communication-start has been observed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_COM_BEG == 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_IRQ_COM_END</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt if a communication-end has been observed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWD_CTRL_COM_END == 1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The CPU interrupt request remains active until all enabled interrupt-causing conditions are resolved.
The interrupt can only trigger if the module is actually enabled (<code>TWD_CTRL_EN</code> is set).</p>
</div>
<div class="paragraph">
<p><strong>Tristate Drivers</strong></p>
</div>
<div class="paragraph">
<p>The TWD module requires two tristate drivers (actually: open-drain drivers - signals can only be actively driven low) for
the SDA and SCL lines, which have to be implemented by the user in the setup&#8217;s top module / IO ring. A generic VHDL example
is shown below (here, <code>sda_io</code> and <code>scl_io</code> are the actual TWD bus lines).</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. TWD Tristate Driver Example (VHDL)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-VHDL hljs" data-lang="VHDL">sda_io : inout std_logic;
scl_io : inout std_logic;
...
sda_io    &lt;= '0' when (twd_sda_o = '0') else 'Z'; -- drive (pull low)
scl_io    &lt;= '0' when (twd_scl_o = '0') else 'Z'; -- drive (pull low)
twd_sda_i &lt;= std_ulogic(sda_io); -- sense
twd_scl_i &lt;= std_ulogic(scl_io); -- sense</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. TWD register map (<code>struct NEORV32_TWD</code>)</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 7.1428%;">
<col style="width: 42.8573%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="20"><p class="tableblock"><code>0xffea0000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="20"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>TWD_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWD enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>TWD_CTRL_CLR_RX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear RX FIFO, flag auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>TWD_CTRL_CLR_TX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear TX FIFO, flag auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>     <code>TWD_CTRL_FSEL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus sample clock / filter select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10:4</code>  <code>TWD_CTRL_DEV_ADDR6 : TWD_CTRL_DEV_ADDR0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device address (7-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code>    <code>TWD_CTRL_IRQ_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if RX FIFO data available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code>    <code>TWD_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code>    <code>TWD_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code>    <code>TWD_CTRL_IRQ_TX_NFULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if TX FIFO is not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code>    <code>TWD_CTRL_IRQ_COM_BEG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if begin of communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>TWD_CTRL_IRQ_COM_END</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if end of communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20:17</code> <code>TWD_CTRL_RX_FIFO_MSB : TWD_CTRL_RX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<code>IO_TWD_RX_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24:21</code> <code>TWD_CTRL_TX_FIFO_MSB : TWD_CTRL_TX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<code>IO_TWD_TX_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code>    <code>TWD_CTRL_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code>    <code>TWD_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>TWD_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>    <code>TWD_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>TWD_CTRL_COM_BEG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Communication has started; clear by writing 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>TWD_CTRL_COM_END</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Communication has ended; clear by writing 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>TWD_CTRL_COM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xffea0004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <code>TWD_DATA_MSB : TWD_DATA_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX/TX data FIFO access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code>  -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_one_wire_serial_interface_controller_onewire">2.8.18. One-Wire Serial Interface Controller (ONEWIRE)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__onewire_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__onewire_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit 1-wire bus sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit 1-wire bus output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_ONEWIRE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement ONEWIRE interface controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_ONEWIRE_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTX FIFO depth, has to be zero or a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dallas&#174; 1-Wire&#8482;-compatible host controller</p>
</li>
<li>
<p>Hardware-based protocol handling (RESET, presence, data, etc.)</p>
</li>
<li>
<p>Fine-grained programmable bus timings</p>
</li>
<li>
<p>Optional data/command FIFO</p>
</li>
<li>
<p>Interrupt based on FIFO status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 ONEWIRE module implements a single-wire interface controller that is compatible to the
Dallas/Maxim 1-Wire protocol, which is an asynchronous half-duplex bus requiring only a single signal wire
(plus ground) for communication.</p>
</div>
<div class="paragraph">
<p>The bus is based on a single open-drain signal. The controller as well as all devices on the bus can only pull-down
the bus (similar to TWI/I2C). The default high-level is provided by a single pull-up resistor connected to the positive
power supply close to the bus controller. Recommended values are between 1k and 10k depending on the bus
characteristics (wire length, number of devices, etc.).</p>
</div>
<div class="paragraph">
<p><strong>Tri-State Drivers</strong></p>
</div>
<div class="paragraph">
<p>The ONEWIRE module requires a tristate driver (actually, just an open-drain driver) for the 1-wire bus line, which has
to be implemented in the top module / IO ring of the design. A generic VHDL example is given below (<code>onewire_io</code> is the
actual 1-wire bus signal, which is of type <code>std_logic</code>; <code>onewire_o</code> and <code>onewire_i</code> are the processor&#8217;s ONEWIRE port signals).</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. ONEWIRE VHDL Tristate Driver Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-VHDL hljs" data-lang="VHDL">onewire_io &lt;= '0' when (onewire_o = '0') else 'Z'; -- drive (low)
onewire_i  &lt;= std_ulogic(onewire_io); -- sense</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The ONEWIRE controller provides two interface registers: <code>CTRL</code> and <code>DCMD.</code> The control register (<code>CTRL</code>)
is used to configure the module and to monitor the current state. The <code>DCMD</code> register, which can optionally
by buffered by a configurable FIFO (<code>IO_ONEWIRE_FIFO</code> generic), is used to read/write data from/to the bus
and to trigger bus operations.</p>
</div>
<div class="paragraph">
<p>The module is enabled by setting the <code>ONEWIRE_CTRL_EN</code> bit in the control register. If this bit is cleared, the
module is automatically reset, any bus operation is aborted, the bus is brought to high-level (due to the external
pull-up resistor) and the internal FIFO is cleared. The basic timing configuration is programmed via a coarse clock
prescaler (<code>ONEWIRE_CTRL_PRSCx</code> bits) and a fine clock divider (<code>ONEWIRE_CTRL_CLKDIVx</code> bits).</p>
</div>
<div class="paragraph">
<p>The controller can execute four basic bus operations, which are triggered by writing the according command bits
in the <code>DCMD</code> register (<code>ONEWIRE_DCMD_DATA_*</code> bits) while also writing the actual data bits (<code>ONEWIRE_DCMD_CMD_*</code>
bits).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>0b00</code> (<code>ONEWIRE_CMD_NOP</code>) - no operation (dummy)</p>
</li>
<li>
<p><code>0b01</code> (<code>ONEWIRE_CMD_BIT</code>) - transfer a single-bit (read-while-write)</p>
</li>
<li>
<p><code>0b10</code> (<code>ONEWIRE_CMD_BYTE</code>) - transfer a full-byte (read-while-write)</p>
</li>
<li>
<p><code>0b11</code> (<code>ONEWIRE_CMD_RESET</code>) - generate reset pulse and check for device presence</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Every command (except NOP) will result in a bus operation when dispatched from the data/command FIFO.
Each command (except NOP) will also sample a bus response (a read bit, a read byte or a presence pulse) to a
shadowed receive FIFO that is accessed when reading the <code>DCMD</code> register.</p>
</div>
<div class="paragraph">
<p>When the single-bit operation (<code>ONEWIRE_CMD_BIT</code>) is executed, the data previously written to <code>DCMD[0]</code> will
be send to the bus and the response is sample to <code>DCMD[7]</code>. Accordingly, a full-byte transmission (<code>ONEWIRE_CMD_BYTE</code>)
will send the byte written to <code>DCMD[7:0]</code> to the bus and will sample the response to <code>DCMD[7:0]</code> (LSB-first). Finally, the
reset command (<code>ONEWIRE_CMD_RESET</code>) will generate a bus reset and will also sample the "presence pulse" from the device(s)
to the <code>DCMD[ONEWIRE_DCMD_PRESENCE]</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read from Bus</div>
In order to read a single bit from the bus <code>DCMD[0]</code> has to set to <code>1</code> before triggering the bit transmission
operation to allow the accessed device to pull-down the bus. Accordingly, <code>DCMD[7:0]</code> has to be set to <code>0xFF</code> before
triggering the byte transmission operation when the controller shall read a byte from the bus.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As soon as the current bus operation has completed (and there are no further operations pending in the FIFO) the
<code>ONEWIRE_CTRL_BUSY</code> bit in the control registers clears.</p>
</div>
<div class="paragraph">
<p><strong>Bus Timing</strong></p>
</div>
<div class="paragraph">
<p>The control register provides a 2-bit clock prescaler select (<code>ONEWIRE_CTRL_PRSC</code>) and a 8-bit clock divider
(<code>ONEWIRE_CTRL_CLKDIV</code>) for timing configuration. Both are used to define the elementary base time T<sub>base</sub>.
All bus operations are timed using multiples of this elementary base time.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 26. ONEWIRE Clock Prescaler Configurations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>ONEWIRE_CTRL_PRSC[2:0]</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b00</code></th>
<th class="tableblock halign-center valign-top"><code>0b01</code></th>
<th class="tableblock halign-center valign-top"><code>0b10</code></th>
<th class="tableblock halign-center valign-top"><code>0b11</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Together with the clock divider value (<code>ONEWIRE_CTRL_PRSCx</code> bits = <code>clock_divider</code>) the base time is defined by the
following formula:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>T<sub>base</sub></strong></em> = (1 / <em>f<sub>main</sub>[Hz]</em>) * <code>clock_prescaler</code> * (<code>clock_divider</code> + 1)</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>f<sub>main</sub></em> = 100MHz</p>
</li>
<li>
<p>clock prescaler select = <code>0b01</code> &#8594; <code>clock_prescaler</code> = 4</p>
</li>
<li>
<p>clock divider <code>clock_divider</code> = 249</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>T<sub>base</sub></strong></em> = (1 / 100000000Hz) * 4 * (249 + 1) = 10000ns = <strong>10s</strong></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The base time is used to coordinate all bus interactions. Hence, all delays, time slots and points in time are
quantized as multiples of the base time T<sub>base</sub>. The following images show the two basic operations of the ONEWIRE
controller: single-bit (0 or 1) transaction and reset with presence detect. Note that the full-byte operations just repeats
the single-bit operation eight times. The relevant points in time are shown as <em>absolute</em> time points (in multiples of the
time base T<sub>base</sub>) with the falling edge of the bus as reference points.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-f6b0724faa555870de41192bed2934fa.svg" alt="Diagram" width="400" height="150">
</div>
<div class="title">Figure 11. Single-bit data transmission (not to scale)</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-f33abf6df22e0555461e14be7cb59887.svg" alt="Diagram" width="400" height="120">
</div>
<div class="title">Figure 12. Reset pulse and presence detect (not to scale)</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 27. Data Transmission Timing</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 21.4285%;">
<col style="width: 21.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Multiples of T<sub>base</sub></th>
<th class="tableblock halign-center valign-top">Time when T<sub>base</sub> = 10s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Single-bit data transmission</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t0</code> (a&#8594;b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of active low-phase when writing a <code>'1'</code> or when reading</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t1</code> (a&#8594;c)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until controller samples bus state (read operation)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">20s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t2</code> (a&#8594;d)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of bit time slot (when writing a <code>'0'</code> or when reading)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">70s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t3</code> (a&#8594;e)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of inter-slot pause (= total duration of one bit)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">90s</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Reset pulse and presence detect</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t4</code> (f&#8594;g)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of active reset pulse</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">480s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t5</code> (f&#8594;h)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until controller samples bus presence</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">55</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">550s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t6</code> (f&#8594;i)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of presence phase</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">960s</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default Timing Parameters</div>
The "known-good" default values for base time multiples were chosen for stable and reliable bus
operation and not for maximum throughput.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The absolute points in time are hardwired by the VHDL code and cannot be changed during runtime.
However, the timing parameter can be customized (if necessary) by editing the ONEWIRE&#8217;s VHDL source file.
The times t0 to t6 correspond to the previous timing diagrams.</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. Hardwired timing configuration in <code>neorv32_onewire.vhd</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-VHDL hljs" data-lang="VHDL">-- timing configuration (absolute time in multiples of the base tick time t_base) --
constant t_write_one_c       : unsigned(6 downto 0) := to_unsigned( 1, 7); -- t0
constant t_read_sample_c     : unsigned(6 downto 0) := to_unsigned( 2, 7); -- t1
constant t_slot_end_c        : unsigned(6 downto 0) := to_unsigned( 7, 7); -- t2
constant t_pause_end_c       : unsigned(6 downto 0) := to_unsigned( 9, 7); -- t3
constant t_reset_end_c       : unsigned(6 downto 0) := to_unsigned(48, 7); -- t4
constant t_presence_sample_c : unsigned(6 downto 0) := to_unsigned(55, 7); -- t5
constant t_presence_end_c    : unsigned(6 downto 0) := to_unsigned(96, 7); -- t6</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Overdrive Mode</div>
The ONEWIRE controller does not support the overdrive mode natively. However, it can be implemented by reducing
the base time <strong>T<sub>base</sub></strong> (and by eventually changing the hardwired timing configuration in the VHDL source file).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interrupt</strong></p>
</div>
<div class="paragraph">
<p>A single interrupt is provided by the ONEWIRE module to signal "idle" condition to the CPU. Whenever the
controller is idle (again) and the data/command FIFO is empty, the interrupt becomes active.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. ONEWIRE register map (<code>struct NEORV32_ONEWIRE</code>)</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock"><code>0xfff20000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>ONEWIRE_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ONEWIRE enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>ONEWIRE_CTRL_CLEAR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clear RXT FIFO, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:2</code>   <code>ONEWIRE_CTRL_PRSC1 : ONEWIRE_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:4</code>  <code>ONEWIRE_CTRL_CLKDIV7 : ONEWIRE_CTRL_CLKDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit clock divider value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14:12</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18:15</code> <code>ONEWIRE_CTRL_FIFO_MSB : ONEWIRE_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<code>IO_ONEWIRE_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27:19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>    <code>ONEWIRE_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>ONEWIRE_CTRL_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>ONEWIRE_CTRL_SENSE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of the bus line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>ONEWIRE_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation in progress when set or TX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfff20004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DCMD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>  <code>ONEWIRE_DCMD_DATA_MSB : ONEWIRE_DCMD_DATA_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9:8</code>  <code>ONEWIRE_DCMD_CMD_HI : ONEWIRE_DCMD_CMD_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation command LSBs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code>   <code>ONEWIRE_DCMD_PRESENCE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus presence detected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:11</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_pulse_width_modulation_controller_pwm">2.8.19. Pulse-Width Modulation Controller (PWM)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__pwm_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__pwm_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM output channels (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_PWM_NUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of PWM channels to implement (0..32)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Up to 32 individual channels with up to 16-bit resolution and programmable polarity</p>
</li>
<li>
<p>Fast-PWM or phase-correct operation mode with counter-compare and counter-wrap registers</p>
</li>
<li>
<p>Toggle-free 0% and 100% duty cycle output rates</p>
</li>
<li>
<p>Global clock prescaler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The PWM module implements a pulse-width modulation controller with up to 32 independent channels. Period length
(and thus, the carrier frequency), duty cycle, polarity and operation mode can be programmed individually for each
channel. However, the clock for the PWM counter increment is defined by a single global clock prescaler. PWM
operation is based on 16-bit wide period counters that are constrained by programmable wrapping values.</p>
</div>
<div class="paragraph">
<p>The total number of implemented channels is defined by the <code>IO_PWM_NUM</code> generic. The PWM output signal <code>pwm_o</code> has
a static size of 32 bit. Channel 0 corresponds to bit 0, channel 1 to bit 1 and so on. If less than 32 channels
are configured, only the LSB-aligned channel bits are connected while the remaining ones are hardwired to zero.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The PWM module provides several configuration registers: an <code>ENABLE</code> register, a <code>POLARITY</code> registers, a <code>CLKPRSC</code>
register, and a <code>MODE</code> register. Each of these register provides one bit (LSB-aligned) for each available PWM channel.
Additional, up to <code>IO_PWM_NUM</code> channel register <code>CHANNEL</code> are provided.</p>
</div>
<div class="paragraph">
<p>The <code>ENABLE</code> register is used to enable individual PWM channels. By using bit-masks several channels can be enabled
at once so they operate in perfect lockstep. The PWM counter of a disabled channel is halted and reset to zero. The
according PWM output (<code>pwm_o(i)</code>) is also reset to 0. The polarity of each channel&#8217;s output can be inverted by setting
the corresponding bit in the <code>POLARITY</code> register.</p>
</div>
<div class="paragraph">
<p>The <code>CLKPRSC</code> register configures the <em>global</em> clock prescaler that is used for the PWM counter increment of all
channels. Eight pre-defined prescaler values are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 29. PWM prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>CLKPRSC</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>MODE</code> register defines the PWM operation mode of a channel. If bit <em>i</em> is <code>0</code> channel <em>i</em> operates in
<strong>fast-PWM</strong> mode. If bit <em>i</em> is <code>1</code> channel <em>i</em> operates in <strong>phase-correct PWM</strong> mode.</p>
</div>
<div class="paragraph">
<p>Duty cycle and period length of each channel are defined by the according <code>CHANNEL</code>. This register is split in
two half-words: the lowest half-word defines the counter-compare value (<code>CMP</code>) while the upper half-word defines
the counter-wrap value (<code>TOP</code>). Regardless of the configured PWM operation mode, the duty cycle of channel <em>i</em> is
defined by the following formula:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>Duty Cycle[i]</em> = 100% * (<code>CMP[i]</code> / (<code>TOP[i] + 1</code>))</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The NEORV32 PWM module supports toggle-free 0% and 100% duty cycle output rates. 0% duty cycle is achieved by
setting <code>CMP = 0</code>. 100% duty cycle is achieved by setting <code>CMP = TOP + 1</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title"><code>CHANNEL</code> Half-Word Access</div>
In contrast to many other NEORV32 peripherals, the PWM <code>CHANNEL[i]</code> registers can also be accessed using half-word
load/store operation. This allows to update the <code>TOP</code> and <code>CMP</code> sub-registers with a single instruction.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Fast-PWM Mode</strong></p>
</div>
<div class="paragraph">
<p>When in fast-PWM mode (<code>MODE[i] = 0</code>) the channel&#8217;s PWM counter generates a sawtooth-like waveform. The counter
automatically wraps to all-zero when reaching the programmed <code>TOP[i]</code> value. Whenever the counter value is less
equal to or greater than the <code>CMP[i]</code> value the PWM output is set to the programmed polarity (<code>POLARITY[i]</code>)
value; otherwise it is set to the inverse polarity.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Fast-PWM Operation</div>
<div class="content">
<pre>MODE[i] = 0

TOP[i] ---------------------/|--------------/|--------------/|--------------/
                          /  |            /  |            /  |            /
                        /    |          /    |          /    |          /
CMP[i] ---------------/------|--------/------|--------/------|--------/
                    / .      |      / .      |      / .      |      / .
                  /   .      |    /   .      |    /   .      |    /   .
                /     .      |  /     .      |  /     .      |  /     .
counter[i] ___/       .      |/       .      |/       .      |/       .
                      .      .        .      .        .      .        .
                      .      .        .      .        .      .        .
         -------------+      +--------+      +--------+      +--------+
pwm_o[i]              |      |        |      |        |      |        |       (POLARITY[i] = 0)
                      +------+        +------+        +------+        +------
                      .      .        .      .        .      .        .
                      .      .        .      .        .      .        .
                      +------+        +------+        +------+        +------
pwm_o[i]              |      |        |      |        |      |        |       (POLARITY[i] = 1)
         -------------+      +--------+      +--------+      +--------+</pre>
</div>
</div>
<div class="paragraph">
<p>Based on the global clock prescaler and the <code>TOP</code> wrap value, the carrier frequency of a channel is defined by
the following formula (<em>f<sub>main</sub></em> is the main clock frequency of the processor; <code>clock_prescaler</code> is the global
pre-scaling factor according to the selected <code>CLKPRSC</code> value):</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>f<sub>PWM</sub>[i]</em> = <em>f<sub>main</sub></em> / (<code>clock_prescaler</code> * (<code>TOP[i]</code> + 1))</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Phase-Correct PWM Mode</strong></p>
</div>
<div class="paragraph">
<p>When in phase-correct PWM mode (<code>MODE[i] = 1</code>) the channel&#8217;s PWM counter generates a triangle-like waveform.
Phase-correct mode centers the pulse on the same point regardless of the duty cycle. After enabling, the PWM
counters counts upward until it reaches the <code>TOP</code> value. After that the counter, the counter counts downward
until it reaches 0 again. Whenever the counter value is equal to or greater than the <code>CMP[i]</code> value the PWM
output is set to the programmed polarity (<code>POLARITY[i]</code>) value; otherwise it is set to the inverse polarity.</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Phase-Correct PWM Operation</div>
<div class="content">
<pre>MODE[i] = 1

TOP[i] ---------------------/\----------------------------/\
                          /    \                        /    \
                        /        \                    /        \
CMP[i] ---------------/------------\----------------/------------\
                    / .            . \            / .            . \
                  /   .            .   \        /   .            .   \
                /     .            .     \    /     .            .     \
counter[i] ___/       .            .       \/       .            .       \___
                      .            .                .            .
                      .            .                .            .
         -------------+            +----------------+            +-----------
pwm_o[i]              |            |                |            |            (POLARITY[i] = 0)
                      +------------+                +------------+
                      .            .                .            .
                      .            .                .            .
                      +------------+                +------------+
pwm_o[i]              |            |                |            |            (POLARITY[i] = 1)
         -------------+            +----------------+            +-----------</pre>
</div>
</div>
<div class="paragraph">
<p>Based on the global clock prescaler and the <code>TOP</code> wrap value, the carrier frequency of a channel is defined
by the following formula (<em>f<sub>main</sub></em> is the main clock frequency of the processor; <code>clock_prescaler</code> is the
global pre-scaling factor according to the selected <code>CLKPRSC</code> value):</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>f<sub>PWM</sub>[i]</em> = <em>f<sub>main</sub></em> / (<code>clock_prescaler</code> * 2 * <code>TOP[i]</code>)</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">PWM Dead Time</div>
The phase-correct PWM mode can also be used for controlling modules that require a certain dead time
(e.g. H-bridges). This requires two PWM channels, both of which operate in phase-correct mode, but the
second channel is configured with an inverse polarity. Both channels need to have the same <code>TOP</code> value
and must be enabled at once to have a perfect phase and frequency match. The dead time is define by
the difference of the channel&#8217;s <code>CMP</code> values:<br>
T<sub>dead</sub> = 0.5 * T * (<code>CMP[i]</code> - <code>CMP[i+1]</code>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. PWM register map (<code>struct NEORV32_PWM</code>)</caption>
<colgroup>
<col style="width: 17.647%;">
<col style="width: 17.647%;">
<col style="width: 11.7647%;">
<col style="width: 11.7647%;">
<col style="width: 41.1766%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff00000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENABLE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel enable, one bit per channel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff00004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POLARITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel polarity, one bit per channel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff00008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLKPRSC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff0000c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel operation mode (0 = fast-PWM, 1 = phase-correct PWM), one bit per channel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff00080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANNEL[0].TOPCMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel 0 full word access alias (<code>TOP</code> and <code>CMP</code> together at 32-bit value)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff00080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANNEL[0].CMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel 0 top/wrap value register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff00082</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANNEL[0].TOP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel 0 compare value register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff000fc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANNEL[31].TOPCMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel 31 full word access alias (<code>TOP</code> and <code>CMP</code> together at 32-bit value)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff000fc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANNEL[31].CMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel 31 top/wrap value register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff000fe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHANNEL[31].TOP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel 31 compare value register</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_true_random_number_generator_trng">2.8.20. True Random-Number Generator (TRNG)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__trng_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__trng_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TRNG when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data FIFO depth, min 1, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data available interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>True random number generator based on phase noise</p>
</li>
<li>
<p>Completely technology-independent architecture</p>
</li>
<li>
<p>Optional random data FIFO</p>
</li>
<li>
<p>Interrupt based on FIFO status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 true random number generator provides <em>physically</em> true random numbers. It is based on free-running
ring-oscillators that generate <strong>phase noise</strong> when being sampled by a constant clock. This phase noise is
used as physical entropy source. The TRNG features a platform independent architecture without FPGA-specific
primitives, macros or attributes so it can be synthesized for <em>any</em> FPGA.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">In-Depth Documentation</div>
For more information about the neoTRNG architecture and an analysis of its random quality check out the
neoTRNG repository: <a href="https://github.com/stnolting/neoTRNG" class="bare">https://github.com/stnolting/neoTRNG</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Inferring Latches</div>
The synthesis tool might emit warnings regarding <strong>inferred latches</strong> or <strong>combinatorial loops</strong>. However, this
is not design flaw as this is exactly what we want.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The TRNG provides two memory mapped interface register. One control register (<code>CTRL</code>) for configuration and
status check and one data register (<code>DATA</code>) for obtaining the random data. The TRNG is enabled by setting the
control register&#8217;s <code>TRNG_CTRL_EN</code>. As soon as the <code>TRNG_CTRL_AVAIL</code> bit is set a new random data byte is
available and can be obtained from the lowest 8 bits of the <code>DATA</code> register. If this bit is cleared, there
is no valid data available and the reading <code>DATA</code> will return all-zero.</p>
</div>
<div class="paragraph">
<p>An internal entropy FIFO can be configured using the <code>IO_TRNG_FIFO</code> generic. This FIFO automatically samples
new random data from the TRNG to provide some kind of <em>random data pool</em> for applications which require a
larger number of random data in a short time. The random data FIFO can be cleared at any time either by
disabling the TRNG or by setting the <code>TRNG_CTRL_FIFO_CLR</code> flag. The FIFO depth can be retrieved by software
via the <code>TRNG_CTRL_FIFO_*</code> bits.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Simulation</div>
When simulating the processor the TRNG is automatically set to "simulation mode". In this mode the physical
entropy sources (the ring oscillators) are replaced by a simple <strong>pseudo RNG</strong> based on a LFSR providing only
<strong>deterministic pseudo-random</strong> data. The <code>TRNG_CTRL_SIM_MODE</code> flag of the control register is set if simulation
mode is active.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The TRNG provides a single interrupt request signal that gets triggered when the TRNG is enabled and the
data FIFO is completely full (indicating that at least <code>IO_TRNG_FIFO</code> bytes of random data are available).</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. TRNG register map (<code>struct NEORV32_TRNG</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>0xfffa0000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>    <code>TRNG_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>    <code>TRNG_CTRL_FIFO_CLR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush random data FIFO when set; auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5:2</code>  <code>TRNG_CTRL_FIFO_MSB : TRNG_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth, log2(<code>IO_TRNG_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code>    <code>TRNG_CTRL_SIM_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simulation mode (PRNG!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code>    <code>TRNG_CTRL_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random data available when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfffa0004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>  <code>TRNG_DATA_MSB : TRNG_DATA_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random data byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_custom_functions_subsystem_cfs">2.8.21. Custom Functions Subsystem (CFS)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__cfs_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__cfs_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom input conduit, 256-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom output conduit, 256-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CFS when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tightly-coupled co-processor unit for custom hardware accelerators</p>
</li>
<li>
<p>Can operate independently of the CPU</p>
</li>
<li>
<p>CPU access via memory-mapped registers (16kB)</p>
</li>
<li>
<p>Custom 256-bit input and output conduits for custom IO</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The custom functions subsystem is meant for implementing custom tightly-coupled co-processors or interfaces.
It provides up to 16384 32-bit memory-mapped read/write registers (<code>REG</code>, see register map below) that can be
accessed by the CPU via normal load/store operations. The actual functionality of these register has to be
defined by the hardware designer. Furthermore, the CFS provides two input/output conduits to implement custom
on-chip or off-chip interfaces.</p>
</div>
<div class="paragraph">
<p>Just like any other externally-connected IP, logic implemented within the custom functions subsystem can operate
<em>independently</em> of the CPU providing true parallel processing capabilities. Potential use cases might include
dedicated hardware accelerators for en-/decryption (AES), signal processing (FFT) or AI applications
(CNNs) as well as custom IO systems like fast memory interfaces (DDR) and mass storage (SDIO), networking (CAN)
real-time data transport (I2S) or just replication of existent NEORV32 peripherals.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Custom ISA Instructions</div>
If you like to implement <em>custom instructions</em> that are executed right within the CPU&#8217;s ALU
see the <a href="#_xcfu_isa_extension"><code>Xcfu</code> ISA Extension</a> and the according <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CFS Template</div>
Take a look at the template CFS VHDL source file (<code>rtl/core/neorv32_cfs.vhd</code>). The file is highly
commented to illustrate all aspects that are relevant for implementing custom CFS-based co-processor designs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CFS Software Access</strong></p>
</div>
<div class="paragraph">
<p>The CFS memory-mapped registers can be accessed by software using the provided C-language aliases (see
register map table below). Note that all interface registers are defined as 32-bit words of type <code>uint32_t</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. CFS Software Access Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">// C-code CFS usage example
NEORV32_CFS-&gt;REG[0] = (uint32_t)some_data_array(i); // write to CFS register 0
int temp = (int)NEORV32_CFS-&gt;REG[20]; // read from CFS register 20</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CFS Custom IOs</strong></p>
</div>
<div class="paragraph">
<p>The CFS provides two unidirectional input and output conduits <code>cfs_in_i</code> and <code>cfs_out_o</code>. Both signals
are 512 bit wide and are are directly propagated to the processor&#8217;s top entity. These conduits can be used
to implement application-specific interfaces like memory or peripheral connections. The actual use case of
these signals has to be defined by the hardware designer.</p>
</div>
<div class="paragraph">
<p><strong>CFS Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The CFS provides a single high-level-triggered interrupt request signal mapped to the CPU&#8217;s fast interrupt channel 1.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. CFS register map (<code>struct NEORV32_CFS</code>)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffeb0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffeb0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffebfff8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[16382]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 16382</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffebfffc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[16383]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 16383</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_smart_led_interface_neoled">2.8.22. Smart LED Interface (NEOLED)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__neoled_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__neoled_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement NEOLED controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission FIFO depth, has to be a power of 2, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable NEOLED data FIFO interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>"NeoPixel&#8482;"-compatible LED controller</p>
</li>
<li>
<p>Hardware-based protocol handling</p>
</li>
<li>
<p>Fine-grained programmable bus timings</p>
</li>
<li>
<p>Optional data/command FIFO</p>
</li>
<li>
<p>Interrupt based on FIFO status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED module provides a dedicated interface for "smart LEDs" like WS2812, WS2811 and other compatible ones.
These LEDs provide a single-wire interface that uses an asynchronous serial protocol for transmitting data.
The NEOLED module handles the tight timing constraints of the interface entirely in hardware. A configurable data
and command buffer (FIFO) allows to utilize (e.g. DMA-backed) block transfer operation without CPU intervention.</p>
</div>
<div class="paragraph">
<p>LEDs are connected to the <code>neoled_o</code> output and can be arbitrarily chained. The module also supports 24-bit and
32-bit LED data Hence, mixed setups with RGB LEDs (24-bit color) and RGBW LEDs (32-bit color including a dedicated
white LED chip) are fully supported.</p>
</div>
<div class="paragraph">
<p>The NEOLED modules provides four accessible interface registers: the control register <code>CTRL</code> and the write-only
<code>DATA24</code>, <code>DATA32</code> and <code>STROBE</code> registers. The precise interface timing is configured via the control registers.
The data and strobe registers are used for sending 24-bit/32-bit data and reset/strobe commands.</p>
</div>
<div class="paragraph">
<p><strong>Protocol</strong></p>
</div>
<div class="paragraph">
<p>The interface of the smart LEDs is based on duty-cycle modulation of a specific carrier signal. Data is transmitted
in a serial manner starting with the MSB. The intensity for each R/G/B (/W) LED chip is defined via an 8-bit
value. The actual data bits are transferred by modifying the duty cycle of the base carriers. A RESET command is
send by pulling the data line LOW for at least 50s.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-9141be4a7c37df95f85ecda4b48e0dec.svg" alt="Diagram" width="500" height="90">
</div>
<div class="title">Figure 13. WS2812 bit-level timing (timing does not scale)</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. Example: WS2812 Protocol Timings</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>total</sub> (T<sub>carrier</sub>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25s +/- 300ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">period for a single bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4s +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8s +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.85s +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.45s +/- 150 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Above 50s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a RESET command</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Timing Configuration</strong></p>
</div>
<div class="paragraph">
<p>The basic carrier frequency (800kHz for the WS2812 LEDs) is configured via a 3-bit clock prescaler
(<code>NEOLED_CTRL_PRSC*</code>, see table below) that scales the main processor clock f<sub>main</sub> and a 5-bit cycle
multiplier <code>NEOLED_CTRL_T_TOT_*</code>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 34. NEOLED Prescaler Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>NEOLED_CTRL_PRSC[2:0]</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The duty-cycles (or more precisely: the high- and low-times for sending either a '1' bit or a '0' bit) are
defined via the 5-bit <code>NEOLED_CTRL_T_1H_*</code> and <code>NEOLED_CTRL_T_0H_*</code> values, respectively. These programmable
timing constants allow to adapt the interface for a wide variety of smart LED protocols.</p>
</div>
<div class="paragraph">
<p><strong>Timing Configuration - Example (WS2812)</strong></p>
</div>
<div class="paragraph">
<p>Generate the base clock f<sub>TX</sub> for the NEOLED TX engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processor clock f<sub>main</sub> = 100 MHz</p>
</li>
<li>
<p><code>NEOLED_CTRL_PRSCx</code> = <code>0b001</code> = f<sub>main</sub> / 4</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>f<sub>TX</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code> = 100MHz / 4 = 25MHz</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>TX</sub></strong></em> = 1 / <em><strong>f<sub>TX</sub></strong></em> = 40ns</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Generate carrier period (T<sub>carrier</sub>) and <strong>high-times</strong> (duty cycle) for sending <code>0</code> (T<sub>0H</sub>) and <code>1</code> (T<sub>1H</sub>) bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NEOLED_CTRL_T_TOT</code> = <code>0b11110</code> (= decimal 30)</p>
</li>
<li>
<p><code>NEOLED_CTRL_T_0H</code>  = <code>0b01010</code> (= decimal 10)</p>
</li>
<li>
<p><code>NEOLED_CTRL_T_1H</code>  = <code>0b10100</code> (= decimal 20)</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em><strong>T<sub>carrier</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <code>NEOLED_CTRL_T_TOT</code> = 40ns * 30 = 1.4s</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>0H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <code>NEOLED_CTRL_T_0H</code> = 40ns * 10 = 0.4s</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>1H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <code>NEOLED_CTRL_T_1H</code> = 40ns * 20 = 0.8s</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEOLED SW driver library (<code>neorv32_neoled.h</code>) provides a simplified configuration
function that configures all timing parameters for driving WS2812 LEDs based on the processor
clock frequency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>NEOLED Data/Command (FIFO)</strong></p>
</div>
<div class="paragraph">
<p>The interface features a configurable TX data and command buffer (a FIFO) to allow more CPU-independent operation.
The buffer depth is configured via the <code>IO_NEOLED_TX_FIFO</code> top generic. The FIFO size configuration can be
read by software from the <code>NEOLED_CTRL_FIFO_x</code> control register bits. If the module is disabled by clearing
<code>NEOLED_CTRL_EN</code> the entire data and command buffer is cleared.</p>
</div>
<div class="paragraph">
<p>LED data and commands are written to the <code>DATA24</code>, <code>DATA32</code> and <code>STROBE</code> registers, which are transparently buffered
by the optional FIFO. Writing data to <code>DATA24</code> will finally transmit the 24 LSB-aligned bits from the written data
word to the LED string. Writing data to <code>DATA32</code> will finally transmit all 32-bit bits from the written data word to
the LED string. Writing any data to <code>STROBE</code>, which is also buffered by the FIFO, will send a STROBE (RESET) command
to the LED string.</p>
</div>
<div class="paragraph">
<p>Software can check the FIFO fill level via the control register&#8217;s <code>NEOLED_CTRL_TX_EMPTY</code> and <code>NEOLED_CTRL_TX_FULL</code>
flags. The <code>NEOLED_CTRL_TX_BUSY</code> flag provides additional information if the serial transmit engine is still busy
sending data.</p>
</div>
<div class="paragraph">
<p><strong>NEOLED Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules features a single interrupt that gets triggered when the TX data/command FIFO is empty.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. NEOLED register map (<code>struct NEORV32_NEOLED</code>)</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 7.1428%;">
<col style="width: 35.7142%;">
<col style="width: 7.1428%;">
<col style="width: 35.7145%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xfffd0000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>NEOLED_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:1</code>   <code>NEOLED_CTRL_PRSC_MSB : NEOLED_CTRL_PRSC_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8:4</code>   <code>NEOLED_CTRL_T_TOT_MSB : NEOLED_CTRL_T_TOT_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-scaled clock ticks per total single-bit period (T<sub>total</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13:9</code>  <code>NEOLED_CTRL_T_0H_MSB : NEOLED_CTRL_T_0H_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-scaled clock ticks per high-time for sending a zero-bit (T<sub>0H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18:14</code> <code>NEOLED_CTRL_T_1H_MSB : NEOLED_CTRL_T_1H_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-scaled clock ticks per high-time for sending a one-bit (T<sub>1H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24:19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28:25</code> <code>NEOLED_CTRL_FIFO_MSB : NEOLED_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log(FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>NEOLED_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>NEOLED_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>NEOLED_CTRL_TX_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX serial engine is busy when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffd0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write 24-bit RGB data to transmission buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffd0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write 32-bit RGB data to transmission buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffd000c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STROBE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write strobe/reset command  to transmission buffer</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_timer_gptmr">2.8.23. General Purpose Timer (GPTMR)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__gptmr_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__gptmr_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPTMR_NUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of individual GPTMR timer slices (0..16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Up to 16 individual timer slices with 32-bit-wide timer and timer-match registers</p>
</li>
<li>
<p>Per-slice enable, mode and interrupt control/status</p>
</li>
<li>
<p>Single-shot or interval operation mode</p>
</li>
<li>
<p>Global clock prescaler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The general purpose timer module provides up to 16 individual timers organized as slices (the number of
implemented slices is configured by <code>IO_GPTMR_NUM</code>. Each slice can operate as single-shot timer or as
continuous/interval timer and provides a 32-bit counter (<code>SLICE[i].CNT</code>) and a 32-bit threshold registers
(<code>SLICE[i].THR</code>). Operation is controlled by two 32-bit control and status registers (<code>CSR0</code> and <code>CSR1</code>).
An interrupt is triggered when a slice counter matches the according threshold value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CSR Access</div>
<code>CSR0</code> and <code>CSR1</code> can be accessed in full-word mode (<code>CSR[0/1].WORD</code>) and also in half-word
mode (e.g. <code>CSR0.ENABLE</code>) to update configuration sub-words with a single memory operation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>A slice <em>i</em> is enabled when the according bit of <code>CSR0.ENABLE</code> is set. Only the lowest <code>IO_GPTMR_NUM</code>
bits are available. When enabled, the slice`s counter register <code>SLICE[i].CNT</code> starts incrementing at
a prescaled clock frequency. This prescaler is globally configured (= for all slices) by the
<code>CSR1.PRSC</code> register:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 36. GPTMR prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>CSR1.PRSC</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When <code>SLICE[i].CNT</code> matches the threshold value in <code>SLICE[i].THR</code> the according interrupt-pending bit in
<code>CSR1.IRQ</code> becomes set. Disabled slices (<code>CSR0.ENABLE(i) = 0</code>) cannot generate any new interrupt requests.
However, pending interrupt in <code>CSR1.IRQ</code> will remain pending even if the according slice is disabled via.
Software can clear pending interrupts by writing zero to the according <code>CSR1.IRQ</code> bits. A CPU interrupt
request is generates if any slice interrupt <em>i</em> is pending and slice <em>i</em> is enabled (<code>CSR0.ENABLE(i) = 1</code>
and <code>CSR1.IRQ(i) = 1</code>).</p>
</div>
<div class="paragraph">
<p>The time until a slice interrupt is triggered (<em>T[i]</em>) depends on the processor clock (<em>f<sub>main</sub></em>) global
clock prescaler (selected by <code>CSR1.PRSC</code>) and the slice threshold value (<code>SLICE[i].THR</code>):</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><em>T[i]</em> = <em>f<sub>main</sub></em> / (<code>prescaler</code> * <code>SLICE[i].THR</code>)</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Each slice can operate as single-shot timer or as continuous interval timer: If <code>CSR0.MODE(i) = 0</code>
the according slice operates in <strong>single-shot mode</strong>: if the counter matches the programmed threshold
(<code>SLICE[i].CNT == SLICE[i].THR</code>) the slice interrupt becomes pending and the counter stops at the
threshold value. If <code>CSR0.MODE(i) = 1</code> the according slice operates in <strong>continuous mode</strong>: if the
counter matches the programmed threshold (<code>SLICE[i].CNT == SLICE[i].THR</code>) the slice interrupt becomes
pending and the counter is reset to zero and starts counting again up to the threshold value.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. GPTMR register map (<code>struct NEORV32_GPTMR</code>)</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 5.5555%;">
<col style="width: 38.889%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR0.WORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and status register 0 (full-word access).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR0.ENABLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice enable (one bit per implemented slice starting at LSB).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR0.MODE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice operation mode: 0 = single shot, 1 = continuous (one bit per implemented slice starting at LSB).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR1.WORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and status register 1 (full-word access).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR1.IRQ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice interrupt pending (one bit per implemented slice starting at LSB); write 0 to bit to clear interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10006</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR1.PRSC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global clock prescaler select.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SLICE[0].CNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice 0 counter register.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff10084</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SLICE[0].THR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice 0 threshold register.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff100F8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SLICE[15].CNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice 15 counter register.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff100FC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SLICE[15].THR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slice 15 threshold register.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_execution_trace_buffer_tracer">2.8.24. Execution Trace Buffer (TRACER)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_tracer.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_tracer.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__tracer_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_tracer.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__tracer_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRACER_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TRACER module when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRACER_BUFFER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trace buffer depth, has to be zero or a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRACER_SIMLOG_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write full trace log to file when <code>true</code> (simulation-only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing stop-address match interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delta-tracing of instruction execution</p>
</li>
<li>
<p>Auto-stop tracing (and issue interrupt) when reaching a programmable instruction address</p>
</li>
<li>
<p>Dump and inspect delta-trace directly from the firmware or via GDB</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 tracer module allows to record program execution in order to find out how the CPU
arrived at a certain code point. It is fed by the CPU&#8217;s <a href="#_execution_trace_port">Execution Trace Port</a>.
In order to keep the data rate low, so-called <em>instruction delta tracing</em> is used:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Instruction delta tracing, also known as branch tracing, works by tracking execution from a known
start address by sending information about the deltas taken by the program. Deltas are typically
introduced by jump, call, return and branch type instructions, although interrupts and exceptions are
also types of deltas. Instruction delta tracing provides an efficient encoding of an instruction sequence
by exploiting the deterministic way the processor behaves based on the program it is executing.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; RISC-V Trace Specification<br>
<cite>github.com/riscv-non-isa/riscv-trace-spec</cite>
</div>
</div>
<div class="paragraph">
<p>This means that only non-linear changes of the program counter are recorded. These <em>deltas</em> are stored in a
a local memory (the trace buffer) and can be read by the debugger (e.g. GDB). The size of this trace buffer
is configurable via the <code>IO_TRACER_BUFFER</code> generic.</p>
</div>
<div class="paragraph">
<p>The program being executed can also read the trace buffer itself (stand-alone-mode, not debugger required).
In the dual-core configuration, for example, one CPU core can analyze the trace of the other CPU core.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">TRACER Demo Program</div>
A demo program for the tracer can be found in <code>sw/example/demo_tracer</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The tracer module provides four memory-mapped registers: the status and control register <code>CTRL</code>, a "stop-tracing"
address register <code>STOP_ADDR</code> and two read-only registers to read trace data (<code>DELTA_SRC</code> and <code>DELTA_DST</code>).</p>
</div>
<div class="paragraph">
<p>The trace module is enabled by setting the <code>TRACER_CTRL_EN</code> bit in the control register. If this bit is cleared,
the module i enabled and the internal trace buffer is cleared. Bit <code>TRACER_CTRL_HSEL</code> selects the hart / CPU core
that shall be traced. This bit is read-only zero for the single-core configuration.</p>
</div>
<div class="paragraph">
<p>Tracing is started by writing <code>1</code> to the <code>TRACER_CTRL_START</code> control register bit. Tracing can be stopped at any
time by manually writing <code>1</code> to the <code>TRACER_CTRL_START</code> control register bit. Software can check if tracing is
in progress by reading the <code>TRACER_CTRL_RUN</code>. Tracing is <em>automatically stopped</em> when program execution reaches
the address in the <code>STOP_ADDR</code> register. Automatic trace stopping can be disabled by writing -1 to this register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Halt Tracing during Debug-Mode</div>
Whenever the CPU enters debug mode, either by a halt request from the debugger or by a (hard-coded) breakpoint or
watchpoint, tracing is paused until the CPU resumes normal operation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During tracing, the module writes the instruction deltas to the internal buffer. The buffer is implemented as FIFO,
so that only the last <em>IO_TRACER_BUFFER</em> instruction deltas are kept. At least one instruction delta is available
in the trace buffer when <code>TRACER_CTRL_AVAIL</code> is set. A single entry ("packet") of the trace buffer data can be read
via the two registers <code>DELTA_SRC</code> and <code>DELTA_DST</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DELTA_SRC</code> provides the 31-bit instruction address of the branch source.
Bit 0 is set if this trace packet is the very first after trace start; it is cleared for all further packets.</p>
</li>
<li>
<p><code>DELTA_DST</code> provides the 31-bit instruction address of the branch destination.
Bit 0 is set if this branch was caused by a trap-entry; it is cleared if this branch was caused by a jump/call/branch instruction.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trace Buffer Read Access</div>
The trace buffer&#8217;s FIFO read-pointer automatically increments when reading <code>DELTA_DST</code>,
so make sure to read <code>DELTA_SRC</code> before <code>DELTA_DST</code>. The implementation as FIFO also
means that the <strong>trace data can only be read once</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Tracer Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The tracer module features a single interrupt that gets triggered when the traced program reached the address
stored in the module&#8217;s <code>STOP_ADDR</code> register. The pending interrupt needs to be explicitly acknowledged/cleared
by writing <code>1</code> to the <code>TRACER_CTRL_IRQ_CLR</code> control register bit.</p>
</div>
<div class="paragraph">
<p><strong>Evaluating Trace Data from GDB</strong></p>
</div>
<div class="paragraph">
<p>Two simple functions for handling the tracer are implemented as GDB script. The script is located in the tracer
example program and can be imported into GDB using the <code>source</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Importing the Tracer GDB Script</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gdb hljs" data-lang="gdb">(gdb) source path/to/neorv32/sw/example/demo_tracer/neorv32_tracer.gdb</code></pre>
</div>
</div>
<div class="paragraph">
<p>After sourcing, two additional commands are available that can be executed from the GDB command line:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tracer_get</code>: read-out the data from the trace buffer and print the execution history</p>
</li>
<li>
<p><code>tracer_start arg</code>: restart the tracer; the CPU ID has to be provided as argument (<code>arg</code>, 0 or 1)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the tracer from GDB is briefly illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Using the Tracer from GDB (GDB started in <code>neorv32/sw/example/demo_tracer</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gdb hljs" data-lang="gdb">(gdb) make clean elf <i class="conum" data-value="1"></i><b>(1)</b>
...
(gdb) load <i class="conum" data-value="2"></i><b>(2)</b>
...
(gdb) c <i class="conum" data-value="3"></i><b>(3)</b>
...
(gdb) source neorv32_tracer.gdb <i class="conum" data-value="4"></i><b>(4)</b>
(gdb) tracer_get <i class="conum" data-value="5"></i><b>(5)</b>
[0] SRC: 0x3b0 -&gt; DST: 0x2cc &lt;TRACE_START&gt;
Line 128 of "main.c" starts at address 0x3b0 &lt;main+212&gt; and ends at 0x3b4 &lt;main+216&gt;.
Line 68 of "main.c" starts at address 0x2cc &lt;test_code&gt; and ends at 0x2d0 &lt;test_code+4&gt;.
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Compile the demo program.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Upload the compiled ELF.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Start executing. The program will stop re-entering debug-mode when reaching main&#8217;s <code>return</code> statement.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Import the tracer helper functions script.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Get trace log and print.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Tracer Simulation Logging</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Simulation-Only</div>
This feature is available in simulation only.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 tracer module can also be used to generate a complete log of all executed instructions. Simulation
trace logging is enabled by the <code>IO_TRACER_SIMLOG_EN</code> top generic. This also requires the tracer is implemented
(<code>IO_TRACER_EN</code> = true). However, no specific configuration of the control register <code>CTRL</code> is required. During
simulation, all traced instructions are written to log files in the simulator&#8217;s home folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>neorv32.tracer0.log</code> for CPU 0</p>
</li>
<li>
<p><code>neorv32.tracer1.log</code> for CPU 1 (only if <a href="#_dual_core_configuration">Dual-Core Configuration</a> is enabled)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The trace log is structured line by line where each line describes an executed instruction.
The start of an exemplary trace log might look like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. Exemplary cut-out from a simulation trace log (here: <code>neorv32.tracer1.log</code> showing boot of core 1)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-log hljs" data-lang="log">51 929749 0x0000009c 0xfff44737 M lui           x14, 0xfff44000 &lt;TRAP_ENTRY&gt; <i class="conum" data-value="1"></i><b>(1)</b>
52 929751 0x000000a0 0x00872103 M lw            x2, 2(x14)
53 929759 0x000000a4 0x00c72603 M c.lw          x12, 12(x14)
54 929767 0x000000a6 0xfff40737 M lui           x14, 0xfff40000
55 929770 0x000000aa 0x00072223 M sw            x14, 4(x0)
56 929778 0x000000ae 0x04a0006f M c.jal         x0, 74
57 929798 0x000000f8 0x80000197 M auipc         x3, 0x80000000
58 929800 0x000000fc 0x70818193 M addi          x3, x8, 1800
59 929824 0x00000100 0x0ff0000f M fence
60 929831 0x00000104 0x0000100f M fence.i
61 929853 0x00000108 0x30029073 M csrrw         x0, mstatus, x5</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line is used for explanation (see below).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Column structure:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>51</code>: Instruction index ("order"); a linear increasing counter that starts at zero and increments with each executed instruction; printed as decimal integer.</p>
</li>
<li>
<p><code>890622</code>: Time stamp; a linear increasing counter that starts at zero and increments with each clock cycle; printed as decimal integer.</p>
</li>
<li>
<p><code>0x000000c8</code>: Instruction address (program counter); printed as hexadecimal 32-bit value (<code>0x</code> prefix).</p>
</li>
<li>
<p><code>0xfff44737</code>: 32-bit instruction word; printed as hexadecimal 32-bit value (<code>0x</code> prefix); compressed 16-bit instructions are shown in their decompressed 32-bit format.</p>
</li>
<li>
<p><code>M</code>: Current operating mode / privilege level (<code>M</code> = machine-mode, <code>U</code> = user-mode, <code>D</code> = debug-mode); printed as single character</p>
</li>
<li>
<p><code>lui</code>: The decoded instruction mnemonic. For unknown instructions <code>INVALID</code> is printed instead. Decompressed 16-bit instructions have a prefixed <code>c.</code> (e.g. <code>c.lw</code>).</p>
</li>
<li>
<p><code>x14, 0xfff44000</code>: Operands of the decoded instruction.</p>
</li>
<li>
<p>If the CPU encounters a trap (synchronous exception or interrupt) <code>&lt;TRAP_ENTRY&gt;</code> is printed at the end of the line corresponding to the first instruction of the trap handler.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Instruction Execution Time</div>
The execution time of instruction <em>i</em> (number of cycles required for retiring) can be calculated by
subtracting the current time stamp <em>i</em> from the next time stamp <em>i+1</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. TRACER register map (<code>struct NEORV32_TRACER</code>)</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 27.2727%;">
<col style="width: 9.0909%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock"><code>0xfff30000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>    <code>TRACER_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRACER enable, reset module when 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>    <code>TRACER_CTRL_HSEL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart select for tracing (<code>0</code> = CPU0, <code>1</code> = CPU1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>    <code>TRACER_CTRL_START</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start tracing, flag always reads as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>    <code>TRACER_CTRL_STOP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manually stop tracing, flag always reads as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>    <code>TRACER_CTRL_RUN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tracing in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code>    <code>TRACER_CTRL_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace data available when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code>    <code>TRACER_CTRL_IRQ_CLR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear pending interrupt when writing <code>1</code>, flag always reads as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10:7</code> <code>TRACER_CTRL_TBM_MSB : TRACER_CTRL_TBM_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log2(IO_TRACER_BUFFER)</code>: trace buffer depth</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:11</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfff30004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOP_ADDR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop-tracing-address register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfff30008</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DELTA_SRC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch source address, set to <code>-1</code> to disable automatic stopping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> = very first instruction delta in current trace; <code>0</code> = any further instruction delta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfff3000c</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DELTA_DST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> = branch due trap entry (interrupt or synchronous exception); <code>0</code> = branch due to jump/call/branch instruction</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_system_configuration_information_memory_sysinfo">2.8.25. System Configuration Information Memory (SYSINFO)</h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sysinfo.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver files:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sysinfo.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__sysinfo_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity ports:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">most of the top&#8217;s configuration generics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provides detailed SoC configuration information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The SYSINFO module allows the application software to determine the setting of most of the <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>
that are related to CPU and processor/SoC configuration. This device is always implemented - regardless of the actual hardware
configuration since the NEORV32 software framework requires information from this device for correct operation.
However, advanced users that do not want to use the default NEORV32 software framework can choose to disable the
entire SYSINFO module. This might also be suitable for setups that use the processor just as wrapper for a CPU-only
configuration.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<div class="paragraph">
<p>All registers of this module are read-only except for the <code>CLK</code> register. Upon reset, the <code>CLK</code> registers is initialized
from the <code>CLOCK_FREQUENCY</code> top entity generic. Application software can override this default value in order, for example,
to take into account a dynamic frequency scaling of the processor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. SYSINFO register map (<code>struct NEORV32_SYSINFO</code>)</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 63.6364%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffe0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock frequency in Hz (initialized from top&#8217;s <code>CLOCK_FREQUENCY</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffe0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MISC[4]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">miscellaneous system configurations (see <a href="#_sysinfo_miscellaneous_configuration">SYSINFO - Miscellaneous Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffe0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specific SoC configuration (see <a href="#_sysinfo_soc_configuration">SYSINFO - SoC Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffe000c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache configuration information (see <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a>)</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sysinfo_miscellaneous_configuration">SYSINFO - Miscellaneous Configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. SYSINFO <code>MEM</code> Bits</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Byte</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MISC_IMEM_MBS : SYSINFO_MISC_IMEM_LSB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(internal IMEM size in bytes), via top&#8217;s <code>IMEM_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MISC_DMEM_MSB : SYSINFO_MISC_DMEM_LSB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(internal DMEM size in bytes), via top&#8217;s <code>DMEM_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MISC_HART_MSB : SYSINFO_MISC_HART_LSB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of physical CPU cores ("harts")</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>21:20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MISC_BOOT_MSB : SYSINFO_MISC_BOOT_LSB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boot mode configuration, via top&#8217;s <code>BOOT_MODE_SELECT</code> generic (see <a href="#_boot_configuration">Boot Configuration</a>))</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>26:22</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MISC_ITMO_MSB : SYSINFO_MISC_ITMO_LSB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(internal bus timeout cycles), see <a href="#_bus_monitor_and_timeout">Bus Monitor and Timeout</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:27</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MISC_ETMO_MSB : SYSINFO_MISC_ETMO_LSB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(external bus timeout cycles), see <a href="#_bus_monitor_and_timeout">Bus Monitor and Timeout</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_soc_configuration">SYSINFO - SoC Configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. SYSINFO <code>SOC</code> Bits</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_BOOTLOADER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal bootloader is implemented (via top&#8217;s <code>BOOT_MODE_SELECT</code> generic; see <a href="#_boot_configuration">Boot Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_XBUS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if external bus interface is implemented (via top&#8217;s <code>XBUS_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal DMEM is implemented (via top&#8217;s <code>IMEM_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_DMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal IMEM is implemented (via top&#8217;s <code>DMEM_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_OCD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if on-chip debugger is implemented (via top&#8217;s <code>OCD_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_ICACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal instruction cache is implemented (via top&#8217;s <code>ICACHE_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_DCACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal data cache is implemented (via top&#8217;s <code>DCACHE_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_OCD_AUTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if on-chip debugger authentication is implemented (via top&#8217;s <code>OCD_AUTHENTICATION</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IMEM_ROM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal IMEM is implemented as pre-initialized ROM (via top&#8217;s <code>BOOT_MODE_SELECT</code> generic; see <a href="#_boot_configuration">Boot Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_TWD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if TWD is implemented (via top&#8217;s <code>IO_TWD_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_DMA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if direct memory access controller is implemented (via top&#8217;s <code>IO_DMA_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_GPIO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if GPIO is implemented (via top&#8217;s <code>IO_GPIO_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_CLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if CLINT is implemented (via top&#8217;s <code>IO_CLINT_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_UART0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if primary UART0 is implemented (via top&#8217;s <code>IO_UART0_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_SPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if SPI is implemented (via top&#8217;s <code>IO_SPI_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_TWI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if TWI is implemented (via top&#8217;s <code>IO_TWI_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_PWM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if PWM is implemented (via top&#8217;s <code>IO_PWM_NUM</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>21</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_WDT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if WDT is implemented (via top&#8217;s <code>IO_WDT_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>22</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_CFS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if custom functions subsystem is implemented (via top&#8217;s <code>IO_CFS_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_TRNG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if TRNG is implemented (via top&#8217;s <code>IO_TRNG_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_SDI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if SDI is implemented (via top&#8217;s <code>IO_SDI_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_UART1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if secondary UART1 is implemented (via top&#8217;s <code>IO_UART1_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>26</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_NEOLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if smart LED interface is implemented (via top&#8217;s <code>IO_NEOLED_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>27</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_TRACER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if execution tracer is implemented (via top&#8217;s <code>IO_TRACER_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>28</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_GPTMR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if GPTMR is implemented (via top&#8217;s <code>IO_GPTMR_NUM</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>29</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_SLINK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if stream link interface is implemented (via top&#8217;s <code>IO_SLINK_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_ONEWIRE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if ONEWIRE interface is implemented (via top&#8217;s <code>IO_ONEWIRE_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_SIM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if NEORV32 is being simulated</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_cache_configuration">SYSINFO - Cache Configuration</h5>
<div class="paragraph">
<p>The SYSINFO cache register provides information about the configuration of the processor caches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_instruction_cache_icache">Instruction Cache (iCache)</a></p>
</li>
<li>
<p><a href="#_data_cache_dcache">Data Cache (dCache)</a></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. SYSINFO <code>CACHE</code> Bits</caption>
<colgroup>
<col style="width: 4.7619%;">
<col style="width: 47.619%;">
<col style="width: 47.6191%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_INST_BLOCK_SIZE_3 : SYSINFO_CACHE_INST_BLOCK_SIZE_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache block size in bytes), via top&#8217;s <code>ICACHE_BLOCK_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7:4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_INST_NUM_BLOCKS_3 : SYSINFO_CACHE_INST_NUM_BLOCKS_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache number of cache blocks), via top&#8217;s <code>ICACHE_NUM_BLOCKS</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>11:8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DATA_BLOCK_SIZE_3 : SYSINFO_CACHE_DATA_BLOCK_SIZE_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(d-cache block size in bytes), via top&#8217;s <code>DCACHE_BLOCK_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DATA_NUM_BLOCKS_3 : SYSINFO_CACHE_DATA_NUM_BLOCKS_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(d-cache number of cache blocks), via top&#8217;s <code>DCACHE_NUM_BLOCKS</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_INST_BURSTS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-cache burst transfers enabled, via top&#8217;s <code>CACHE_BURSTS_EN</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23:17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DATA_BURSTS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">d-cache burst transfers enabled, via top&#8217;s <code>CACHE_BURSTS_EN</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 CPU is an area-optimized RISC-V core implementing the <code>rv32i_zicsr_zifencei</code> base (privileged) ISA and
supporting several additional/optional ISA extensions. The CPU&#8217;s micro architecture is based on a von-Neumann
machine build upon a mixture of multi-cycle and pipelined execution schemes. Optionally, the core can be implemented
as SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V Specifications</div>
This chapter assumes that the reader is familiar with the official
RISC-V <em>User</em> and <em>Privileged Architecture</em> specifications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a> and <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a></p>
</li>
<li>
<p><a href="#_architecture">Architecture</a> and <a href="#_full_virtualization">Full Virtualization</a></p>
</li>
<li>
<p><a href="#_execution_trace_port">Execution Trace Port</a></p>
</li>
<li>
<p><a href="#_cpu_tuning_options">CPU Tuning Options</a></p>
</li>
<li>
<p><a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a> and <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a></p>
</li>
<li>
<p><a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a></p>
</li>
<li>
<p><a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a></p>
</li>
<li>
<p><a href="#_bus_interface">Bus Interface</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_cpu_top_entity_signals">3.1. CPU Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows all interface signals of the CPU top entity <code>rtl/core/neorv32_cpu.vhd</code>. The
type of all signals is <em>std_ulogic</em> or <em>std_ulogic_vector</em>, respectively. The "Dir." column shows the signal
direction as seen from the CPU.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 43. NEORV32 CPU Signal List</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 7.6923%;">
<col style="width: 61.5385%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width/Type</th>
<th class="tableblock halign-center valign-top">Dir</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Clock and Reset</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global clock line, all registers triggering on rising edge.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global reset, low-active.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Status</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>trace_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>trace_port_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_execution_trace_port">Execution Trace Port</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sleep_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set while the CPU is in <a href="#_sleep_mode">Sleep Mode</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Interrupts (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>msi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine software interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mei_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine external interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mti_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine timer interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>firq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom fast interrupt request signals.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dbi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request CPU to halt and enter debug mode (RISC-V <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Instruction <a href="#_bus_interface">Bus Interface</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ibus_req_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_req_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction fetch bus request.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ibus_rsp_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_rsp_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction fetch bus response.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Data <a href="#_bus_interface">Bus Interface</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dbus_req_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_req_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data access (load/store) bus request.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dbus_rsp_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_rsp_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data access (load/store) bus response.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bus Interface Protocol</div>
See section <a href="#_bus_interface">Bus Interface</a> for the instruction fetch and data access interface protocol and the
according interface types (<code>bus_req_t</code> and <code>bus_rsp_t</code>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_generics">3.2. CPU Top Entity - Generics</h3>
<div class="paragraph">
<p>Most of the CPU configuration generics are a subset of the <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> and are not
listed here. However, the CPU provides some <em>specific</em> generics that are used to configure the CPU for the
NEORV32 processor setup. These generics are assigned by the processor setup only and are not available for
user defined configuration. The specific generics are listed below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Table Abbreviations</div>
The generic type "suv(x:y)" represents a <code>std_ulogic_vector(x downto y)</code>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 44. NEORV32 CPU-Exclusive Generic List</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HART_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the core (for <a href="#_mhartid"><strong><code>mhartid</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VENDOR_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor ID (for <a href="#_mvendorid"><strong><code>mvendorid</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOOT_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU reset address. See section <a href="#_address_space">Address Space</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG_PARK_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Park loop" entry address for the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>, has to be 4-byte aligned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG_EXC_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Exception" entry address for the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>, has to be 4-byte aligned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Sdext</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement RISC-V-compatible "debug" CPU operation mode required for the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Sdtrig</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement RISC-V-compatible <a href="#_trigger_module">Trigger Module</a>. See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_ISA_Smpmp</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement RISC-V-compatible physical memory protection (PMP). See section <a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NUM_HW_TRIGGERS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of hardware triggers for the <a href="#_trigger_module">Trigger Module</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tuning Option Generics</div>
Additional generics that are related to certain <em>tuning options</em> are listed in section <a href="#_cpu_tuning_options">CPU Tuning Options</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_architecture">3.3. Architecture</h3>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_cpu.png" alt="neorv32 cpu">
</div>
</div>
<div class="paragraph">
<p>The CPU implements a pipelined multi-cycle architecture: each instruction is executed as a series of consecutive
micro-operations. In order to increase performance, the CPU&#8217;s front-end (instruction fetch) and back-end
(instruction execution) are de-couples via a FIFO (the instruction prefetch buffer. Thus, the front-end can already
fetch new instructions while the back-end is still processing the previously-fetched instructions.</p>
</div>
<div class="paragraph">
<p>Basically, the CPU&#8217;s micro architecture is somewhere between a classical pipelined architecture, where each stage
requires exactly one processing cycle (if not stalled) and a classical multi-cycle architecture, which executes
every single instruction (<em>including</em> fetch) in a series of consecutive micro-operations. The combination of these
two design paradigms allows an increased instruction execution in contrast to a pure multi-cycle approach (due to
overlapping operation of fetch and execute) at a reduced hardware footprint (due to the multi-cycle concept).</p>
</div>
<div class="paragraph">
<p>As a Von-Neumann machine, the CPU provides independent interfaces for instruction fetch and data access. However,
these two bus interfaces are merged into a single processor-internal bus via a prioritizing bus switch (data accesses
have higher priority). Hence, <em>all</em> memory addresses including peripheral devices are mapped to a single unified 32-bit
<a href="#_address_space">Address Space</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">No Hardware Support for Misaligned Memory Accesses</div>
The CPU does not support resolving unaligned memory access by the hardware. Any kind of
unaligned memory access will raise an exception to allow a software-based emulation.
See section <a href="#_application_context_handling">Application Context Handling</a> for more information.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_front_end">3.3.1. CPU Front-End</h4>
<div class="paragraph">
<p>The front-end is responsible for fetching instructions in chunks of 32-bits. This can be a single aligned 32-bit
instruction, two 16-bit instructions or a mixture of both. Unaligned 32bit instructions are explicitly supported.
The instruction chunks are queued within the instruction prefetch buffer (IPB). A consecutive logic reads data
from this FIFO, optionally decompresses 16-bit instructions and assembles 32-bit instruction words that are forwarded
to the CPU back-end for execution.</p>
</div>
<div class="paragraph">
<p>The IPB allows the front-end to do "speculative" instruction fetches as it keeps fetching the next consecutive
instruction all the time. This also allows to decouple instruction fetch and instruction execution so both stages
can operate in parallel to increase performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_back_end">3.3.2. CPU Back-End</h4>
<div class="paragraph">
<p>The actual instruction execution is conducted by a micro-sequencer-based approach. Execution is split into several
micro-operations, each of which generates special control signals, e.g., to configure the ALU or to trigger memory
accesses. Simple arithmetic/logical operations require two cycles, while more complex operations require additional
cycles depending on the CPU configuration. Since the front-end essentially works in parallel "in the background",
an optimal CPI (cycles per instruction) value of 2 can be achieved.</p>
</div>
<div class="paragraph">
<p>The division into individual micro-operations not only allows for small hardware that reuses CPU parts in different
cycles (e.g., the ALU: for arithmetic/logical calculations and also for calculating the next program counter). It also
allows for precise monitoring of execution and the generation of precise traps. Hence, the back-end also includes
<a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a>, the<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> logic and the <a href="#_cpu_debug_mode">CPU Debug Mode</a> controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_register_file">3.3.3. CPU Register File</h4>
<div class="paragraph">
<p>The data register file (VHDL file <code>neorv32_cpu_regfile.vhd</code>) implements the general purpose RISC-V architecture registers
<code>x0</code> to <code>x31</code>. For the "embedded" <code>rv32e</code> ISA option only the lower 16 registers are implemented. Register zero (<code>x0</code>/<code>zero</code>)
always reads as zero and any write access to it has no effect. Read and write accesses are mutually exclusive as they occur
in different execution cycles. Hence, the "read-during-write" behavior of the register file is irrelevant.</p>
</div>
<div class="paragraph">
<p>The register file can be realized using different architecture styles to optimize the implementation for the target
platform/technology. The <code>CPU_RF_ARCH_SEL</code> <a href="#_cpu_tuning_options">CPU tuning option</a> generic is used to select a
specific architecture style:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 45. CPU Register File Implementation Flavors</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>CPU_RF_ARCH_SEL</code></th>
<th class="tableblock halign-left valign-top">Implementation Style</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong> (<code>sram_sync</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_register_based_with_synchronous_read">Register-Based with Synchronous Read</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can infer FPGA block-RAM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong> (<code>sram_async</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_register_based_with_asynchronous_read">Register-Based with Asynchronous Read</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can infer FPGA distributed-RAM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong> (<code>reg</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_register_based_with_reset">Register-Based with Reset</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provides a full hardware reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong> (<code>latch</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_latch_based">Latch-Based</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">improved efficiency for ASIC implementations</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">No Hardware Reset</div>
Apart from the <a href="#_register_based_with_reset">Register-Based with Reset</a> style, the register file does not provide a dedicated hardware reset.
Hence, all <code>x</code> registers power-up in an undefined state and need software-based initialization (e.g. by the <a href="#_start_up_code_crt0">Start-Up Code (crt0)</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Technology-Specific Register File</div>
For maximum efficiency regarding area, performance and energy the default register file VHDL module can be replaced
by a platform-/technology-specific macro or primitive.
</td>
</tr>
</table>
</div>
<h5 id="_register_based_with_synchronous_read" class="discrete">Register-Based with Synchronous Read</h5>
<div class="paragraph">
<p>This style implements the architecture registers as register-based SRAM array forming a synchronous simple-dual-port
RAM. One port is used in time division multiplexing for writing (<code>rd</code>) and reading the first operand (<code>rs1</code>). The
second port is used exclusively for reading the second operand (<code>rs2</code>). Read and write accesses are implemented as
synchronous operations triggering on the rising clock edge. Hence, this architecture style can infer <strong>FPGA block RAM</strong>.</p>
</div>
<div class="paragraph">
<p>The <code>x0</code>/<code>zero</code> register is also implemented as another physical register within the RAM. However, this requires that
these register bits are explicitly initialized (set to zero) by the hardware. This is done transparently by the CPU
control without requiring additional processing effort.</p>
</div>
<h5 id="_register_based_with_asynchronous_read" class="discrete">Register-Based with Asynchronous Read</h5>
<div class="paragraph">
<p>For this style, the register file is implemented as register-based SRAM, too. Writing data (<code>rd</code>) and reading
operands (<code>rs1</code> &amp; <code>rs2</code>) is performed by three individual port, whereby the read accesses are implemented <em>asynchronously</em>.
Hence, this architecture style can infer <strong>FPGA distributed RAM</strong>. If the <code>x0</code>/<code>zero</code> register is read, the respective
operand is masked before the read data is buffered in the operand output register.</p>
</div>
<h5 id="_register_based_with_reset" class="discrete">Register-Based with Reset</h5>
<div class="paragraph">
<p>The register file can also be constructed from individual rising-edge-triggered flip flops (registers). No registers
are implemented for <code>x0</code>/<code>zero</code> which is hardwired to zero. In contrast to the other architecture styles, this
implementation flavor provides a <strong>dedicated hardware reset</strong> that initializes all registers to zero during CPU reset.</p>
</div>
<h5 id="_latch_based" class="discrete">Latch-Based</h5>
<div class="paragraph">
<p>The latch-based architecture version implements the individual architecture registers as simple latches that are
transparent during the low phase of the clock. A data input register (for <code>rd</code>) and two output registers (for
<code>rs1</code> &amp; <code>rs2</code>) ensure correct control and improved timing. No latches are implemented for architecture register
<code>x0</code>/<code>zero</code>; it is hardwired to zero. This architecture styles provides superior performance and area efficiency
for <strong>ASIC implementations</strong> when realized with standard cells.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_arithmetic_logic_unit">3.3.4. CPU Arithmetic Logic Unit</h4>
<div class="paragraph">
<p>The arithmetic/logic unit ("ALU", VHDL file <code>neorv32_cpu_alu.vhd</code>) is used for actual data processing as well as generating
memory and branch addresses. All "simple" <a href="#_i_isa_extension"><code>I</code> ISA Extension</a> computational instructions (like <code>add</code> and <code>or</code>) are implemented
as plain combinatorial logic requiring only a single cycle to complete. More sophisticated instructions like shift operations
or multiplications are processed by so-called "ALU co-processors" (VHDL files <code>neorv32_cpu_alu_*.vhd</code>).</p>
</div>
<div class="paragraph">
<p>The co-processors are implemented as iterative units that require several cycles to complete processing. Besides the base ISA&#8217;s
shift instructions, the co-processors are used to implement all further unprivileged ISA extensions (e.g. <a href="#_m_isa_extension"><code>M</code> ISA Extension</a>,
<a href="#_zfinx_isa_extension"><code>Zfinx</code> ISA Extension</a> and also custom instructions implemented within the <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>). If the CPU logic
detects an illegal instruction or an instruction fetch alignment or bus error no co-processor will be triggered to prevent
corruption of the co-processor&#8217;s internal state (like FPU CSRs).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Multi-Cycle Execution Monitor</div>
The CPU control will raise an illegal instruction exception if a multi-cycle functional unit (like the
<a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>) does not complete processing in a bound amount of time (configured via
the package&#8217;s <code>alu_cp_tmo_c</code> constant; default = 512 clock cycles).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_loadstore_unit">3.3.5. CPU Load/Store Unit</h4>
<div class="paragraph">
<p>The load/store unit (VHDL file <code>neorv32_cpu_lsu.vhd</code>) takes care of handling data memory accesses via load and store
instructions. It performs data adjustment when accessing sub-word data quantities (16-bit or 8-bit) and applies sign-extension
for singed load operations.</p>
</div>
<div class="paragraph">
<p>A list of the bus interface signals and a detailed description of the protocol can be found in section <a href="#_bus_interface">Bus Interface</a>.
All bus interface signals are driven/buffered by registers; so even a complex SoC interconnection bus network will not
effect maximal operation frequency.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Unaligned Accesses</div>
The CPU does not support a hardware-based handling of unaligned memory accesses! Any unaligned access will raise a bus load/store unaligned
address exception. The exception handler can be used to <em>emulate</em> unaligned memory accesses in software.
See the NEORV32 Runtime Environment&#8217;s <a href="#_application_context_handling">Application Context Handling</a> section for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_execution_trace_port">3.3.6. Execution Trace Port</h4>
<div class="paragraph">
<p>The execution trace port provides information to trace the CPU&#8217;s instruction execution. This can be used for advanced debugging,
profiling or verification. Optionally, the trace data can be tracked by the <a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a> to perform online
branch delta tracing. Furthermore, trace data can also be made available externally by the two <code>trace_cpu0_o</code> and <code>trace_cpu1_o</code>
<a href="#_processor_top_entity_signals">top module ports</a>.</p>
</div>
<div class="paragraph">
<p>Trace data is generated by the CPU&#8217;s trace generator (VHDL file <code>neorv32_cpu_trace.vhd</code>), which is enabled if either the
<a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a> is implemented of if the external trace ports are enabled by the <code>TRACE_PORT_EN</code>
<a href="#_processor_top_entity_generics">top generic</a> (via the CPU core&#8217;s <a href="#_cpu_trace_en"><strong><code>CPU_TRACE_EN</code></strong></a> tuning option).</p>
</div>
<div class="paragraph">
<p>The trace port protocol is partly compatible to the <strong>RISC-V Formal Interface (RVFI)</strong> defined by Yosys
(<a href="https://yosyshq.readthedocs.io/projects/riscv-formal/en/latest/rvfi.html" class="bare">https://yosyshq.readthedocs.io/projects/riscv-formal/en/latest/rvfi.html</a>).</p>
</div>
<div class="paragraph">
<p>The trace ports uses a custom interface type <code>trace_port_t</code> (VHDL record) which is defined in the processor&#8217;s main RTL
package file (<code>neorv32_package.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 46. Trace Port Signals (<code>trace_port_t</code> VHDL type)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 7.6923%;">
<col style="width: 15.3846%;">
<col style="width: 61.5385%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">RVFI Equivalent</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>valid</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_valid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All others signals are valid when set; high for one cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Instruction Metadata</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>order</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_order</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction index (linear incrementing counter; resets to zero on overflow)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>insn</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_insn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction word; compressed instructions are shown in their decompressed 32-bit format (with <code>compr = 1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>trap</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_trap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the current instruction causes a synchronous exception</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>halt</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_halt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the current instruction is last instruction before halting</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>intr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_intr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the current instruction is the first instruction of a trap handler</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current privilege level; <code>00</code> = user, <code>11</code> = machine</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ixl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_ixl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current <code>XLEN</code>; hardwired to <code>01</code> = 32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>debug</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the current instruction is executed in debug-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>compr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the current instruction is a decompressed instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>delta</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if the current instruction is the target of a control-flow transfer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Integer Register</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rs1_addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_rs1_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register <code>rs1</code> address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rs2_addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_rs2_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register <code>rs2</code> address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rs1_rdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_rs1_rdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register <code>rs1</code> read data (<em>before</em> instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rs2_rdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_rs2_rdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register <code>rs2</code> read data (<em>before</em> instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rd_addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_rd_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register <code>rd</code> address; all-zero if no write</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rd_rdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_rd_wdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">register <code>rd</code> write data (<em>after</em> instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Program Counter</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>pc_rdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_pc_rdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of current instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>pc_wdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_pc_wdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of next address; e.g. branch destination (<em>after</em> instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Control and Status Register</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>csr_addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSR access address; all-zero if no CSR access</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>csr_rdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSR read data (valid if <code>csr_addr != 0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>csr_wdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSR write data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Memory Access</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mem_addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_mem_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory access address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mem_rmask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_mem_rmask</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory read-mask (byte-wise read-enable; all-zero if no memory read)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mem_wmask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_mem_wmask</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory write-mask (byte-wise write-enable; all-zero if no memory write)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mem_rdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_mem_rdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory read data (valid if <code>mem_rmask != 0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mem_wdata</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvfi_mem_wdata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory write data (valid if <code>mem_wmask != 0</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_tuning_options">3.3.7. CPU Tuning Options</h4>
<div class="paragraph">
<p>The top module provides several tuning options to optimize the CPU for performance, size and even security.
Note that these configuration options have no impact on the actual functionality (e.g. ISA compatibility).</p>
</div>
<h5 id="_cpu_trace_en" class="discrete"><strong><code>CPU_TRACE_EN</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution trace generation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code> (disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this option is <strong>enabled</strong>, the CPU code generates execution trace data that can be consumed by the
<a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a> for advanced debugging and profiling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <strong>disabled</strong>, no trace data is generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Note</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option is automatically enabled if the <a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a> is implemented or
if the <code>TRACE_PORT_EN</code> top generic is <code>true</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_cpu_constt_br_en" class="discrete"><strong><code>CPU_CONSTT_BR_EN</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant-time branches (data-independent timing)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code> (disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this option is <strong>enabled</strong>, all conditional branch instructions have identical execution times for taken and not
taken branch conditions. Thus, all branches behave as if they were always taken (including a complete CPU pipeline flush). Enabling
this feature makes execution times more predictable and makes timing side-channel attacks more difficult. Futhermore, thic option can
help to shorten the CPU&#8217;s critical path simplifying timing closure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <strong>disabled</strong>, not-taken conditional branches are executed faster without clearing the CPU pipeline. Hence, for maximum
performance, this feature should be disabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_cpu_fast_mul_en" class="discrete"><strong><code>CPU_FAST_MUL_EN</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast multiplication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code> (disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <strong>enabled</strong> the <code>M</code>/<code>Zmmul</code> extension&#8217;s multiplier is implemented as "plain multiplication" allowing the
synthesis tool to infer <strong>DSP blocks</strong> / multiplication primitives. Multiplication operations only require a few cycles due to the
DSP-internal register stages. The execution time is time-independent of the provided operands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <strong>disabled</strong> the <code>M</code>/<code>Zmmul</code> extension&#8217;s multiplier is implemented as <strong>bit-serial multiplier</strong> that computes one
result bit in every cycle. Multiplication operations always require 32 clock cycles.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_cpu_fast_shift_en" class="discrete"><strong><code>CPU_FAST_SHIFT_EN</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast bit-shifting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code> (disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <strong>enabled</strong> the ALU&#8217;s shifter unit is implemented as full-parallel <strong>barrel shifter</strong> that is capable
of shifting a data word by an arbitrary number of positions within a single cycle. Hence, the execution time of any base-ISA
shift operation is independent of the provided operands. Furthermore, this feature can help to reduce the risk of timing
side-channel attacks. Note that the barrel shifter requires a lot of hardware resources for implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When <strong>disabled</strong> the ALU&#8217;s shifter unit is implemented as <strong>bit-serial shifter</strong> that can shift the input data
only by one position per cycle. Hence, several cycles might be required to complete any base-ISA shift-related operations.
Therefore, the execution time of the serial approach is <strong>not</strong> time-independent of the provided operands. However, the serial
approach requires only a few hardware resources and does not impact the critical path.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_cpu_rf_arch_sel" class="discrete"><strong><code>CPU_RF_ARCH_SEL</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register file implementation style</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>natural</code> (0..2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> (simple-dual-port RAM with synchronous read)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This variable can be used to select a specific architecture for the CPU&#8217;s general-purpose register file that
can be implemented most efficiently for the target platform/technology. see section <a href="#_cpu_register_file">CPU Register File</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_sleep_mode">3.3.8. Sleep Mode</h4>
<div class="paragraph">
<p>The NEORV32 CPU provides a single sleep mode that can be entered to power-down the core reducing
dynamic power consumption. Sleep mode is entered by executing the RISC-V <code>wfi</code> ("wait for interrupt") instruction.</p>
</div>
<div class="paragraph">
<p>CPU-external modules like memories, timers and peripheral interfaces are not affected by this. Furthermore, the CPU will
continue to buffer/enqueue incoming interrupts. The CPU will leave sleep mode as soon as any <em>enabled</em> interrupt (via <a href="#_mie"><strong><code>mie</code></strong></a>)
source becomes <em>pending</em> or if a debug session is started.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Sleep during Debugging</div>
When executed in debug-mode or during single-stepping, <code>wfi</code> will behave as simple <code>nop</code> without entering sleep mode.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_full_virtualization">3.3.9. Full Virtualization</h4>
<div class="paragraph">
<p>Just like the RISC-V ISA, the NEORV32 aims to provide <em>maximum virtualization</em> capabilities on CPU and SoC level to
allow a high standard of <strong>execution safety</strong>. The CPU supports <strong>all</strong> traps specified by the official RISC-V
specifications. Thus, the CPU provides defined hardware fall-backs via traps for any expected and unexpected situations
(e.g. executing a malformed or not supported instruction or accessing a non-allocated memory address). For any kind
of trap the core is always in a defined and fully synchronized state throughout the whole system (i.e. there are no
out-of-order operations that might have to be reverted). This allows a defined and predictable execution behavior
at any time improving overall execution safety.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_bus_interface">3.4. Bus Interface</h3>
<div class="paragraph">
<p>The NEORV32 CPU provides separated instruction fetch and data access interfaces making it a <strong>Harvard Architecture</strong>:
the instruction fetch interface (<code>i_bus_*</code> signals) is used for fetching instructions and the data access interface
(<code>d_bus_*</code> signals) is used to access data via load and store operations. Each of these interfaces can access an address
space of up to 2<sup>32</sup> bytes (4GB).</p>
</div>
<div class="paragraph">
<p>The bus interface uses two custom interface types: <code>bus_req_t</code> is used to propagate the bus access requests downstream
from a host to a device. These signals are driven by the request-issuing device (i.e. the CPU core). Vice versa, <code>bus_rsp_t</code>
is used to return the bus response upstream from a device back to the host and is driven by the accessed device or bus system
(i.e. a processor-internal memory or IO device).</p>
</div>
<div class="paragraph">
<p>The signals of the request bus are split in to two categories: <em>in-band</em> signals and <em>out-of-band</em> signals. In-band
signals always belong to a certain bus transaction and are valid between <code>stb</code> (request) being set and the according
<code>err</code> or <code>ack</code> (response) being set. In contrast, the out-of-band signals are not associated with any bus transaction
and are always valid when set.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Adding Register Stages</div>
Arbitrary pipeline stages can be added to the request and response buses at any point to relax timing (at the cost of
additional latency). However, <em>all</em> bus signals (request and response) need to be registered.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 47. Bus Interface - Request Bus (<code>bus_req_t</code>)</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>In-Band Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>meta</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access meta information.<br>
<code>meta(4:3)</code>: core ID from the lowest two bits of the <a href="#_mhartid"><strong><code>mhartid</code></strong></a> CSR; the DMA has core ID <code>0b10</code><br>
<code>meta(2)</code>: set when CPU is in debug-mode<br>
<code>meta(1)</code>: current privilege mode, <code>0</code> = user-mode, <code>1</code> = machine-mode<br>
<code>meta(0)</code>: access source, <code>0</code> = data access, <code>1</code> = instruction fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access address using byte-wise addressing. Half-word (16-bit) and word (32-bit) addresses are aligned accordingly (e.g. LSB = 0 for half-word accesses).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write data. Writing individual bytes is controlled via <code>ben</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ben</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte-enable for each byte in <code>data</code>. This signal is used for the write-data as well as for the read-data.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request trigger ("strobe"). This signal is high for exactly one cycle starting a bus request. All other <em>in-band</em> signals are valid only if <code>stb</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rw</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access direction (<code>0</code> = read, <code>1</code> = write).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>amo</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if current access is an atomic memory operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>amoop</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actual type of atomic memory operation. Irrelevant if <code>amo</code> is not set.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>burst</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set during a burst transaction (always set together with <code>lock</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>lock</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if locked access; allow exclusive access to the bus system.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>Out-Of-Band Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fence</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data (load/store; <code>fence</code>) or instruction (instruction-fetch; <code>fence.i</code>) fence request; single-shot; see <a href="#_memory_coherence">Memory Coherence</a>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 48. Bus Interface - Response Bus (<code>bus_rsp_t</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfer acknowledge, single-shot.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>err</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfer error when set, valid if <code>ack = 1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read data, valid if <code>ack = 1</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_bus_interface_protocol">3.4.1. Bus Interface Protocol</h4>
<div class="paragraph">
<p>Transactions are triggered by the request bus. A new bus request is initiated by setting the <em>strobe</em>
signal <code>stb</code> high for exactly one cycle. All remaining signals of the bus are set together with <code>stb</code> and will
remain unchanged until the transaction is completed.</p>
</div>
<div class="paragraph">
<p>The transaction is completed when the accessed device returns an acknowledge via the <code>ack</code> signal, which is high
for exactly one cycle. Together with <code>ack</code> the accessed device returns an optional error status (<code>err</code>) and read
data (<code>rdata</code>) in case of a read-access. <code>err</code> and <code>data</code> are evaluated only when <code>ack</code> is high.</p>
</div>
<div class="paragraph">
<p>The figure below shows three exemplary single-access bus transactions:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>A read access to address <code>A_addr</code> returning <code>rdata</code> after several cycles (slow response; <code>ACK</code> arrives after several cycles).</p>
</li>
<li>
<p>A write access to address <code>B_addr</code> writing <code>wdata</code> (fastest response; <code>ACK</code> arrives right in the next cycle).</p>
</li>
<li>
<p>A failing read access to address <code>C_addr</code> (slow response; <code>ERR</code> arrives after several cycles).</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-9b856798a313513cd12dd902d8a6fae4.svg" alt="Diagram" width="680" height="480">
</div>
<div class="title">Figure 14. Three Exemplary <strong>Single-Access</strong> Transactions</div>
</div>
</div>
<div class="sect3">
<h4 id="_locked_bus_accesses_and_bursts">3.4.2. Locked Bus Accesses and Bursts</h4>
<div class="paragraph">
<p>Bus hosts like the CPU or the caches can request exclusive access to the downstream bus system using
the "bus lock" mechanism. When the bus is locked the locking host has exclusive access and can issue an arbitrary
number of transfers that cannot be interleaved by any other host. This feature is used to implement
atomic read-modify-write operations and for burst transfers.</p>
</div>
<div class="paragraph">
<p>The following figure shows a simplified read-followed-by-write transaction implemented as uninterruptible
exclusive bus access and a 4-word incrementing-address read burst.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-f765de9bd8f0174acdbda210492423d8.svg" alt="Diagram" width="800" height="480">
</div>
<div class="title">Figure 15. <strong>Atomic Access</strong> Transfer (left) and 4-Word Incrementing-Address <strong>Burst Read</strong> Transfer (right)</div>
</div>
<div class="paragraph">
<p><strong>Atomic Access Transfer</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The lock request is sent by setting <code>lock</code> together with the first <code>stb</code> ("a").
<code>lock</code> stays high until the end of the entire read-write transfer ("f").</p>
</li>
<li>
<p>The bus is locked when the host received the first <code>ack</code> ("c").</p>
</li>
<li>
<p>Now the host can send further requests using <code>stb</code> ("d").</p>
</li>
<li>
<p>When the exclusive access is completed the host clears <code>lock</code> after receiving the last <code>ack</code> of the transfer ("f").</p>
</li>
<li>
<p><code>lock</code> has to be low for at least one cycle after the last <code>ack</code> ("f"). This will release the bus lock.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Burst Read Transfer</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The locked burst request is sent by setting <code>lock</code> and <code>burst</code> together with the first <code>stb</code> ("h"). The address applied to <code>addr</code>
defines the base/start address of the burst. <code>lock</code> and <code>burst</code> stay high until the end of the burst ("m").</p>
</li>
<li>
<p>The bus is locked when the host received the first <code>ack</code> ("j"). Now the host has exclusive bus access and can
request the remaining burst strobes ("k").</p>
</li>
<li>
<p>The burst is completed when all required <code>stb</code> pulses are sent and when all corresponding <code>ack</code> have been received ("n").
<code>burst</code> is cleared. <code>lock</code> is cleared and has to be low for at least one cycle to release the bus lock.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Burst Generators</div>
Only the caches (<a href="#_processor_internal_instruction_cache_icache">i-cache</a> / <a href="#_processor_internal_data_cache_dcache">d-cache</a>)
can generate burst transfers (and only if explicitly enabled via <code>CACHE_BURSTS_EN</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Fast Burst Response</div>
The accessed device/memory can return all data words of the burst already after receiving the first strobe of
the locked transfer ("j").
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_instruction_sets_and_extensions">3.5. Instruction Sets and Extensions</h3>
<div class="paragraph">
<p>The NEORV32 CPU provides several optional RISC-V-compliant and custom/user-defined ISA extensions.
The extensions can be enabled/configured via the according <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>.
This chapter gives a brief overview of all available ISA extensions.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 49. NEORV32 Instruction Set Extensions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 50%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"><a href="#_processor_top_entity_generics">Enabled by Generic</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_a_isa_extension"><code>A</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic memory instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Implicitly</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_b_isa_extension"><code>B</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit manipulation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Implicitly</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_c_isa_extension"><code>C</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressed (16-bit) instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_C</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_e_isa_extension"><code>E</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embedded CPU extension (reduced register file size)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_E</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_i_isa_extension"><code>I</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer base ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled if <code>RISCV_ISA_E</code> is <strong>not</strong> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_m_isa_extension"><code>M</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer multiplication and division instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_M</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_u_isa_extension"><code>U</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less-privileged <em>user</em> mode extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_U</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_x_isa_extension"><code>X</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform-specific / NEORV32-specific extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zaamo_isa_extension"><code>Zaamo</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic read-modify-write memory operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zaamo</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zalrsc_isa_extension"><code>Zalrsc</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic reservation-set memory operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zalrsc</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zba_isa_extension"><code>Zba</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shifted-add bit manipulation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zba</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbb_isa_extension"><code>Zbb</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic bit manipulation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbb</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbkb_isa_extension"><code>Zbkb</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography bit manipulation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbkb</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbkc_isa_extension"><code>Zbkc</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography carry-less multiplication instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbkc</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbkx_isa_extension"><code>Zbkx</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography crossbar permutation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbkx</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbs_isa_extension"><code>Zbs</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single-bit bit manipulation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbs</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_c_isa_extension"><code>Zca</code></a> (an alias)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressed instruction without floating-point operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implicitly enabled via <a href="#_processor_top_entity_generics"><code>RISCV_ISA_C</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zcb_isa_extension"><code>Zcb</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional code size reduction instructions (build upon <code>C</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zcb</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zfinx_isa_extension"><code>Zfinx</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point instructions using integer registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zfinx</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zibi_isa_extension"><code>Zibi</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches with immediate-comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zibi</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicntr_isa_extension"><code>Zicntr</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base counters extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zicntr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicond_isa_extension"><code>Zicond</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer conditional operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zicond</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and status register access instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zifencei_isa_extension"><code>Zifencei</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction stream synchronization instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zihpm_isa_extension"><code>Zihpm</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware performance monitors extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zihpm</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zimop_isa_extension"><code>Zimop</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May-be-operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zimop</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zkn_isa_extension"><code>Zkn</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography NIST algorithm suite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Implicitly</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zknd_isa_extension"><code>Zknd</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography NIST AES decryption instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zknd</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zkne_isa_extension"><code>Zkne</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography NIST AES encryption instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zkne</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zknh_isa_extension"><code>Zknh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography NIST hash function instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zknh</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zks_isa_extension"><code>Zks</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography ShangMi algorithm suite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Implicitly</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zksed_isa_extension"><code>Zksed</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography ShangMi block cypher instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zksed</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zksh_isa_extension"><code>Zksh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar cryptography ShangMi hash instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zksh</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zkt_isa_extension"><code>Zkt</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data independent execution time (of cryptography operations)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Implicitly</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zmmul_isa_extension"><code>Zmmul</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer multiplication-only instructions (subset of <code>M</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zmmul</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdext_isa_extension"><code>Sdext</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External debug support extension (on-chip debugger)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>OCD_EN</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdtrig_isa_extension"><code>Sdtrig</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug trigger module extension (hardware breakpoint)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>OCD_NUM_HW_TRIGGERS</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smcntrpmf_isa_extension"><code>Smcntrpmf</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter privilege-mode filtering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Smcntrpmf</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smpmp_isa_extension"><code>Smpmp</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection (PMP) extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Smpmp</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_xcfu_isa_extension"><code>Xcfu</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom / user-defined instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_processor_top_entity_generics"><code>RISCV_ISA_Xcfu</code></a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">RISC-V ISA Specification</div>
For more information regarding the RISC-V ISA extensions please refer to the "RISC-V Instruction Set Manual - Volume
I: Unprivileged ISA" and "The RISC-V Instruction Set Manual Volume II: Privileged Architecture". A copy of these
documents can be found in the projects <code>docs/references</code> folder.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Discovering ISA Extensions</div>
Software can discover available ISA extensions via the <a href="#_misa"><strong><code>misa</code></strong></a> and <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSRs or by executing an instruction
and checking for an illegal instruction exception (i.e. <a href="#_full_virtualization">Full Virtualization</a>).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_latency_definitions">3.5.1. Latency Definitions</h4>
<div class="paragraph">
<p>This chapter shows the CPI values (cycles per instruction) for each individual instruction/type. For some instructions
a placeholder variable from the table below is used. Note that the provided values reflect <em>optimal bus accesses</em>
(i.e. no congestion/wait states due to dual-core or DMA accesses) and no pipeline wait cycles. To benchmark a certain
processor configuration for its setup-specific CPI value please refer to the <code>sw/example/performance_tests</code> test programs.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Alias</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T_shift_latency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 if <a href="#_cpu_fast_shift_en"><strong><code>CPU_FAST_SHIFT_EN</code></strong></a> is <code>true</code>; otherwise <code>T_shift_latency</code> equals the shift offset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T_data_latency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 for accessing the default processor-internal memories;<br>
1 if accessing the data cache results in a hit;<br>
2 for accessing the default processor-internal peripherals;<br>
uncached accesses via the <a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a> may have additional wait states</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T_inst_latency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 for accessing the default processor-internal memories;<br>
1 if accessing the instruction cache results in a hit;<br>
2 for accessing the default processor-internal peripherals;<br>
uncached accesses via the <a href="#_processor_external_bus_interface_xbus">Processor-External Bus Interface (XBUS)</a> may have additional wait states;<br>
branches to an unaligned address require additional <code>2 x T_inst_latency</code> cycles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T_mul_latency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 if <a href="#_cpu_fast_mul_en"><strong><code>CPU_FAST_MUL_EN</code></strong></a> is <code>true</code>; 32 otherwise</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T_cust_latency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">latency is defined by the custom <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> logic;<br>
however, the minimum is 1 and the maximum is 512</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_isa_extension">3.5.2. <code>A</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>A</code> ISA extension adds instructions and mechanisms for atomic memory operations hat can be used to
manage mutually-exclusive access to shared resources. Note that this ISA extension cannot be enabled by
a specific generic. Instead, it is enabled if a specific set of sub-extensions is enabled. The <code>A</code>
extension is shorthand for the following set of other extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_zaamo_isa_extension"><code>Zaamo</code> ISA Extension</a> - Atomic read-modify-write instructions.</p>
</li>
<li>
<p><a href="#_zalrsc_isa_extension"><code>Zalrsc</code> ISA Extension</a> - Atomic reservation-set instructions.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Atomic Variable in C Languages</div>
The C <code>_Atomic</code> specifier should be used for atomic variables.
See section <a href="#_coherence_example">Coherence Example</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>A</code> ISA Extension Exceptions</div>
Note that load and load-reserved instructions generate load exceptions,
whereas store, store-conditional, and AMO instructions generate store exceptions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_b_isa_extension">3.5.3. <code>B</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>B</code> ISA extension adds instructions for bit-manipulation operations.
This ISA extension cannot be enabled by a specific generic. Instead, it is enabled if a specific set of
sub-extensions is enabled. The <code>B</code> extension is shorthand for the following set of other extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_zba_isa_extension"><code>Zba</code> ISA Extension</a> - Address-generation / shifted-add instructions.</p>
</li>
<li>
<p><a href="#_zbb_isa_extension"><code>Zbb</code> ISA Extension</a> - Basic bit manipulation instructions.</p>
</li>
<li>
<p><a href="#_zbs_isa_extension"><code>Zbs</code> ISA Extension</a> - Single-bit operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A processor configuration which implements <code>B</code> must implement all of the above extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_c_isa_extension">3.5.4. <code>C</code> ISA Extension</h4>
<div class="paragraph">
<p>The "compressed" ISA extension provides 16-bit encodings of commonly used instructions to reduce code size.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 50. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.addi4spn</code> <code>c.nop</code> <code>c.add[i]</code> <code>c.li</code> <code>c.addi16sp</code> <code>c.lui</code> <code>c.and[i]</code> <code>c.sub</code> <code>c.xor</code> <code>c.or</code> <code>c.mv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU shifts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.srli</code> <code>c.srai</code> <code>c.slli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 + <code>T_shift_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.beqz</code> <code>c.bnez</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not taken: 3<br>
taken: 5 + <code>T_inst_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jump/call</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.jal[r]</code> <code>c.j</code> <code>c.jr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 + <code>T_inst_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load/store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.lw</code> <code>c.sw</code> <code>c.lwsp</code> <code>c.swsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <code>T_data_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.break</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7 + <code>T_inst_latency</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the NEORV32 <code>C</code> ISA extension only includes the <code>Zca</code> instructions; i.e. all instructions from <code>C</code>
excluding the single-precision (<code>F</code>) and double-precision (<code>D</code>) floating-point instructions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_e_isa_extension">3.5.5. <code>E</code> ISA Extension</h4>
<div class="paragraph">
<p>The "embedded" ISA extensions reduces the size of the general purpose register file from 32 entries
to 16 entries to shrink hardware size. It provides the same instructions as the base <code>I</code> ISA extension.
Due to the reduced register file size an alternate toolchain ABI (<code>ilp32e*</code>) is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_i_isa_extension">3.5.6. <code>I</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>I</code> ISA extensions is the base RISC-V integer ISA that is always enabled.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 51. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add[i]</code> <code>slt[i]</code> <code>slt[i]u</code> <code>xor[i]</code> <code>or[i]</code> <code>and[i]</code> <code>sub</code> <code>lui</code> <code>auipc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU shifts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sll[i]</code> <code>srl[i]</code> <code>sra[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + <code>T_shift_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beq</code> <code>bne</code> <code>blt</code> <code>bge</code> <code>bltu</code> <code>bgeu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not taken: 3<br>
taken: 5 + <code>T_inst_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jump/call</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jal[r]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 + <code>T_inst_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load/store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lb</code> <code>lh</code> <code>lw</code> <code>lbu</code> <code>lhu</code> <code>sb</code> <code>sh</code> <code>sw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <code>T_data_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data fence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecall</code> <code>ebreak</code> <code>mret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7 + <code>T_inst_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wfi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>fence</code> Instruction</div>
Analogous to the <code>fence.i</code> instruction (<a href="#_zifencei_isa_extension"><code>Zifencei</code> ISA Extension</a>) the <code>fence</code> instruction triggers
a load/store memory synchronization operation by flushing the CPU&#8217;s data cache. See section
<a href="#_memory_coherence">Memory Coherence</a> for more information. NEORV32 ignores the predecessor and successor fields and
always executes a conservative fence on all operations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>wfi</code> Instruction</div>
The <code>wfi</code> instruction is used to enter CPU <a href="#_sleep_mode">Sleep Mode</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_m_isa_extension">3.5.7. <code>M</code> ISA Extension</h4>
<div class="paragraph">
<p>Hardware-accelerated integer multiplication and division operations are available via the RISC-V <code>M</code> ISA extension.
This ISA extension is implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_alu_muldiv.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 52. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mul</code> <code>mulh</code> <code>mulhsu</code> <code>mulhu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + <code>T_mul_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div</code> <code>divu</code> <code>rem</code> <code>remu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + 32</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Multiplication Tuning Options</div>
The physical implementation of the multiplier can be tuned for certain design goals like area or throughput.
See section <a href="#_cpu_tuning_options">CPU Tuning Options</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_u_isa_extension">3.5.8. <code>U</code> ISA Extension</h4>
<div class="paragraph">
<p>In addition to the highest-privileged machine-mode, the user-mode ISA extensions adds a second <strong>less-privileged</strong>
operation mode. Code executed in user-mode has reduced CSR access rights. Furthermore, user-mode accesses to the address space
(like peripheral/IO devices) can be constrained via the physical memory protection.
Any kind of privilege rights violation will raise an exception to allow <a href="#_full_virtualization">Full Virtualization</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_x_isa_extension">3.5.9. <code>X</code> ISA Extension</h4>
<div class="paragraph">
<p>The NEORV32-specific ISA extensions <code>X</code> is always enabled. The most important points of the NEORV32-specific extensions are:
* The CPU provides 16 <em>fast interrupt</em> interrupts (<code>FIRQ</code>), which are controlled via custom bits in the <a href="#_mie"><strong><code>mie</code></strong></a>
and <a href="#_mip"><strong><code>mip</code></strong></a> CSRs. These extensions are mapped to CSR bits, that are available for custom use according to the
RISC-V specs. Also, custom trap codes for <a href="#_mcause"><strong><code>mcause</code></strong></a> are implemented.
* All undefined/unimplemented/malformed/illegal instructions do raise an illegal instruction exception (see <a href="#_full_virtualization">Full Virtualization</a>).
* Additional <a href="#_neorv32_specific_csrs">NEORV32-Specific CSRs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zaamo_isa_extension">3.5.10. <code>Zaamo</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zaamo</code> ISA extension is a sub-extension of the RISC-V <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> and compromises
instructions for atomic read-modify-write operations. It is enabled by the top&#8217;s
<a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zaamo</code></a> generic. Atomic read-modify-write operations
are handled by the processor&#8217;s <a href="#_atomic_memory_operations_controller">Atomic Memory Operations Controller</a>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 53. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic read-modify-write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>amoswap.w</code> <code>amoadd.w</code> <code>amoand.w</code> <code>amoor.w</code> <code>amoxor.w</code> <code>amomax[u].w</code> <code>amomin[u].w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + 2x <code>T_data_latency</code> + 1</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>aq</code> and <code>rl</code> Bits</div>
The instruction word&#8217;s <code>aq</code> and <code>lr</code> memory ordering bits are not evaluated by the hardware at all.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zalrsc_isa_extension">3.5.11. <code>Zalrsc</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zalrsc</code> ISA extension is a sub-extension of the RISC-V <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> and compromises
instructions for reservation-set operations. It is enabled by the top&#8217;s
<a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zalrsc</code></a> generic. Atomic reservation-set operations
are handled by the processor&#8217;s <a href="#_atomic_reservation_set_controller">Atomic Reservation-Set Controller</a>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 54. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic reservation-set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lr.w</code> <code>sc.w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <code>T_data_latency</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>aq</code> and <code>rl</code> Bits</div>
The instruction word&#8217;s <code>aq</code> and <code>lr</code> memory ordering bits are not evaluated by the hardware at all.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zcb_isa_extension">3.5.12. <code>Zcb</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extension is part of the "code size reduction" ISA extension <code>Zc*</code> and adds additional
compressed instruction for common operation. <code>Zcb</code> requires the <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> to be enabled.
Some instructions may require additional ISA (sub-) extensions.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 55. Instructions and Timing</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 25%;">
<col style="width: 25.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Depends on ISA Ext.</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.lbu</code> <code>c.lh</code> <code>c.lhu</code> <code>c.sb</code> <code>c.sh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <code>T_data_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.not</code> <code>c.zext.b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.sext.b</code> <code>c.zext.h</code> <code>c.zext.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>B</code> or <code>Zbb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arithmetic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.mul</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>M</code> or <code>Zmmul</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + <code>T_mul_latency</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">RISC-V GCC ISA String</div>
Technically, <code>Zbc</code> required the <code>Zca</code> extension which is <code>C</code> but excluding the floating-point operations.
Therefore, <code>Zca</code> and <code>Zbc</code> must be contained in the ISA string so that the compiler generates <code>Zbc</code> instructions..
Example: <code>MARCH=rv32imc_zca_zcb_&#8230;&#8203;</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zifencei_isa_extension">3.5.13. <code>Zifencei</code> ISA Extension</h4>
<div class="paragraph">
<p>This instruction is the only standard mechanism to ensure that stores visible to a hart will also be visible to its
instruction fetches. When executed, the CPU flushes the instruction prefetch buffer and reloads the CPU&#8217;s
instruction cache (if enabled). See section <a href="#_memory_coherence">Memory Coherence</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 56. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction fence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence.i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zfinx_isa_extension">3.5.14. <code>Zfinx</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zfinx</code> floating-point extension is an <em>alternative</em> of the standard <code>F</code> floating-point ISA extension.
It also uses the integer register file <code>x</code> to store and operate on floating-point data
instead of a dedicated floating-point register file. Thus, the <code>Zfinx</code> extension requires
less hardware resources and features faster context changes. This also implies that there are NO dedicated <code>f</code>
register file-related load/store or move instructions. The <code>Zfinx</code> extension&#8217;S floating-point unit is controlled
via dedicated <a href="#_floating_point_csrs">Floating-Point CSRs</a>.
This ISA extension is implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_alu_fpu.vhd</code>).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Fused / Multiply-Add and Division / Square Root Instructions</div>
Fused multiply-add instructions <code>f[n]m[add/sub].s</code> and division <code>fdiv.s</code> and square root <code>fsqrt.s</code> instructions
are not supported yet. are not supported. Special GCC flags are used to prevent the compiler from emitting these
operations (see <a href="#_default_compiler_flags">Default Compiler Flags</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Subnormal Numbers</div>
Subnormal numbers ("de-normalized" numbers, i.e. exponent = 0) are not supported by the NEORV32 FPU.
Subnormal numbers are <em>flushed to zero</em> setting them to +/- 0 before being processed by <strong>any</strong> FPU operation.
If a computational instruction generates a subnormal result it is also flushed to zero during normalization.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 57. Instructions and Timing</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 44.4444%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add/sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fadd.s</code> <code>fsub.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiply</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmul.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmin.s</code> <code>fmax.s</code> <code>feq.s</code> <code>flt.s</code> <code>fle.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert (float &#8594; int)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fcvt.w.s</code> <code>fcvt.wu.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert (int &#8594; float)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fcvt.s.w</code> <code>fcvt.s.wu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sign-injection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fsgnj.s</code> <code>fsgnjn.s</code> <code>fsgnjx.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Classify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fclass.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zibi_isa_extension">3.5.15. <code>Zibi</code> ISA Extension</h4>
<div class="paragraph">
<p>The RISC-V <code>Zibi</code> ISA extension adds two new "branch with immediate" instructions. The instruction
word&#8217;s <code>rs2</code> bit-field selects one out of 32 pre-defined immediate values which is used for the
actual comparison.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Non-Ratified ISA Extension</div>
The RISC-V <code>Zibi</code> ISA extension has not been ratified yet!
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 58. Instructions and Timing</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch with immediate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beqi</code> <code>bnei</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not taken: 3<br>
taken: 5 + <code>T_inst_latency</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zicntr_isa_extension">3.5.16. <code>Zicntr</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zicntr</code> ISA extension adds the basic <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a>, <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a>, <a href="#_instreth"><strong><code>instret[h]</code></strong></a> and <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a>
counter CSRs. Section <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> shows a list of all <code>Zicntr</code>-related CSRs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Time CSRs</div>
The user-mode <code>time[h]</code> CSRs are <strong>not implemented</strong>. Any access will trap allowing the trap handler to
retrieve system time from the <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Constrained Access</div>
User-level access to the counter CSRs can be constrained by the <a href="#_mcounteren"><strong><code>mcounteren</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zicond_isa_extension">3.5.17. <code>Zicond</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zicond</code> ISA extension adds integer conditional move primitives that allow to implement branch-less
control flows. It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zicond</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_cond.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 59. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>czero.eqz</code> <code>czero.nez</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zicsr_isa_extension">3.5.18. <code>Zicsr</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extensions provides instructions for accessing the <a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> as well as further
privileged-architecture extensions. This extension is mandatory and cannot be disabled. Hence, there is no generic
for enabling/disabling this ISA extension.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Side-Effects if Destination is Zero-Register</div>
If <code>rd=x0</code> for the <code>csrrw[i]</code> instructions there will be no actual read access to the according CSR.
However, access privileges are still enforced so these instruction variants <em>do</em> cause side-effects
(the RISC-V spec. state that these combinations "shall" not cause any side-effects).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 60. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>csrrw[i]</code> <code>csrrs[i]</code> <code>csrrc[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zihpm_isa_extension">3.5.19. <code>Zihpm</code> ISA Extension</h4>
<div class="paragraph">
<p>In additions to the base counters the NEORV32 CPU provides up to 13 hardware performance monitors (HPM 3..15),
which can be used to benchmark applications. Each HPM consists of an N-bit wide counter (split in a high-word 32-bit
CSR and a low-word 32-bit CSR), where N is defined via the top&#8217;s <code>HPM_CNT_WIDTH</code> generic and a corresponding event
configuration CSR.</p>
</div>
<div class="paragraph">
<p>The event configuration CSR defines the architectural events that lead to an increment of the associated HPM counter.
See section <a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a> for a list of all HPM-related CSRs and event configurations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Machine-Mode HPMs Only</div>
Note that only the machine-mode hardware performance counter CSR are available (<code>mhpmcounter*[h]</code>).
Accessing any user-mode HPM CSR (<code>hpmcounter*[h]</code>) will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Increment Inhibit</div>
The event-driven increment of the HPMs can be deactivated individually via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zimop_isa_extension">3.5.20. <code>Zimop</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zimop</code> ISA extension introduces the concept of instructions that may be operations (MOPs). MOPs are initially
defined to simply write zero to the destination register, but are designed to be redefined by later extensions to
perform some other system/environment-class actions. NEORV32 can implement this ISA extension for software compatibility.
Without the <code>Zimop</code> extension, any <code>mop.r*</code> instruction will raise an illegal instruction exception.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 61. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mop.r.[0..31]</code> <code>mop.rr.[0..7]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zba_isa_extension">3.5.21. <code>Zba</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zba</code> sub-extension is part of the <em>RISC-V bit manipulation</em> ISA specification (<a href="#_b_isa_extension"><code>B</code> ISA Extension</a>)
and adds shifted-add / address-generation instructions. It is enabled by the top&#8217;s
<a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zba</code></a> generic. This ISA extension is implemented as multi-cycle
ALU co-processor (<code>rtl/core/neorv32_cpu_alu_bitmanip.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 62. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shifted-add</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sh1add</code> <code>sh2add</code> <code>sh3add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zbb_isa_extension">3.5.22. <code>Zbb</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zbb</code> sub-extension is part of the <em>RISC-V bit manipulation</em> ISA specification (<a href="#_b_isa_extension"><code>B</code> ISA Extension</a>)
and adds the basic bit manipulation instructions. It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbb</code></a>
generic. This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_bitmanip.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 63. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logic with negate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>andn</code> <code>orn</code> <code>xnor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clz</code> <code>ctz</code> <code>cpop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <code>T_shift_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer maximum/minimum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min[u]</code> <code>max[u]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sign/zero extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sext.b</code> <code>sext.h</code> <code>zext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise rotation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rol</code> <code>ror[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <code>T_shift_latency</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR-combine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>orc.b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte-reverse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rev8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">shifter Tuning Options</div>
The physical implementation of the bit-shifter can be tuned for certain design goals like area or throughput.
See section <a href="#_cpu_tuning_options">CPU Tuning Options</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zbs_isa_extension">3.5.23. <code>Zbs</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zbs</code> sub-extension is part of the <em>RISC-V bit manipulation</em> ISA specification (<a href="#_b_isa_extension"><code>B</code> ISA Extension</a>)
and adds single-bit operations. It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbs</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_bitmanip.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 64. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sbset[i]</code> <code>sbclr[i]</code> <code>sbinv[i]</code> <code>sbext[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zbkb_isa_extension">3.5.24. <code>Zbkb</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zbkb</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and extends the <em>RISC-V bit manipulation</em>
ISA extension with additional instructions. It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbkb</code></a> generic.
Note that enabling this extension will also enable the <code>Zbb</code> basic bit-manipulation ISA extension (which is extended by <code>Zknb</code>).
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_bitmanip.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 65. Instructions and Timing (in addition to <code>Zbb</code>)</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pack</code> <code>packh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interleaving</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zip</code> <code>unzip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte-wise bit reversal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>brev8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zbkc_isa_extension">3.5.25. <code>Zbkc</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zbkc</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA extension and adds carry-less multiplication instruction.
ISA extension with additional instructions. It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbkc</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_bitmanip.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 66. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carry-less multiply</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clmul</code> <code>clmulh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + 32</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zbkx_isa_extension">3.5.26. <code>Zbkx</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zbkx</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and adds crossbar permutation instructions.
It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zbkx</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_crypto.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 67. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crossbar permutation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xperm8</code> <code>xperm4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zkn_isa_extension">3.5.27. <code>Zkn</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zkn</code> ISA extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and defines the "NIST algorithm suite".
This ISA extension cannot be enabled by a specific generic. Instead, it is enabled if a specific set of cryptography-related
sub-extensions is enabled.</p>
</div>
<div class="paragraph">
<p>The <code>Zkn</code> extension is shorthand for the following set of other extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_zbkb_isa_extension"><code>Zbkb</code> ISA Extension</a> - Bit manipulation instructions for cryptography.</p>
</li>
<li>
<p><a href="#_zbkc_isa_extension"><code>Zbkc</code> ISA Extension</a> - Carry-less multiply instructions.</p>
</li>
<li>
<p><a href="#_zbkx_isa_extension"><code>Zbkx</code> ISA Extension</a> - Cross-bar permutation instructions.</p>
</li>
<li>
<p><a href="#_zkne_isa_extension"><code>Zkne</code> ISA Extension</a> - AES encryption instructions.</p>
</li>
<li>
<p><a href="#_zknd_isa_extension"><code>Zknd</code> ISA Extension</a> - AES decryption instructions.</p>
</li>
<li>
<p><a href="#_zknh_isa_extension"><code>Zknh</code> ISA Extension</a> - SHA2 hash function instructions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A processor configuration which implements <code>Zkn</code> must implement all of the above extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zknd_isa_extension">3.5.28. <code>Zknd</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zknd</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and adds NIST AES decryption instructions.
It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zknd</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_crypto.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 68. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AES decryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aes32dsi</code> <code>aes32dsmi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zkne_isa_extension">3.5.29. <code>Zkne</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zkne</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and adds NIST AES encryption instructions.
It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zkne</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_crypto.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 69. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AES decryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aes32esi</code> <code>aes32esmi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zknh_isa_extension">3.5.30. <code>Zknh</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zknh</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and adds NIST hash function instructions.
It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zknh</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_crypto.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 70. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sha256sig0</code> <code>sha256sig1</code> <code>sha256sum0</code> <code>sha256sum1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sha512sig0h</code> <code>sha512sig0l</code> <code>sha512sig1h</code> <code>sha512sig1l</code> <code>sha512sum0r</code> <code>sha512sum1r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zks_isa_extension">3.5.31. <code>Zks</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zks</code> ISA extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and defines the "ShangMi algorithm suite".
This ISA extension cannot be enabled by a specific generic. Instead, it is enabled if a specific set of cryptography-related
sub-extensions is enabled.</p>
</div>
<div class="paragraph">
<p>The <code>Zks</code> extension is shorthand for the following set of other extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_zbkb_isa_extension"><code>Zbkb</code> ISA Extension</a> - Bit manipulation instructions for cryptography.</p>
</li>
<li>
<p><a href="#_zbkc_isa_extension"><code>Zbkc</code> ISA Extension</a> - Carry-less multiply instructions.</p>
</li>
<li>
<p><a href="#_zbkx_isa_extension"><code>Zbkx</code> ISA Extension</a> - Cross-bar permutation instructions.</p>
</li>
<li>
<p><a href="#_zksed_isa_extension"><code>Zksed</code> ISA Extension</a> - SM4 block cipher instructions.</p>
</li>
<li>
<p><a href="#_zksh_isa_extension"><code>Zksh</code> ISA Extension</a> - SM3 hash function instructions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A processor configuration which implements <code>Zks</code> must implement all of the above extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zksed_isa_extension">3.5.32. <code>Zksed</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zksed</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and adds ShangMi block cypher
and key schedule instructions. It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zksed</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_crypto.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 71. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block cyphers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sm4ed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key schedule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sm4ks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zksh_isa_extension">3.5.33. <code>Zksh</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zksh</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and adds ShangMi hash function instructions.
It is enabled by the top&#8217;s <a href="#_processor_top_entity_generics"><code>RISCV_ISA_Zksh</code></a> generic.
This ISA extension is implemented as multi-cycle ALU co-processor (<code>rtl/core/neorv32_cpu_alu_crypto.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 72. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sm3p0</code> <code>sm3p1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zkt_isa_extension">3.5.34. <code>Zkt</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zkt</code> sub-extension is part of the <em>RISC-V scalar cryptography</em> ISA specification and guarantees data independent execution
times of cryptography and cryptography-related instructions. The ISA extension cannot be enabled by a specific generic.
Instead, it is enabled implicitly by certain CPU configurations.</p>
</div>
<div class="paragraph">
<p>The RISC-V <code>Zkt</code> specifications provides a list of instructions that are included within this specification.
However, not all instructions are required to be implemented. Rather, every one of these instructions that the
core does implement must adhere to the requirements of <code>Zkt</code>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 73. <code>Zkt</code> instruction listing</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parent extension</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Data independent execution time?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>RVI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lui</code> <code>auipc</code> <code>add[i]</code> <code>slt[i][u]</code> <code>xor[i]</code> <code>or[i]</code> <code>and[i]</code> <code>sub</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sll[i]</code> <code>srl[i]</code> <code>sra[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes if <code>CPU_FAST_SHIFT_EN</code> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RVM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mul[h]</code> <code>mulh[s]u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>RVC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.nop</code> <code>c.addi</code> <code>c.lui</code> <code>c.andi</code> <code>c.sub</code> <code>c.xor</code> <code>c.and</code> <code>c.mv</code> <code>c.add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.srli</code> <code>c.srai</code> <code>c.slli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes if <code>CPU_FAST_SHIFT_EN</code> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>Zcb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.mul</code>, <code>c.not</code>, <code>c.zext.b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RVK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aes32ds[m]i</code> <code>aes32es[m]i</code> <code>sha256sig*</code> <code>sha512sig*</code> <code>sha512sum*</code> <code>sm3p0</code> <code>sm3p1</code> <code>sm4ed</code> <code>sm4ks</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>RVB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xperm4</code> <code>xperm8</code> <code>andn</code> <code>orn</code> <code>xnor</code> <code>pack[h]</code> <code>brev8</code> <code>rev8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ror[i]</code> <code>rol</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Data-Independent Timing of Branches</div>
To further reduce the possibility of timing side-channel attacks, conditional branches can be executed with constant time
(i.e. data-independent execution times). See the <a href="#_cpu_constt_br_en"><strong><code>CPU_CONSTT_BR_EN</code></strong></a> <a href="#_cpu_tuning_options">CPU Tuning Options</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmul_isa_extension">3.5.35. <code>Zmmul</code> - ISA Extension</h4>
<div class="paragraph">
<p>This is a sub-extension of the <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> ISA extension. It implements only the multiplication operations
of the <code>M</code> extensions and is intended for size-constrained setups that require hardware-based
integer multiplications but not hardware-based divisions, which will be computed entirely in software.</p>
</div>
</div>
<div class="sect3">
<h4 id="_xcfu_isa_extension">3.5.36. <code>Xcfu</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Xcfu</code> presents a custom NEORV32-specific ISA extension. It adds the <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> to
the CPU core, which allows to add custom RISC-V instructions to the processor core.
For detailed information regarding the CFU, its hardware and the according software interface
see section <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.</p>
</div>
<div class="paragraph">
<p>Software can utilize the custom instructions by using <em>intrinsics</em>, which are basically inline assembly functions that
behave like regular C functions but that evaluate to a single custom instruction word (no calling overhead at all).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Execution Time</div>
The actual CFU execution time depends on the logic being implemented. The CPU architecture requires a minimal execution
time of 3 cycles (purely combinatorial CFU operation) and automatically terminates execution after 512 cycles if the CFU
does not complete operation within this time window.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 74. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction words with <code>custom-0</code> or <code>custom-1</code> opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + <code>T_cust_latency</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_smpmp_isa_extension">3.5.37. <code>Smpmp</code> ISA Extension</h4>
<div class="paragraph">
<p>The NEORV32 physical memory protection (PMP) provides an elementary memory protection mechanism that can be used
to configure read/write(execute permission of arbitrary memory regions. In general, the PMP can <strong>grant permissions
to user mode</strong>, which by default has none, and can <strong>revoke permissions from M-mode</strong>, which by default has full
permissions. The NEORV32 PMP is fully compatible to the RISC-V Privileged Architecture Specifications and is
configured via several CSRs (<a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a>). Several <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>
are provided to adjust the CPU&#8217;s PMP capabilities according to the application requirements (pre-synthesis):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>PMP_NUM_REGIONS</code> defines the number of implemented PMP regions (0..16); setting this generic to zero will
result in absolutely no PMP logic being implemented</p>
</li>
<li>
<p><code>PMP_MIN_GRANULARITY</code> defines the minimal granularity of each region (has to be a power of 2, minimal
granularity = 4 bytes); note that a smaller granularity will lead to wider comparators and thus, to higher area footprint
and longer critical path</p>
</li>
<li>
<p><code>PMP_TOR_MODE_EN</code> controls the implementation of the top-of-region (TOR) mode (default = true); disabling this mode
will reduce area footprint</p>
</li>
<li>
<p><code>PMP_NAP_MODE_EN</code> controls the implementation of the naturally-aligned-power-of-two (NA4 and NAPOT) modes (default =
true); disabling this mode will reduce area footprint and critical path length</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">PMP Permissions when in Debug Mode</div>
When in debug-mode all PMP rules are bypassed/ignored granting the debugger maximum access permissions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">PMP Time-Multiplex</div>
Instructions are executed in a multi-cycle manner. Hence, data access (load/store) and instruction fetch cannot occur
at the same time. Therefore, the PMP hardware uses only a single set of comparators for memory access permissions checks
that are switched in an iterative, time-multiplex style reducing hardware footprint by approx. 50% while maintaining
full security features and RISC-V compatibility.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">PMP Memory Accesses</div>
Load/store accesses for which there are insufficient access permission do not trigger any memory/bus accesses at all.
In contrast, instruction accesses for which there are insufficient access permission nevertheless lead to a memory/bus
access (causing potential side effects on the memory side=. However, the fetched instruction will be discarded and the
corresponding exception will still be triggered precisely.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_smcntrpmf_isa_extension">3.5.38. <code>Smcntrpmf</code> - ISA Extension</h4>
<div class="paragraph">
<p>The counter privilege-mode filtering (<code>Smcntrpmf</code>) ISA extension allows to halt the standard cycle (<code>[m]cycle[h]</code>)
and instructions-retired (<code>[m]instret[h]</code>) counters if the CPU operates in a specific privilege mode (machine or user).
Four additional CSRs are provided by this ISA extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_mcyclecfgh"><code>mcyclecfg[h]</code></a></p>
</li>
<li>
<p><a href="#_minstretcfgh"><code>minstretcfg[h]</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sdext_isa_extension">3.5.39. <code>Sdext</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extension enables the RISC-V-compatible "external debug support" by implementing
the CPU "debug mode", which is required for the on-chip debugger.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> / <a href="#_cpu_debug_mode">CPU Debug Mode</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 75. Instructions and Timing</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 45.4545%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_sdtrig_isa_extension">3.5.40. <code>Sdtrig</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extension implements the RISC-V-compatible "trigger module" which provides support for
hardware breakpoints for the on-chip-debugger.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> / <a href="#_trigger_module">Trigger Module</a> for more information.</p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_functions_unit_cfu">3.6. Custom Functions Unit (CFU)</h3>
<div class="paragraph">
<p>The Custom Functions Unit (CFU) is the central part of the custom NEORV32-specific <a href="#_xcfu_isa_extension"><code>Xcfu</code> ISA Extension</a> and
represents the actual hardware module that can be used to implement <strong>custom RISC-V instructions</strong>.
These are intended for operations that are inefficient in terms of performance, latency, energy consumption or
program memory requirements when implemented entirely in software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Complexity</div>
The CFU is not intended for complex and <strong>CPU-independent</strong> functional units that implement complete accelerators
(like full block-based AES encryption). These kind of accelerators should be implemented as memory-mapped co-processor
via the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> to allow CPU-independent operation. A comparative survey of all NEORV32-specific
hardware extension/customization options is provided in the user guide section
<a href="https://stnolting.github.io/neorv32/ug/#_adding_custom_hardware_modules">Adding Custom Hardware Modules</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Default CFU Hardware/Software Example</div>
The default CFU module (<code>rtl/core/neorv32_cpu_alu_cfu.vhd</code>) implements the <em>Extended Tiny Encryption Algorithm (XTEA)</em>
as application example. The according example program is located in <code>sw/example/demo_cfu</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cfu_instruction_formats">3.6.1. CFU Instruction Formats</h4>
<div class="paragraph">
<p>The custom instructions executed by the CFU utilize a specific opcode space in the <code>rv32</code> 32-bit instruction
encoding space that has been explicitly reserved for user-defined extensions by the RISC-V specifications ("Guaranteed
Non-Standard Encoding Space"). The NEORV32 CFU uses the <code>custom-0</code> and <code>custom-1</code> opcodes to identify the instructions
implemented by the CFU and to differentiate between the predefined instruction formats. The NEORV32 CFU utilizes these
two opcodes to support user-defined <strong>R-type</strong> instructions and <strong>I-type</strong> instructions. Both instruction formats are
compliant to the RISC-V specification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>custom-0</code> (<code>0001011</code>), used for <a href="#_cfu_r_type_instructions">CFU R-Type Instructions</a></p>
</li>
<li>
<p><code>custom-1</code> (<code>0101011</code>), used for <a href="#_cfu_i_type_instructions">CFU I-Type Instructions</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_cfu_r_type_instructions">CFU R-Type Instructions</h5>
<div class="paragraph">
<p>The R-type CFU instructions operate on two source registers <code>rs1</code> and <code>rs2</code> and return the processing result to
the destination register <code>rd</code>. The actual operation can be defined by using the <code>funct7</code> and <code>funct3</code> bit fields.
These immediates can also be used to pass additional data to the CFU like offsets, look-up-tables addresses or
shift-amounts. However, the actual functionality is entirely user-defined. Note that all immediate values are
always compile-time-static.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; rs1 xnor rs2</code> (bit-wise logical XNOR)</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-c32631a1b9669440b2e00e5ac50e40b4.svg" alt="Diagram" width="800" height="70">
</div>
<div class="title">Figure 16. CFU R-type instruction format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>funct7</code>: 7-bit immediate (immediate data or function select)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (providing 32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (providing 32-bit source data)</p>
</li>
<li>
<p><code>funct3</code>: 3-bit immediate (immediate data or function select)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>0001011</code> (RISC-V <code>custom-0</code> opcode)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_cfu_i_type_instructions">CFU I-Type Instructions</h5>
<div class="paragraph">
<p>The I-type CFU instructions operate on one source registers <code>rs1</code> and a 12-bit immediate value <code>im12</code> and return
the processing result to the destination register <code>rd</code>. The actual operation can be defined by using the <code>funct3</code>
bit field. Alternatively, this immediate can also be used to pass additional data to the CFU like offsets,
look-up-tables addresses or shift-amounts. However, the actual functionality is entirely user-defined. Note that
all immediate values are always compile-time-static.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; rs1 * imm12</code> (multiply with immediate)</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-0fe3406abcee148c83a5beea571a6d25.svg" alt="Diagram" width="800" height="70">
</div>
<div class="title">Figure 17. CFU I-type instruction format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>imm12</code>: 12-bit immediate</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (providing 32-bit source data)</p>
</li>
<li>
<p><code>funct3</code>: 3-bit immediate (immediate data or function select)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>0101011</code> (RISC-V <code>custom-1</code> opcode)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_custom_instructions_in_software">3.6.2. Using Custom Instructions in Software</h4>
<div class="paragraph">
<p>The custom instructions provided by the CFU can be used in plain C code by using <strong>intrinsics</strong>. Intrinsics
behave like "normal" C functions but under the hood they are a set of macros that hide the complexity of inline
assembly, which is used to construct the custom 32-bit instruction words. Using intrinsics removes the need to
modify the compiler, built-in libraries or the assembler when using custom instructions. Each intrinsic will be
compiled into a single 32-bit instruction word without any overhead providing maximum code efficiency. The
NEORV32 software framework provides two pre-defined prototypes for custom instructions:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. CFU instruction prototypes (defined in <code>sw/lib/include/neorv32_cfu.h</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">uint32_t neorv32_cfu_r_instr(funct7, funct3, rs1, rs2); // R-type instruction
uint32_t neorv32_cfu_i_instr(funct3, imm12, rs1);       // I-type instruction</code></pre>
</div>
</div>
<div class="paragraph">
<p>The intrinsic functions always return a 32-bit value of type <code>uint32_t</code> (the processing result) which can be
discarded if not needed. The <code>funct3</code>, <code>funct7</code> and <code>im12</code> bit-fields are used to pass  compile-time-static
literals to the CFU. The <code>rs1</code> and <code>rs2</code> arguments pass actual runtime data to the CFU via register addresses.
These register arguments can be populated with variables or literals; the compiler will add the required code
to move the data into a register before passing it to the CFU. The following examples shows how to pass arguments:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. CFU instruction usage examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">uint32_t res = neorv32_cfu_r_instr(0b0000000, 0b101, 8, 123);
uint32_t tmp = neorv32_cfu_i_instr(0b011, 0x47a, res);
neorv32_cfu_r_instr(0b0100100, 0b001, res, tmp);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_instructions_hardware">3.6.3. Custom Instructions Hardware</h4>
<div class="paragraph">
<p>The CFU hardware module (<code>rtl/core/neorv32_cpu_alu_cfu.vhd</code>) is tightly integrated into to CPU and coupled as ALU
co-processor. A simple interface is used to communicate operands, operation definition and the processing result.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 76. CFU Interface</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Instruction Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Request</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger CFU operation; high for exactly one cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFU instruction type (<code>0</code> = R-type, <code>1</code> = I-type); defined by the opcode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>funct3</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit function select from the according custom instruction word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>funct7</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">R-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7-bit function select from the according custom instruction word (**)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>imm12</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">I-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bit immediate from the custom according instruction word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rs1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register operand 1 (addresses by the <code>rs1</code> instruction word bit field)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rs2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">R-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register operand 2 (addresses by the <code>rs2</code> instruction word bit field)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Response</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>result</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processing result that is written to <code>rd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>valid</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High for exactly one cycle when the CFU operation is done an <code>result</code> is valid</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-abe10b38b1d11bb395a82c75cf9d0eb4.svg" alt="Diagram" width="740" height="330">
</div>
<div class="title">Figure 18. CFU Interface Timing Examples</div>
</div>
<div class="paragraph">
<p>CFU operations can be entirely combinatorial (e.g. for a bit-reversal operation) so the result is available at
the end of the current clock cycle. However, operations can also take several clock cycles to complete (like
multiplications) and may also include internal states and memories. However, the CFU has to complete computation
within a <strong>bound time window</strong> (default = 512 clock cycles). Otherwise, an illegal instruction exception is raised.
See section <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Exception</div>
The CFU can intentionally raise an illegal instruction exception by not asserting the <code>valid</code> signal at all which
will cause an execution timeout. For example this can be used to signal invalid configurations/operations to the
runtime environment. See the documentation in the CFU&#8217;s VHDL source file for more information.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_control_and_status_registers_csrs">3.7. Control and Status Registers (CSRs)</h3>
<div class="paragraph">
<p>The following table shows a summary of all available NEORV32 CSRs. The address field defines the CSR address for
the CSR access instructions. The "Name [ASM]" column provides the CSR name aliases that can be used in (inline) assembly.
The "Name [C]" column lists the name aliases that are defined by the NEORV32 core library. These can be used in plain C code.
The "Access" column shows the minimal required privilege mode required for accessing the according CSR (<code>M</code> = machine-mode,
<code>U</code> = user-mode, <code>D</code> = debug-mode) and the read/write capabilities (<code>RW</code> = read-write, <code>RO</code> = read-only)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unused, Reserved, Unimplemented and Disabled CSRs</div>
All CSRs and CSR bits that are not listed in the table below are <em>unimplemented</em> and are <em>hardwired to zero</em>. Additionally,
CSRs that are unavailable ("disabled") because the according ISA extension is not enabled are also considered <em>unimplemented</em>
and are also hardwired to zero. Any access to such a CSR will raise an illegal instruction exception. All writable CSRs provide
<strong>WARL</strong> behavior (write all values; read only legal values). Application software should always read back a CSR after writing
to check if the targeted bits can actually be modified.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Read-Only RW CSRs</div>
Some CSRs are listed with "read-write" capabilities but will ignore any value written to them.
In the following table these CSRs are highlighted with "".
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 77. NEORV32 Control and Status Registers (CSRs)</caption>
<colgroup>
<col style="width: 10.3448%;">
<col style="width: 17.2413%;">
<col style="width: 20.6896%;">
<col style="width: 10.3448%;">
<col style="width: 41.3795%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [ASM]</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Access</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_floating_point_csrs">Floating-Point CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fflags"><strong><code>fflags</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_FFLAGS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point accrued exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_frm"><strong><code>frm</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_FRM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point dynamic rounding mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fcsr"><strong><code>fcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_FCSR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point control and status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_trap_setup_csrs">Machine Trap Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatus"><strong><code>mstatus</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_misa"><strong><code>misa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine CPU ISA and extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mie"><strong><code>mie</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtvec"><strong><code>mtvec</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MTVEC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap-handler base address for ALL traps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTEREN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatush"><strong><code>mstatush</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUSH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_configuration_csrs">Machine Configuration CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfg"><strong><code>menvcfg</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MENVCFG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfgh"><strong><code>menvcfgh</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MENVCFGH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_counter_setup_csrs">Machine Counter Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-inhibit register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x321</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcyclecfgh"><code>mcyclecfg</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCYCLECFG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter privilege mode filtering - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstretcfgh"><code>minstretcfg</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MINSTRETCFG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instret counter privilege mode filtering - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x721</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcyclecfgh"><code>mcyclecfgh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCYCLECFGH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter privilege mode filtering - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x722</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstretcfgh"><code>minstretcfgh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MINSTRETCFGH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instret counter privilege mode filtering - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mscratch"><strong><code>mscratch</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSCRATCH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine scratch register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mepc"><strong><code>mepc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MEPC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine exception program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcause"><strong><code>mcause</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCAUSE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap cause</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtval"><strong><code>mtval</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MTVAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mip"><strong><code>mip</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt pending register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x34a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtinst"><strong><code>mtinst</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MTINST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a0 .. 0x303</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpcfg"><code>pmpcfg0</code></a> .. <a href="#_pmpcfg"><code>pmpcfg3</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_PMPCFG0</code> .. <code>CSR_PMPCFG3</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection configuration registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3b0 .. 0x3bf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpaddr"><code>pmpaddr0</code></a> .. <a href="#_pmpaddr"><code>pmpaddr15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_PMPADDR0</code> .. <code>CSR_PMPADDR15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection address registers</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_trigger_module_csrs">Trigger Module CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tselect"><strong><code>tselect</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TSELECT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger select register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata1"><strong><code>tdata1</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TDATA1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata2"><strong><code>tdata2</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TDATA2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tinfo"><strong><code>tinfo</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TINFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger information register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dcsr"><strong><code>dcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dpc"><strong><code>dpc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dscratch0"><strong><code>dscratch0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug scratch register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCYCLE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MINSTRET</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycleh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCYCLEH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstreth</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MINSTRETH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_CYCLE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_INSTRET</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycleh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_CYCLEH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instreth</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_INSTRETH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x323 .. 0x32f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmevent"><code>mhpmevent3</code></a> .. <a href="#_mhpmevent"><code>mhpmevent15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHPMEVENT3</code> .. <code>CSR_MHPMEVENT15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring event select for counter 3..15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb03 .. 0xb0f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3</code></a> .. <a href="#_mhpmcounterh"><code>mhpmcounter15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHPMCOUNTER3</code> .. <code>CSR_MHPMCOUNTER15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..15 low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb83 .. 0xb8f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3h</code></a> .. <a href="#_mhpmcounterh"><code>mhpmcounter15h</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHPMCOUNTER3H</code> .. <code>CSR_MHPMCOUNTER15H</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..15 high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_information_csrs">Machine Information CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mvendorid"><strong><code>mvendorid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MVENDORID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine vendor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_marchid"><strong><code>marchid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MARCHID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine architecture ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mimpid"><strong><code>mimpid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIMPID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine implementation ID / version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhartid"><strong><code>mhartid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHARTID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware thread ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mconfigptr"><strong><code>mconfigptr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCONFIGPTR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine configuration pointer register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_neorv32_specific_csrs">NEORV32-Specific CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfc0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mxisa"><strong><code>mxisa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended machine CPU ISA and extensions</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_floating_point_csrs">3.7.1. Floating-Point CSRs</h4>
<h5 id="_fflags" class="discrete"><strong><code>fflags</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point accrued exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x001</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zfinx_isa_extension"><code>Zfinx</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPU status flags.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 78. <code>fflags</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NX</strong>: inexact</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UF</strong>: underflow</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OF</strong>: overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DZ</strong>: division by zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NV</strong>: invalid operation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_frm" class="discrete"><strong><code>frm</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point dynamic rounding mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x002</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zfinx_isa_extension"><code>Zfinx</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>frm</code> CSR is used to configure the rounding mode of the FPU.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 79. <code>frm</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounding mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_fcsr" class="discrete"><strong><code>fcsr</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x003</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zfinx_isa_extension"><code>Zfinx</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>fcsr</code> provides combined access to the <a href="#_fflags"><strong><code>fflags</code></strong></a> and <a href="#_frm"><strong><code>frm</code></strong></a> flags.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 80. <code>fcsr</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accrued exception flags (<a href="#_fflags"><strong><code>fflags</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounding mode (<a href="#_frm"><strong><code>frm</code></strong></a>)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_trap_setup_csrs">3.7.2. Machine Trap Setup CSRs</h4>
<h5 id="_mstatus" class="discrete"><strong><code>mstatus</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mstatus</code> CSR is used to configure general machine environment parameters.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 81. <code>mstatus</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS_MIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MIE</strong>: Machine-mode interrupt enable flag</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS_MPIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPIE</strong>: Previous machine-mode interrupt enable flag state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12:11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS_MPP_H</code> : <code>CSR_MSTATUS_MPP_L</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPP</strong>: Previous machine privilege mode, <code>11</code> = machine-mode "M", <code>00</code> = user-mode "U"; other values will fall-back to machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS_MPRV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPRV</strong>: Effective privilege mode for load/stores; use <code>MPP</code> as effective privilege mode when set; hardwired to zero if user-mode not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS_TW</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TW</strong>: Trap on execution of <code>wfi</code> instruction in user mode when set; hardwired to zero if user-mode not implemented</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_misa" class="discrete"><strong><code>misa</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA and extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x301</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code>, according to enabled ISA extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>misa</code> CSR provides information regarding the availability of basic RISC-V ISa extensions.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 <code>misa</code> CSR is read-only. Hence, active CPU extensions are entirely defined by pre-synthesis configurations
and cannot be switched on/off during runtime. For compatibility reasons any write access to this CSR is simply ignored and
will <em>not</em> cause an illegal instruction exception.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 82. <code>misa</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_A_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>A</strong>: CPU extension (atomic memory access) available, set when <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_B_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>B</strong>: CPU extension (bit-manipulation) available, set when <a href="#_b_isa_extension"><code>B</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_C_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C</strong>: CPU extension (compressed instruction) available, set when <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_E_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>E</strong>: CPU extension (embedded) available, set when <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_I_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I</strong>: CPU base ISA, cleared when <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_M_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>M</strong>: CPU extension (mul/div) available, set when <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_U_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>U</strong>: CPU extension (user mode) available, set when <a href="#_u_isa_extension"><code>U</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_X_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X</strong>: bit is always set to indicate non-standard / NEORV32-specific extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA_MXL_HI_EXT</code> : <code>CSR_MISA_MXL_LO_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MXL</strong>: 32-bit architecture indicator (always <code>01</code>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Machine-mode software can discover available <code>Z*</code> sub-extensions (like <code>Zicsr</code> or <code>Zfinx</code>) by checking the NEORV32-specific
<a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mie" class="discrete"><strong><code>mie</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt-enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x304</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mie</code> CSR is used to enable/disable individual interrupt sources.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 83. <code>mie</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIE_MSIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MSIE</strong>: Machine <em>software</em> interrupt enable (from <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIE_MTIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTIE</strong>: Machine <em>timer</em> interrupt enable (from <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIE_MEIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEIE</strong>: Machine <em>external</em> interrupt enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIE_FIRQ15E</code> : <code>CSR_MIE_FIRQ0E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast interrupt channel 15..0 enable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mtvec" class="discrete"><strong><code>mtvec</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap-handler base address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x305</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mtvec</code> CSR holds the trap vector configuration.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 84. <code>mtvec</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MODE</strong>: mode configuration, <code>00</code> = DIRECT, <code>01</code> = VECTORED; other encodings are <em>reserved</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BASE</strong>: in DIRECT mode = 4-byte-aligned base address of trap base handler, <em>all</em> traps jump to <code>pc = BASE</code>;
in VECTORED mode = 128-byte-aligned base address of trap vector table, interrupts cause a jump to <code>pc = BASE + 4 * mcause</code>
and exceptions a jump to <code>pc = BASE</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Interrupt Latency</div>
The vectored <code>mtvec</code> mode is useful for reducing the time between interrupt request (IRQ) and servicing it (ISR).
As software does not need to determine the interrupt cause the reduction in latency can be 5 to 10 times and as low as <em>26</em> cycles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcounteren" class="discrete"><strong><code>mcounteren</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x306</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_u_isa_extension"><code>U</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mcounteren</code> CSR is used to constrain user-mode access to the CPU&#8217;s counter CSRs.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 85. <code>mcounteren</code> CSR bits</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 23.0769%;">
<col style="width: 7.6923%;">
<col style="width: 61.5385%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTEREN_CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CY</strong>: User-mode is allowed to read <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TM</strong>: not implemented, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTEREN_IR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IR</strong>: User-mode is allowed to read <a href="#_instreth"><strong><code>instret[h]</code></strong></a> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPM</strong>: hardwired to zero; hardware performance monitors are accessible by machine-mode software only</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mstatush" class="discrete"><strong><code>mstatush</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x310</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The features of this CSR are not implemented yet. The register is read-only and always returns zero.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_trap_handling_csrs">3.7.3. Machine Trap Handling CSRs</h4>
<h5 id="_mscratch" class="discrete"><strong><code>mscratch</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scratch register for machine trap handlers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x340</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mscratch</code> is a general-purpose machine-mode scratch register.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mepc" class="discrete"><strong><code>mepc</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine exception program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x341</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mepc</code> CSR provides the instruction address where execution has stopped/failed when
an interrupt is triggered / an exception is raised. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for a list of all legal values.
The <code>mret</code> instruction will return to the address stored in <code>mepc</code> by automatically moving <code>mepc</code> to the program counter.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>mepc[0]</code> is hardwired to zero. If IALIGN = 32 (i.e. <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> is disabled) then <code>mepc[1]</code> is also hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcause" class="discrete"><strong><code>mcause</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap cause</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x342</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mcause</code> CSRs shows the exact cause of a trap. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for a list of all legal values.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Only</div>
Note that the NEORV32 <code>mcause</code> CSR is updated by the hardware only and cannot be written from software.
However, any write-access will be ignored and will not cause any exception to maintain RISC-V compatibility.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 86. <code>mcause</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Exception code</strong>: see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interrupt</strong>: <code>1</code> if the trap is caused by an interrupt (<code>0</code> if the trap is caused by an exception)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mtval" class="discrete"><strong><code>mtval</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x343</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mtval</code> CSR provides additional information why a trap was entered. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Only</div>
Note that the NEORV32 <code>mtval</code> CSR is updated by the hardware only and cannot be written from software.
However, any write-access will be ignored and will not cause any exception to maintain RISC-V compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mip" class="discrete"><strong><code>mip</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt pending</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x344</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mip</code> CSR shows currently <em>pending</em> machine-mode interrupt requests. Any write access to this register is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 87. <code>mip</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIP_MSIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MSIP</strong>: Machine <em>software</em> interrupt pending, triggered by <code>msi_i</code> top port (see <a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a>); cleared by source-specific mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIP_MTIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTIP</strong>: Machine <em>timer</em> interrupt pending, triggered by <code>mei_i</code> top port (see <a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a>) or by the processor-internal <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>; cleared by source-specific mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIP_MEIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEIP</strong>: Machine <em>external</em> interrupt pending, triggered by <code>mti_i</code> top port (see <a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a>) or by the processor-internal <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>; cleared by source-specific mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIP_FIRQ15P</code> : <code>CSR_MIP_FIRQ0P</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FIRQxP</strong>: Fast interrupt channel 15..0 pending, see <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a>; cleared by source-specific mechanism</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">FIRQ Channel Mapping</div>
See section <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a> for the mapping of the FIRQ channels and the according
interrupt-triggering processor module.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mtinst" class="discrete"><strong><code>mtinst</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x34a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mtinst</code> CSR provides additional information why a trap was entered. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Only</div>
Note that the NEORV32 <code>mtinst</code> CSR is updated by the hardware only and cannot be written from software.
However, any write-access will be ignored and will not cause any exception to maintain RISC-V compatibility.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction Transformation</div>
The RISC-V priv. spec. suggests that the instruction word written to <code>mtinst</code> by the hardware should be "transformed".
However, the NEORV32 <code>mtinst</code> CSR uses a simplified transformation scheme: if the trap-causing instruction is a
standard 32-bit instruction, <code>mtinst</code> contains the exact instruction word that caused the trap. If the trap-causing
instruction is a compressed instruction, <code>mtinst</code> contains the de-compressed 32-bit equivalent with bit 1 being cleared
while all remaining bits represent the pre-decoded 32-bit instruction equivalent.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_configuration_csrs">3.7.4. Machine Configuration CSRs</h4>
<h5 id="_menvcfg" class="discrete"><strong><code>menvcfg</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_u_isa_extension"><code>U</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently, the features of this CSR are not supported. Hence, the entire register is hardwired to all-zero.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_menvcfgh" class="discrete"><strong><code>menvcfgh</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x31a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_u_isa_extension"><code>U</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently, the features of this CSR are not supported. Hence, the entire register is hardwired to all-zero.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_physical_memory_protection_csrs">3.7.5. Machine Physical Memory Protection CSRs</h4>
<div class="paragraph">
<p>The physical memory protection system is configured via the <code>PMP_NUM_REGIONS</code> and <code>PMP_MIN_GRANULARITY</code> top entity
generics. <code>PMP_NUM_REGIONS</code> defines the total number of implemented regions. Note that the maximum number of regions
is constrained to 16. If trying to access a PMP-related CSR beyond <code>PMP_NUM_REGIONS</code> (but below PMP configuration/address
register 16) <strong>no illegal instruction exception</strong> is triggered. The according CSRs are read-only (writes are ignored) and
always return zero. See section <a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a> for more information.</p>
</div>
<h5 id="_pmpcfg" class="discrete"><strong><code>pmpcfg</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection region configuration registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a0</code> (<code>pmpcfg0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a1</code> (<code>pmpcfg1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a2</code> (<code>pmpcfg2</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a3</code> (<code>pmpcfg3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_smpmp_isa_extension"><code>Smpmp</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration of physical memory protection regions. Each region provides an individual 8-bit array in these CSRs.
Note that, depending on <code>PMP_NUM_REGIONS</code>, a <strong>maximum</strong> of the lowest 4 configuration registers are physically implemented (<code>pmpcfg0 .. pmpcfg3</code>).
All remaining register are hardwired to zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 88. <code>pmpcfg*</code> CSR Bits</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 73.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMPCFG_R</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>R</strong>: Read permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMPCFG_W</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>W</strong>: Write permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMPCFG_X</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X</strong>: Execute permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMPCFG_A_MSB</code> : <code>PMPCFG_A_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>A</strong>: Mode configuration (<code>00</code> = OFF, <code>01</code> = TOR, <code>10</code> = NA4, <code>11</code> = NAPOT)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMPCFG_L</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L</strong>: Lock bit, prevents further write accesses, also enforces access rights in machine-mode, can only be cleared by CPU reset</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Implemented Modes</div>
In order to reduce the CPU size certain PMP modes (<code>A</code> bits) can be excluded from synthesis.
Use the <code>PMP_TOR_MODE_EN</code> and <code>PMP_NAP_MODE_EN</code> <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> to control
implementation of the according modes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_pmpaddr" class="discrete"><strong><code>pmpaddr</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection region address registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b0</code> (<code>pmpaddr1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b1</code> (<code>pmpaddr2</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b2</code> (<code>pmpaddr3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b3</code> (<code>pmpaddr4</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b4</code> (<code>pmpaddr5</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b5</code> (<code>pmpaddr6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b6</code> (<code>pmpaddr6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b7</code> (<code>pmpaddr7</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b8</code> (<code>pmpaddr8</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b9</code> (<code>pmpaddr9</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3ba</code> (<code>pmpaddr10</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bb</code> (<code>pmpaddr11</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bc</code> (<code>pmpaddr12</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bd</code> (<code>pmpaddr13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3be</code> (<code>pmpaddr14</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bf</code> (<code>pmpaddr15</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_smpmp_isa_extension"><code>Smpmp</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Region address/boundaries configuration.
Note that, depending on <code>PMP_NUM_REGIONS</code>, a <strong>maximum</strong> of the lowest 16 address registers are physically implemented (<code>pmpaddr0 .. pmpaddr15</code>).
All remaining register are hardwired to zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 89. <code>pmpaddr*</code> CSR Bits</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 84.6154%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r-w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address bits <code>33 downto 32</code>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">29:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address bits <code>31 downto 2</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_counter_and_timer_csrs">3.7.6. (Machine) Counter and Timer CSRs</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title"><code>time[h]</code> CSRs (Wall Clock Time)</div>
The NEORV32 does not implement the <code>time[h]</code> CSRs. Any access to these registers will trap. It is
recommended that the trap handler software provides a means of accessing the machine timer of the
<a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Retired Counter Increment</div>
The <code>[m]instret[h]</code> counter always increments when a instruction enters the pipeline&#8217;s execute stage no matter
if this instruction is actually going to retire or if it causes an exception.
</td>
</tr>
</table>
</div>
<h5 id="_cycleh" class="discrete"><strong><code>cycle[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc00</code> (<code>cycle</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc80</code> (<code>cycleh</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000_00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zicntr_isa_extension"><code>Zicntr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>cycle[h]</code> CSRs are user-mode shadow copies of the according <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a> CSRs. The user-mode
counter are read-only. Any write access will raise an illegal instruction exception.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_instreth" class="discrete"><strong><code>instret[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instructions-retired counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc02</code> (<code>instret</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc82</code> (<code>instreth</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000_00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zicntr_isa_extension"><code>Zicntr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>instret[h]</code> CSRs are user-mode shadow copies of the according <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a> CSRs. The user-mode
counter are read-only. Any write access will raise an illegal instruction exception.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcycleh" class="discrete"><strong><code>mcycle[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb00</code> (<code>mcycle</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb80</code> (<code>mcycleh</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000_00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zicntr_isa_extension"><code>Zicntr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not halted via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR the <code>cycle[h]</code> CSRs will increment with every active CPU clock
cycle (CPU not in <a href="#_sleep_mode">Sleep Mode</a>). These registers are read/write only for machine-mode software.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_minstreth" class="discrete"><strong><code>minstret[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instructions-retired counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb02</code> (<code>minstret</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb82</code> (<code>minstreth</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000_00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zicntr_isa_extension"><code>Zicntr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not halted via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR the <code>minstret[h]</code> CSRs will increment with every retired instruction.
These registers are read/write only for machine-mode software</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction Retiring</div>
Note that <strong>all</strong> executed instruction do increment the <code>[m]instret[h]</code> counters even if they do not retire
(e.g. if the instruction causes an exception).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_hardware_performance_monitors_hpm_csrs">3.7.7. Hardware Performance Monitors (HPM) CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Machine-Mode HPMs Only</div>
Note that only the machine-mode hardware performance counter CSR are available (<code>mhpmcounter*[h]</code>).
Accessing any user-mode HPM CSR (<code>hpmcounter*[h]</code>) will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The actual number of implemented hardware performance monitors is configured via the <code>HPM_NUM_CNTS</code> top entity generic,
Note that always all 13 HPM counter and configuration registers (<code>mhpmcounter*[h]</code>) are implemented, but
only the actually configured ones are implemented as "real" physical registers - the remaining ones will be hardwired to zero.
If trying to access an HPM-related CSR beyond <code>HPM_NUM_CNTS</code> <strong>no illegal instruction exception is
triggered</strong>. These CSRs are read-only, writes are ignored and reads always return zero.</p>
</div>
<div class="paragraph">
<p>The total counter width of the HPMs can be configured before synthesis via the <code>HPM_CNT_WIDTH</code> generic (0..64-bit).
If <code>HPM_NUM_CNTS</code> is less than 64, all remaining MSB-aligned bits are hardwired to zero.</p>
</div>
<h5 id="_mhpmevent" class="discrete"><strong><code>mhpmevent</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware performance monitor event select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x233</code> (<code>mhpmevent3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x234</code> (<code>mhpmevent4</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x235</code> (<code>mhpmevent5</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x236</code> (<code>mhpmevent6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x237</code> (<code>mhpmevent7</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x238</code> (<code>mhpmevent8</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x239</code> (<code>mhpmevent9</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23a</code> (<code>mhpmevent10</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23b</code> (<code>mhpmevent11</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23c</code> (<code>mhpmevent12</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23d</code> (<code>mhpmevent13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23e</code> (<code>mhpmevent14</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23f</code> (<code>mhpmevent15</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zihpm_isa_extension"><code>Zihpm</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value in these CSRs define the micro-architectural events that cause an increment of the according <code>mhpmcounter*[h]</code> counter(s).
All available events are listed in the table below. If more than one event is enabled, the according counter will increment if <em>any</em> of the enabled
events is observed (logical OR). Note that the counter will only increment by 1 step per clock cycle even if more than one trigger event is observed.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 90. <code>mhpmevent*</code> CSR Bits (Micro-Architectural Counter Events)</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>RISC-V-compatible</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active clock cycle (CPU not in <a href="#_sleep_mode">Sleep Mode</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_TM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>not implemented</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_IR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executed instruction (16-bit/compressed or 32-bit/uncompressed)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>NEORV32-specific</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_COMPR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executed 16-bit/compressed (<a href="#_c_isa_extension"><code>C</code> ISA Extension</a>) instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_WAIT_DIS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction dispatch wait cycle (wait for instruction prefetch-buffer refill);
caused by a fence instruction, a control flow transfer or a instruction fetch bus wait cycle)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_WAIT_ALU</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delay/wait cycle caused by a <em>multi-cycle</em> <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a> operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_BRANCH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executed branch instruction (unconditional, conditional-taken or conditional-not-taken)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_CTRLFLOW</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">control flow transfer (jump, taken branch, trap entry, trap exit)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_LOAD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executed load operation (read-modify-write AMOs are counted as one load and one store operation)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_STORE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executed store operation (read-modify-write AMOs are counted as one load and one store operation)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPMCNT_EVENT_WAIT_LSU</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory/bus/cache/etc. delay/wait cycle while executing any load or store operation (caused by a data bus wait cycle))</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction Retiring ("Retired == Executed")</div>
The CPU HPM/counter logic treats all executed instruction as "retired" even if they raise an exception,
cause an interrupt, trigger a privilege mode change or were not meant to retire (i.e. claimed by the RISC-V spec.).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Atomic Memory Access</div>
The read-modify-write instructions of the <a href="#_zaamo_isa_extension"><code>Zaamo</code> ISA Extension</a> operate as simple load for the CPU hardware.
Hence, they will only trigger <code>HPMCNT_EVENT_LOAD</code> and only once.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mhpmcounterh" class="discrete"><strong><code>mhpmcounter[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware performance monitor (HPM) counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb03</code>, <code>0xb83</code> (<code>mhpmcounter3</code>, <code>mhpmcounter3h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb04</code>, <code>0xb84</code> (<code>mhpmcounter4</code>, <code>mhpmcounter4h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb05</code>, <code>0xb85</code> (<code>mhpmcounter5</code>, <code>mhpmcounter5h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb06</code>, <code>0xb86</code> (<code>mhpmcounter6</code>, <code>mhpmcounter6h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb07</code>, <code>0xb87</code> (<code>mhpmcounter7</code>, <code>mhpmcounter7h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb08</code>, <code>0xb88</code> (<code>mhpmcounter8</code>, <code>mhpmcounter8h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb09</code>, <code>0xb89</code> (<code>mhpmcounter9</code>, <code>mhpmcounter9h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0a</code>, <code>0xb8a</code> (<code>mhpmcounter10</code>, <code>mhpmcounter10h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0b</code>, <code>0xb8b</code> (<code>mhpmcounter11</code>, <code>mhpmcounter11h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0c</code>, <code>0xb8c</code> (<code>mhpmcounter12</code>, <code>mhpmcounter12h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0d</code>, <code>0xb8d</code> (<code>mhpmcounter13</code>, <code>mhpmcounter13h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0e</code>, <code>0xb8e</code> (<code>mhpmcounter14</code>, <code>mhpmcounter14h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0f</code>, <code>0xb8f</code> (<code>mhpmcounter15</code>, <code>mhpmcounter15h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <code>0x00000000_00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zihpm_isa_extension"><code>Zihpm</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not halted via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR the HPM counter CSRs increment whenever the
configured events from the according <a href="#_mhpmevent"><strong><code>mhpmevent</code></strong></a> CSR occur. The HPM counter registers are read/write for machine mode
software and are not accessible for lower-privileged software.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_counter_setup_csrs">3.7.8. Machine Counter Setup CSRs</h4>
<h5 id="_mcountinhibit" class="discrete"><strong><code>mcountinhibit</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-inhibit register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x320</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set bit to halt the according counter CSR.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 91. <code>mcountinhibit</code> CSR Bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT_IR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IR</strong>: Set to <code>1</code> to halt <code>[m]instret[h]</code>; hardwired to zero if <code>Zicntr</code> ISA extension is disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TM</strong>: Hardwired to zero as <code>time[h]</code> CSRs are not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT_CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CY</strong>: Set to <code>1</code> to halt <code>[m]cycle[h]</code>; hardwired to zero if <code>Zicntr</code> ISA extension is disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT_HPM3</code> : <code>CSR_MCOUNTINHIBIT_HPM15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPMx</strong>: Set to <code>1</code> to halt <code>[m]hpmcount*[h]</code>; hardwired to zero if <code>Zihpm</code> ISA extension is disabled</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcyclecfgh" class="discrete"><strong><code>mcyclecfg[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter privilege mode filtering</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x321</code> (<code>mcyclecfg</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x721</code> (<code>mcyclecfgh</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zicntr_isa_extension"><code>Zicntr</code></a> &amp; <a href="#_smcntrpmf_isa_extension"><code>Smcntrpmf</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt cycle counter when CPU operates in a specific privilege mode.
Note that <code>mcyclecfg</code> is hardwired to all-zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 92. <code>mcyclecfgh</code> CSR Bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MCYCLECFGH_UINH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UINH</strong>: Set to <code>1</code> to halt <code>[m]cycle[h]</code> counter when CPU is in user-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MCYCLECFGH_MINH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MINH</strong>: Set to <code>1</code> to halt <code>[m]cycle[h]</code> counter when CPU is in machine-mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_minstretcfgh" class="discrete"><strong><code>minstretcfg[h]</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instret counter privilege mode filtering</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x322</code> (<code>minstretcfg</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x722</code> (<code>minstretcfgh</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_zicntr_isa_extension"><code>Zicntr</code></a> &amp; <a href="#_smcntrpmf_isa_extension"><code>Smcntrpmf</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt instruction-retired counter when CPU operates in a specific privilege mode.
Note that <code>minstretcfg</code> is hardwired to all-zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 93. <code>minstretcfgh</code> CSR Bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MINSTRETCFGH_UINH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UINH</strong>: Set to <code>1</code> to halt <code>[m]instret[h]</code> counter when CPU is in user-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MINSTRETCFGH_MINH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MINH</strong>: Set to <code>1</code> to halt <code>[m]instret[h]</code> counter when CPU is in machine-mode</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_information_csrs">3.7.9. Machine Information CSRs</h4>
<h5 id="_mvendorid" class="discrete"><strong><code>mvendorid</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine vendor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf11</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This register is hardwired to the value provided by the <code>OCD_JEDEC_ID</code> <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>
(the upper bits are filled with zeros).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 94. <code>mvendorid</code> CSR Bits</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEDEC ID offset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEDEC ID bank</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_marchid" class="discrete"><strong><code>marchid</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine architecture ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf12</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000013</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>marchid</code> CSR is read-only and provides the NEORV32 official RISC-V open-source architecture ID
(decimal: 19, 32-bit hexadecimal: 0x00000013).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mimpid" class="discrete"><strong><code>mimpid</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine implementation ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf13</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mimpid</code> CSR is read-only and provides the version of the
NEORV32 as BCD-coded number (example: <code>mimpid = 0x01020312</code>  01.02.03.12  version 1.2.3.12).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mhartid" class="discrete"><strong><code>mhartid</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware thread ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf14</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mhartid</code> CSR is read-only and provides the core&#8217;s hart ID. In a multi-core system, the hard
ID of each core is unique and starts at 0 and is incremented continuously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mconfigptr" class="discrete"><strong><code>mconfigptr</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine configuration pointer register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf15</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The features of this CSR are not implemented yet. The register is read-only and always returns zero.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_csrs">3.7.10. NEORV32-Specific CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V-Compliant Mapping</div>
NEORV32-specific CSRs are mapped to addresses that are explicitly reserved for custom/implementation-specific use.
</td>
</tr>
</table>
</div>
<h5 id="_mxisa" class="discrete"><strong><code>mxisa</code></strong></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine extended ISA and extensions register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfc0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a> &amp; <a href="#_x_isa_extension"><code>X</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mxisa</code> CSR is a NEORV32-specific read-only CSR that helps machine-mode software to
discover additional ISA (sub-)extensions and CPU configuration options.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 95. <code>mxisa</code> CSR Bits</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZICSR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZIFENCEI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zifencei_isa_extension"><code>Zifencei</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZMMUL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zmmul_isa_extension"><code>Zmmul</code> - ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_XCFU</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_xcfu_isa_extension"><code>Xcfu</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zkt_isa_extension"><code>Zkt</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZFINX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zfinx_isa_extension"><code>Zfinx</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZICOND</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicond_isa_extension"><code>Zicond</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZICNTR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicntr_isa_extension"><code>Zicntr</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_SMPMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZIHPM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zihpm_isa_extension"><code>Zihpm</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_SDEXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdext_isa_extension"><code>Sdext</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_SDTRIG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZBKX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbkx_isa_extension"><code>Zbkx</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKND</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zknd_isa_extension"><code>Zknd</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKNE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zkne_isa_extension"><code>Zkne</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKNH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zknh_isa_extension"><code>Zknh</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZBKB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbkb_isa_extension"><code>Zbkb</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZBKC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbkc_isa_extension"><code>Zbkc</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zkn_isa_extension"><code>Zkn</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKSH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zksh_isa_extension"><code>Zksh</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKSED</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zksed_isa_extension"><code>Zksed</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZKS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zks_isa_extension"><code>Zks</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZBA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zba_isa_extension"><code>Zba</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZBB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbb_isa_extension"><code>Zbb</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZBS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zbs_isa_extension"><code>Zbs</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZAAMO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zaamo_isa_extension"><code>Zaamo</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZALRSC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zalrsc_isa_extension"><code>Zalrsc</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZCB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zcb_isa_extension"><code>Zcb</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZCA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"`C` without floating-point", available when <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> is available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZIBI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zibi_isa_extension"><code>Zibi</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_ZIMOP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zimop_isa_extension"><code>Zimop</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA_SMCNTRPMF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smcntrpmf_isa_extension"><code>Smcntrpmf</code> - ISA Extension</a> available</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_traps_exceptions_and_interrupts">3.8. Traps, Exceptions and Interrupts</h3>
<div class="paragraph">
<p>In this document the following terminology is used (derived from the RISC-V trace specification
available at <a href="https://github.com/riscv-non-isa/riscv-trace-spec" class="bare">https://github.com/riscv-non-isa/riscv-trace-spec</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>exception</strong>: an unusual condition occurring at run time associated (i.e. <em>synchronous</em>) with an instruction in a RISC-V hart</p>
</li>
<li>
<p><strong>interrupt</strong>: an external <em>asynchronous</em> event that may cause a RISC-V hart to experience an unexpected transfer of control</p>
</li>
<li>
<p><strong>trap</strong>: the transfer of control to a trap handler caused by either an <em>exception</em> or an <em>interrupt</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whenever an exception or interrupt is triggered, the CPU switches to machine-mode (if not already in machine-mode)
and continues operation at the address being stored in the <a href="#_mtvec"><strong><code>mtvec</code></strong></a> CSR. The cause of the trap can be determined via the
<a href="#_mcause"><strong><code>mcause</code></strong></a> CSR. A list of all implemented <code>mcause</code> values and the according description can be found below in section
<a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>. The address that reflects the current program counter when a trap was taken is stored to
<a href="#_mepc"><strong><code>mepc</code></strong></a> CSR. Additional information regarding the cause of the trap can be retrieved from the <a href="#_mtval"><strong><code>mtval</code></strong></a> and <a href="#_mtinst"><strong><code>mtinst</code></strong></a> CSRs.</p>
</div>
<div class="paragraph">
<p>The traps are prioritized. If several <em>exceptions</em> occur at once only the one with highest priority is triggered
while all remaining exceptions are ignored and discarded. If several <em>interrupts</em> trigger at once, the one with highest priority
is serviced first while the remaining ones stay <em>pending</em>. After completing the interrupt handler the interrupt with
the second highest priority will get serviced and so on until no further interrupts are pending.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupts when in User-Mode</div>
If the core is currently operating in less privileged user-mode, interrupts are globally enabled
even if <a href="#_mstatus"><strong><code>mstatus</code></strong></a>.mie is cleared.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Signal Requirements</div>
All CPU interrupt request signals are <strong>high-active</strong>. Once triggered, the interrupt request line should stay high
until it is explicitly acknowledged by a source-specific mechanism (for example by writing to a specific memory-mapped register).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Atomicity and Forward-Progress</div>
All instructions execute as atomic operations - interrupts can only trigger <em>between</em> consecutive instructions.
Additionally, if there is a permanent interrupt request, exactly one instruction from the interrupted program will be executed before
another interrupt handler can start. This allows program progress even if there are permanent interrupt requests.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_memory_access_exceptions">3.8.1. Memory Access Exceptions</h4>
<div class="paragraph">
<p>If a load operation causes any exception, the instruction&#8217;s destination register is <strong>not written</strong> at all. Furthermore,
exceptions caused by a misaligned memory address a physical memory protection fault do not trigger a memory access request at all.</p>
</div>
<div class="paragraph">
<p>For 32-bit-only instructions (= no <code>C</code> extension) the misaligned instruction exception is raised if bit 1 of the fetch
address is set (i.e. not on a 32-bit boundary). If the <code>C</code> extension is implemented there will <strong>never</strong> be a misaligned
instruction exception at all.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nested_interrupts">3.8.2. Nested Interrupts</h4>
<div class="paragraph">
<p>The CPU supports nested interrupt handling in software. It automatically disables interrupts upon entering any trap
handler by clearing <a href="#_mstatus"><strong><code>mstatus</code></strong></a>.<code>MIE</code>. Otherwise, further interrupts during the critical part of the handler (i.e.
before saving the context: <code>mcause</code>, <code>mepc</code>, stack frame, etc.) would cause a context loss. However, software can
explicitly enable interrupts again by manually setting <a href="#_mstatus"><strong><code>mstatus</code></strong></a>.<code>MIE</code> from within the handler to allow another
interrupt to trigger.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_fast_interrupt_request_lines">3.8.3. Custom Fast Interrupt Request Lines</h4>
<div class="paragraph">
<p>As a custom extension, the NEORV32 CPU features 16 fast interrupt request (FIRQ) lines via the <code>firq_i</code> CPU top
entity signals. These interrupts have custom configuration and status flags in the <a href="#_mie"><strong><code>mie</code></strong></a> and <a href="#_mip"><strong><code>mip</code></strong></a> CSRs and also
provide custom trap codes in <a href="#_mcause"><strong><code>mcause</code></strong></a>. These FIRQs are reserved for NEORV32 processor-internal usage only.</p>
</div>
</div>
<div class="sect3">
<h4 id="_neorv32_trap_listing">3.8.4. NEORV32 Trap Listing</h4>
<div class="paragraph">
<p>The following tables show all traps that are currently supported by the NEORV32 CPU. It also shows the prioritization
and the CSR side-effects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">FIRQ Mapping</div>
See section <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a> for the mapping of the FIRQ channels to the according hardware modules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Table Annotations</strong></p>
</div>
<div class="paragraph">
<p>The "RTE Trap ID" aliases are defined by the NEORV32 core library and can be used in plain C code
when interacting with the pre-defined RTE functions. The <a href="#_mcause"><strong><code>mcause</code></strong></a>, <a href="#_mepc"><strong><code>mepc</code></strong></a>, <a href="#_mtval"><strong><code>mtval</code></strong></a>, and
<a href="#_mtinst"><strong><code>mtinst</code></strong></a> columns show the value being written to the according CSRs when a trap is encountered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>I-PC</strong> - address of intercepted instruction (instruction at this address has not been executed yet and must be executed after the trap handler to maintain program flow)</p>
</li>
<li>
<p><strong>PC</strong> - address of instruction that caused the trap (instruction has been executed)</p>
</li>
<li>
<p><strong>ADDR</strong> - bad data memory access address that caused the trap</p>
</li>
<li>
<p><strong>INST</strong> - the actual transformed/decompressed instruction word that caused the trap</p>
</li>
<li>
<p><strong>LAST</strong> - the last transformed/decompressed instruction word that was executed before the trap</p>
</li>
<li>
<p><strong>0</strong> - zero</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 96. NEORV32 Trap Listing</caption>
<colgroup>
<col style="width: 3.4482%;">
<col style="width: 13.7931%;">
<col style="width: 27.5862%;">
<col style="width: 34.4827%;">
<col style="width: 6.8965%;">
<col style="width: 6.8965%;">
<col style="width: 6.8968%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Priority</th>
<th class="tableblock halign-left valign-top"><code>mcause</code></th>
<th class="tableblock halign-left valign-top">RTE Trap ID</th>
<th class="tableblock halign-left valign-top">Cause</th>
<th class="tableblock halign-left valign-top"><code>mepc</code></th>
<th class="tableblock halign-left valign-top"><code>mtval</code></th>
<th class="tableblock halign-left valign-top"><code>mtinst</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><strong>Exceptions</strong> (<em>synchronous</em> to instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">highest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_DOUBLE_TRAP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double trap (trap inside trap)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ILLEGAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0000000b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from M-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_UENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from U-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_BREAKPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">software breakpoint / HW trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000006</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000005</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INST</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><strong>Interrupts</strong> (<em>asynchronous</em> to instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000012</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000013</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000014</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000015</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000016</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000017</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000018</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000019</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000000b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MEI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (MEI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (MSI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lowest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (MTI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 97. NEORV32 Trap Description</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Trap ID [C]</th>
<th class="tableblock halign-left valign-top">Triggered when &#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout, bus access error or <a href="#_smpmp_isa_extension">PMP</a> rule violation during instruction fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ILLEGAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trying to execute an invalid instruction word (malformed or not supported) or on a privilege violation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fetching a 32-bit instruction word that is not 32-bit-aligned (see note below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ecall</code> instruction in machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_UENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ecall</code> instruction in user-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_BREAKPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ebreak</code> instruction or if <a href="#_trigger_module">Trigger Module</a> fires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storing data to an address that is not naturally aligned to the data size (half/word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loading data from an address that is not naturally aligned to the data size  (half/word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout, bus access error or <a href="#_smpmp_isa_extension">PMP</a> rule violation during store data operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout, bus access error or <a href="#_smpmp_isa_extension">PMP</a> rule violation during load data operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">caused by interrupt-condition of <strong>processor-internal modules</strong>, see <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MEI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (via dedicated <a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (internal <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a> or via dedicated <a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (internal <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a> or via dedicated <a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Resumable Exceptions</div>
Note that not all exceptions are resumable. The "instruction access fault"
and the "instruction address misaligned" exceptions are not resumable in most cases.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_dual_core_configuration">3.9. Dual-Core Configuration</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Dual-Core Example Programs</div>
A set of rather simple dual-core example programs can be found in <code>sw/example/demo_dual_core*</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Optionally, the CPU core can be implemented as <strong>symmetric multiprocessing (SMP) dual-core</strong> system.
This dual-core configuration is enabled by the <code>DUAL_CORE_EN</code> <a href="#_processor_top_entity_generics">top generic</a>.
When enabled, two <em>core complexes</em> are implemented. Each core complex consists of a CPU core and optional
instruction (<code>I$</code>) and data (<code>D$</code>) caches. Similar to the single-core <a href="#_bus_system">Bus System</a>, the instruction and
data interfaces are switched into a single bus interface by a prioritizing bus switch. The bus interfaces
of both core complexes are further switched into a single system bus using a round-robin arbiter.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/smp_system.png" alt="smp system">
</div>
</div>
<div class="paragraph">
<p>Both CPU cores are fully identical and use the same ISA, tuning and cache configurations provided by the
according <a href="#_processor_top_entity_generics">top generics</a>. However, each core can be identified by the
according "hart ID" that can be retrieved from the <a href="#_mhartid"><strong><code>mhartid</code></strong></a> CSR. CPU core 0 (the <em>primary</em> core) has
<code>mhartid = 0</code> while core 1 (the <em>secondary</em> core) has <code>mhartid = 1</code>.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the most important aspects when using the dual-core configuration.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU configuration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both cores use the same cache, CPU and ISA configuration provided by the according top generics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debugging</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A special SMP openOCD script (<code>sw/openocd/openocd_neorv32.dual_core.cfg</code>) is required to
debug both cores at once. SMP-debugging is fully supported by the RISC-V gdb port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Clock and reset</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both cores use the same global processor clock and reset.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Address space</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both cores have full access to the same physical <a href="#_address_space">Address Space</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interrupts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All <a href="#_processor_interrupts">Processor Interrupts</a> are routed to both cores. Hence, each core has access to
all <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a> (FIRQs). Additionally, the RISC-V machine-level <em>external interrupt</em>
(via the top <code>irq_mei_i</code> port) is also sent to both cores. In contrast, the RISC-V machine level
<em>software</em> and <em>timer</em> interrupts are core-exclusive (provided by the <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RTE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a> can be used for both cores. However, the RTE needs to be
explicitly initialized on each core (executing <code>neorv32_rte_setup()</code>). Note that the installed trap handlers
apply to both cores. The installed user-defined trap handlers can check the according core&#8217;s ID via the
<a href="#_mhartid"><strong><code>mhartid</code></strong></a> CSR to perform core-specific trap handling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Memory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each core has its own stack. The top of stack of core 0 is defined by the <a href="#_linker_script">Linker Script</a>
while the top of stack of core 1 has to be explicitly defined by core 0 (see <a href="#_dual_core_boot">Dual-Core Boot</a>). Both
cores share the same heap, <code>.data</code> and <code>.bss</code> sections. Hence, only core 0 setups the <code>.data</code> and <code>.bss</code>
sections at boot-up.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Constructors and destructors</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructors and destructors are supported by core 0 only
(see section <a href="#_c_standard_library">C Standard Library</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cache layout</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, each CPU core has its own data and/or instruction cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cache coherency</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Be aware that there is no cache snooping available. If any CPU1 cache is enabled
care must be taken to prevent access to outdated data - either by using cache synchronization (<code>fence</code> / <code>fence.i</code>
instructions) or by using atomic memory accesses. See <a href="#_memory_coherence">Memory Coherence</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bootloader</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only core 0 will boot and execute the bootloader while core 1 is held in standby.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Booting</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See section <a href="#_dual_core_boot">Dual-Core Boot</a>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_dual_core_boot">3.9.1. Dual-Core Boot</h4>
<div class="paragraph">
<p>After reset, both cores start booting at the same reset vector using the same executable. However, core 1
will - regardless of the <a href="#_boot_configuration">Boot Configuration</a> - always enter <a href="#_sleep_mode">Sleep Mode</a> right inside the default
<a href="#_start_up_code_crt0">Start-Up Code (crt0)</a>. The primary core (core 0) will continue booting, executing either the <a href="#_bootloader">Bootloader</a>
or the pre-installed image from the internal instruction memory (depending on the boot configuration).
To explicitly boot-up core 1, the primary core has to use a special library function provided by the
NEORV32 software framework:</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. CPU Core 1 Launch Function Prototype (note that this function can only be executed on core 0)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int neorv32_smp_launch(int (*entry_point)(void), uint8_t* stack_memory, size_t stack_size_bytes);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Core 1 Boot-Up</div>
Core 0 will ensure that core 1 only uses start-up code from the shared executable.
See <a href="https://github.com/stnolting/neorv32/pull/1450" class="bare">https://github.com/stnolting/neorv32/pull/1450</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Core 0 uses the two 32-bit <code>MTIMECMP</code> registers of the <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a> to submit a
<em>launch configuration</em> to core 1. This launch configuration consists of the stack layout (via the
<code>stack_memory</code> and <code>stack_size_bytes</code> arguments) and the actual entry point for core 1. When these
registers have been populated, core 0 will trigger the software interrupt of core 1 (also via the CLINT)
to wake it from sleep mode. After that, core 1 will fetch the launch configuration and will start
execution at the configured entry point.</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. CPU Core 1 Main Function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int core1_main(void) { // return `int`, no arguments
  return 0; // return to crt0 and go to sleep mode
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Core 1 Stack Memory</div>
The memory for the stack of core 1 (<code>stack_memory</code>) can be either statically allocated (i.e. a global
volatile memory array; placed in the <code>.data</code> or <code>.bss</code> section of core 0) or dynamically allocated
(using <code>malloc</code>; placed on the heap of core 0). In any case the memory should be aligned to a 16-byte
boundary.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_framework">4. Software Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 project comes with a complete software ecosystem called the "software framework" which
is based on the C-language RISC-V GCC port and consists of the following parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_compiler_toolchain">Compiler Toolchain</a></p>
</li>
<li>
<p><a href="#_core_libraries">Core Libraries</a></p>
</li>
<li>
<p><a href="#_system_view_description_file_svd">System View Description File (SVD)</a></p>
</li>
<li>
<p><a href="#_application_makefile">Application Makefile</a></p>
</li>
<li>
<p><a href="#_default_compiler_flags">Default Compiler Flags</a></p>
</li>
<li>
<p><a href="#_linker_script">Linker Script</a></p>
</li>
<li>
<p><a href="#_c_standard_library">C Standard Library</a></p>
</li>
<li>
<p><a href="#_start_up_code_crt0">Start-Up Code (crt0)</a></p>
</li>
<li>
<p><a href="#_executable_image_formats">Executable Image Formats</a></p>
</li>
<li>
<p><a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a></p>
</li>
<li>
<p><a href="#_bootloader">Bootloader</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Software Documentation</div>
All core libraries and example programs are documented <em>in-code</em> using <strong>Doxygen</strong>.
The API documentation is automatically built and deployed to GitHub pages:
<a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Programs</div>
A collection of annotated example programs illustrating how to use certain NEORV32 functions
and peripheral/IO modules can be found in <code>sw/example</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_compiler_toolchain">4.1. Compiler Toolchain</h3>
<div class="paragraph">
<p>The toolchain for this project is based on the free and open RISC-V GCC-port. You can find the compiler sources and
build instructions in the official RISC-V GNU toolchain GitHub repository: <a href="https://github.com/riscv-collab/riscv-gnu-toolchain" class="bare">https://github.com/riscv-collab/riscv-gnu-toolchain</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Toolchain Installation</div>
More information regarding the toolchain (building from scratch or downloading prebuilt ones) can be found in the
user guide section <a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_core_libraries">4.2. Core Libraries</h3>
<div class="paragraph">
<p>The NEORV32 project provides a set of pre-defined C libraries that allow an easy integration of the processor/CPU features
(also called "HAL" - <em>hardware abstraction layer</em>). All driver and runtime-related files are located in
<code>sw/lib</code>. These library files are automatically included and linked by adding the following include statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include &lt;neorv32.h&gt; // NEORV32 HAL, core and runtime libraries</code></pre>
</div>
</div>
<div class="paragraph">
<p>The NEORV32 HAL consists of the following files.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 98. NEORV32 Hardware Abstraction Layer File List</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">C source file</th>
<th class="tableblock halign-left valign-top">C header file</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main NEORV32 library file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_aux.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_aux.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General auxiliary/helper function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_clint.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_clint.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_csr.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> definitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_dma.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_dma.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_intrinsics.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Macros for intrinsics and custom instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_legacy.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy / backwards-compatibility wrappers (<strong>do not use for new designs</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_onewire.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_onewire.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_sdi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_sdi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_smp.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_smp.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL for the SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_sysinfo.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_tracer.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_tracer.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_execution_trace_buffer_tracer">Execution Trace Buffer (TRACER)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twd.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twd.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_device_controller_twd">Two-Wire Serial Device Controller (TWD)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> and UART1 HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_newlib.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform-specific system calls for <em>newlib</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Doxygen API Documentation</div>
The Doxygen-based documentation of all core libraries is available online at
<a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_system_view_description_file_svd">4.3. System View Description File (SVD)</h3>
<div class="paragraph">
<p>A CMSIS-SVD-compatible <strong>System View Description (SVD)</strong> file including all peripherals is available in <code>sw/svd</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_application_makefile">4.4. Application Makefile</h3>
<div class="paragraph">
<p>Application compilation is based on a centralized GNU makefile (<code>sw/common/common.mk</code>). Each software project
(for example the ones in <code>sw/example</code> folder) should provide a local makefile that just includes the central makefile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-makefile hljs" data-lang="makefile"># Set path to NEORV32 root directory
NEORV32_HOME ?= ../../..
# Include the main NEORV32 makefile
include $(NEORV32_HOME)/sw/common/common.mk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, the functionality of the central makefile (including all targets) becomes available for the project.
A project-local makefile should be used to define all setup-relevant configuration options instead of changing the
central makefile to keep the code base clean. Setting variables in the project-local makefile will override the default
configuration. Most example projects already provide a makefile that list all relevant configuration options.</p>
</div>
<div class="paragraph">
<p>The following example shows the configuration of a local Makefile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-makefile hljs" data-lang="makefile"># Override the default CPU ISA
MARCH = rv32imc_zicsr_zifencei

# Override the default RISC-V GCC prefix
RISCV_PREFIX ?= riscv-none-elf-

# Override default optimization goal
EFFORT = -Os

# Add extended debug symbols for Eclipse
USER_FLAGS += -ggdb -gdwarf-3

# Additional sources
APP_SRC += $(wildcard ./*.c)
APP_INC += -I .

# Adjust processor IMEM size and base address
USER_FLAGS += -Wl,--defsym,__neorv32_rom_size=16k
USER_FLAGS += -Wl,--defsym,__neorv32_rom_base=0x00000000

# Adjust processor DMEM size and base address
USER_FLAGS += -Wl,--defsym,__neorv32_ram_size=8k
USER_FLAGS += -Wl,--defsym,__neorv32_ram_base=0x80000000

# Adjust maximum heap size
USER_FLAGS += -Wl,--defsym,__neorv32_heap_size=2k

# Set path to NEORV32 root directory
NEORV32_HOME ?= ../../..

# Include the main NEORV32 makefile
include $(NEORV32_HOME)/sw/common/common.mk</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Setup of a New Project</div>
When creating a new project, copy an existing project folder or at least the makefile to the new project folder.
It is recommended to create new projects also in <code>sw/example</code> to keep the file dependencies. However, these
dependencies can be manually configured via makefile variables if the new project is located somewhere else.
For more complex projects, it may be useful to use explicit <code>source</code> and <code>include</code> folders. See <code>sw/example/coremark</code> for an example.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_makefile_targets">4.4.1. Makefile Targets</h4>
<div class="paragraph">
<p>Invoking a project-local makefile (executing <code>make</code> or <code>make help</code>) will show the help menu that lists all
available targets as well as all variable including their <em>current</em> setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">neorv32/sw/example/hello_world$ make
NEORV32 Software Makefile
Find more information at https://github.com/stnolting/neorv32
Use 'make V=1' or set BUILD_VERBOSE to increase build verbosity

Targets:

  help       show this text
  check      check toolchain and list supported ISA extensions
  info       show project/makefile configuration
  gdb        start GNU debugging session
  asm        build and generate &lt;main.asm&gt; assembly listing file
  elf        build and generate &lt;main.elf&gt; ELF file
  exe        build and generate &lt;neorv32_exe.bin&gt; executable file for bootloader upload
  bin        build and generate &lt;neorv32_raw_exe.bin&gt; executable memory image
  hex        build and generate &lt;neorv32_raw_exe.hex&gt; executable memory image
  coe        build and generate &lt;neorv32_raw_exe.coe&gt; executable memory image
  mem        build and generate &lt;neorv32_raw_exe.mem&gt; executable memory image
  mif        build and generate &lt;neorv32_raw_exe.mif&gt; executable memory image
  image      build and generate VHDL IMEM application memory image &lt;neorv32_imem_image.vhd&gt; in local folder
  install    build, generate and install VHDL IMEM application memory image &lt;neorv32_imem_image.vhd&gt;
  clean      clean up project home folder
  clean_all  clean up project home folder and image generator
  all        clean_all + elf + asm + exe + hex + bin + coe + mem + mif + image + install

Additional targets:

  sim           in-console simulation using default testbench (sim folder) and GHDL
  hdl_lists     regenerate HDL file-lists (*.f) in NEORV32_HOME/rtl
  upload        upload executable to bootloader via UART (/dev/ttyUSB1)
  elf_info      show ELF layout info
  elf_sections  show ELF sections
  bl_image      build and generate VHDL BOOTROM bootloader memory image &lt;neorv32_bootrom_image.vhd&gt; in local folder
  bootloader    build, generate and install VHDL BOOTROM bootloader memory image &lt;neorv32_bootrom_image.vhd&gt;

Variables:

  BUILD_VERBOSE   Set to increase build verbosity: "0"
  USER_FLAGS      Custom toolchain flags [append only]: "-ggdb -gdwarf-3 -Wl,--defsym,__neorv32_rom_size=16k -Wl,--defsym,__neorv32_ram_size=8k"
  USER_LIBS       Custom libraries [append only]: ""
  EFFORT          Optimization level: "-Os"
  MARCH           Machine architecture: "rv32i_zicsr_zifencei"
  MABI            Machine binary interface: "ilp32"
  APP_INC         C include folder(s) [append only]: "-I ."
  APP_SRC         C source folder(s) [append only]: "./main.c   "
  APP_OBJ         Object file(s) [append only]: ""
  ASM_INC         ASM include folder(s) [append only]: "-I ."
  RISCV_PREFIX    Toolchain prefix: "riscv-none-elf-"
  NEORV32_HOME    NEORV32 home folder: "../../.."
  GDB_ARGS        GDB arguments: "-ex target extended-remote localhost:3333"
  UART_TTY        Serial port for upload to bootloader: "/dev/ttyUSB1"
  GHDL_RUN_FLAGS  GHDL simulation run arguments: ""</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Build Artifacts</div>
All <em>intermediate</em> build artifacts (like object files and binaries) will be places into a (new) project-local
folder named <code>build</code>. The <em>resulting</em> build artifacts (like executable, the main ELF and all memory
initialization/image files) will be placed in the root project folder.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Increase Verbosity</div>
Use <code>make V=1</code> or set <code>BUILD_VERBOSE</code> in your environment to increase build verbosity.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_default_compiler_flags">4.4.2. Default Compiler Flags</h4>
<div class="paragraph">
<p>The central makefile uses specific compiler flags to tune the code to the NEORV32 hardware. Hence, these flags should not
be altered. However, experienced users can modify them to further tune compilation.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 99. Compiler Options (<code>CC_OPTS</code>)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable all compiler warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ffunction-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put functions in independent sections. This allows a code optimization as dead code can be easily removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-fdata-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put data segment in independent sections. This allows a code optimization as unused data can be easily removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-nostartfiles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use the default start code. Instead, the NEORV32-specific start-up code (<code>sw/common/crt0.S</code>) is used (pulled-in by the linker script).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mno-fdiv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use built-in software functions for floating-point divisions and square roots (since the according instructions are not supported yet).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mstrict-align</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unaligned memory accesses cannot be resolved by the hardware and require emulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mbranch-cost=10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branching costs a lot of cycles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wl,--gc-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make the linker perform dead code elimination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ffp-contract=off</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable floating-point expression contraction (fused multiply-add/sub; not supported by the NEORV32 FPU).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-g</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add (simple) debug information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 100. Linker Libraries (<code>LD_LIBS</code>)</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 81.8182%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include/link with <code>math.h</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for the standard C library when linking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lgcc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make sure we have no unresolved references to internal GCC library subroutines.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Advanced Debug Symbols</div>
By default, only "simple" symbols are added to the ELF (<code>-g</code>). Extended debug flags (e.g. for Eclipse) can be added
using the <code>USER_FLAGS</code> variable (e.g. <code>USER_FLAGS += -ggdb -gdwarf-3</code>). Note that other debug flags may be required
depending of the GCC/GDB version
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_linker_script">4.5. Linker Script</h3>
<div class="paragraph">
<p>The NEORV32-specific linker script (<code>sw/common/neorv32.ld</code>) is used to link the compiled sources according to the
processor&#8217;s <a href="#_address_space">Address Space</a>). For the final executable, only two memory segments are required:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 101. Linker script - Memory Segments</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory section</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction memory address space (processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> and/or external memory)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ram</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data memory address space (processor-internal <a href="#_data_memory_dmem">Data Memory (DMEM)</a> and/or external memory)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These two sections are configured by several variables defined in the linker script and exposed to the build
framework (aka the makefile). Those variable allow to customized the RAM/ROM sizes and base addresses. Additionally,
a certain amount of the RAM can be reserved for the software-managed heap (see <a href="#_ram_layout">RAM Layout</a>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 102. Linker script - Configuration</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 70%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory section</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__neorv32_rom_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ROM" size (instruction memory / IMEM)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16kB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__neorv32_ram_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"RAM" size (data memory / DMEM)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8kB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__neorv32_rom_base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ROM" base address (instruction memory / IMEM)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__neorv32_ram_base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"RAM" base address (data memory / DMEM)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__neorv32_heap_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum heap size; part of the "RAM"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0kB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each variable provides a default value (e.g. "16K" for the instruction memory /ROM /IMEM size). These defaults can
be overridden by setup-specific values to take the user-defined processor configuration into account (e.g. a different IMEM
size). The <code>USER_FLAGS</code> variable provided by the <a href="#_application_makefile">Application Makefile</a> can also be used to customize the memory
configuration. For example, the following line can be added to a project-specific local makefile to adjust the memory
sizes:</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. Overriding Default Memory Sizes (configuring 64kB IMEM and 32kB DMEM)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-makefile hljs" data-lang="makefile">USER_FLAGS += "-Wl,--defsym,__neorv32_rom_size=64k -Wl,--defsym,__neorv32_ram_size=32k"</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Memory Configuration Constraints</div>
Memory sizes have to be a multiple of 4 bytes. Memory base addresses have to be 32-bit-aligned.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ram_layout">4.5.1. RAM Layout</h4>
<div class="paragraph">
<p>The default NEORV32 linker script uses the defined RAM (<strong>DMEM</strong>) size to map several sections.
Note that depending on the application some sections might have zero size.</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. Default RAM Layout</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">End of RAM
+------------------------------+
|             Stack            |
+------------------------------+
.     stack grows downwards    .
.                              .
.                              .
.      heap grows upwards      .
+------------------------------+
|   Dynamic memory (".heap")   |
+------------------------------+
| Uninitialized data (".bss")  |
+------------------------------+
|  Initialized data (".data")  |
+------------------------------+
Start of RAM</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>Initialized data (<code>.data</code>)</strong>: The data section is placed right at the beginning of the RAM. For example, this
contains <em>explicitly initialized</em> global variables which are initialized by the <a href="#_start_up_code_crt0">Start-Up Code (crt0)</a>.</p>
</li>
<li>
<p><strong>Non-initialized data (<code>.bss</code>)</strong>: This dynamic data section contains data like global variables
<em>without explicit initialization</em>. This memory section is cleared by the <a href="#_start_up_code_crt0">Start-Up Code (crt0)</a>.</p>
</li>
<li>
<p><strong>Heap (<code>.heap</code>)</strong>: The heap is used for dynamic memory that is managed by functions like <code>malloc()</code> and <code>free()</code>.
The heap grows upwards. This section is not initialized at all.</p>
</li>
<li>
<p><strong>Stack</strong>: The stack starts at the end of the RAM at the last 16-byte aligned address. According to the RISC-V ABI / calling
convention the stack is 128-bit-aligned before procedure entry. The stack grows downwards.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Heap Size</div>
The maximum size of the heap is defined by the <code>__neorv32_heap_size</code> variable. This variable has to be
<strong>explicitly defined</strong> in order to define a heap size (and to use dynamic memory allocation at all).
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Heap-Stack Collision</div>
Take care when using dynamic memory to avoid collision of the heap and stack memory areas. There is no compile-time
protection mechanism available as the actual heap and stack size are defined by <em>runtime</em> data.
The <a href="#_smpmp_isa_extension">physical memory protection</a> extension can be used to implement a guarding mechanism.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rom_layout">4.5.2. ROM Layout</h4>
<div class="paragraph">
<p>The default NEORV32 linker script uses the defined ROM (<strong>IMEM</strong>) size to map several sections.
Note that depending on the application some sections might have zero size.</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. Default ROM Layout</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">End of ROM
+------------------------------+
|   Initial data for ".data"   |
+------------------------------+
|  Read-only data (".rodata")  |
+------------------------------+
|    Program code (".text")    |
+------------------------------+
Start of ROM</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>Program code (<code>.text</code>)</strong>: This section contains the actual instructions of the program.</p>
</li>
<li>
<p><strong>Read-only data (<code>.rodata</code>)</strong>: Read-only data, for example for constants and strings.</p>
</li>
<li>
<p><strong>Heap (<code>.heap</code>)</strong>: Initialization data that is copied at runtime to the RAM&#8217;s <code>data</code> section by by the <a href="#_start_up_code_crt0">Start-Up Code (crt0)</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Binary Executable Image</div>
The main <a href="#_application_makefile">Application Makefile</a> extracts the <code>.text</code>, <code>.rodata</code>, and <code>.data</code> sections from the final ELF
and concatenates them in order to build the final binary executable image (<code>main.bin</code>). Once placed in memory,
this image can be executed right away. Furthermore, this image is used by the image generator auxiliary tool
to generate different <a href="#_executable_image_formats">Executable Image Formats</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_c_standard_library">4.6. C Standard Library</h3>
<div class="paragraph">
<p>The default software framework relies on <strong>newlib</strong> as default C standard library. Newlib provides hooks for common
"system calls" (like file handling and standard input/output) that are used by other C libraries like <code>stdio</code>.
These hooks are available in <code>sw/lib/source/newlib.c</code> and were adapted for the NEORV32 processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Standard Input/Output Streams / Consoles</div>
The <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a>
is used to implement all the standard input, output and error consoles (<code>STDIN</code> = file number 0, <code>STDOUT</code> = file
number 1, <code>STDERR</code> = file number 2). All other input/output streams (other file number than 0,1,2) are redirected
to <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Constructors and Destructors</div>
Constructors and destructors for plain C code or for C++ applications are supported by the software framework.
See <code>sw/example/hello_cpp</code> for a minimal example. Note that constructor and destructors are only executed
by core 0 (primary core) in the SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Newlib Test/Demo Program</div>
A simple test and demo program that uses some of newlib&#8217;s system functions (like <code>malloc</code>/<code>free</code> and <code>read</code>/<code>write</code>)
is available in <code>sw/example/demo_newlib</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Executing System Functions on a Host Computer</div>
The NEORV32 on-chip debugger supports <a href="#_semihosting">Semihosting</a> which allow to use the input/output facilities on a host computer.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_start_up_code_crt0">4.7. Start-Up Code (crt0)</h3>
<div class="paragraph">
<p>The CPU and also the processor require a minimal start-up and initialization code to bring the hardware into an
operational state. Furthermore, the C runtime requires an initialization before compiled code can be executed.
This setup is done by the start-up code (<code>sw/common/crt0.S</code>) which is automatically linked with <em>every</em> application
program and gets mapped before the actual application code so it gets executed right after boot.
The <code>crt0.S</code> start-up performs the following operations:</p>
</div>
<table class="tableblock frame-ends grid-all stretch">
<caption class="title">Table 103. CTR0 operations executed by each CPU core</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>CPU 0 (primary core)</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>CPU 1 (secondary core)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">setup the stack pointer (<code>sp</code>) and the global pointer (<code>gp</code>) according to the <a href="#_ram_layout">RAM Layout</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">initialize <a href="#_mstatus"><strong><code>mstatus</code></strong></a> disabling machine-level interrupts</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">install an endless loop as trap handler ("crt0 panic") to <a href="#_mtvec"><strong><code>mtvec</code></strong></a>: the core will halt if any trap occurs</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">clear <a href="#_mie"><strong><code>mie</code></strong></a> disabling all interrupt sources</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">initialize all integer register <code>x1..x31</code> (only <code>x1..x15</code> if <code>E</code> ISA extension is enabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">initialize <code>.data</code> section</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">wait in SMP sleep mode for <a href="#_dual_core_boot">Dual-Core Boot</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">clear <code>.bss</code> section</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">call constructors</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">call core0&#8217;s <code>main</code> function</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">call core1&#8217;s <code>main</code> function</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><em>execute application</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><code>main</code> returns</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">clear <a href="#_mie"><strong><code>mie</code></strong></a> disabling all interrupt sources</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">reinstall an endless loop as trap handler ("crt0 panic") to <a href="#_mtvec"><strong><code>mtvec</code></strong></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><code>main</code> return value is copied to <a href="#_mscratch"><strong><code>mscratch</code></strong></a> for inspection by a debugger</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">call destructors</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">execute <code>ebreak</code> instruction to notify external debugger</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">halt: CPU enters sleep mode executing <code>wfi</code> in an endless loop</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>CPU 0 (primary core)</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>CPU 1 (secondary core)</strong></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_executable_image_formats">4.8. Executable Image Formats</h3>
<div class="paragraph">
<p>The binary executable image (see <a href="#_rom_layout">ROM Layout</a>) is further processed by the NEORV32 image generator (<code>sw/image_gen</code>)
to generate a final executable file. The image generator can generate several types of executable file formats selected
by a flag when calling the generator. <strong>Note that all these options are managed by the makefile (see <a href="#_makefile_targets">Makefile Targets</a>).</strong></p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable binary file (including a bootloader header) for upload via the bootloader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vhd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a VHDL memory image (package file, package name is the same as the output file name).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a raw 8x ASCII hex-char file for custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a raw binary file for custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>coe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a raw COE file for FPGA memory initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a raw MEM file for FPGA memory initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mif</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a raw MIF file for FPGA memory initialization.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Image Generator Compilation</div>
The sources of the image generator are automatically compiled when invoking the makefile
(requires a native GCC installation).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Executable Header</div>
For the <code>app_bin</code> option the image generator adds a small header to the executable. This header is required by the
<a href="#_bootloader">Bootloader</a> to identify and manage the executable. The header consists of three 32-bit words located right
at the beginning of the file. The first word of the executable is the signature word and is always <code>0xB007C0DE</code>.
Based on this word the bootloader can identify a valid image file. The next word represents the size in bytes of the
actual program image in bytes. A simple complement checksum of the actual program image is given by the third word.
This provides a simple protection against data transmission or storage errors.
<strong>Note that this executable format cannot be used for <em>direct</em> execution.</strong>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">VHDL Memory Initialization Files</div>
The generated VHDL images are plain VHDL packages providing program data as constant array.
Note that this array is always extended to a power of 2. Unused elements are set to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Optionally, the NEORV32 image generator can also be used stand-alone:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">neorv32/sw/image_gen$ ./image_gen
NEORV32 executable image generator

Usage:    image_gen [options]
Example:  image_gen -i main.bin -o main_exe.bin -t app_bin

Options:
  -h             Show this help text and exit
  -i file_name   Input binary file name; mandatory
  -o file_name   Output file name; mandatory
  -t type        Type of image to generate; default is 'app_bin'

Image type:
  app_bin   Application executable for bootloader upload (binary file with header)
  app_vhd   Application memory image (IMEM VHDL package file)
  bld_vhd   Bootloader memory image (BOOTROM VHDL package file)
  raw_hex   ASCII hex file (raw executable)
  raw_bin   Binary file (raw executable)
  raw_coe   COE file (raw executable)
  raw_mem   MEM file (raw executable)
  raw_mif   MIF file (raw executable)</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_bootloader">4.9. Bootloader</h3>
<div class="paragraph">
<p>The NEORV32 bootloader provides an optional built-in firmware that allows to upload new application firmware at
any time without the need to re-synthesize the FPGA&#8217;s bitstream. The bootloader is automatically executed after
reset when enabled via the <a href="#_boot_configuration">Boot Configuration</a> <code>BOOT_MODE_SELECT</code> generic. The bootloader provides the
following key features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>interactive user console via UART</p>
</li>
<li>
<p>upload executable via UART</p>
</li>
<li>
<p>load executable from SPI flash; store executable to SPI flash</p>
</li>
<li>
<p>load executable from TWI flash; store executable to TWI flash (<em>option disabled by default</em>)</p>
</li>
<li>
<p>load executable from SD card (<em>option disabled by default</em>)</p>
</li>
<li>
<p>automatic boot sequence: automatically boot from TWI/SPI flash / SD card</p>
</li>
<li>
<p>highly configurable to adapt to application requirements</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Pre-Built Bootloader Image</div>
This section refers to the <strong>default</strong> NEORV32 bootloader. The <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> image file
already contains the pre-compiled bootloader (<code>sw/bootloader/bootloader.c</code>) in its default configuration.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Minimal Hardware Requirements</div>
The default bootloader image was compiled for a minimal <code>rv32e_zicsr_zifencei</code> ISA configuration and requires a
RAM (DMEM) size of at least 256 bytes. These constraints ensure that the bootloader can be executed on any
CPU/processor configuration. It is recommended to enable at least
<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a>,
the <a href="#_core_local_interruptor_clint">CLINT</a> and the <a href="#_general_purpose_input_and_output_port_gpio">GPIO</a> controller.
See <a href="#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a> for more information.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_bootloader_console">4.9.1. Bootloader Console</h4>
<div class="paragraph">
<p>The default bootloader provides a serial console via UART0 for user interaction using the following terminal
settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>19200 Baud, 8 data bits, no parity bit, 1 stop bit (<code>19200-8-N-1</code>)</p>
</li>
<li>
<p>line breaks: carriage return + newline (<code>\r\n</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Terminal Program</div>
Any terminal program that can connect to a serial port should work. However, make sure the program can transfer
data in <em>raw</em> byte mode without any protocol overhead (e.g. XMODEM). Note that some terminal programs struggle
with transmitting files larger than 4kB (see <a href="https://github.com/stnolting/neorv32/pull/215" class="bare">https://github.com/stnolting/neorv32/pull/215</a>).
<strong>For Windows I can recommend TeraTerm (GUI) and SimplySerial (Window terminal). For Linux I can recommend <code>picocom</code>.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the bootloader uses the LSB of the top entity&#8217;s GPIO output port (<code>gpio_o(0)</code>) for an high-active
status LED. All other output pins are set to low. After reset, the status LED will start blinking at 2Hz and the
<a href="#_auto_boot_sequence">Auto Boot Sequence</a> is started. This auto-boot sequence can be skipped within 8s by pressing any key.</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. Default Bootloader Console</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">NEORV32 Bootloader
build: Dec 13 2025 <i class="conum" data-value="1"></i><b>(1)</b>

Auto-boot in 8s. Press any key to abort. <i class="conum" data-value="2"></i><b>(2)</b>
Aborted. <i class="conum" data-value="3"></i><b>(3)</b>

Type 'h' for help.
CMD:&gt; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootloader version (compile date).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start of auto-boot sequence.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Auto-boot sequence aborted due to user console input.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Command prompt.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To see a list of all available commands press <code>h</code> to see the help menu:</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. Bootloader Help Menu</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">CMD:&gt; h
Available CMDs:
h: Help                <i class="conum" data-value="1"></i><b>(1)</b>
i: System info         <i class="conum" data-value="2"></i><b>(2)</b>
r: Restart             <i class="conum" data-value="3"></i><b>(3)</b>
u: Upload via UART     <i class="conum" data-value="4"></i><b>(4)</b>
t: TWI flash - load    <i class="conum" data-value="5"></i><b>(5)</b>
w: TWI flash - program <i class="conum" data-value="6"></i><b>(6)</b>
l: SPI flash - load    <i class="conum" data-value="7"></i><b>(7)</b>
s: SPI flash - program <i class="conum" data-value="8"></i><b>(8)</b>
c: SD card - load      <i class="conum" data-value="9"></i><b>(9)</b>
e: Start executable    <i class="conum" data-value="10"></i><b>(10)</b>
x: Exit                <i class="conum" data-value="11"></i><b>(11)</b>
CMD:&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Show "Available CMDs" help text again.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Show hardware configuration information.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Restart bootloader and auto-boot sequence.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Upload new executable (<code>neorv32_exe.bin</code>) via UART.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Load executable from TWI flash (<em>this option is disabled by default</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Store executable to TWI flash (<em>this option is disabled by default</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Load executable from SPI flash.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Program previously-uploaded executable to SPI flash.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Load executable from SD card (<em>this option is disabled by default</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Start the (up)loaded executable.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Raise a breakpoint exception: If a debugger is connected this will transfer control to the debugger.
If no debugger is connected this will print an exception error (<a href="#_bootloader_error_codes">Bootloader Error Codes</a>)
shutting down the processor.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unavailable Commands</div>
Note that not all options are enabled in the default bootloader configuration in order to keep the bootloader
ROM size below 4kB. However, these options can be enabled in <code>config.h</code> (see <a href="#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Available commands can be executed by typing the according letter. For example, when executing the <code>i</code> command
the general system configuration is printed:</p>
</div>
<div class="listingblock">
<div class="title">Listing 26. System Configuration Information (Example)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">CMD:&gt; i
HWV:  0x01120101 <i class="conum" data-value="1"></i><b>(1)</b>
CLK:  0x05f5e100 <i class="conum" data-value="2"></i><b>(2)</b>
MISA: 0x40901107 <i class="conum" data-value="3"></i><b>(3)</b>
XISA: 0x0fc06fd3 <i class="conum" data-value="4"></i><b>(4)</b>
SOC:  0x38efc87b <i class="conum" data-value="5"></i><b>(5)</b>
MISC: 0x0a010d00 <i class="conum" data-value="6"></i><b>(6)</b>
CMD:&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Processor hardware version in BCD format (<a href="#_mimpid"><strong><code>mimpid</code></strong></a> CSR).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Processor clock speed in Hz (<code>CLK</code> register of <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>RISC-V CPU extensions (<a href="#_misa"><strong><code>misa</code></strong></a> CSR).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>NEORV32-specific CPU extensions (<a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Processor configuration (<code>SOC</code> register of <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Miscellaneous memory and SoC configuration (<code>MISC</code> register of <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boot_sequence">4.9.2. Auto Boot Sequence</h4>
<div class="paragraph">
<p>After reset, the bootloader waits 8 seconds for UART console input before it starts the automatic boot sequence.
Depending on the configuration (<a href="#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a>) the bootloader will try to fetch a valid
executable from different sources:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Try to load an executable from TWI flash (default device ID is <code>0xA0</code>).</p>
</li>
<li>
<p>Try to load an executable from SPI flash (default SPI chip select line is <code>spi_csn_o(0)</code>).</p>
</li>
<li>
<p>Try to load file <code>boot.bin</code> from SD flash (default SPI chip select line is <code>spi_csn_o(1)</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a valid boot image is loaded it will be immediately started. If no valid executable can be fetched the interactive
bootloader console is started.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uploading_an_executable">4.9.3. Uploading an Executable</h4>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Connect the primary UART (UART0) interface of the processor to a serial port of your host computer.</p>
</li>
<li>
<p>Start a serial terminal program.</p>
</li>
<li>
<p>Open a connection to the the serial port your UART is connected to.</p>
</li>
<li>
<p>Press the NEORV32 reset button to restart the bootloader. The status LED starts blinking and the
bootloader intro screen appears in the console. Press any key to abort the automatic boot sequence
and to start the actual bootloader user interface console.</p>
</li>
<li>
<p>Execute the "Upload" command by typing <code>u</code>. Now the bootloader is waiting for a binary executable to be send:
<code>Awaiting neorv32_exe.bin&#8230;&#8203;</code></p>
</li>
<li>
<p>Use the "send file" option of your terminal program to send a valid NEORV32 executable (<code>neorv32_exe.bin</code>).
Make sure the terminal sends the executable in raw binary mode.</p>
</li>
<li>
<p>If everything went fine, <code>Awaiting neorv32_exe.bin&#8230;&#8203; OK</code> is printed in the terminal.</p>
</li>
<li>
<p>The executable is now in the instruction memory of the processor. To execute the program right
now run the "start executable" command by typing <code>e</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Uploading via <code>make upload</code> right from the console</div>
The <a href="#_application_makefile">Application Makefile</a> provides an &#8220;upload&#8221; target that allows you to transfer a compiled executable directly
to the bootloader via UART right from the console. This script handles the communication with the bootloader and is
based on a simple shell helper script <code>neorv32/sw/image_gen/uart_upload.sh</code>. Example:
<code>neorv32/sw/example/demo_blink_led$ make UART_TTY=/dev/ttyUSB1 upload</code>.
The serial interface device is defined by <code>UART_TTY</code> .
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_programming_an_spi_twi_flash">4.9.4. Programming an SPI (/TWI) Flash</h4>
<div class="paragraph">
<p>This guide shows how to write an executable to the SPI flash via the bootloader so it can be automatically
fetched and executed after processor reset. If the TWI flash option is enabled, an according command for
programming the TWI flash is available.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Reset the NEORV32 processor and wait until the bootloader start screen appears.</p>
</li>
<li>
<p>Abort the auto boot sequence and start the user console by pressing any key.</p>
</li>
<li>
<p>Press <code>u</code> to upload the executable that shall be programmed to the flash.</p>
</li>
<li>
<p>Send the binary via the terminal program. When the upload is completed and "OK"
appears, press <code>s</code> to trigger the SPI flash programming:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; s
Write 0x00001614 bytes to SPI flash @0x00400000 (y/n)?</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>The bootloader shows the size of the executable and the base address of the SPI flash where the
executable will be stored. A prompt appears: type <code>y</code> to start the programming or type <code>n</code> to abort.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; s
Write 0x00001614 bytes to SPI flash @0x00400000 (y/n)?
Flashing... OK
CMD:&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Note that flash programming can take some time (depending on the TWI/SPI clock configuration in <code>config.h</code>).
If "OK" appears, the programming process was successful and the flash can be used for the auto-boot sequence.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_booting_from_sd_card">4.9.5. Booting from SD Card</h4>
<div class="paragraph">
<p>The SD card is accessed in SPI mode. The card has to be formatted using the <strong>FAT32</strong> file system with
a sector size of at least 512 bytes. The executable has to be placed in the card&#8217;s root directory.
By default the bootloader will fetch the <code>boot.bin</code> file, which is just a renamed copy of the
default <code>neorv32_exe.bin</code> file that is generated by the application compilation flow. The name of the
SD card&#8217;s boot file can be changed to a custom file name (see <a href="#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a>),
but it has to use the 8.3 DOS format (max 8 character for the name plus dot plus 3 characters suffix).</p>
</div>
<div class="paragraph">
<p>SD-card and FAT32 support is provided by the great <strong>Petit FatFs</strong> library by Elm-Chan:
<a href="https://elm-chan.org/fsw/ff/00index_p.html" class="bare">https://elm-chan.org/fsw/ff/00index_p.html</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_internal_bootloader">4.9.6. Customizing the Internal Bootloader</h4>
<div class="paragraph">
<p>The NEORV32 bootloader provides several options to configure it for a custom setup. It configured via set of
C-language <code>defines</code> in <code>sw/bootloader/config.h</code>. All defines provide default value that can be edited or
overridden by Makefile directives.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 104. Bootloader Configuration Parameters</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-center valign-top">Legal values</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Memory layout</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXE_BASE_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any 4-byte-aligned address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory base address for the executable; also the boot address for the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Serial console</strong> - requires <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>1</code> to enable the serial console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART_BAUD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19200</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate of UART0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Status LED</strong> - requires <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STATUS_LED_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable bootloader status led ("heart beat") at <code>GPIO</code> output port pin <code>STATUS_LED_PIN</code> when <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STATUS_LED_PIN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0..31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GPIO</code> output pin used for the high-active status LED.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Auto-boot</strong> - requires <a href="#_core_local_interruptor_clint">Core-Local Interruptor (CLINT)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTO_BOOT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-boot enabled when <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTO_BOOT_TIMEOUT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout in seconds after which the auto-boot sequence starts (if there is no UART input by the user).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>TWI flash</strong> - requires <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>1</code> to enable the SPI flash (boot) options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_PROG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>1</code> to enable programming the TWI flash from the bootloader menu.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_CLK_PRSC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_1024</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_2</code> <code>CLK_PRSC_4</code> <code>CLK_PRSC_8</code> <code>CLK_PRSC_64</code> <code>CLK_PRSC_128</code> <code>CLK_PRSC_1024</code> <code>CLK_PRSC_2024</code> <code>CLK_PRSC_4096</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI clock prescaler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_CLK_DIV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0..15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI clock divider value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xA0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit TWI device address (with R/W bit cleared).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_BASE_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the TWI flash base address for the executable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TWI_FLASH_ADDR_BYTES</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1,2,3,4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of TWI flash address bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>SPI flash</strong> - requires <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>1</code> to enable the TWI flash (boot) options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_PROG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>1</code> to enable programming the SPI flash from the bootloader menu.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_CS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0..7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI chip select line (port <code>spi_csn_o</code>) for selecting the SPI flash.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_CLK_PRSC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_64</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_2</code> <code>CLK_PRSC_4</code> <code>CLK_PRSC_8</code> <code>CLK_PRSC_64</code> <code>CLK_PRSC_128</code> <code>CLK_PRSC_1024</code> <code>CLK_PRSC_2024</code> <code>CLK_PRSC_4096</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock prescaler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_CLK_DIV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0..15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock divider value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_BASE_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00400000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the SPI flash base address for the executable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_ADDR_BYTES</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1,2,3,4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI flash address size in number of bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_SECTOR_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16*1024</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of SPI flash address bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>SPI SD card</strong> - requires <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_SDCARD_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0,1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>1</code> to enable booting from SD card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_SDCARD_CS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0..7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI chip select line (port <code>spi_csn_o</code>) for selecting the SD card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_SDCARD_CLK_PRSC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_64</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_2</code> <code>CLK_PRSC_4</code> <code>CLK_PRSC_8</code> <code>CLK_PRSC_64</code> <code>CLK_PRSC_128</code> <code>CLK_PRSC_1024</code> <code>CLK_PRSC_2024</code> <code>CLK_PRSC_4096</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock prescaler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_SDCARD_CLK_DIV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0..15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock divider value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_SDCARD_FILE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"boot.bin"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8.3 DOS format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File name of the boot image. Has to be located in the root directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Branding</strong> - for text printed via serial console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>THEME_INTRO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"NEORV32 Bootloader"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intro text that is shown in the bootloader console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>THEME_EXE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"neorv32_exe.bin"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">any string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of executable that is shown in the console menu.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_bootloader_error_codes">4.9.7. Bootloader Error Codes</h4>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_DEVICE</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A device-accessing function returned an error code. Make sure that the device is properly
connected and that all required processor modules/interface are actually enabled (by the according <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_SIGNATURE</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The signature that indicates a valid NEORV32 executable of the accessed executable is incorrect.
This can be caused by a temporary transmission error or by an invalid or corrupted executable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_CHECKSUM</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The checksum of the loaded executable is incorrect. This can be caused by a temporary transmission
error or by an invalid or corrupted executable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_EXCEPTION</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An unexpected exception has occurred. This can be caused by an invalid bootloader configuration (non-available
processor modules, memory layout, &#8230;&#8203;). For debugging purpose the error message will also display the content of the <a href="#_mcause"><strong><code>mcause</code></strong></a>, <a href="#_mepc"><strong><code>mepc</code></strong></a>,
<a href="#_mtinst"><strong><code>mtinst</code></strong></a> and <a href="#_mtval"><strong><code>mtval</code></strong></a> CSRs. Example: <code>ERROR_EXCEPTION 0x00000003 0xffe00cb4 0x00100073 0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_neorv32_runtime_environment">4.10. NEORV32 Runtime Environment</h3>
<div class="paragraph">
<p>The NEORV32 software framework provides a minimal runtime environment ("RTE") that takes care of a stable
and <em>safe</em> execution environment by providing a unified interface for handling of <em>all</em> traps (exceptions and
interrupts). Once initialized, the RTE provides <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> that catch all possible traps.
These default handlers just output a message via UART when a certain trap has been triggered. The default
handlers can be overridden by the application code to install application-specific handler functions for each trap.</p>
</div>
<div class="paragraph">
<p>Using the RTE is <strong>optional but highly recommended</strong> for bare-metal / non-OS applications. The RTE provides a
simple and comfortable way of delegating traps to application-specific handlers while making sure that all traps
(even though they are not explicitly used by the application) are handled correctly. Performance-optimized
applications or embedded operating systems may not use the RTE at all in order to increase response time.</p>
</div>
<div class="sect3">
<h4 id="_rte_operation">4.10.1. RTE Operation</h4>
<div class="paragraph">
<p>The RTE manages the trap-related CSRs of the CPU&#8217;s privileged architecture (see <a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a>).
It initializes the <a href="#_mtvec"><strong><code>mtvec</code></strong></a> CSR in DIRECT mode, which provides the base entry point for <em>all</em> traps. The address
stored to this register defines the address of the <strong>first-level trap handler</strong>, which is provided by the NEORV32
RTE. Whenever an exception or interrupt is triggered this first-level trap handler is executed.</p>
</div>
<div class="paragraph">
<p>The first-level handler performs a complete context save, analyzes the source of the trap and calls the according
<strong>second-level trap handler</strong>, which takes care of the actual exception/interrupt handling. The RTE manages an
internal look-up table to track the addresses of the according second-level trap handlers.</p>
</div>
<div class="paragraph">
<p>After the initial RTE setup, each entry in the RTE&#8217;s trap handler look-up table is initialized with a
<a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a>. These default handler do not execute any trap-related operations - they just output
a debugging message via the primary UART (UART0) (if enabled) to inform the user that a trap has occurred that is
not (yet) handled by a proper application-specific trap handler. After sending this message, the RTE tries to resume
normal execution by moving on to the next linear instruction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Dual-Core Configuration</div>
The RTE&#8217;s internal trap handler look-up table is used globally for <strong>both</strong> cores. If a core-specific handling is
required, the according user-defined trap handler need to retrieve the core&#8217;s ID from <a href="#_mhartid"><strong><code>mhartid</code></strong></a> and branch
accordingly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_rte">4.10.2. Using the RTE</h4>
<div class="paragraph">
<p>The NEORV32 runtime environment is part of the default NEORV32 software framework. The links to the according
software references are listed below.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_rte.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__rte_8c.html">Online software reference (Doxygen)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_rte.h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://stnolting.github.io/neorv32/sw/neorv32__rte_8h.html">Online software reference (Doxygen)</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The RTE has to be explicitly enabled by calling the according setup function. It is recommended to do this right at the
beginning of the application&#8217;s <code>main</code> function. For the SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a> the RTE setup functions has to
be called on each core that wants to use the RTE.</p>
</div>
<div class="listingblock">
<div class="title">Listing 27. RTE Setup Right at the Beginning of "main"</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int main() {

  neorv32_rte_setup(); // setup NEORV32 runtime environment

  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>After setup, all traps will trigger execution of the RTE&#8217;s <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> at first. In order to use
application-specific trap handlers the default debug handlers can be overridden by installing user-defined ones:</p>
</div>
<div class="listingblock">
<div class="title">Listing 28. Installing an Application-Specific Trap Handler (Function Prototype)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">int neorv32_rte_handler_install(uint8_t id, void (*handler)(void));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument <code>id</code> defines the "trap ID" (for example a certain interrupt request) that shall be handled by the
user-defined handler. These IDs are defined in <code>sw/lib/include/neorv32_rte.h</code>. However, more convenient device-specific
aliases are also defined in <code>sw/lib/include/neorv32.h</code>. The second argument <code>handler</code> is the actual function that
implements the user-defined trap handler. The custom handler functions must have a specific type without any arguments
and with no return value:</p>
</div>
<div class="listingblock">
<div class="title">Listing 29. Custom Trap Handler (Function Prototype)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">void custom_trap_handler_xyz(void) {

  // handle trap...
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Custom Trap Handler Attributes</div>
Do <strong>NOT</strong> use the <code>interrupt</code> attribute for the application trap handler functions! This would place an <code>mret</code>
instruction at the end of the handler making it impossible to return to the first-level trap handler of the RTE core.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title"><code>mscratch</code> CSR</div>
The <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR should not be used inside an application trap handler as this register is used by the RTE to
provide the base address of the application&#8217;s stack frame <a href="#_application_context_handling">Application Context Handling</a> (i.e. modifying the
registers of application code that caused a trap).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to install trap handlers for exemplary traps.</p>
</div>
<div class="listingblock">
<div class="title">Listing 30. Installing Custom Trap Handlers Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">neorv32_rte_handler_install(RTE_TRAP_MTI, machine_timer_irq_handler); // handler for machine timer interrupt
neorv32_rte_handler_install(RTE_TRAP_MENV_CALL, environment_call_handler); // handler for machine environment call exception
neorv32_rte_handler_install(SLINK_RX_RTE_ID, slink_rx_handler); // handler for SLINK receive interrupt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_default_rte_trap_handlers">4.10.3. Default RTE Trap Handlers</h4>
<div class="paragraph">
<p>The default RTE trap handlers are executed when a certain trap is triggered that is not (yet) handled by an
application-defined trap handler. The default handler will output a message giving additional debug information
via the <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> to inform the user and it will also
try to resume normal program execution (exemplary RTE outputs are shown below). The specific message right at
the beginning of the debug trap handler message corresponds to the trap code obtained from the <a href="#_mcause"><strong><code>mcause</code></strong></a> CSR
(see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>).</p>
</div>
<div class="paragraph">
<p>In most cases the RTE can successfully continue operation - for example if it catches an <strong>interrupt</strong> request
that is not handled by the actual application program. However, if the RTE catches an un-handled <strong>trap</strong> like
a bus access fault exception, continuing execution will most likely fail making the CPU crash.</p>
</div>
<div class="listingblock">
<div class="title">Listing 31. RTE Default Trap Handler UART0 Output Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;NEORV32-RTE-PANIC&gt; [cpu0|M] Illegal instruction MEPC=0x000002d6 MTINST=0x000000FF MTVAL=0x00000000 &lt;/NEORV32-RTE-PANIC&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;NEORV32-RTE-PANIC&gt; [cpu0|U] Illegal instruction MEPC=0x00000302 MTINST=0x00000000 MTVAL=0x00000000 &lt;/NEORV32-RTE-PANIC&gt; <i class="conum" data-value="2"></i><b>(2)</b>
&lt;NEORV32-RTE-PANIC&gt; [cpu0|U] Load address misaligned MEPC=0x00000440 MTINST=0x01052603 MTVAL=0x80000101 &lt;/NEORV32-RTE-PANIC&gt; <i class="conum" data-value="3"></i><b>(3)</b>
&lt;NEORV32-RTE-PANIC&gt; [cpu1|M] FIRQ channel 0x00000003 MEPC=0x00000820 MTINST=0x00000000 MTVAL=0x00000000 &lt;/NEORV32-RTE-PANIC&gt; <i class="conum" data-value="4"></i><b>(4)</b>
&lt;NEORV32-RTE-PANIC&gt; [cpu1|M] Instruction access fault MEPC=0x90000000 MTINST=0x42078b63 MTVAL=0x00000000 FATAL! HALTING CPU &lt;/NEORV32-RTE-PANIC&gt;\n <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Illegal 32-bit instruction <code>MTINST=0x000000FF</code> at address <code>MEPC=0x000002d6</code> while CPU 0 was in machine-mode (<code>[cpu0|M]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Illegal 16-bit instruction <code>MTINST=0x00000000</code> at address <code>MEPC=0x00000302</code> while CPU 0 was in user-mode (<code>[cpu0|U]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Misaligned load access at address <code>MEPC=0x00000440</code> caused by instruction <code>MTINST=0x01052603</code> (trying to load a full 32-bit word from address <code>MTVAL=0x80000101</code>) while CPU 0 was in user-mode (<code>[cpu0|U]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Fast interrupt request from channel 3 before executing instruction at address <code>MEPC=0x00000820</code> while CPU 1 was in machine-mode (<code>[cpu0|M]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Instruction bus access fault at address <code>MEPC=0x90000000</code> while executing instruction <code>MTINST=0x42078b63</code> while CPU 1 was in machine-mode (<code>[cpu0|M]</code>). This is a fatal/non-resumable exception halting the CPU.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_application_context_handling">4.10.4. Application Context Handling</h4>
<div class="paragraph">
<p>Upon trap entry the RTE backups the entire application context (i.e. all <code>x</code> general purpose registers) to the
stack. The context is restored automatically after trap completion. The base address of the according stack frame
is copied to the <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR. By having this information available, the RTE provides dedicated functions
for accessing and altering the application context:</p>
</div>
<div class="listingblock">
<div class="title">Listing 32. RTE Context Access Functions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">// Prototypes
uint32_t neorv32_rte_context_get(int x); // read register
void     neorv32_rte_context_put(int x, uint32_t data); // write data to register

// Examples
uint32_t tmp = neorv32_rte_context_get(9); // read register 'x9'
neorv32_rte_context_put(28, tmp); // write 'tmp' to register 'x28'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>x</code> argument is used to specify one of the RISC-V general purpose register <code>x0</code> to <code>x31</code>. Note that registers
<code>x16</code> to <code>x31</code> are not available if the RISC-V <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> is enabled. For he SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a>
the provided context functions will access the stack frame of the interrupted application code that was running
on the specific CPU core that caused the trap entry.</p>
</div>
<div class="paragraph">
<p>The context access functions can be used by application-specific trap handlers to <em>emulate</em> unsupported
CPU / SoC features like unimplemented IO modules, unsupported instructions and even unaligned memory accesses.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Demo Program: Emulate Unaligned Memory Access</div>
A demo program, which showcases how to emulate unaligned memory accesses using the NEORV32 runtime environment
can be found in <code>sw/example/demo_emulate_unaligned</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor features an <em>on-chip debugger</em> (OCD) compatible to the <strong>Minimal RISC-V Debug Specification</strong>
implementing the <strong>execution-based debugging</strong> scheme. A copy of the specification is available in <code>docs/references</code>.
The on-chip debugger is implemented if the <a href="#_processor_top_entity_generics"><code>OCD_EN</code></a> processor top generic is set
to <code>true</code>. Optionally, a up to 16 hardware triggers can be implemented (<a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a>) to support
hardware-assisted break- and watchpoints. Furthermore, the OCD supports an optional <a href="#_debug_authentication">Debug Authentication</a>
module to constrain OCD access to authorized parties.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hands-On Tutorial</div>
A simple example on how to use NEORV32 on-chip debugger in combination with OpenOCD and the GNU debugger is shown in
section <a href="https://stnolting.github.io/neorv32/ug/#_debugging_using_the_on_chip_debugger">Debugging using the On-Chip Debugger</a>
of the User Guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_openocd">openOCD</a></p>
</li>
<li>
<p><a href="#_semihosting">Semihosting</a></p>
</li>
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a></p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a></p>
</li>
<li>
<p><a href="#_debug_authentication">Debug Authentication</a></p>
</li>
<li>
<p><a href="#_cpu_debug_mode">CPU Debug Mode</a></p>
</li>
<li>
<p><a href="#_trigger_module">Trigger Module</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>standard 4-wire JTAG access port</p>
</li>
<li>
<p>debugging of up to 4 CPU cores ("harts")</p>
</li>
<li>
<p>full control of the CPU: halting, single-stepping and resuming</p>
</li>
<li>
<p>indirect access to all core registers and the entire processor address space (via program buffer)</p>
</li>
<li>
<p>execution of arbitrary programs via the program buffer</p>
</li>
<li>
<p>compatible with upstream OpenOCD and GDB</p>
</li>
<li>
<p>optional trigger module for up to 16 hardware break- and watchpoints</p>
</li>
<li>
<p>optional authentication for advanced security</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuration Options</strong></p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 105. NEORV32 OCD Configuration Generics</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 53.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Type</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the on-chip debugger and the CPU debug mode..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_NUM_HW_TRIGGERS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented HW triggers (<a href="#_trigger_module">Trigger Module</a> / <a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a>) for hardware break-/watchpoints (0..16).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_AUTHENTICATION</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement optional <a href="#_debug_authentication">Debug Authentication</a> module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OCD_JEDEC_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(10:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">"00000000000"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEDEC ID; continuation codes plus vendor ID (passed to the JTAG <a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_ocd_complex.png" alt="neorv32 ocd complex">
</div>
<div class="title">Figure 19. NEORV32 on-chip debugger complex</div>
</div>
<div class="paragraph">
<p>The NEORV32 on-chip debugger is based on five hardware modules:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a>: JTAG access tap to allow an external adapter to interface with the <em>debug module (DM)</em>.</p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a>: The RISC-V debug module is the main bridge between the external debugger and the processor being
debugged. It provides a <em>data buffer</em> for data transfer from/to the DM, a <em>code ROM</em> containing the "park loop" code, a
<em>program buffer</em> to allow the debugger to execute small programs defined by the DM and a <em>status register</em> that is used
to communicate <em>exception</em>, <em>halt</em>, <em>resume</em> and <em>execute</em> requests/acknowledges between the debugger and the CPU.</p>
</li>
<li>
<p><a href="#_debug_authentication">Debug Authentication</a>: Authenticator module to secure on-chip debugger access. By default this module implements a
very simple authentication mechanism as example. Users can modify/replace this default logic to implement arbitrary
authentication mechanism.</p>
</li>
<li>
<p><a href="#_cpu_debug_mode">CPU Debug Mode</a> ISA extension: This ISA extension provides the "debug execution mode" as another CPU operation mode
that is used to execute the park loop code from the DM. This mode also provides additional CSRs and instructions.</p>
</li>
<li>
<p>CPU <a href="#_trigger_module">Trigger Module</a>: This module provides up to 16 hardware triggers that can be used as hardware-assisted break- or
watchpoints.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>When debugging the system using the OCD, the external debugger (e.g. GDB) issues a halt request to the CPU to make it
enter so-called <em>debug mode</em>. In this mode the application-defined architectural state of the system/CPU is "frozen" so
the debugger can monitor it without interfering with the actual application. However, the OCD can also modify the entire
architectural state at any time. While in debug mode, the debugger has full control over the entire CPU core.</p>
</div>
<div class="paragraph">
<p>After halting, the CPU executes the "park loop" code from the code ROM of the debug module (DM). This park loop implements
an endless loop that is used to poll a memory-mapped <a href="#_status_register">Status Register</a> of the DM. The flags in this register are used to
communicate requests from the DM and to acknowledge their processing them by the CPU: trigger execution of the program buffer
or resume the halted application. Furthermore, the CPU uses this register to signal that the CPU has halted after a halt
request or to signal that an exception has been raised while being in debug mode.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_openocd">5.1. openOCD</h3>
<div class="paragraph">
<p>By default, the free and open-source openOCD (<a href="https://openocd.org/" class="bare">https://openocd.org/</a>) is used to establish a debugger connection.
However, other interfaces can be used (like Segger or Lauterbach tools) if they provide RISC-V support.</p>
</div>
<div class="paragraph">
<p>openOCD is configured by a set of configuration scripts which are located in <code>neorv32/sw/openocd</code>.
Two top scripts are provided: one for the single-core processor configuration (<code>neorv32.cfg</code>)
and another one for the SMP dual-core configuration (<code>neorv32.dual-core.cfg</code>).
Both scripts have the same format and include several helper scripts.</p>
</div>
<div class="listingblock">
<div class="title">Listing 33. NEORV32 openOCD single-core CFG file (<code>neorv32.cfg</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl"># configuration
set PATH [file dirname [file normalize [info script]]] <i class="conum" data-value="1"></i><b>(1)</b>
set CORENAME neorv32 <i class="conum" data-value="2"></i><b>(2)</b>
set NUMCORES 1 <i class="conum" data-value="3"></i><b>(3)</b>

# configure JTAG interface, setup target, authenticate and start
source [file join $PATH lib/interface.cfg] <i class="conum" data-value="4"></i><b>(4)</b>
source [file join $PATH lib/target.cfg] <i class="conum" data-value="5"></i><b>(5)</b>
source [file join $PATH lib/authenticate.cfg] <i class="conum" data-value="6"></i><b>(6)</b>
source [file join $PATH lib/start.cfg] <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the absolute path of the script.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the core name that will show up in openOCD and GDB. This can be changed to any custom name.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Number of CPU cores (1 for the single-core setup, 2 for the dual-core setup).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Interface adapter (JTAG) configuration script. Replace by custom adapter setup.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>NEORV32-specific target configuration and initialization.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional authentication process; the <a href="#_default_authentication_mechanism">Default Authentication Mechanism</a> is implemented as example;
Replace this when using a custom authentication mechanism.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Reset and halt the target.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_semihosting">5.2. Semihosting</h3>
<div class="paragraph">
<p>Semihosting is a mechanism developed by ARM that enables code running on the NEORV32 to communicate and use the
input/output facilities on a host computer that is running a debugger. Examples of these facilities include keyboard
input, screen output, and disk I/O. For example, you can use this mechanism to enable functions in the C library,
such as <code>printf()</code> and <code>scanf()</code>, to use the screen and keyboard of the host instead of having a screen and keyboard
on the target system. (source: <a href="https://developer.arm.com/documentation/dui0471/i/semihosting/what-is-semihosting-?lang=en" class="bare">https://developer.arm.com/documentation/dui0471/i/semihosting/what-is-semihosting-?lang=en</a>)</p>
</div>
<div class="paragraph">
<p>For example, with semihosting you can</p>
</div>
<div class="ulist">
<ul>
<li>
<p>print to the host&#8217;s <code>stdout</code> console</p>
</li>
<li>
<p>read from the host&#8217;s <code>stdin</code> console</p>
</li>
<li>
<p>execute arbitrary command in the host&#8217;s shell</p>
</li>
<li>
<p>retrieve the host&#8217;s system time</p>
</li>
<li>
<p>read and write files on the host system</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Semihosting Example Program</div>
A simple semihosting example program can be found in <code>sw/example/demo_semihosting</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V Semihosting Specification</div>
A copy of the implemented RISC-V semihosting specification is available in the
documentation references folder: <code>docs/references/riscv-semihosting.pdf</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The RISC-V semihosting builds upon the ARM standard. Hence, semihosting has to be <strong>explicitly enabled</strong> on the host
side (in <code>GDB</code>) using the ARM command set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gdb hljs" data-lang="gdb">(gdb) monitor arm semihosting enable
semihosting is enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>File accesses need to be explicitly enabled. Additionally, the base folder for accessing those
file should be defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gdb hljs" data-lang="gdb">(gdb) monitor arm semihosting_fileio enable
(gdb) monitor arm semihosting_basedir path/to/neorv32/sw/example/demo_semihosting</code></pre>
</div>
</div>
<div class="paragraph">
<p>The NEORV32 software framework provides a build-in library for semihosting primitive (<code>sw/lib/include/neorv32_semihosting.h</code>).
Additionally, accesses to the standard IO streams (<code>stdin</code> and <code>stdout</code>) can be automatically mapped to the host&#8217;s console.
Functions such as <code>printf</code> and <code>puts</code> can then print right to the host&#8217;s <code>stdout</code> console. Vice versa, functions like <code>scanf</code>
and <code>fgets</code> will read from the host&#8217;s <code>stdin</code>. To enable this automatic mapping, the <em>define</em> <code>STDIO_SEMIHOSTING</code> needs to be
defined and the application firmware needs to be recompiled.</p>
</div>
<div class="listingblock">
<div class="title">Listing 34. Forward <code>stdio.h</code> Calls to Host Computer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-makefile hljs" data-lang="makefile">USER_FLAGS += -DSTDIO_SEMIHOSTING</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>STDIO_SEMIHOSTING</code> is defined <em>all</em> file accesses provided by <code>stdio.h</code> (via Newlib) will be redirected to the host
computer via semihosting services.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Redirecting all UART data via Semihosting</div>
You can redirect <strong>all</strong> physical UART data via semihosting by defining <code>UART_SEMIHOSTING</code>
(e.g. <code>"USER_FLAGS+=-DSTDIO_SEMIHOSTING -DUART_SEMIHOSTING"</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Semihosting Services Without a Host</div>
If any semihosting request is issued without a host being connected, an environment breakpoint exception is raised.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Further references:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A great overview: <a href="https://interrupt.memfault.com/blog/arm-semihosting" class="bare">https://interrupt.memfault.com/blog/arm-semihosting</a></p>
</li>
<li>
<p>Implementing semihosting on RISC-V: <a href="https://embeddedinn.com/articles/tutorial/understanding-riscv-semihosting/" class="bare">https://embeddedinn.com/articles/tutorial/understanding-riscv-semihosting/</a></p>
</li>
<li>
<p>Description of the service calls by ARM: <a href="https://developer.arm.com/documentation/dui0203/j/semihosting/semihosting-operations?lang=en" class="bare">https://developer.arm.com/documentation/dui0203/j/semihosting/semihosting-operations?lang=en</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_debug_transport_module_dtm">5.3. Debug Transport Module (DTM)</h3>
<div class="paragraph">
<p>The debug transport module "DTM" (VHDL module: <code>rtl/core/neorv32_debug_dtm.vhd</code>) provides a bridge between a standard 4-wire
JTAG test access port ("tap") and the internal debug module interface.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 106. JTAG Top Level Signals of the DTM</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Maximum JTAG Clock</div>
All JTAG signals are synchronized to the processor&#8217;s clock domain. Hence, no additional clock domain is required
for the DTM. However, this constraints the maximal JTAG clock frequency (<code>jtag_tck_i</code>) to be less than or equal
to <strong>1/5</strong> of the processor clock frequency (<code>clk_i</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">JTAG TAP Reset</div>
The NEORV32 JTAG TAP does not provide a dedicated reset signal ("TRST").
However, JTAG-level resets can be triggered using  TMS signaling.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Maintaining the JTAG Chain</div>
If the on-chip debugger is disabled the JTAG serial input <code>jtag_tdi_i</code> is directly
connected to the JTAG serial output <code>jtag_tdo_o</code> to maintain the JTAG chain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DTM implement a single 5-bit <em>instruction register</em> <code>IR</code> and several <em>data registers</em> <code>DR</code> with different sizes. The
individual data registers are accessed by writing the according address to the instruction register. The following table
shows all available data registers and their addresses:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 107. JTAG TAP registers</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address (via <code>IR</code>)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size (bits)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>00001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>IDCODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identification code (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DTMCS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug transport module control and status register (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DMI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug module interface (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">others</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BYPASS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default JTAG bypass register</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 108. <code>IDCODE</code> - DTM Identification Code Register</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version ID, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>partid</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">part ID, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>manid</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEDEDC manufacturer ID, assigned via the <a href="#_processor_top_entity_generics"><code>JEDEC_ID</code></a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardwired to <code>1</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 109. <code>DTMCS</code> - DTM Control and Status Register</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20:18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>errinfo</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not implemented; hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmihardreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setting this bit will reset the debug module interface; this bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmireset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setting this bit will clear the sticky error state; this bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>idle</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">recommended idle states (= 0, no idle states required)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmistat</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read-only alias of <code>DMI.op</code>; hardwired to <code>00</code> (NOP)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abits</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of address bits in <code>DMI</code> register (= 6)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code> = DTM is compatible to RISC-V debug spec. versions v0.13 and v1.0</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 110. <code>DMI</code> - DTM Debug Module Interface Register</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">40:34</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7-bit address, see <a href="#_dm_registers">DM Registers</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">33:2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit data to write/read to/from the addresses DM register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>op</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-bit operation (<code>00</code> = NOP; <code>10</code> = write; <code>01</code> = read)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_debug_module_dm">5.4. Debug Module (DM)</h3>
<div class="paragraph">
<p>The debug module "DM" (VHDL module: <code>rtl/core/neorv32_debug_dm.vhd</code>) acts as a translation interface between abstract
operations issued by the debugger application (like GDB) and the platform-specific debugger hardware.
It supports the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gives the debugger necessary information about the implementation.</p>
</li>
<li>
<p>Allows the hart to be halted/resumed/reset and provides the current status.</p>
</li>
<li>
<p>Provides abstract read and write access to the halted hart&#8217;s general purpose registers.</p>
</li>
<li>
<p>Provides access to a reset signal that allows debugging from the very first instruction after reset.</p>
</li>
<li>
<p>Provides a <em>program buffer</em> to force the hart to execute arbitrary instructions.</p>
</li>
<li>
<p>Allows memory accesses (to the entire address space) from a hart&#8217;s point of view.</p>
</li>
<li>
<p>Optionally implements an authentication mechanism to secure on-chip debugger access.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NEORV32 DM follows the "Minimal RISC-V External Debug Specification" to provide full debugging capabilities while
keeping resource/area requirements at a minimum. It implements the <strong>execution based debugging scheme</strong> for up to
four individual CPU cores ("harts") and provides the following architectural core features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>program buffer with 2 entries and an implicit <code>ebreak</code> instruction at the end</p>
</li>
<li>
<p>indirect bus access via the CPU using the program buffer</p>
</li>
<li>
<p>abstract commands: "access register" plus auto-execution</p>
</li>
<li>
<p>halt-on-reset capability</p>
</li>
<li>
<p>optional authentication</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DM Spec. Version</div>
The NEORV32 DM complies to the RISC-V DM spec version 1.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>From the DTM&#8217;s point of view, the DM implements a set of <a href="#_dm_registers">DM Registers</a> that are used to control and monitor the
debugging session. From the CPU&#8217;s point of view, the DM implements several memory-mapped registers that are used for
communicating data, instructions, debugging control and status (<a href="#_dm_cpu_access">DM CPU Access</a>).</p>
</div>
<div class="paragraph">
<p><strong>External Reset Output</strong></p>
</div>
<div class="paragraph">
<p>The entire processor can be reset at any time by the debugger via the <code>ndmreset</code> bit of the <a href="#_dmcontrol"><strong><code>dmcontrol</code></strong></a> register.
This signal is also available as processor top signal (<a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>: <code>rstn_ocd_o</code>) and can be used
to reset processor-external modules via the on-chip debugger. This signal is low-active and synchronous to the processor
clock. It is available if the on-chip debugger is actually implemented; otherwise it is hardwired to <code>1</code>. Note that the
signal also becomes active (low) when the processor&#8217;s main reset signal is active (even if the on-chip debugger is
deactivated or disabled for synthesis).</p>
</div>
<div class="sect3">
<h4 id="_dm_registers">5.4.1. DM Registers</h4>
<div class="paragraph">
<p>The DM is controlled via a set of registers that are accessed via the DTM. The following registers are implemented:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unimplemented Registers</div>
Write accesses to registers that are not implemented are simply ignored and read accesses to these
registers will always return zero. In both cases no error condition is signaled to the DTM.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 111. Available DM registers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 25%;">
<col style="width: 58.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_data0"><strong><code>data0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract data register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_dmcontrol"><strong><code>dmcontrol</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module control</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_dmstatus"><strong><code>dmstatus</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_hartinfo"><strong><code>hartinfo</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart information</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_abstracts"><strong><code>abstracts</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract control and status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_command"><strong><code>command</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_abstractauto"><strong><code>abstractauto</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command auto-execution</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x1d</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nextdm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base address of next DM; reads as zero to indicate there is only one DM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_progbuf"><code>progbuf0</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_progbuf"><code>progbuf1</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_authdata"><strong><code>authdata</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data to/from the authentication module</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x38</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sbcs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System bus access control and status; reads as zero to indicate there is <strong>no</strong> system bus access</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x40</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_haltsum0"><strong><code>haltsum0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart halt summary</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_data0"><strong><code>data0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract data 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Basic read/write data exchange register to be used with abstract commands (for example to read/write data from/to CPU GPRs).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmcontrol"><strong><code>dmcontrol</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module control register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmcontrol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Control of the overall debug module and the hart. The following table shows all implemented bits. All remaining bits/bit-fields
are configured as "zero" and are read-only. Writing '1' to these bits/fields will be ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 112. <code>dmcontrol</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>haltreq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set/clear hart halt request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>resumereq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request hart to resume</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ackhavereset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write <code>1</code> to clear <code>*havereset</code> flags</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hasel</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: only a single hart can be selected at once</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hartsello</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hart select; only the lowest 3 bits are implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hartselhi</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>setresethaltreq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: halt-on-reset not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>clrresethaltreq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: halt-on-reset not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ndmreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put whole system (except OCD) into reset state when <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmactive</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM enable; writing <code>0</code>-<code>1</code> will reset the DM</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmstatus"><strong><code>dmstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmstatus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00400083</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Current status of the overall debug module and the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 113. <code>dmstatus</code> Register Bits</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 15.3846%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:25</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ndmresetpending</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM in reset state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stickyunavail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*unavail</code> bits reflect the current state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>impebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: indicates an implicit <code>ebreak</code> instruction after the last program buffer entry</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhavereset</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the selected hart is in reset state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhavereset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allresumeack</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the selected hart has acknowledged a resume request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyresumeack</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allnonexistent</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the selected hart is not available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anynonexistent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allunavail</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the DM is disabled to indicate the selected hart is unavailable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyunavail</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allrunning</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the selected hart is running</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyrunning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhalted</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the selected hart is halted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhalted</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authenticated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if authentication passed; see <a href="#_debug_authentication">Debug Authentication</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authbusy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if authentication is busy, see <a href="#_debug_authentication">Debug Authentication</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hasresethaltreq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: halt-on-reset is not supported (directly)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>confstrptrvalid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: no configuration string available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0011</code>: DM compatible to debug spec. version v1.0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hartinfo"><strong><code>hartinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hart information</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>hartinfo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>see below</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This register gives information about the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 114. <code>hartinfo</code> Register Bits</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nscratch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>: number of <code>dscratch*</code> CPU registers = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19:17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataccess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: the <code>data</code> registers are shadowed in the hart&#8217;s address space</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datasize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>: number of 32-bit words in the address space dedicated to shadowing the <code>data</code> registers (1 register)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataaddr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= <code>dm_data_base_c(11:0)</code>, signed base address of <code>data</code> words (see address map in <a href="#_dm_cpu_access">DM CPU Access</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstracts"><strong><code>abstracts</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract control and status</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstracts</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x02000801</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Command execution info and status.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 115. <code>abstracts</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:29</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbufsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0010</code>: size of the program buffer (<code>progbuf</code>) = 2 entries</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set when a command is being executed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>relaxedpriv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: PMP rules are ignored when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmderr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error during command execution (see below); has to be cleared by writing <code>111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datacount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>: number of implemented <code>data</code> registers for abstract commands = 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Error codes in <code>cmderr</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>000</code> - no error</p>
</li>
<li>
<p><code>100</code> - command cannot be executed since hart is not in expected state</p>
</li>
<li>
<p><code>011</code> - exception during command execution</p>
</li>
<li>
<p><code>010</code> - unsupported command</p>
</li>
<li>
<p><code>001</code> - invalid DM register read/write while command is/was executing</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_command"><strong><code>command</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>command</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Writing this register will trigger the execution of an abstract command. New command can only be executed if
<code>cmderr</code> is zero. The entire register in write-only (reads will return zero).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 DM only supports <strong>Access Register</strong> abstract commands. These commands can only access the
hart&#8217;s GPRs x0 - x15/31 (abstract command register index <code>0x1000</code> - <code>0x101f</code>).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 116. <code>command</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description / required value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmdtype</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000000</code>: indicates "access register" command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, has to be <code>0</code> when writing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>010</code>: indicates 32-bit accesses</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarpostincrement</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: post-increment is not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>postexec</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the program buffer is executed <em>after</em> the command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>transfer</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the operation in <code>write</code> is conducted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>write</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: copy <code>data0</code> to <code>[regno]</code>, <code>0</code>: copy <code>[regno]</code> to <code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>regno</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPR-access only; has to be <code>0x1000</code> - <code>0x101f</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstractauto"><strong><code>abstractauto</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command auto-execution</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstractauto</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Register to configure if a read/write access to a DM register re-triggers execution of the last abstract command.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 117. <code>abstractauto</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf1</code> will execute <code>command</code> again</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf0</code> will execute <code>command</code> again</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecdata[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>data0</code> will execute <code>command</code> again</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_progbuf"><strong><code>progbuf</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 1</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000013</code> ("NOP")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Program buffer (two entries) for the DM.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_authdata"><strong><code>authdata</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Authentication data</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>authdata</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>user-defined</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This register serves as a 32-bit serial port to/from the authentication module. See <a href="#_debug_authentication">Debug Authentication</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_haltsum0"><strong><code>haltsum0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Halt summary 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>haltsum0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Each bit corresponds to a hart being halted. Only the lowest four bits are implemented.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dm_cpu_access">5.4.2. DM CPU Access</h4>
<div class="paragraph">
<p>From the CPU&#8217;s perspective the DM acts like another memory-mapped peripheral. It occupies 512 bytes of the CPU&#8217;s
address space starting at address <code>base_io_dm_c</code> (<code>0xffff0000</code>). This address space is divided into four sections
with 64 bytes each to provide access to the <em>park loop code ROM</em>, the <em>program buffer</em>, the <em>data buffer</em> and the
<em>status register</em>. The program buffer, the data buffer and the status register do not fully occupy the 64-byte-wide
sections and are mirrored several times across the according section.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 118. DM CPU Access - Address Map</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-center valign-top">Physical size</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff00</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROM for the "park loop" code (<a href="#_code_rom">Code ROM</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff40</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer (<a href="#_progbuf"><strong><code>progbuf</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff80</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data buffer (<a href="#_data0"><strong><code>data0</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffffc0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_status_register">Status Register</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">DM Register Access</div>
All memory-mapped registers of the DM can only be accessed by the CPU when in debug mode. Hence, the DM registers are
not accessible for normal CPU operations. Any CPU access outside of debug mode will raise a bus access fault exception.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_code_rom">Code ROM</h5>
<div class="paragraph">
<p>The code ROM contain the minimal OCD firmware that implements the debuggers part loop.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Park Loop Code Sources ("OCD Firmware")</div>
The assembly sources of the park loop code are available in <code>sw/ocd-firmware/park_loop.S</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The park loop code provides two entry points where code execution can start. These are used to enter the park loop
either when an explicit debug-entry/halt request has been issued (for example a halt request) or when an exception
has occurred while executing code in debug mode (from the profram buffer).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 119. Park Loop Entry Points</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_exc_entry_c</code>  (<code>base_io_dm_c</code> + 0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception entry address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_park_entry_c</code> (<code>base_io_dm_c</code> + 4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal entry address (halt request)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the CPU enters (via an explicit halt request from the debugger) or re-enters debug mode (for example via an
<code>ebreak</code> in the DM&#8217;s program buffer), it jumps to the <strong>normal entry point</strong> that is configured via the
<a href="#_cpu_top_entity_generics"><code>CPU_DEBUG_PARK_ADDR</code></a> CPU generic. By default, this address is set to <code>dm_park_entry_c</code>,
which is defined in the main package file. If an exception is encountered during debug mode, the CPU jumps to the
address of the <strong>exception entry point</strong> configured via the <a href="#_cpu_top_entity_generics"><code>CPU_DEBUG_EXC_ADDR</code></a> CPU
generic. By default, this address is set to <code>dm_exc_entry_c</code>, which is also defined in the main package file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_status_register">Status Register</h5>
<div class="paragraph">
<p>The status register provides a direct communication channel between a CPU executing the park loop and the
debugger-controlled DM. This register is used to communicate <strong>requests</strong> which are issued by the DM, and
the according <strong>acknowledges</strong> which are issued by a CPU core.</p>
</div>
<div class="paragraph">
<p>From the CPU side the register is accessed using byte-wide load and store operations. Each of the four bytes
is associated to a specific request when read or to an according acknowledge when written.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/diag-wavedrom-md5-f58a7ed296d2b2b6dab7b476b2ef296f.svg" alt="Diagram" width="800" height="70">
</div>
<div class="title">Figure 20. DM Status Register Layout</div>
</div>
<div class="paragraph">
<p>If the park-loop code of a CPU reads a non-zero value from <code>RES</code> then it is requested to resume operation.
If it reads a non-zero value from <code>EXE</code> then it is requested to execute the program buffer.
Accordingly, the park-loop code acknowledges these requests by writing <em>any</em> value (including zero) to the
according byte. The <code>HAT</code> and <code>EXC</code> bytes are used to acknowledge the external halt request and to indicate
that executing the program buffer has encountered an exception, respectively.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 120. DM Status Register (byte-wise access)</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 41.6666%;">
<col style="width: 41.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">CPU Read Access (Request)</th>
<th class="tableblock halign-center valign-top">CPU Write Access (Acknowledge)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>EXC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">CPU has encountered an exception</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>EXE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DM requests program buffer execution</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">CPU has started to execute program buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>RES</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DM requests resuming</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">CPU has started to resume</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HLT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">CPU has halted</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the SMP <a href="#_dual_core_configuration">Dual-Core Configuration</a> all cores use the same request/acknowledge communication mechanism
by reading and writing the DM status register. The CPU-specific requests and acknowledges can still be clearly
assigned, as the CPU <a href="#_bus_interface">Bus Interface</a> implicitly transmits the ID of the accessing CPU core. Therefore, CPU
core <em>i</em> only sees the requests intended for it and can only set the acknowledges originating from itself when
accessing the DM status register.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_debug_authentication">5.5. Debug Authentication</h3>
<div class="paragraph">
<p>Optionally, the on-chip debugger DM can be equipped with an <em>authenticator module</em> to secure debugger access. This authentication
is enabled by the <a href="#_processor_top_entity_generics"><code>OCD_AUTHENTICATION</code></a> top generic. When disabled, the debugger is always
authorized and has unlimited access. When enabled, the debugger is required to authenticate in order to gain access.</p>
</div>
<div class="paragraph">
<p>The authenticator module is implemented as individual RTL module (<code>rtl/core/neorv32_debug_auth.vhd</code>). By default, it implements
a very simple authentication mechanism. Note that this default mechanism is not secure in any way - it is intended as example
logic to illustrate the interface and authentication process. Users can modify the default logic or replace the entire module
to implement a more sophisticated custom authentication mechanism.</p>
</div>
<div class="paragraph">
<p>The authentication interface is compliant to the RISC-V debug spec and is based on a single CSR and two additional status bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_authdata"><strong><code>authdata</code></strong></a> CSR: this 32-bit register is used to read/write data from/to the authentication module. It is hardwired to
all-zero if authentication is not implemented.</p>
</li>
<li>
<p><a href="#_dmstatus"><strong><code>dmstatus</code></strong></a> CSR:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>authenticated</code> bit (read-only) is set if authentication was successful. The debugger can access the processor only
if this bit is set. It is automatically hardwired to <code>1</code> (always authenticated) if the authentication module is not implemented.</p>
</li>
<li>
<p>The <code>authbusy</code> bit (read-only) indicates if the authentication module is busy. When set, no data should be written/read to/from
<a href="#_authdata"><strong><code>authdata</code></strong></a>. This bit is automatically hardwired to <code>0</code> (never busy) if the authentication module is not implemented.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>openOCD provides dedicated commands to exchange data with the authenticator module:</p>
</div>
<div class="listingblock">
<div class="title">Listing 35. openOCD RISC-V Authentication Commands</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">riscv authdata_read        // read 32-bit from authdata CSR
riscv authdata_write value // write 32-bit value to authdata CSR</code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on these two primitives arbitrary complex authentication mechanism can be implemented.</p>
</div>
<div class="sect3">
<h4 id="_default_authentication_mechanism">5.5.1. Default Authentication Mechanism</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The default authentication mechanism is not secure at all. Replace it by a custom design.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default authenticator hardware implements a very simple authentication mechanism: a single read/write bit is implemented
that directly corresponds to the <code>authenticated</code> bit in <a href="#_dmstatus"><strong><code>dmstatus</code></strong></a>. This bit can be read/written as bit zero (LSB) of the
<a href="#_authdata"><strong><code>authdata</code></strong></a> CSR. Writing 1 to this register will result in a successful authentication.</p>
</div>
<div class="paragraph">
<p>The default openOCD configuration script provides a helper script for authentication. This script also provides
several helper functions for interaction with the RISC-V debug mechanism. Additionally, the default authentication
mechanism is implemented there (as example):</p>
</div>
<div class="listingblock">
<div class="title">Listing 36. Default authentication process (<code>sw/openocd/authentication.cfg</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl"># read challenge
set CHALLENGE [authenticator_read]
# compute response (default authenticator module)
set RESPONSE [expr {$CHALLENGE | 1}]
# send response
authenticator_write $RESPONSE
# success?
authenticator_check</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_debug_mode">5.6. CPU Debug Mode</h3>
<div class="paragraph">
<p>The NEORV32 CPU Debug Mode is compatible to the <strong>Minimal RISC-V Debug Specification 1.0</strong> <code>Sdext</code> (external debug)
ISA extension. When enabled via the CPU&#8217;s <a href="#_sdext_isa_extension"><code>Sdext</code> ISA Extension</a> generic and/or the processor&#8217;s <code>OCD_EN</code> it adds
a new CPU operation mode ("debug mode"), three additional <a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a> and one additional instruction
(<code>dret</code>) to the core.</p>
</div>
<div class="paragraph">
<p>Debug-mode is entered on any of the following events:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The CPU executes an <code>ebreak</code> instruction (when in machine-mode and <code>ebreakm</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> is set OR when in user-mode and <code>ebreaku</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> is set).</p>
</li>
<li>
<p>A debug halt request is issued by the DM (via CPU <code>db_halt_req_i</code> signal, high-active).</p>
</li>
<li>
<p>The CPU completes executing of a single instruction while being in single-step debugging mode (<code>step</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> is set).</p>
</li>
<li>
<p>A hardware trigger from the <a href="#_trigger_module">Trigger Module</a> fires (if <code>exe</code> in <a href="#_tdata1"><strong><code>tdata1</code></strong></a> / <code>mcontrol</code> is set).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
From a hardware point of view these debug-mode-entry conditions are normal traps (synchronous exceptions or
asynchronous interrupts) that are handled transparently by the control logic.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Whenever the CPU enters debug-mode it performs the following operations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>wake-up CPU if it was send to sleep mode by the <code>wfi</code> instruction</p>
</li>
<li>
<p>switch to debug-mode privilege level</p>
</li>
<li>
<p>move the current program counter to <a href="#_dpc"><strong><code>dpc</code></strong></a></p>
</li>
<li>
<p>copy the hart&#8217;s current privilege level to the <code>prv</code> flags in <a href="#_dcsr"><strong><code>dcsr</code></strong></a></p>
</li>
<li>
<p>set <code>cause</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> according to the cause why debug mode is entered</p>
</li>
<li>
<p><strong>no update</strong> of <code>mtval</code>, <code>mcause</code>, <code>mtval</code> and <code>mstatus[h]</code> CSRs</p>
</li>
<li>
<p>load the address configured via the CPU&#8217;s (<a href="#_cpu_top_entity_generics"><code>CPU_DEBUG_PARK_ADDR</code></a>) generic to the program counter jumping to the
"debugger park loop" code stored in the debug module (DM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>When the CPU is in debug-mode:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>while in debug mode, the CPU executes the parking loop and - if requested by the DM - the program buffer</p>
</li>
<li>
<p>effective CPU privilege level is <code>machine</code> mode; any active physical memory protection (PMP) configuration is bypassed</p>
</li>
<li>
<p>the <code>wfi</code> instruction acts as a <code>nop</code> (also during single-stepping)</p>
</li>
<li>
<p>if an exception occurs while being in debug mode:</p>
<div class="ulist">
<ul>
<li>
<p>if the exception was caused by any debug-mode entry action the CPU jumps to the normal entry point (defined by the
<a href="#_cpu_top_entity_generics"><code>CPU_DEBUG_PARK_ADDR</code></a> generic) of the park loop again (for example when executing <code>ebreak</code> while in debug-mode)</p>
</li>
<li>
<p>for all other exception sources the CPU jumps to the exception entry point (defined by the <a href="#_cpu_top_entity_generics"><code>CPU_DEBUG_EXC_ADDR</code></a> generic)
to signal an exception to the DM; the CPU restarts the park loop again afterwards</p>
</li>
</ul>
</div>
</li>
<li>
<p>interrupts are disabled; however, they will remain pending and will get executed after the CPU has left debug mode and is not being single-stepped</p>
</li>
<li>
<p>if the DM makes a resume request, the park loop exits and the CPU leaves debug mode (executing <code>dret</code>)</p>
</li>
<li>
<p>the standard counters <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> <code>[m]cycle[h]</code> and <code>[m]instret[h]</code> are stopped</p>
</li>
<li>
<p>all <a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a> are stopped</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debug mode is left either by executing the <code>dret</code> instruction or by performing a hardware reset of the CPU.
Executing <code>dret</code> outside of debug mode will raise an illegal instruction exception.</p>
</div>
<div class="paragraph">
<p><strong>Whenever the CPU leaves debug mode it performs the following operations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the hart&#8217;s current privilege level according to the <code>prv</code> flags of <a href="#_dcsr"><strong><code>dcsr</code></strong></a></p>
</li>
<li>
<p>restore the original program counter from <a href="#_dpc"><strong><code>dpc</code></strong></a> resuming normal operation</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_cpu_debug_mode_csrs">5.6.1. CPU Debug Mode CSRs</h4>
<div class="paragraph">
<p>Two additional CSRs are required by the "Minimal RISC-V Debug Specification": the debug mode control and status register
<code>dcsr</code> and the debug program counter <code>dpc</code>. An additional general purpose scratch register for debug-mode-only
(<code>dscratch0</code>) allows faster execution by having a fast-accessible backup register. These CSRs are only accessible if the CPU
is in debug mode. If these CSRs are accessed outside of debug mode an illegal instruction exception is raised.</p>
</div>
<div class="sect4">
<h5 id="_dcsr"><strong><code>dcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x40000410</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This register is used to configure the debug mode environment and provides additional status information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 121. Debug control and status register <code>dcsr</code> bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>xdebugver</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0100</code>: CPU debug mode is compatible to spec. version 1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>000000000000</code>: <em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>machine</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: hypervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaks</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: supervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaku</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>user</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stepie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: IRQs are disabled during single-stepping</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stopcount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: standard counters and HPMs are stopped when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stoptime</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: timers increment as usual</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cause</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause identifier: why debug mode was entered (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: <em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mprven</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: <code>mprv</code> in <a href="#_mstatus"><strong><code>mstatus</code></strong></a> is also evaluated when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nmip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: non-maskable interrupt is pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>step</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable single-stepping when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>prv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU privilege level before/after debug mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Cause codes in <code>dcsr.cause</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>010</code> - triggered by hardware <a href="#_trigger_module">Trigger Module</a></p>
</li>
<li>
<p><code>001</code> - executed <code>EBREAK</code> instruction</p>
</li>
<li>
<p><code>011</code> - external halt request (from DM)</p>
</li>
<li>
<p><code>100</code> - return from single-stepping</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_dpc"><strong><code>dpc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The register is used to store the current program counter when debug mode is entered. The <code>dret</code> instruction will
return to the address stored in <code>dpc</code> by automatically moving <code>dpc</code> to the program counter.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dpc[0]</code> is hardwired to zero. If <code>IALIGN</code> = 32 (i.e. <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> is disabled) then <code>dpc[1]</code> is also hardwired to zero.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_dscratch0"><strong><code>dscratch0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug scratch register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The register provides a general purpose debug mode-only scratch register.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trigger_module">5.7. Trigger Module</h3>
<div class="paragraph">
<p>The RISC-V <code>Sdtrig</code> ISA extension adds a <em>trigger module</em> to the CPU core. The number of hardware triggers is configured
via the <a href="#_processor_top_entity_generics"><code>OCD_NUM_HW_TRIGGERS</code></a> top generic. Up to 16 hardware triggers can be implemented.
If <code>OCD_NUM_HW_TRIGGERS</code> is set to a value greater than 0 the <a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a> is automatically enabled. The trigger
module implements a subset of the features described in the "RISC-V Debug Specification / Trigger Module (<code>Sdtrig</code>)" and
complies to version v1.0 of that spec. Note that the NEORV32 trigger module only supports "type 6 - instruction address match"
triggers. These triggers can be used as hardware-assisted breakpoints or as hardware-assisted watchpoints.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>breakpoint</strong> stops the program whenever a particular point in the program is reached (i.e. after executing the
instruction at the specified address): GDB&#8217;s <code>hbreak</code> command.</p>
</li>
<li>
<p>A <strong>watchpoint</strong> stops the program whenever the value of a variable or expression changes (i.e. after a load and/or
store operation has accessed data at the specified address): GDB&#8217;s <code>[a|r]watch</code> commands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From a hardware point of view the trigger modules raises an <em>asynchronous</em> exception right after the triggering
operation has been retired. The <a href="#_dpc"><strong><code>dpc</code></strong></a> CSR shows the instruction address where normal execution must be resumed
to preserve the program flow</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Debug-Mode Only</div>
The trigger module can be used by debug-mode only. Write accesses from machine-mode are
constrained as <a href="#_tdata1"><strong><code>tdata1</code></strong></a>.<code>dmode</code> is hardwired to one. However, the <a href="#_smpmp_isa_extension"><code>Smpmp</code> ISA Extension</a>
can be used for machine-mode instruction or data address traps.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_trigger_module_csrs">5.7.1. Trigger Module CSRs</h4>
<div class="paragraph">
<p>The <code>Sdtrig</code> ISA extension adds 4 additional CSRs. These CSRs can also be read from machine-mode, but
write-accesses are restricted as <code>tdata1.dmode</code> is hardwired to one.</p>
</div>
<div class="sect4">
<h5 id="_tselect"><strong><code>tselect</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger select register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This CSR is used to select which hardware trigger is available via the <a href="#_tdata1"><strong><code>tdata1</code></strong></a>, <a href="#_tdata2"><strong><code>tdata2</code></strong></a> and
<a href="#_tinfo"><strong><code>tinfo</code></strong></a> CSRs. Only the lowest <code>log2(OCD_NUM_HW_TRIGGERS)+1</code> bit are writable. However, software should check if
<a href="#_tinfo"><strong><code>tinfo</code></strong></a> is non-zero for the written <code>tselect</code> value to determine if the selected trigger exists.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata1"><strong><code>tdata1</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 1, visible as trigger "type 6 match control" (<code>mcontrol6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x60000048</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This CSR provides access to the configuration bits of the currently selected trigger (via <a href="#_tselect"><strong><code>tselect</code></strong></a>).
Note that only "type 6" triggers are supported. The according configuration bits are listed below.
Write accesses from machine-mode are ignored (because <code>tdata1.dmode</code> is hardwired to one).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 122. Match control CSR (<code>tdata1</code>) bits of the trigger selected via <code>tselect</code></caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0110</code>: address match trigger type 6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmode</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'1': ignore write accesses to <a href="#_tdata1"><strong><code>tdata1</code></strong></a> and <a href="#_tdata2"><strong><code>tdata2</code></strong></a> from machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>uncertain</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: trigger satisfies the configured conditions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hit1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <code>hit0</code> bit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>vs</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: VS-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>vu</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: VU-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hit0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hit1</code> (MSB) and <code>hit0</code> (LSB) combine into a single 2-bit field; this field is set to
<code>0b11</code> when the trigger just fired; timing: the trigger fires <strong>immediately after</strong> the instruction that triggered has retired,
but before any subsequent instructions were executed; the debugger has to write zeros to acknowledge the firing trigger</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>select</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: only address matching is supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20:19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00</code>: hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>000</code>: match accesses of any size</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>action</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>: enter debug-mode on trigger match</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>chain</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: chaining is not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>match</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000</code>: equal-match only</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: trigger enabled when in machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>uncertainen</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: feature not supported, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>: S-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger enabled when in user-mode, set if <code>U</code> ISA extension is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>execute</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to enable this trigger to fire on instruction address match (i.e. "breakpoint")</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>store</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to enable this trigger to fire on data store address match (i.e. "watchpoint")</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>load</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to enable this trigger to fire on data load address match (i.e. "watchpoint")</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata2"><strong><code>tdata2</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This CSR provides access to the address bits (instruction address for breakpoints;
data access address for watchpoints) of the currently selected trigger (via <a href="#_tselect"><strong><code>tselect</code></strong></a>).
Write accesses from machine-mode are ignored (because <code>tdata1.dmode</code> is hardwired to one).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tinfo"><strong><code>tinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger information register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x01000040</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CSR shows additional trigger information of the currently selected trigger (via <a href="#_tselect"><strong><code>tselect</code></strong></a>).
This CSR is read-only, all write access is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 123. Trigger info CSR (<code>tinfo</code>) bits of the trigger selected via <code>tselect</code></caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x01</code>: compatible to <code>Sdtrig</code> spec. version v1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code>: hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>info</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0040</code>: only "type 6" (= bit 6 set) trigger is supported; for invalid value of
<a href="#_tselect"><strong><code>tselect</code></strong></a> this bit-field read as <code>0x0001</code> ("type 0" = none)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">6. Legal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_about">About</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The NEORV32 RISC-V Processor</strong><br>
<a href="https://github.com/stnolting/neorv32" class="bare">https://github.com/stnolting/neorv32</a><br>
Stephan Nolting, M.Sc.<br>
stnolting[t]gmail[dot]com<br>
<span class="image"><img src="https://img.shields.io/badge/European%20Union%20-Germany-000000.svg?longCache=true&amp;style=flat-square&amp;logo=europeanunion&amp;colorA=003399&amp;colorB=000000" alt="European%20Union%20 Germany 000000"></span></p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">DOI</div>
This project provides a <em>digital object identifier</em> provided by <a href="https://zenodo.org">zenodo</a>:
<a href="https://doi.org/10.5281/zenodo.5018888"><span class="image"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5018888.svg" alt="zenodo.5018888" title="zenodo"></span></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p><strong>BSD 3-Clause License</strong></p>
</div>
<div class="paragraph">
<p>Copyright (c) NEORV32 contributors.<br>
Copyright (c) 2020 - 2026, Stephan Nolting. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that
the following conditions are met:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior written permission.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">SPDX Identifier</div>
<code>SPDX-License-Identifier: BSD-3-Clause</code>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_proprietary_notice">Proprietary Notice</h3>
<div class="ulist">
<ul>
<li>
<p>"GitHub" is a subsidiary of Microsoft Corporation.</p>
</li>
<li>
<p>"Vivado" and "Artix" are trademarks of AMD Inc.</p>
</li>
<li>
<p>"ARM", "AMBA", "AXI", "AXI4", "AXI4-Lite" and "AXI4-Stream" are trademarks of Arm Holdings plc.</p>
</li>
<li>
<p>"ModelSim" is a trademark of Mentor Graphics  A Siemens Business.</p>
</li>
<li>
<p>"Quartus [Prime]" and "Cyclone" are trademarks of Intel Corporation.</p>
</li>
<li>
<p>"iCE40", "UltraPlus" and "Radiant" are trademarks of Lattice Semiconductor Corporation.</p>
</li>
<li>
<p>"GateMate" is a trademark of Cologne Chip AG.</p>
</li>
<li>
<p>"Windows" is a trademark of Microsoft Corporation.</p>
</li>
<li>
<p>"Tera Term" copyright by T. Teranishi.</p>
</li>
<li>
<p>"NeoPixel" is a trademark of Adafruit Industries.</p>
</li>
<li>
<p>"Segger Embedded Studio" and "J-Link" are trademarks of Segger Microcontroller Systems GmbH.</p>
</li>
<li>
<p>Images/figures made with <em>Microsoft Power Point</em>.</p>
</li>
<li>
<p>Diagrams made with <em>WaveDrom</em>.</p>
</li>
<li>
<p>Documentation made with <code>asciidoctor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All further/unreferenced projects/products/brands belong to their according copyright holders.
No copyright infringement intended.</p>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimer">Disclaimer</h3>
<div class="paragraph">
<p>This project is released under the BSD 3-Clause license. NO COPYRIGHT INFRINGEMENT INTENDED.
Other implied or used projects/sources might have different licensing  see their according
documentation for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitation_of_liability_for_external_links">Limitation of Liability for External Links</h3>
<div class="paragraph">
<p>This document contains links to the websites of third parties ("external links"). As the content of these websites
is not under our control, we cannot assume any liability for such external content. In all cases, the provider of
information of the linked websites is liable for the content and accuracy of the information provided. At the
point in time when the links were placed, no infringements of the law were recognizable to us. As soon as an
infringement of the law becomes known to us, we will immediately remove the link in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p><strong>A big shout-out to the community and all the <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a>,
who helped improving this project! This project would not be where it is without them. </strong></p>
</div>
<div class="paragraph">
<p><a href="https://riscv.org">RISC-V</a> - instruction sets want to be free!</p>
</div>
<div class="paragraph">
<p>Continuous integration provided by <a href="https://github.com/features/actions">GitHub Actions</a>
and powered by <a href="https://github.com/ghdl/ghdl">GHDL</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.12.8-r19-g31297d61<br>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>